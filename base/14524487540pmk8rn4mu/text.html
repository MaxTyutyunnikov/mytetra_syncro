<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:10pt; font-weight:400; font-style:normal;">
<p style=" margin-top:40px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:xx-large; font-weight:600;">Введение в использование mod_rewrite</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В данном уроке объясняется, что такое <span style=" font-style:italic;">mod_rewrite</span> и как его использовать. Описываются три практичных примера: перенаправление 301, создание дружественных URL и блокирование использования ссылок на изображения.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">mod_rewrite - это замечательный модуль веб сервера Apache. Он очень гибкий и может выполнять много полезных функций. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Использование mod_rewrite может представлять определенные трудности для новичков по причине сложного синтаксиса и механизма обработки. Однако, стоит разобраться в нескольких базовых концепциях и можно будет эффективно использовать mod_rewrite для собственного сервера.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В данном уроке мы научимся создавать несколько базовых правил mod_rewrite на реальных примерах, которые можно будет использовать для собственного сайта. Рекомендуется тщательно изучить <a href="http://ru.wikipedia.org/wiki/%D0%A0%D0%B5%D0%B3%D1%83%D0%BB%D1%8F%D1%80%D0%BD%D1%8B%D0%B5_%D0%B2%D1%8B%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F"><span style=" text-decoration: underline; color:#0000ff;">материал о регулярных выражениях</span></a>, если вы еще не знаете что это такое. </p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Что такое mod_rewrite?</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">mod_rewrite - это модуль сервера Apache для манипуляции (изменения) URL. Часто это означает получение запроса URL от посетителя и посылка ему содержания с другого URL. Например, посетитель вводит следующий URL в адресной строке браузера:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="highlighter_259499"></a><span style=" font-family:'Courier New,courier';">1</span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.example.com/page.html"><span style=" font-family:'Courier New,courier'; text-decoration: underline; color:#0000ff;">http://www.example.com/page.html</span></a></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обычно Apache отправляет обратно пользователю содержание файла <span style=" font-family:'Courier New,courier';">page.html</span>. Однако с помощью mod_rewrite можно отправить содержание с другого URL, например такого: </p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="highlighter_89285"></a><span style=" font-family:'Courier New,courier';">1</span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.example.com/another_page.html"><span style=" font-family:'Courier New,courier'; text-decoration: underline; color:#0000ff;">http://www.example.com/another_page.html</span></a></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Важно понимать, что изменение адреса происходит внутри сервера Apache. Адресная строка браузера по прежнему будет показывать <span style=" font-family:'Courier New,courier';">http://www.example.com/page.html</span>, но сервер Apache отправит содержание страницы <span style=" font-family:'Courier New,courier';">http://www.example.com/another_page.html</span>. В этом заключается отличие от перенаправления HTTP, которое указывает браузеру посетить другой URL.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Хотя с помощью модуля mod_rewrite можно выполнять и перенаправление HTTP и еще много других функций, таких как возвращение кодов  ошибки HTTP.</p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Что можно делать с помощью mod_rewrite</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Модуль mod_rewrite позволяет создавать правила манипулирования адресами URL. Например, вы можете вставить значение полученное из запрашиваемого URL в новый URL, организуя динамическое перенаправление URL. Или можно проверить переменные сервера, например, HTTP_USER_AGENT (тип браузера), и изменять URL только если используется браузер, например, Safari, запущенный на iPhone.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вот несколько обычных функций, которые выполняет mod_rewrite:</p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Создание &quot;дружественных&quot; адресов URL, которые маскируют &quot;корявые&quot; адреса URL.</span> Например, вы можете маскировать с помощью отлично выглядящего адреса URL <span style=" font-family:'Courier New,courier';">www.example.com/articles/my-article/</span> реальный адрес URL <span style=" font-family:'Courier New,courier';">www.example.com/display_article.php?articleId=my-article</span>. И каждый сможет использовать &quot;дружественный&quot; адрес URL вместо реального.</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Блокировать использование ссылок на изображения на вашем сайте.</span> Чтобы остановить использование другими ресурсами изображений, размещенных на вашем сайте, можно использовать mod_rewrite для отправки ошибки &quot;Forbidden&quot;, если ссылающийся URL не принадлежит вашему сайту.</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Перенаправление канонических адресов URL.</span> Многие страницы доступны через несколько адресов URL — например, <span style=" font-family:'Courier New,courier';">www.example.com/mypage.html</span> и <span style=" font-family:'Courier New,courier';">example.com/mypage.html</span>. Вы можете использовать mod_rewrite постоянного перенаправления браузера  на &quot;правильный&quot; URL, например <span style=" font-family:'Courier New,courier';">www.example.com/mypage.html</span>. Помимо прочего такое использование mod_rewrite гарантирует отображение правильного URL в результатат поиска.</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Исключение ошибки 404 в момент реорганизации вашего сайта.</span> Например, вы переделываете сайт и переместили страницу <span style=" font-family:'Courier New,courier';">www.example.com/myarticle.html</span> по новому адресу <span style=" font-family:'Courier New,courier';">www.example.com/articles/myarticle.html</span>. С помощью mod_rewrite вы можете перенаправить <span style=" font-family:'Courier New,courier';">www.example.com/myarticle.html</span> на <span style=" font-family:'Courier New,courier';">www.example.com/articles/myarticle.html</span> , так что  посетитель не получит ошибку 404 &quot;не найдена&quot; при посещении старого адреса URL. Благодаря гибкости mod_rewrite, можно легко создать правило, которое будет перенаправлять запросы на старые адреса URL на новые адреса.</li></ul>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Как использовать mod_rewrite</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для использования mod_rewrite, нужно создать директивы Apache для указания модулю, что нужно делать. <span style=" font-style:italic;">Директивы - </span>это простые конфигурационные установки. Часто директивы размещаются в файле <span style=" font-family:'Courier New,courier';">.htaccess</span> в корневой папке вашего веб сайта. Директивы применяются для всего сайта.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Две самых важных директивы mod_rewrite:</p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-weight:600;">RewriteEngine</span>: Включает/выключает механизм mod_rewrite для текущего запроса.</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-weight:600;">RewriteRule</span>: Описывает правило изменения адреса URL.</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вот простой пример. Создайте файл <span style=" font-family:'Courier New,courier';">.htaccess</span> со следующим содержанием и разместите его на вашем сайте:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="highlighter_708390"></a><span style=" font-family:'Courier New,courier';">1</span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteEngine on</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">2</span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteRule ^dummy\.html$ </span><a href="http://www.google.com/"><span style=" font-family:'Courier New,courier'; text-decoration: underline; color:#0000ff;">http://www.google.com/</span></a><span style=" font-family:'Courier New,courier';"> [R=301]</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В данном файле задаются следующие установки:</p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteEngine on </span>- включаем механизм mod_rewrite</li>
<li style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteRule ^dummy\.html$ http://www.google.com/ [R=301] - </span>перенаправялем запросы к странице <span style=" font-family:'Courier New,courier';">dummy.html </span>на сайт Google, используя перенаправление 301.</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если теперь открыть веб-браузер и посетить страницу <span style=" font-family:'Courier New,courier';">dummy.html </span>на вашем сайте (например, введя в адресной строке <span style=" font-family:'Courier New,courier';">http://www.example.com/dummy.html</span>), то , если все было сделано без ошибок, произойдет перенаправление на сайт <span style=" font-family:'Courier New,courier';">http://www.google.com</span>.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> Если вы получаете ошибку 404, то вероятно на вашем хостинге  не используется mod_rewrite. В данном случае надо обратиться к администратору хостинга.</p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Как работает </span><span style=" font-family:'Courier New,courier'; font-size:large; font-weight:600;">RewriteRule</span><span style=" font-size:large; font-weight:600;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вы можете использовать директиву <span style=" font-family:'Courier New,courier';">RewriteRule</span> для создания правил перенаправления. Обобщенный синтаксис директивы имеет вид:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="highlighter_260930"></a><span style=" font-family:'Courier New,courier';">1</span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteRule Pattern Substitution [Optional Flags]</span></p></td></tr></table>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-weight:600; font-style:italic;">Pattern</span> - регулярное выражение шаблона. Если URL соответствует шаблону, то правило выполняется. Иначе правило пропускается.</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-weight:600; font-style:italic;">Substitution</span> - новый URL, который будет использоваться вместо соответствующего шаблону адреса.</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-weight:600; font-style:italic;">[Optional Flags]</span> - один или несколько флагов, которые определяют поведение правила.</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вы можете добавить в файл <span style=" font-family:'Courier New,courier';">.htaccess</span> столько правил <span style=" font-family:'Courier New,courier';">RewriteRule</span>, сколько нужно. Модуль mod_rewrite проходит все правила каждый раз при запросе, обрабатывая соответствующие адресу URL.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если правило изменяет запрашиваемый URL на новый адрес, то новый URL используется дальше при проходе по файлу <span style=" font-family:'Courier New,courier';">.htaccess</span>, и может соответствовать другому правилу <span style=" font-family:'Courier New,courier';">RewriteRule</span>, размещающемуся далее в файле. (Если нужно изменить такое поведение, то надо использовать флаг <span style=" font-family:'Courier New,courier';">L</span> (&quot;последнее правило&quot;).)</p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Несколько примеров использования mod_rewrite</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Самый простой способ объяснить mod_rewrite - показать его использование при решении практических задач.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; font-weight:600;">Пример 1: исключение ошибки 404</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Иногда происходит изменение URL страницы на вашем сайте. Такое может произойти в момент реорганизации содержания. Если поисковый механизм или другие сайты ссылаются на старый адрес URL, то пользователь получит ошибку &quot;404 Not Found&quot;, когда он попробует воспользоваться ссылкой.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для решения данной проблемы вы можете использовать модуль mod_rewrite для перенаправления 301. Таким образом заголовок HTTP отсылается любому браузеру, запросившему старый адрес URL, сообщая ему о том, что страница перемещена по новому адресу. Также поисковые механизмы информируются о том, что надо обновить индексы с новым адресом URL.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Следующий файл <span style=" font-family:'Courier New,courier';">.htaccess</span> перенаправит запросы на новый адрес URL:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="highlighter_918955"></a><span style=" font-family:'Courier New,courier';">1</span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteEngine on</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">2</span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteRule ^my-old-url\.html$ /my-new-url.html [R=301,L]</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Правило <span style=" font-family:'Courier New,courier';">RewriteRule</span> работает так:</p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">^my-old-url\.html$ </span>- регулярное выражение, которому соответствует адрес URL для изменения. Шаблон означает: &quot;соответствует началу адреса URL (<span style=" font-family:'Courier New,courier';">^</span>), за которым следует текст <span style=" font-family:'Courier New,courier';">'my-old-url.html'</span>, за которым следует символ окончания URL  (<span style=" font-family:'Courier New,courier';">$</span>).&quot; В регулярном выражении символ точки (.) означает соответствие любому символу, поэтому нужно использовать обратный слэш, чтобы указать, что нам нужна именно точка (\.). </li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">/my-new-url.html - </span>вторая часть правила <span style=" font-family:'Courier New,courier';">RewriteRule</span>, которая описывает  на что нужно менять. В данном случае это просто <span style=" font-family:'Courier New,courier';">/my-new-url.html.</span></li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[R=301,L]</span>третья часть правила, которая содержит один или несколько флагов, помещенных в квадратные скобки. Флаги позволяют добавлять определенные опции или действия к правилу. В данном примере используется 2 флага: <span style=" font-family:'Courier New,courier';">R=301</span> означает &quot;использовать перенаправление 301 на новый адрес URL&quot;; а <span style=" font-family:'Courier New,courier';">L </span>означает &quot;последнее правило&quot;, или другими словами &quot;остановить процесс обработки URL, если он соответствует правилу &quot;.</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; font-weight:600;">Пример 2: создание дружественных адресов URL</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Допустим, вы  написали PHP скрипт <span style=" font-family:'Courier New,courier';">display_article.php</span> для вывода статей на вашем сайте. Вы можете ссылаться на статью с помощью следующего адреса URL:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="highlighter_798320"></a><span style=" font-family:'Courier New,courier';">1</span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.example.com/display_article.php?articleId=my-article"><span style=" font-family:'Courier New,courier'; text-decoration: underline; color:#0000ff;">http://www.example.com/display_article.php?articleId=my-article</span></a></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Данный адрес выглядит уродливо и запрос внутри него (<span style=" font-family:'Courier New,courier';">?articleId=my-article</span>) может смущать некоторые поисковые механизмы. Гораздо лучше использовать адрес  URL  такого вида:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="highlighter_341512"></a><span style=" font-family:'Courier New,courier';">1</span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.example.com/articles/my-article/"><span style=" font-family:'Courier New,courier'; text-decoration: underline; color:#0000ff;">http://www.example.com/articles/my-article/</span></a></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вы можете задействовать mod_rewrite для преобразования ссылок первого формата во второй, что даст возможность использовать дружественные ссылки на страницах сайта, а обращение будет выполняться к реальным адресам, не видимым никому. Для этого файл <span style=" font-family:'Courier New,courier';">.htaccess</span>, расположенный в корневой директории вашего сайта, должен содержать следующие строки:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="highlighter_538066"></a><span style=" font-family:'Courier New,courier';">1</span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteEngine on</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">2</span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteRule ^articles/([^/]+)/?$ display_article.php?articleId=$1 [L]</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Описание правила <span style=" font-family:'Courier New,courier';">RewriteRule</span>:</p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">^articles/([^/]+)/?$ - </span>регулярное выражение, соответствующее любому URL в формате <span style=" font-family:'Courier New,courier';">articles/(article ID)/</span>. Оно гласит:&quot;соответствует началу URL (<span style=" font-family:'Courier New,courier';">^</span>) , за которым следует текст <span style=" font-family:'Courier New,courier';">articles/</span>, за которым следует один или более символов, не являющиеся слэшем <span style=" font-family:'Courier New,courier';">([^/]+)</span>, за которыми может следовать слэш <span style=" font-family:'Courier New,courier';">(/?)</span>, за которым следует символ окончания URL <span style=" font-family:'Courier New,courier';">($)</span>&quot;. Обратите внимание на круглые скобки вокруг части шаблона <span style=" font-family:'Courier New,courier';">[^/]+</span>. Таким образом текст, соответствующей данной части, например, <span style=" font-family:'Courier New,courier';">&quot;my-article&quot;</span>, сохраняется для дальнейшего использования.</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">display_article.php?articleId=$1 - </span>данная часть правила указывает серверу Apache использовать скрипт <span style=" font-family:'Courier New,courier';">display_article.php</span> , которому передается текст, соответствующий подшаблону <span style=" font-family:'Courier New,courier';">[^/]+ </span>из регулярного выражения первой части (например, <span style=" font-family:'Courier New,courier';">&quot;my-article&quot;</span>), в качестве параметра <span style=" font-family:'Courier New,courier';">articleId</span>. <span style=" font-family:'Courier New,courier';">$1 </span>называется <span style=" font-style:italic;">обратной связью</span> и хранит текст соответствующий подшаблону. Если регулярное выражение содержит еще один подшаблон в круглых скобках, то соответствующий ему текст будет храниться в переменной <span style=" font-family:'Courier New,courier';">$2, </span>и так далее.</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">[L] - </span>как и в предыдущем примере мы используем флаг для остановки дальнейшей обработки URL, чтобы не произошло изменение адреса другими правилами <span style=" font-family:'Courier New,courier';">RewriteRule.</span></li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выше приведенное правило <span style=" font-family:'Courier New,courier';">RewriteRule</span> берет запрашиваемый URL в формате <span style=" font-family:'Courier New,courier';">http://www.example.com/articles/my-article/</span> и преобразует его в URL вида  <span style=" font-family:'Courier New,courier';">http://www.example.com/display_article.php?articleId=my-article</span>.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium; font-weight:600;">Пример 3: предотвращаем использование ссылок на изображения на вашем сайте</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Еще одной типовой задачей, которую решает использование модуля mod_rewrite, является предотвращение использования  ссылок на изображения на вашем сайте другими веб проектами. Допустим, на вашем сайте есть страница  <span style=" font-family:'Courier New,courier';">http://www.example.com/mypage.html</span>, которая содержит следующий тег <span style=" font-family:'Courier New,courier';">img</span>:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="highlighter_930846"></a><span style=" font-family:'Courier New,courier';">1</span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">&lt;img</span> <span style=" font-family:'Courier New,courier';">src=&quot;myphoto.jpg&quot;</span> <span style=" font-family:'Courier New,courier';">alt=&quot;Моя фотография&quot;</span> <span style=" font-family:'Courier New,courier';">/&gt;</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Другой сайт может ссылаться на своих страницах прямо на вашу фотографию следующим образом: </p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="highlighter_158630"></a><span style=" font-family:'Courier New,courier';">1</span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">&lt;img</span> <span style=" font-family:'Courier New,courier';">src=&quot;</span><a href="http://www.example.com/myphoto.jpg"><span style=" font-family:'Courier New,courier'; text-decoration: underline; color:#0000ff;">http://www.example.com/myphoto.jpg</span></a><span style=" font-family:'Courier New,courier';">&quot;</span> <span style=" font-family:'Courier New,courier';">alt=&quot;Моя фотография&quot;</span> <span style=" font-family:'Courier New,courier';">/&gt;</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Это означает, что чужой сайт не только &quot;заимствует&quot; ваше изображение, но использует часть трафика вашего сервера для отображения изображения на своих страницах. И если чужой сайт имеет большой поток посетителей, то такое положение станет проблемой!</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вы можете использовать следующие директивы mod_rewrite для того, чтобы прекратить использование ссылок на изображения всеми другими сайтами, кроме вашего собственного.  Разместите ниже приведенный код в файле <span style=" font-family:'Courier New,courier';">.htaccess</span> в корневом каталоге вашего сайта или в папке с изображениями, которые надо защитить. Измените <span style=" font-family:'Courier New,courier';">example.com</span> на имя вашего домена.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="highlighter_820255"></a><span style=" font-family:'Courier New,courier';">1</span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteEngine on</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">2</span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteCond %{HTTP_REFERER} !^$</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">3</span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteCond %{HTTP_REFERER} !^</span><a href="http://"><span style=" font-family:'Courier New,courier'; text-decoration: underline; color:#0000ff;">http://</span></a><span style=" font-family:'Courier New,courier';">(www\.)?example\.com/.*$ [NC]</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="2" cellpadding="0">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">4</span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteRule .+\.(gif|jpg|png)$ - [F]</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Как только вы закончите выполнять все операции копирования любой браузер , запрашивающий изображения с вашего сайта использующий при запросе URL, начинающийся с имени домена, отличного от  <span style=" font-family:'Courier New,courier';">www.example.com</span> или <span style=" font-family:'Courier New,courier';">example.com</span> , будет получать ошибку &quot;403 Forbidden&quot;. что остановит использование ссылок на ваши изображения на других сайтах.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вот как работает данный набор правил:</p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteEngine on - </span>включаем механизм mod_rewrite</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteCond %{HTTP_REFERER} !^$</span>- <span style=" font-family:'Courier New,courier';">RewriteCond </span>является еще одной директивой mod_rewrite. Она позволяет устанавливать условие, которое должно выполняться для обработки URL следующим за ним правилом <span style=" font-family:'Courier New,courier';">RewriteRule</span> . В данном случае условием является наличие значения в переменной <span style=" font-family:'Courier New,courier';">HTTP_REFERER</span>.</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteCond %{HTTP_REFERER} !^http://(www\.)?example\.com/.*$ [NC] - </span>вторая директива <span style=" font-family:'Courier New,courier';">RewriteCond</span>  требует, чтобы значение переменной <span style=" font-family:'Courier New,courier';">HTTP_REFERER </span>не начиналось с <span style=" font-family:'Courier New,courier';">http://www.example.com/</span> или <span style=" font-family:'Courier New,courier';">http://example.com/</span> . Флаг <span style=" font-family:'Courier New,courier';">[NC] </span>устанавливает чувствительность к регистру символов.</li>
<li style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">RewriteRule .+\.(gif|jpg|png)$ - [F] - </span>если два выше предыдущих условия <span style=" font-family:'Courier New,courier';">RewriteCond </span>не выполняются, то правило пропускается. Само же правило возвращает ошибку &quot;403 Forbidden&quot; (используется флаг <span style=" font-family:'Courier New,courier';">[F]</span>), если URL содержит имя файла изображения (строка заканчивается на <span style=" font-family:'Courier New,courier';">.gif</span>, <span style=" font-family:'Courier New,courier';">.jpg</span> или <span style=" font-family:'Courier New,courier';">.png</span>), Тире в параметре подстановки означает &quot;не надо заменять URL другим адресом&quot;.</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">То есть весь набор правил в файле <span style=" font-family:'Courier New,courier';">.htaccess </span>гласит, если переменная <span style=" font-family:'Courier New,courier';">HTTP_REFERER</span> содержит значение, и оно не начинается на <span style=" font-family:'Courier New,courier';">http://example.com/ </span>или <span style=" font-family:'Courier New,courier';">http://www.example.com/</span>, и запрашиваемый URL содержит имя файла изображения, то надо отказать запросу с ошибкой &quot;403 Forbidden&quot;.</p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:large; font-weight:600;">Заключение</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В данном уроке мы провели введение в использование модуля сервера Apache  mod_rewrite для манипулирования адресами URL. Рассмотренные три практических примера затрагивают лишь небольшую часть всех возможностей модуля. Более подробную информацию о mod-rewrite на русском языке можно найти <a href="http://www.opennet.ru/docs/RUS/mod_rewrite/"><span style=" text-decoration: underline; color:#0000ff;">здесь</span></a>. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="lessonPrepared"></a>Данный урок подготовлен для вас командой сайта <a href="http://ruseller.com"><span style=" text-decoration: underline; color:#0000ff;">ruseller.com</span></a><br />Источник урока: <a href="http://ruseller.com/www.elated.com/articles/mod-rewrite-tutorial-for-absolute-beginners/"><span style=" text-decoration: underline; color:#0000ff;">www.elated.com/articles/mod-rewrite-tutorial-for-absolute-beginners/</span></a><br />Перевел: Сергей Фастунов<br />Урок создан: 14 Октября 2010</p></body></html>