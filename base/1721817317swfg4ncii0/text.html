<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14pt; font-weight:600;">Путеводитель по Эльбрусу</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Автор: <span style=" font-family:'sans-serif'; font-size:12pt;">evm</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Следуя традициям многих замечательных туристических путеводителей, опубликованных в нашем прекрасном издании, давайте совершим волшебное путешествие по современной компьютерной архитектуре &quot;Эльбрус 2000&quot;, разработанной в матушке России.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14pt;">Что мы имеем</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Основные модели</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Elbrus-1S+, Elbrus-4S, Elbrus-85, Elbrus-8SV, Elbrus-16S</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Архитектура</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Фон Нейман</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Очень широкое командное слово (VLIW)</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Управление регистровым окном (32-разрядные базовые регистры)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">Регистры</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">g0-g31: Глобальные регистры</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">r0-r17: Универсальные (оконные) регистры</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">bO-b7: Регистр наложения окна</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Pred0-Pred31: Регистры логических предикатов</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">Адресное пространство</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">64-разрядная виртуальная адресация</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Неизвестная нам физическая карта памяти</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:14pt;">Предыстория и история</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">&quot;Эльбрус&quot; - это российская архитектура процессоров, которая в той или иной форме существует уже более 40 лет. Все началось в Институте точной механики и вычислительной техники им. Лебедева. Это был первый суперскалярный процессор с </span><span style=" font-family:'sans-serif'; font-size:12pt;">out-of-order</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> исполнением, разработанный в Советском Союзе (когда &quot;Эльбрус-1&quot; дебютировал в 1979 году). В 1990 году архитектура Elbrus 3 была расширена до архитектуры с очень длинными инструкциями (VLIW). После полной интеграции в качестве микропроцессорной архитектуры в 2001 году (ранее в предыдущих версиях использовалось много дискретных микросхем), архитектура стала известна как Elbrus 2000 (сокращенно E2K). &quot;Эльбрус&quot; разработан в России, но в настоящее время производится компанией TSMC на Тайване из-за нехватки российских производственных мощностей, способных производить чипы на передовых технологических нормах. </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; vertical-align:super;">48</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">В начале 90-х годов из Института Лебедева было выделено акционерное общество &quot;Московский центр SPARC технологий&quot; (сокращенно - МЦСТ). В настоящее время МЦСТ производит новые чипы &quot;Эльбрус&quot; для ПК, ноутбуков и серверов на базе &quot;Эльбруса&quot;. В настоящее время Elbrus-8S и 8SV являются самыми современными моделями процессоров (восьмиядерные версии для серверов и настольных компьютеров), а также доступны более дешевые 1S+ (одноядерные). Обратите внимание на транслитерацию с кириллицы, где названия моделей выглядят как Эльбрус-8S, Эльбрус-8CB и Эльбрус-1C+ соответственно. Как ни странно, процессоры 8S примерно в три раза медленнее аналогичных процессоров Intel, </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; vertical-align:super;">49</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> но преимущество Эльбруса в том, что это полностью отечественный процессор российского производства. Сообщается, что российские военные заказали тысячи ноутбуков в защищенном исполнении на базе Эльбрус-1S+ </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; vertical-align:super;">50</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">, хотя нет никаких указаний на то, что этот заказ когда-либо был доставлен.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">В настоящее время существует очень мало общедоступной документации по Elbrus, поскольку MCST контролирует большую часть документации в соответствии с соглашениями о неразглашении. Это означает, что у нас нет полной документации по процессору, как это обычно бывает с коммерческими процессорами.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<hr />
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Стр. 46</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">A Tourist’s Guide to Эльбрус</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'sans-serif'; font-size:12pt;">by evm</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'sans-serif'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'sans-serif'; font-size:12pt;">In the tradition of the many high quality tourist guides that have appeared in this fine publication, let’s take a magical tour around Russia’s modern computer architecture, the Elbrus 2000. </span><span style=" font-family:'sans-serif'; font-size:12pt; vertical-align:super;">45 46 47</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'sans-serif'; font-size:12pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">At A Glance</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">CommonM odels</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Elbrus-1S+, Elbrus-4S, Elbrus-85, Elbrus-8SV, Elbrus-16S</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Architecture</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Von Neumann</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Very Long Instruction Word</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Register Windowing (32-bit Base Registers)</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Registers</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">g0-g31: Global Registers</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">r0-r17: General Purpose (Windowed)</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">bO-b7: Overlay Register within Window</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Pred0-Pred31: Boolean Predicate Registers</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Address Space</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">64bit Virtual Addressing</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Unknown Physical Memory Map</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Background &amp; History</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'sans-serif'; font-size:12pt;">Elbrus is a Russian CPU architecture that has been around in some form for over 40 years. It started at Lebedev Institute of Precision Mechanics and Computer Engineering. It was the first superscalar, out-of-order execution processor developed in the Soviet Union (when the Elbrus 1 debuted in 1979). The architecture was extended to be a very long instruction word (VLIW) architecture with Elbrus 3 in 1990. Once fully integrated as a microprocessor architecture in 2001 (previous versions had used many discrete chips), the architecture became known as Elbrus 2000, or E2K for short. Elbrus is designed in Russia but currently manufactured by TSMC in Taiwan because of a lack of Russian production facilities capable of producing chips at advanced technology nodes. </span><span style=" font-family:'sans-serif'; font-size:12pt; vertical-align:super;">48</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'sans-serif'; font-size:12pt;">In the early ’90s, the Lebedev Institute spun off a joint stock company called the Moscow Center of SPARC Technologies (now shortened to just MCST). MCST currently produces new Elbrus chips and Elbrus-based PCs, laptops, and servers. Elbrus-8S and 8SV are the current top-of-the-line processor models (eight core versions for servers and desktops), and a lower-cost 1S+ (single core) is available as well. Note the transliteration from Cyrillic where the model names appear as Эльбрус-8С, Эльбрус-8СB, and Эльбрус-1C+, respectively. Anecdotally, the 8S CPUs are about three times slower than a comparable Intel CPU, </span><span style=" font-family:'sans-serif'; font-size:12pt; vertical-align:super;">49</span><span style=" font-family:'sans-serif'; font-size:12pt;"> but the draw of Elbrus is that it’s a fully domestically designed Russian processor. The Russian military has reportedly ordered thousands of ruggedized laptops based on the Elbrus-1S+, </span><span style=" font-family:'sans-serif'; font-size:12pt; vertical-align:super;">50</span><span style=" font-family:'sans-serif'; font-size:12pt;"> although there is no indication that the order was ever delivered.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'sans-serif'; font-size:12pt;">There is currently very little public documentation on Elbrus because MCST controls most documentation under nondisclosure agreements. This means we don’t have full processor documentation like we normally would for a commercial CPU.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:12pt;">45 </span><span style=" font-family:'sans-serif'; font-size:12pt;">Travis Goodspeed and Ryan Speers, “A Tourist’s Phrasebook for Reversing Embedded ARM in the Dialect of the CortexM Series,” PoC</span><span style=" font-family:'monospace'; font-size:12pt;">∥</span><span style=" font-family:'sans-serif'; font-size:12pt;">GTFO 11:6</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:12pt;">46 </span><span style=" font-family:'sans-serif'; font-size:12pt;">Ryan Speers and Travis Goodspeed, “A Tourist’s Phrasebook for Reversing MSP430,” PoC</span><span style=" font-family:'monospace'; font-size:12pt;">∥</span><span style=" font-family:'sans-serif'; font-size:12pt;">GTFO 11:08</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:12pt;">47 </span><span style=" font-family:'sans-serif'; font-size:12pt;">Chris Hewitt, “A Tourist’s Guide to Altera NIOS,” PoC</span><span style=" font-family:'monospace'; font-size:12pt;">∥</span><span style=" font-family:'sans-serif'; font-size:12pt;">GTFO 21:7</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:12pt;">48 </span><span style=" font-family:'sans-serif'; font-size:12pt;">Ian Cutress, “Russia’s Elbrus 8CB Microarchitecture: 8-core VLIW on TSMC 28nm,” AnandTech, June 1, 2020.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:12pt;">49 </span><span style=" font-family:'sans-serif'; font-size:12pt;">Anton Shilov, “Russian-Made Elbrus CPUs Fail Trials, ‘A Completely Unacceptable Platform’,” Tom’s Hardware, December 24, 2021.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:12pt;">50 </span><span style=" font-family:'sans-serif'; font-size:12pt;">Inna Sidorkova, “Цены на военные ноутбуки достигли Эльбруса.” July 9, 2018, RBC.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'sans-serif'; font-size:12pt;"><br /></p>
<hr />
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'sans-serif'; font-size:12pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'sans-serif'; font-size:12pt;">Стр 48</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'sans-serif'; font-size:12pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'sans-serif'; font-size:12pt;">Реклама</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'sans-serif'; font-size:12pt;"><br /></p>
<hr />
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'sans-serif'; font-size:12pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'sans-serif'; font-size:12pt;">Стр. 49</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'sans-serif'; font-size:12pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'sans-serif'; font-size:12pt;">We used three sources of information for this article: (1) a Russian guide to Elbrus programming and optimization published by MCST,51 (2) source code published by the OpenE2K group (a hobbyist group seemingly unrelated to MCST), and (3) leaked Linux kernel source code.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'sans-serif'; font-size:12pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'sans-serif'; font-size:12pt;">MCST is currently on the US sanctions list but thanks to the Reverend and friends we had access to an Elbrus-1S+ machine and used it to play around with some code examples. Our Elbrus was running a version of Linux made by MCST, but other Russian Linux distros are also available for Elbrus (e.g., Astra Linux). The Elbrus machine has a compiler called lcc, which is the MCST compiler based on gcc. It produces standard Linux ELF binary files. The options for disassembly at the moment are limited to ldis, which is part of lcc, and objdump, which is part of the binutils package put out by the OpenE2K group. ldis produces cleaner output, including resolution of symbol names, while objdump has a debug flag in the build that will prefix the output with the decoded instructions in hex. Anecdotally, ldis seems to miss some things (e.g., not disassemble all functions), although that could be due to operator error. </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'sans-serif'; font-size:12pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'sans-serif'; font-size:12pt;">In order to explore the Elbrus instruction set we updated rix’s Smashing C++ VPTRs from Phrack 56:8. That is a whole story for a another day, but you will find my code examples and the corresponding Elbrus disassembly attached to this PDF. </span><span style=" font-family:'sans-serif'; font-size:12pt; vertical-align:super;">52</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'sans-serif'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'sans-serif'; font-size:12pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'sans-serif'; font-size:12pt;">Basics of Instruction Set Decoding</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'sans-serif'; font-size:12pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'sans-serif'; font-size:12pt;">The first thing we needed to figure out was how the instruction format works since the official documentation left this topic out entirely. Fortunately</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">we found that the OpenE2K binutils release has</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">a preprocessor flag </span><span style=" font-family:'monospace'; font-size:12pt;">ENABLE_E2K_ENCODINGS</span><span style=" font-family:'sans-serif'; font-size:12pt;">, which</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">causes objdump to print out the instruction bytes</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">and their groupings.53 A version of objdump with</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">this flag was what we used to produce the disassem-</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">bly for most of this article.</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'sans-serif'; font-size:12pt;">In Elbrus documentation, the VLIW is called</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">a “wide command” (широкой командой). A wide</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">command contains multiple instructions, each of</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">which is targeted at individual execution units in</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">the CPU pipeline. The documentation variously</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">uses the terms “commands” (команд), “instructions”</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">(инструкций), and “operations” (операций) for the</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'sans-serif'; font-size:12pt;">component instructions within the instruction word.</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'sans-serif'; font-size:12pt;">The OpenE2K objdump code refers to the way</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">these component instructions are encoded as “sylla-</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">bles.” A nice feature of Elbrus is that the instruction</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">encoding is fairly simple when compared against</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">modern DSP architectures we’ve experienced. In-</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">struction counting is an exploitation task that can</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">be pretty complicated on some architectures, but</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">not Elbrus. It’s fairly simple to determine the</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">length of an instruction from the initial “HS” syl-</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">lable (shown on page 49).</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'sans-serif'; font-size:12pt;">The HS syllable determines the presence of the</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">other instruction syllables, which appear in a partic-</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">ular order. The order is: SS; ALU; CS0; ALES half</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">syllables 2 and 5; CS1; ALES half syllables 0, 1, 3,</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">and 4; AAS half syllables; a gap check; CDS; PLS;</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">and finally LTS (literals). Literal syllables (i.e., im-</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">mediate values) occur at the end of the syllables.</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">The OpenE2K objdump code looks for all of the</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">syllable presence flags above, reads them in order</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">(minding the possible gap), and then compares the</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">number of syllables read against the size field in HS.</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">Any extra syllables are read as literals. For syllables</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">that contain “half syllables” (i.e., 16-bit values), the</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">order of the syllables is flipped as they appear se-</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">quentially in memory.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'sans-serif'; font-size:12pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:12pt;">Byte order | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 |</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'monospace'; font-size:12pt;">---------------------------------</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'monospace'; font-size:12pt;">Half syllable order | 1 | 0 | 3 | 2 |</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">This makes more sense if you think about the</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">bytes being read in as 4-byte little-endian values.</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'monospace'; font-size:12pt;">Word order | 0 | 1 |</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'monospace'; font-size:12pt;">---------------------------------</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'monospace'; font-size:12pt;">Byte order | 3 | 2 | 1 | 0 | 7 | 6 | 5 | 4 |</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'monospace'; font-size:12pt;">---------------------------------</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'monospace'; font-size:12pt;">Half syllable order | 0 | 1 | 2 | 3 |</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">Register Set</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">Elbrus’s basic registers consist of 18 general-purpose</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">registers (</span><span style=" font-family:'monospace'; font-size:12pt;">r0</span><span style=" font-family:'sans-serif'; font-size:12pt;">–</span><span style=" font-family:'monospace'; font-size:12pt;">r17</span><span style=" font-family:'sans-serif'; font-size:12pt;">), 32 global registers (</span><span style=" font-family:'monospace'; font-size:12pt;">g0</span><span style=" font-family:'sans-serif'; font-size:12pt;">–</span><span style=" font-family:'monospace'; font-size:12pt;">g31</span><span style=" font-family:'sans-serif'; font-size:12pt;">), and</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">a sliding set of windowed registers (</span><span style=" font-family:'monospace'; font-size:12pt;">b0</span><span style=" font-family:'sans-serif'; font-size:12pt;">–</span><span style=" font-family:'monospace'; font-size:12pt;">b7</span><span style=" font-family:'sans-serif'; font-size:12pt;">). More</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">will be explained about the register windowing in</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">the next section. Registers are prefixed with an ac-</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">cess width, similar to x86.</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">For example, </span><span style=" font-family:'monospace'; font-size:12pt;">sr0 </span><span style=" font-family:'sans-serif'; font-size:12pt;">is single (32-bit) </span><span style=" font-family:'monospace'; font-size:12pt;">r0</span><span style=" font-family:'sans-serif'; font-size:12pt;">, and </span><span style=" font-family:'monospace'; font-size:12pt;">dr0 </span><span style=" font-family:'sans-serif'; font-size:12pt;">is</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">double (64-bit) </span><span style=" font-family:'monospace'; font-size:12pt;">r0</span><span style=" font-family:'sans-serif'; font-size:12pt;">, which is also the default. When</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">the registers are used with floating point values,</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'sans-serif'; font-size:12pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:12pt;">51 unzip pocorgtfo22.pdf elbrusprog.pdf</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'sans-serif'; font-size:12pt;">Murad Neumann-zadeh and Sergei Korolev, “Руководство по эффективному программированию на платформе «Эльбрус»”</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'monospace'; font-size:12pt;">52 unzip pocorgtfo22.pdf vptrs.zip</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></span><span style=" font-family:'monospace'; font-size:12pt;">53 git clone https://git.mentality.rip/OpenE2K/binutils-gdb.git</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:12pt;"><br /></p></body></html>