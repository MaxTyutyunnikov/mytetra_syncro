<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-1"></a><span style=" font-size:14px;">p</span><span style=" font-size:14px;">ackage</span><span style=" font-size:14px;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-2"></a><span style=" font-size:14px;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-3"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;"> </span><span style=" font-size:14px;">import Box2D.Collision.b2AABB;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-4"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;"> </span><span style=" font-size:14px;">import Box2D.Collision.Shapes.b2CircleShape;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-5"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;"> </span><span style=" font-size:14px;">import Box2D.Collision.Shapes.b2PolygonShape;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-6"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;"> </span><span style=" font-size:14px;">import Box2D.Collision.Shapes.b2Shape;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-7"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;"> </span><span style=" font-size:14px;">import Box2D.Common.Math.b2Vec2;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-8"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;"> </span><span style=" font-size:14px;">import Box2D.Dynamics.b2Body;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-9"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;"> </span><span style=" font-size:14px;">import Box2D.Dynamics.b2BodyDef;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-10"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;"> </span><span style=" font-size:14px;">import Box2D.Dynamics.b2DebugDraw;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-11"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;"> </span><span style=" font-size:14px;">import Box2D.Dynamics.b2Fixture;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-12"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;"> </span><span style=" font-size:14px;">import Box2D.Dynamics.b2FixtureDef;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-13"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;"> </span><span style=" font-size:14px;">import Box2D.Dynamics.b2World;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-14"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;"> </span><span style=" font-size:14px;">import Box2D.Dynamics.Joints.b2MouseJoint;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-15"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;"> </span><span style=" font-size:14px;">import Box2D.Dynamics.Joints.b2MouseJointDef;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-16"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;"> </span><span style=" font-size:14px;">import flash.display.DisplayObjectContainer;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-17"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;"> </span><span style=" font-size:14px;">import flash.display.Graphics;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-18"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;"> </span><span style=" font-size:14px;">import flash.display.Sprite;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-19"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;"> </span><span style=" font-size:14px;">import flash.events.Event;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-20"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;"> </span><span style=" font-size:14px;">import flash.events.KeyboardEvent;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-21"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;"> </span><span style=" font-size:14px;">import flash.events.MouseEvent;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-22"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;"> </span><span style=" font-size:14px;">import flash.ui.Keyboard;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-23"></a><span style=" font-size:14px;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-24"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;"> </span><span style=" font-size:14px;">/**</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-25"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">  * Для статьи &quot;Перемещение объектов мышкой в Box2DFlash&quot; cyber-code.ru</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-26"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">  * @author Monax</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-27"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">  */</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-28"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;"> </span><span style=" font-size:14px;">[Frame(factoryClass=&quot;Preloader&quot;)]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-29"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;"> </span><span style=" font-size:14px;">public class Main extends Sprite </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-30"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;"> </span><span style=" font-size:14px;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-31"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">private const PPM: Number = 30; // pixel per meter - множитель для перевода метров в пиксели</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-32"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">private const MPP: Number = 1 / 30; // meter per pixel - для перевода пикселей в метры</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-33"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">private const VelIters: int = 10;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-34"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">private const PosIters: int = 10;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-35"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">private var _world: b2World;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-36"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-37"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">private var _mJoint: b2MouseJoint;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-38"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-39"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-40"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">public function Main():void </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-41"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-42"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">if (stage) init() else addEventListener(Event.ADDED_TO_STAGE, init);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-43"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-44"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-45"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-46"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">//////////////////////////////////////////////////////////////////////////////////////////</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-47"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">//{ PRIVATE</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-48"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-49"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">private function init(e:Event = null):void </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-50"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-51"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">removeEventListener(Event.ADDED_TO_STAGE, init);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-52"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-53"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">createScene();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-54"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">addEventListener(Event.ENTER_FRAME, onEnterFrameHandler);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-55"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">stage.addEventListener(KeyboardEvent.KEY_DOWN, onKeyDownHandler);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-56"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-57"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">stage.addEventListener(MouseEvent.MOUSE_DOWN, onMouseDown);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-58"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">stage.addEventListener(MouseEvent.MOUSE_UP, onMouseUp);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-59"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-60"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-61"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">// создание всей сцены</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-62"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">private function createScene():void </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-63"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-64"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">// создание мира</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-65"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">var gv: b2Vec2 = new b2Vec2(0, 9.8);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-66"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">_world = new b2World(gv, true);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-67"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">// инициализация графики</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-68"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">initDebugDraw(this);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-69"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">// создание объектов</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-70"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">createWalls();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-71"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">createObjs(_world);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-72"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-73"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-74"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">// полное уничтожение всей сцены</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-75"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">private function destroyScene():void </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-76"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-77"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">// уничтожаем отображение</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-78"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">removeChildren();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-79"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">// уничтожаем все тела в мире</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-80"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">if (_world)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-81"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">for (var body: b2Body = _world.GetBodyList(); body; body = body.GetNext()) </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-82"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">         </span><span style=" font-size:14px;">if (body) _world.DestroyBody(body);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-83"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">// обнуляем переменную мира</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-84"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">_world = null;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-85"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-86"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-87"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">/**</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-88"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">    * Инициализация debug-отрисовки</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-89"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">    */</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-90"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">private function initDebugDraw(aDDParent: DisplayObjectContainer):void </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-91"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-92"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">// создаём специальный фон для дебаг отрисовки</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-93"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">// это необходимо, чтобы на этапе дебаг отрисовки срабатывали клики мыши например</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-94"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">var ddFon: Sprite = new Sprite();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-95"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">var gr: Graphics = ddFon.graphics;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-96"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">gr.lineStyle(0);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-97"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">gr.beginFill(0x333333, 1);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-98"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">gr.drawRect(-1000, -1000, 2000, 2000);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-99"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">aDDParent.addChild(ddFon);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-100"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">var ddDummy: Sprite = new Sprite();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-101"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">aDDParent.addChild(ddDummy);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-102"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">var debugDraw: b2DebugDraw = new b2DebugDraw();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-103"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">debugDraw.SetSprite(ddDummy);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-104"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">debugDraw.SetDrawScale(PPM);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-105"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">// указываем флаги - что необходимо отрисовывать</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-106"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">debugDraw.SetFlags(b2DebugDraw.e_controllerBit + b2DebugDraw.e_pairBit + b2DebugDraw.e_shapeBit + b2DebugDraw.e_jointBit);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-107"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">debugDraw.SetFillAlpha(0.5);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-108"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">_world.SetDebugDraw(debugDraw);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-109"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-110"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-111"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">// создание стен</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-112"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">private function createWalls():void </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-113"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-114"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">var body: b2Body;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-115"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">var bDef: b2BodyDef;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-116"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">var shape: b2Shape;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-117"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">// создание статического прямоугольника. которые будет в роли земли</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-118"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">bDef = new b2BodyDef();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-119"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">shape = b2PolygonShape.AsBox(640 * MPP / 2, 20 * MPP / 2);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-120"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">bDef.position.Set(640 / 2 * MPP, 480 * MPP);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-121"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">body = _world.CreateBody(bDef);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-122"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">body.CreateFixture2(shape);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-123"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">// левая стена</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-124"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">bDef = new b2BodyDef();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-125"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">shape = b2PolygonShape.AsBox(20 * MPP / 2, 480 * MPP / 2);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-126"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">bDef.position.Set(0, 480 * MPP / 2);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-127"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">body = _world.CreateBody(bDef);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-128"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">body.CreateFixture2(shape);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-129"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">// правая стена</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-130"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">bDef = new b2BodyDef();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-131"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">shape = b2PolygonShape.AsBox(20 * MPP / 2, 480 * MPP / 2);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-132"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">bDef.position.Set(640 * MPP, 480 * MPP / 2);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-133"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">body = _world.CreateBody(bDef);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-134"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">body.CreateFixture2(shape);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-135"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-136"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-137"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">// создание различных объектов</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-138"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">private function createObjs(aWorld: b2World):void </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-139"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-140"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">var i: int;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-141"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">var body: b2Body;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-142"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">var bDef: b2BodyDef;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-143"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">var fixDef: b2FixtureDef;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-144"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">// создаём круги</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-145"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">for (i = 0; i &lt; 10; i++) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-146"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">bDef = new b2BodyDef();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-147"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">bDef.type = b2Body.b2_dynamicBody;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-148"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">bDef.position.Set(Math.random() * 640 * MPP, Math.random() * 480 * MPP);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-149"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">body = aWorld.CreateBody(bDef);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-150"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">fixDef = new b2FixtureDef();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-151"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">fixDef.shape = new b2CircleShape(Math.random() + 0.2);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-152"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">fixDef.density = Math.random() + 0.2;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-153"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">body.CreateFixture(fixDef);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-154"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-155"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">// создаём прямоугольники</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-156"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">for (i = 0; i &lt; 10; i++) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-157"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">bDef = new b2BodyDef();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-158"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">bDef.type = b2Body.b2_dynamicBody;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-159"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">bDef.position.Set(Math.random() * 640 * MPP, Math.random() * 480 * MPP);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-160"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">body = aWorld.CreateBody(bDef);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-161"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">fixDef = new b2FixtureDef();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-162"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">fixDef.shape = b2PolygonShape.AsBox(Math.random() + 0.5, Math.random() + 0.4);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-163"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">fixDef.density = Math.random() + 0.2;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-164"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">body.CreateFixture(fixDef);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-165"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-166"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-167"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-168"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">// обновление мира</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-169"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">private function updateBox2D(aDTime: Number):void </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-170"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-171"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">if (_world) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-172"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">_world.Step(aDTime, VelIters, PosIters);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-173"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">_world.ClearForces();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-174"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">// дебаг рендер физики</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-175"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">_world.DrawDebugData();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-176"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-177"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-178"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-179"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">private function GetBodyAtMouse(includeStatic:Boolean = false): b2Body</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-180"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-181"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">var mXWorldPhys: Number = mouseX * MPP;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-182"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">var mYWorldPhys: Number = mouseY * MPP;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-183"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">var mousePVec: b2Vec2 = new b2Vec2(mXWorldPhys, mYWorldPhys);//записываем текущие координаты курсора</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-184"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">var aabb: b2AABB = new b2AABB(); // создаем прямоугольную область</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-185"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">aabb.lowerBound.Set(mXWorldPhys - 0.001, mYWorldPhys - 0.001); //вокруг курсора мыши</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-186"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">aabb.upperBound.Set(mXWorldPhys + 0.001, mYWorldPhys + 0.001);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-187"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">var body: b2Body = null;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-188"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">var fixture: b2Fixture;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-189"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">function GetBodyCallback(fixture:b2Fixture): Boolean </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-190"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-191"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">var shape:b2Shape = fixture.GetShape(); //получаем шейп который находится под курсором</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-192"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">// если тело не статическое</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-193"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">if (fixture.GetBody().GetType() != b2Body.b2_staticBody || includeStatic) { </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-194"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">         </span><span style=" font-size:14px;">// проверяем находится ли точка-позиция курсора в рамках тела</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-195"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">         </span><span style=" font-size:14px;">var inside: Boolean = shape.TestPoint(fixture.GetBody().GetTransform(), mousePVec);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-196"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">         </span><span style=" font-size:14px;">// если да</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-197"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">         </span><span style=" font-size:14px;">if (inside) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-198"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">           </span><span style=" font-size:14px;">body = fixture.GetBody(); //получаем ссылку на тело</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-199"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">           </span><span style=" font-size:14px;">return false;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-200"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">         </span><span style=" font-size:14px;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-201"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-202"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">return true;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-203"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-204"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">_world.QueryAABB(GetBodyCallback, aabb); //проверяем на попадание любых тел в область aabb</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-205"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">return body; //возвращаем тело</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-206"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-207"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-208"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">//} private</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-209"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-210"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-211"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">//////////////////////////////////////////////////////////////////////////////////////////</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-212"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">//{ EVENTS</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-213"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-214"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">private function onKeyDownHandler(e:KeyboardEvent):void </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-215"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-216"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">switch (e.keyCode) </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-217"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-218"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">case Keyboard.R: // пересоздаём сцену</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-219"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">           </span><span style=" font-size:14px;">destroyScene();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-220"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">           </span><span style=" font-size:14px;">createScene();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-221"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">           </span><span style=" font-size:14px;">break;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-222"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-223"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-224"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-225"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">private function onMouseDown(e:MouseEvent):void </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-226"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-227"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">// если соединение уже есть, то уничтожаем его</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-228"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">if (_mJoint)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-229"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">destroyCurrentJoint();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-230"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">// получаем тело под курсором</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-231"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">var body:b2Body = GetBodyAtMouse();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-232"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">if (body) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-233"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">var md:b2MouseJointDef = new b2MouseJointDef(); //создаем настройки соединения</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-234"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">md.bodyA = _world.GetGroundBody(); //один конец крепим к миру</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-235"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">md.bodyB = body; //другой к телу</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-236"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">md.target.Set(mouseX * MPP, mouseY * MPP); //соединение создается от курсора мыши</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-237"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">md.collideConnected = true;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-238"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">md.maxForce = 3000; //макс. сила которая может быть приложена к телу</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-239"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">_mJoint = _world.CreateJoint(md) as b2MouseJoint; //создаем соединение</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-240"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">body.SetAwake(true); //будим тело</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-241"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-242"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-243"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-244"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">private function destroyCurrentJoint():void </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-245"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-246"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">if (_mJoint)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-247"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">_world.DestroyJoint(_mJoint); // удаляем соединение</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-248"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">_mJoint = null;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-249"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-250"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-251"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">private function onMouseUp(e:MouseEvent):void </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-252"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-253"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">destroyCurrentJoint();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-254"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-255"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-256"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">private function onEnterFrameHandler(e:Event):void </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-257"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-258"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">updateBox2D(1 / stage.frameRate);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-259"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-260"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">if (_mJoint) { //если кнопка мыши нажата и соединение уже существует</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-261"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">var p2:b2Vec2 = new b2Vec2(mouseX * MPP, mouseY * MPP);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-262"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">       </span><span style=" font-size:14px;">_mJoint.SetTarget(p2); //перемещаем соединение за курсором мыши</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-263"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">     </span><span style=" font-size:14px;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-264"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-265"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-266"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span><span style=" font-size:14px;">//} events</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-267"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;">   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-268"></a><span style=" font-size:14px;"> </span><span style=" font-size:14px;"> </span><span style=" font-size:14px;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-269"></a><span style=" font-size:14px;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-5a1f1458e5064333656274-270"></a><span style=" font-size:14px;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:14px;"><br /></p></body></html>