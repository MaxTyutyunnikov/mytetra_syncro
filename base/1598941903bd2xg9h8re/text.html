<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Когда Роскомнадзор блокирует сайты по IP, <span style=" font-weight:600;">под блокировку могут попасть и другие, непричастные сайты</span>, которые находятся на том же хосте у провайдера хостинг-услуг. Такое, например, изредка случается с <a href="https://github.com"><span style=" text-decoration: underline; color:#0000ff;">GitHub</span></a>, если на его же IP-шниках крутится какое-нибудь американское казино.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для доступа к таким незаконно заблокированным сайтам проще всего использовать VPN. Но если VPN нет, то можно попытаться получить доступ напрямую. Все внешние сайты в России доступны по линиям, контролируемым Ростелекомом, поэтому действия по доступу к заблокированным внешним сайтам для любого внутреннего российского провайдера услуг Интернет будут одинаковыми.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">По информации на 2016 год</span>, Ростелеком использует пассивный DPI, т.е. он подключен параллельно, вероятно, пассивным оптическим сплиттером, из-за чего он не может перехватывать отправляемый пакет как таковой, а может только подделать ответ от имени веб-сайта, который перенаправит на страницу-заглушку. Также DPI отправляет перенаправление только с TCP-флагом ACK, хотя обычно используются флаги PSH, ACK. Размер TCP-заголовка тоже всегда равен 20 байтам. Зная эту информацию, для раблокировки сайта у себя на Linux-компьютере, можно написать следующие правила:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;"># iptables -t raw -A PREROUTING -p tcp --sport 80 -m u32 --u32 &quot;0x1E&amp;0xFFFF=0x5010 &amp;&amp; 0x60=0x7761726e &amp;&amp; 0x64=0x696e672e &amp;&amp; 0x68=0x72742e72&quot; -m comment --comment &quot;Rostelecom HTTP&quot; -j DROP</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;"># iptables -t raw -A PREROUTING -p tcp --sport 443 -m u32 --u32 &quot;4=0x00000000&amp;&amp;0x20=0x50140000&quot; -m comment --comment &quot;Rostelecom HTTPS&quot; -j DROP</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Правило iptables для HTTP проверяет TCP-флаги в пакете, пришедшем с 80 порта, его размер, и ищет строку «warning.rt.r» внутри пакета по заданному смещению (строка задается в 16-тиричном виде). Если все совпадает, то отбрасываем этот пакет, и получаем настоящий пакет от сайта.<br /><br />Для HTTPS, ростелекомовский DPI присылает Reset-пакет (флаги RST, ACK) с нулевым значением TCP-окна и нулями в IP Identification, flags и fragment offset. Такого в реальной жизни не случается, и мы можем отбрасывать все такие пакеты.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Информация взята из обсуждения на Habrahabr: <a href="https://habr.com/ru/post/356052/"><span style=" text-decoration: underline; color:#0000ff;">https://habr.com/ru/post/356052/</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>