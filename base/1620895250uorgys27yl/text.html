<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">C++ библиотека lexertl во многом лучше GNU Flex. Она умеет создавать лексические анализаторы из правил в runtime, может обрабатывать unicode, и даже умеет генерировать код сканера на C++. Библиотека header-only и очень проста в установке.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" font-style:italic; color:#323232;">Пример к статье </span><a href="https://github.com/BenHanson/lexertl"><span style=" font-style:italic; text-decoration: underline; color:#2a7ae2;">доступен на github</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Библиотека lexertl служит для разбора регулярных грамматик. Иными словами, с её помощью можно написать лексический анализатор (англ. lexer или scanner), который обработает входной текст и превратить его в поток токенов, который гораздо легче использовать в полноценном парсере.</span></p>
<h2 align="center" style=" margin-top:32px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><a name="wow0"></a><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">У</span><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">становка lexertl</span></h2>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">lexertl является header-only библиотекой для C++, и для установки достаточно</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px;">выкачать исходный код из </span><a href="https://github.com/BenHanson/lexertl"><span style=" font-size:18px; text-decoration: underline; color:#2a7ae2;">репозитория на github</span></a></li>
<li style=" color:#000000;" style=" margin-top:0px; margin-bottom:15px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px;">добавить путь к каталогу с исходным кодом в пути поиска заголовков</span></li></ul>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">После этих шагов создайте новый файл или проект на C++, добавьте туда простой пример кода и соберите:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#include &quot;lexertl/generator.hpp&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#include &quot;lexertl/lookup.hpp&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#include &lt;iostream&gt;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-weight:600; color:#999999; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#445588; background-color:#ffffff;">int</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#990000; background-color:#ffffff;">main</span><span style=" color:#000000; background-color:#ffffff;">()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    lexertl</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">rules rules;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    lexertl</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">state_machine sm;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    rules.push(</span><span style=" color:#dd1144; background-color:#ffffff;">&quot;[0-9]+&quot;</span><span style=" color:#000000; background-color:#ffffff;">, </span><span style=" color:#009999; background-color:#ffffff;">1</span><span style=" color:#000000; background-color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    rules.push(</span><span style=" color:#dd1144; background-color:#ffffff;">&quot;[a-z]+&quot;</span><span style=" color:#000000; background-color:#ffffff;">, </span><span style=" color:#009999; background-color:#ffffff;">2</span><span style=" color:#000000; background-color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    lexertl</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">generator</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">build(rules, sm);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">string input(</span><span style=" color:#dd1144; background-color:#ffffff;">&quot;abc012Ad3e4&quot;</span><span style=" color:#000000; background-color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    lexertl</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">smatch results(input.begin(), input.end());</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Read ahead</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    lexertl</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">lookup(sm, results);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">while</span><span style=" color:#000000; background-color:#ffffff;"> (results.id </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">!=</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#009999; background-color:#ffffff;">0</span><span style=" color:#000000; background-color:#ffffff;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">cout </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;&lt;</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#dd1144; background-color:#ffffff;">&quot;Id: &quot;</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;&lt;</span><span style=" color:#000000; background-color:#ffffff;"> results.id </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;&lt;</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#dd1144; background-color:#ffffff;">&quot;, Token: '&quot;</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;&lt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            results.str () </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;&lt;</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#dd1144; background-color:#ffffff;">&quot;'\n&quot;</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        lexertl</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">lookup(sm, results);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">return</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#009999; background-color:#ffffff;">0</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<h2 align="center" style=" margin-top:32px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><a name="wow1"></a><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">П</span><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">ишем сканер выражений калькулятора с lexertl</span></h2>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" font-style:italic; color:#323232;">У библиотеки есть Web-страница с документацией: </span><a href="http://www.benhanson.net/lexertl.html"><span style=" font-style:italic; text-decoration: underline; color:#2a7ae2;">www.benhanson.net/lexertl.html</span></a></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Представленная ниже программа выводит номера и строки токенов для входного выражения с идентификаторами и числами. Ввод читается построчно из stdin, для выхода из программы достаточно ввести символ конца файла.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">&gt;velocity + 27 * accel / 19</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">Id: 2, Token: 'velocity'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">Id: 3, Token: '+'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">Id: 1, Token: '27'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">Id: 5, Token: '*'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">Id: 2, Token: 'accel'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">Id: 6, Token: '/'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">Id: 1, Token: '19'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Библиотека состоит лишь из заголовочных файлов и не требует компоновки. Конечный автомат для лексического анализа может быть собран в runtime. Поэтому реализация состоит всего лишь из одного файла:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#include &quot;lexertl/generator.hpp&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#include &quot;lexertl/iterator.hpp&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#include &lt;boost/range/iterator_range.hpp&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#include &lt;iostream&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#include &lt;memory&gt;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-weight:600; color:#999999; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#000000; background-color:#ffffff;">enum</span><span style=" color:#000000; background-color:#ffffff;"> {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// ID пользовательских токенов должны начинаться с 1,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  т.к. число 0 lexertl резервирует для ID &quot;конец ввода&quot;.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Если один из ID равен нулю, программа аварийно завершится.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    TK_NUMBER </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#009999; background-color:#ffffff;">1</span><span style=" color:#000000; background-color:#ffffff;">,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    TK_IDENTIFIER,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    TK_PLUS,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    TK_MINUS,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    TK_MULTIPLY,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    TK_DIVIDE,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">};</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Создаёт детерминированный конечный автомат (DFA)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  для лексического анализа грамматики калькулятора</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">unique_ptr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;</span><span style=" color:#000000; background-color:#ffffff;">lexertl</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">state_machine</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&gt;</span><span style=" color:#000000; background-color:#ffffff;"> BuildCalcLexer()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    lexertl</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">rules rules;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Метод push добавляет правило</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    rules.push(</span><span style=" color:#dd1144; background-color:#ffffff;">&quot;[0-9]+&quot;</span><span style=" color:#000000; background-color:#ffffff;">, TK_NUMBER);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    rules.push(</span><span style=" color:#dd1144; background-color:#ffffff;">&quot;[a-z]+&quot;</span><span style=" color:#000000; background-color:#ffffff;">, TK_IDENTIFIER);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    rules.push(</span><span style=" color:#dd1144; background-color:#ffffff;">&quot;\\+&quot;</span><span style=" color:#000000; background-color:#ffffff;">, TK_PLUS);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    rules.push(</span><span style=" color:#dd1144; background-color:#ffffff;">&quot;\\-&quot;</span><span style=" color:#000000; background-color:#ffffff;">, TK_MINUS);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    rules.push(</span><span style=" color:#dd1144; background-color:#ffffff;">&quot;\\*&quot;</span><span style=" color:#000000; background-color:#ffffff;">, TK_MULTIPLY);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    rules.push(</span><span style=" color:#dd1144; background-color:#ffffff;">&quot;\\/&quot;</span><span style=" color:#000000; background-color:#ffffff;">, TK_DIVIDE);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Метод skip возвращает специальный ID,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  который означает, что это совпадение игнорируется.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Так мы можем пропустить пробельные символы.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    rules.push(</span><span style=" color:#dd1144; background-color:#ffffff;">&quot;[ \t\r\n]+&quot;</span><span style=" color:#000000; background-color:#ffffff;">, rules.skip());</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">auto</span><span style=" color:#000000; background-color:#ffffff;"> lexer </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">make_unique</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;</span><span style=" color:#000000; background-color:#ffffff;">lexertl</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">state_machine</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&gt;</span><span style=" color:#000000; background-color:#ffffff;">();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    lexertl</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">generator</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">build(rules, </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">lexer);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">return</span><span style=" color:#000000; background-color:#ffffff;"> lexer;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Возвращает диапазон для прохода слева направо,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  который при запросе следующего элемента</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  получает его из строки `line` с помощью лексера `lexer`</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#000000; background-color:#ffffff;">decltype</span><span style=" color:#000000; background-color:#ffffff;">(</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">auto</span><span style=" color:#000000; background-color:#ffffff;">) TokenizeLine(</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">const</span><span style=" color:#000000; background-color:#ffffff;"> lexertl</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">state_machine </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&amp;</span><span style=" color:#000000; background-color:#ffffff;">lexer, std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">string </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&amp;</span><span style=" color:#000000; background-color:#ffffff;">line)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    lexertl</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">siterator begin(line.begin(), line.end(), lexer);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    lexertl</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">siterator end;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Непосредственно при вызове токенизации не происходит,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  такой подход называется lazy evaluation with generators.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">return</span><span style=" color:#000000; background-color:#ffffff;"> boost</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">make_iterator_range(begin, end);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#445588; background-color:#ffffff;">int</span><span style=" color:#000000; background-color:#ffffff;"> main()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">auto</span><span style=" color:#000000; background-color:#ffffff;"> lexer </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> BuildCalcLexer();</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">while</span><span style=" color:#000000; background-color:#ffffff;"> (std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">cin)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">string line;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">getline(std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">cin, line);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">for</span><span style=" color:#000000; background-color:#ffffff;"> (</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">auto</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&amp;</span><span style=" color:#000000; background-color:#ffffff;">token </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">:</span><span style=" color:#000000; background-color:#ffffff;"> TokenizeLine(</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">lexer, line))</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">cout </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;&lt;</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#dd1144; background-color:#ffffff;">&quot;Id: &quot;</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;&lt;</span><span style=" color:#000000; background-color:#ffffff;"> token.id </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;&lt;</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#dd1144; background-color:#ffffff;">&quot;, Token: '&quot;</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;&lt;</span><span style=" color:#000000; background-color:#ffffff;"> token.str() </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;&lt;</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#dd1144; background-color:#ffffff;">&quot;'\n&quot;</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">return</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#009999; background-color:#ffffff;">0</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<h2 align="center" style=" margin-top:32px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><a name="wow2"></a><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">Г</span><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">енерация C++ кода</span></h2>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Можно легко модифицировать предыдущий пример, чтобы сгенерировать исходный код функции, реализующей лексический анализ той же самой регулярной грамматики. Полученный код по-прежнему использует библиотеку lexertl, но уже не требует конструирования лексера во время выполнения.</span></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Первым делом подключите два новых заголовка:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#include &quot;lexertl/generator.hpp&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#include &quot;lexertl/generate_cpp.hpp&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-weight:600; color:#999999; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Затем в функцию BuildCalcLexer после вызова</span><span style=" color:#000000;"> </span><span style=" color:#000000; background-color:#fefefe;">lexertl::generator::build</span><span style=" color:#000000;"> добавьте всего две строки кода:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Минимизируем детерминированный конечный автомат,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  это занимает немного времени, но взамен ускорит работу сканера.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">lexer</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">minimise();</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Генерируем table-driven лексер на C++,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// В качестве имени функции передаём LookupExprToken.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">lexertl</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">table_based_cpp</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">generate_cpp(</span><span style=" color:#dd1144; background-color:#ffffff;">&quot;LookupExprToken&quot;</span><span style=" color:#000000; background-color:#ffffff;">, </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">lexer, </span><span style=" color:#0086b3; background-color:#ffffff;">false</span><span style=" color:#000000; background-color:#ffffff;">, std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">cout);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Запустите изменённый пример, и при старте программа выведет в консоль C++ код функции lookupExprToken, который выглядит примерно так:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#000000; background-color:#ffffff;">template&lt;typename</span><span style=" color:#000000; background-color:#ffffff;"> iter_type, </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">typename</span><span style=" color:#000000; background-color:#ffffff;"> id_type</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> LookupExprToken (lexertl</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">match_results</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;</span><span style=" color:#000000; background-color:#ffffff;">iter_type, id_type</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&gt;</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&amp;</span><span style=" color:#000000; background-color:#ffffff;">results_)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// ...table-driven реализация разбора следующего токена...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Сгенерированный код можно поместить в файл “LookupExprToken.hpp”, и после этого для реализации лексера достаточно подключить заголовок и написать управляющую функцию. Полученная программа будет вести себя так же, как в предыдущем примере:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#include &quot;lexertl/iterator.hpp&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#include &quot;LookupExprToken.hpp&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-weight:600; color:#999999; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#445588; background-color:#ffffff;">int</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#990000; background-color:#ffffff;">main</span><span style=" color:#000000; background-color:#ffffff;">()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">while</span><span style=" color:#000000; background-color:#ffffff;"> (std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">cin)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">string line;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">getline(std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">cin, line);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Заполняем буфер состояния.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        lexertl</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">smatch results(line.begin(), line.end());</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Cчитываем первый токен</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        LookupExprToken(results);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">while</span><span style=" color:#000000; background-color:#ffffff;"> (results.id </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">!=</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#009999; background-color:#ffffff;">0</span><span style=" color:#000000; background-color:#ffffff;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">cout </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;&lt;</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#dd1144; background-color:#ffffff;">&quot;Id: &quot;</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;&lt;</span><span style=" color:#000000; background-color:#ffffff;"> results.id </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;&lt;</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#dd1144; background-color:#ffffff;">&quot;, Token: '&quot;</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;&lt;</span><span style=" color:#000000; background-color:#ffffff;"> results.str() </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;&lt;</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#dd1144; background-color:#ffffff;">&quot;'\n&quot;</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            LookupExprToken(results);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">return</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#009999; background-color:#ffffff;">0</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<h2 align="center" style=" margin-top:32px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><a name="wow3"></a><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">О</span><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">тладочный вывод структуры ДКА</span></h2>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Можно выполнить отладочную печать состояний и переходов созданного в lexertl ДКА.</span></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Во-первых нужно подключить ещё один заголовок:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#include &quot;lexertl/debug.hpp&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-weight:600; color:#999999; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Затем в функцию BuildCalcLexer после вызова</span><span style=" color:#000000;"> </span><span style=" color:#000000; background-color:#fefefe;">lexertl::generator::build</span><span style=" color:#000000;"> добавьте вызов отладочной печати:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Минимизируем детерминированный конечный автомат,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  это занимает немного времени, но взамен уменьшит объём таблицы.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">lexer</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">minimise();</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Выводим в stdout человекочитаемые таблицы состояний и переходов.</span></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">lexertl</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">debug</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">dump(</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">lexer, std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">cout);</span></p></body></html>