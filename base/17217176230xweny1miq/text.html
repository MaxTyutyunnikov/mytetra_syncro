<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">В Linux доступны разнообразные утилиты для вывода содержимого и анализа ELF-файлов (в том числе совместно используемых библиотек). Одна из самых полезных утилит – </span><span style=" font-family:'FreeMono'; color:#6a1009;">ldd</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">, которая выдает список библиотек, от которых зависит данный ELF-объект. Например, для последнего примера вывод команды </span><span style=" font-family:'FreeMono'; color:#6a1009;">ldd</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> будет выглядеть примерно так:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">mtj@camus:~/dl$ ldd fileWithDl</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">        linux-gate.so.1 =&gt;  (0xffffe000)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">        libdl.so.2 =&gt; /lib/tls/i686/cmov/libdl.so.2 (0xb7fdb000)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">        libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0xb7eac000)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">        /lib/ld-linux.so.2 (0xb7fe7000)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">mtj@camus:~/dl$</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Утилита </span><span style=" font-family:'FreeMono'; color:#6a1009;">ldd</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> сообщила нам, что ELF-файл </span><span style=" font-family:'FreeMono'; color:#6a1009;">fileWithDl</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> зависит от библиотек </span><span style=" font-family:'FreeMono'; color:#6a1009;">linux-gate.so</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> (специальный псевдофайл, который отвечает за обработку системных вызовов Linux и не находится на файловой системе), </span><span style=" font-family:'FreeMono'; color:#6a1009;">libdl.so</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> (API динамической загрузки), </span><span style=" font-family:'FreeMono'; color:#6a1009;">libc.so</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> (библиотека GNU C) и </span><span style=" font-family:'FreeMono'; color:#6a1009;">ld-linux.so.2</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> (динамический загрузчик Linux – он присутствует всегда, когда есть зависимости от совместно используемых библиотек).</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Понять и вывести содержимое ELF-файла поможет мощная команда </span><span style=" font-family:'FreeMono'; color:#6a1009;">readelf</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">. Одна из интересных возможностей этой команды – вывод списка перемещаемых элементов файла. Например, покажем, какие символы в нашей тестовой программе из </span><a href="mytetra://note/938"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">листинга 2</span></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> требуют перемещения:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">mtj@camus:~/dl$ readelf -r fileWithDl</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">Relocation section '.rel.dyn' at offset 0x520 contains 2 entries:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">(Раздел перемещения '.rel.dyn' со смещением 0x520 содержит 2 пункта:)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;"> Offset     Info    Type            Sym.Value  Sym. Name</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;"> (Смещение) (Инфо)  (Тип)           (Знач.симв.)(Имя симв.)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">08049a3c  00001806 R_386_GLOB_DAT    00000000   __gmon_start__</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">08049a78  00001405 R_386_COPY        08049a78   stdin</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">Relocation section '.rel.plt' at offset 0x530 contains 8 entries:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;"> Offset     Info    Type            Sym.Value  Sym. Name</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">08049a4c  00000207 R_386_JUMP_SLOT   00000000   dlsym</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">08049a50  00000607 R_386_JUMP_SLOT   00000000   fgets</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">08049a54  00000b07 R_386_JUMP_SLOT   00000000   dlerror</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">08049a58  00000c07 R_386_JUMP_SLOT   00000000   __libc_start_main</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">08049a5c  00000e07 R_386_JUMP_SLOT   00000000   printf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">08049a60  00001007 R_386_JUMP_SLOT   00000000   dlclose</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">08049a64  00001107 R_386_JUMP_SLOT   00000000   sscanf</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">08049a68  00001907 R_386_JUMP_SLOT   00000000   dlopen</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">mtj@camus:~/dl$</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Из этого списка видно, что перемещения требуют различные вызовы библиотек C (</span><span style=" font-family:'FreeMono'; color:#6a1009;">libc.so</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">), в том числе вызовы к </span><span style=" font-family:'FreeMono'; color:#6a1009;">libdl.so</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">. Обратите внимание на </span><span style=" font-family:'FreeMono'; color:#6a1009;">__libc_start_main</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">: это функция библиотеки C, которая вызывается перед </span><span style=" font-family:'FreeMono'; color:#6a1009;">main</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> и производит всю необходимую инициализацию.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Среди других утилит упомянем objdump, которая печатает сведения об объектных файлах, и </span><span style=" font-family:'FreeMono'; color:#6a1009;">nm</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">, служащую для вывода списка символов объектного файла (включая отладочную информацию). Кстати, можно запускать динамический компоновщик Linux прямо из командной строки, указав в параметре ELF-программу, которую требуется выполнить:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">mtj@camus:~/dl$ /lib/ld-linux.so.2 ./</span><span style=" font-family:'FreeMono'; color:#6a1009;">fileWithDl</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">&gt; libm.so expf 0.0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">  1.000000</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">&gt;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">В добавок, </span><span style=" font-family:'FreeMono'; color:#6a1009;">ld-linux.so</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> может выдать список зависимостей для ELF-файла – точно так же, как делает команда </span><span style=" font-family:'FreeMono'; color:#6a1009;">ldd</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">. Для этого существует опция </span><span style=" font-family:'FreeMono'; color:#6a1009;">--list</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">. Не забывайте, что </span><span style=" font-family:'FreeMono'; color:#6a1009;">ld-linux.so</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> является просто исполняемым приложением, которое в нужный момент запускается ядром.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p></body></html>