<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<h2 style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="analiz-i-izuchenie-faylov-elf-v-linux"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">А</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">нализ и изучение файлов ELF в Linux</span></h2>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Для ана­лиза ELF-фай­лов в Linux существует большой арсенал встро­енных инструментов и ути­лит:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">readelf</span> — ути­лита позволяет в удо­бочи­таемом виде отобразить всю информацию ELF-фай­лов;</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">hexdump</span> — позволяет просматривать файл в шес­тнад­цатерич­ном пред­став­лении;</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">strings</span> — может отобразить име­на всех импорти­руемых (или экспор­тиру­емых) фун­кций, а так­же биб­лиотек, из которых данные фун­кции импорти­рова­ны и еще мно­го другой полезной информации;</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">ldd</span> — поз­воля­ет выводить име­на раз­деля­емых биб­лиотек, из которых импорти­руют­ся те или иные фун­кции, исполь­зуемые иссле­дуемой прог­раммой;</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">nm</span> — позволяет получить информацию в виде таб­лицы имен из сос­тава отла­доч­ной информа­ции, которая добав­ляет­ся в ELF-фай­лы при их ком­пиляции (эта отла­доч­ная информа­ция с помощью коман­ды strip может быть уда­лена из фай­ла, и в этом слу­чае ути­лита nm ничем не поможет);</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">objdump</span> — спо­соб­на вывес­ти информа­цию и содер­жимое всех эле­мен­тов иссле­дуемо­го фай­ла, в том чис­ле и в дизас­сем­бли­рован­ном виде.</li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Часть перечис­ленно­го (кро­ме hexdump и ldd) вхо­дит в сос­тав пакета </span><a href="https://www.gnu.org/software/binutils/"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">GNU Binutils</span></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">. Если это­го пакета в тво­ей сис­теме нет, его лег­ко уста­новить. К при­меру, в Ubuntu это выг­лядит сле­дующим обра­зом: </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">sudo apt install binutils</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">В прин­ципе, имея все перечис­ленное, мож­но уже прис­тупать к ана­лизу и иссле­дова­нию ELF-фай­лов без прив­лечения допол­нитель­ных средств. Для боль­шего удобс­тва и наг­ляднос­ти мож­но добавить к нашему инс­тру­мен­тарию извес­тный в кру­гах реверс‑инже­неров дизас­сем­блер IDA в вер­сии Freeware (этой вер­сии для наших целей будет более чем дос­таточ­но, хотя ник­то не зап­реща­ет вос­поль­зовать­ся вер­сиями Home или Pro, если есть воз­можность за них зап­латить).</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1674200445h403m3vcqv.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="attachment_15450"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">А</span><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">на­лиз заголов­ка файл ELF в IDA</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Так­же неп­лохо было бы исполь­зовать вмес­то hexdump что‑то поудоб­нее, нап­ример 010 Editor или wxHex Editor. Пер­вый hex-редак­тор — дос­той­ная аль­тер­натива Hiew для Linux (в том чис­ле и бла­года­ря воз­можнос­ти исполь­зовать в нем боль­шое количес­тво шаб­лонов для раз­личных типов фай­лов, сре­ди них и шаб­лон для пар­синга ELF-фай­лов). Одна­ко он небес­плат­ный (сто­имость лицен­зии начина­ется с 49,95 дол­лара, при этом есть 30-днев­ный три­аль­ный пери­од).</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1674200489gnjgqlj1xq.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="attachment_15451"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">А</span><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">на­лиз заголов­ка файл ELF в 010 Editor </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Го­воря о допол­нитель­ных инс­тру­мен­тах, которые облегча­ют ана­лиз ELF-фай­лов, нель­зя не упо­мянуть Python-пакет lief. Исполь­зуя этот пакет, мож­но писать Python-скрип­ты для ана­лиза и модифи­кации не толь­ко ELF-фай­лов, но и фай­лов PE и MachO. Ска­чать и уста­новить этот пакет получит­ся тра­дици­онным для Python-пакетов спо­собом:<br />pip install lief</span></p>
<h2 style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="nashi-podopytnye"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">Н</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">аши подопытные</span></h2>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">В Linux (да и во мно­гих дру­гих сов­ремен­ных UNIX-подоб­ных опе­раци­онных сис­темах) фор­мат ELF исполь­зует­ся в нес­коль­ких типах фай­лов.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">Ис­полня­емый файл</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> — содер­жит все необ­ходимое для соз­дания сис­темой обра­за про­цес­са и запус­ка это­го про­цес­са. В общем слу­чае это инс­трук­ции и дан­ные. Так­же в фай­ле может при­сутс­тво­вать опи­сание необ­ходимых раз­деля­емых объ­ектных фай­лов, а так­же сим­воль­ная и отла­доч­ная информа­ция. Исполня­емый файл может быть позици­онно зависи­мым (в этом слу­чае он гру­зит­ся всег­да по одно­му и тому же адре­су, для 32-раз­рядных прог­рамм обыч­но это 0x8048000, для 64-раз­рядных — 0x400000) и позици­онно незави­симым исполня­емым фай­лом (PIE — Position Independent Execution или PIC — Position Independent Code). В этом слу­чае адрес заг­рузки фай­ла может менять­ся при каж­дой заг­рузке. При пос­тро­ении позици­онно незави­симо­го исполня­емо­го фай­ла исполь­зуют­ся такие же прин­ципы, как и при пос­тро­ении раз­деля­емых объ­ектных фай­лов.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">Пе­реме­щаемый файл</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> — содер­жит инс­трук­ции и дан­ные, при этом они могут быть ста­тичес­ки свя­заны с дру­гими объ­ектны­ми фай­лами, в резуль­тате чего получа­ется раз­деля­емый объ­ектный или исполня­емый файл. К это­му типу отно­сят­ся объ­ектные фай­лы ста­тичес­ких биб­лиотек (как пра­вило, для ста­тичес­ких биб­лиотек имя начина­ется с lib и при­меня­ется рас­ширение *.a), одна­ко, как мы уже говори­ли, рас­ширение в Linux прак­тичес­ки ничего не опре­деля­ет. В слу­чае ста­тичес­ких биб­лиотек это прос­то дань тра­диции, а работос­пособ­ность биб­лиоте­ки будет обес­печена с любым име­нем и любым рас­ширени­ем.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">Раз­деля­емый объ­ектный файл</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> — содер­жит инс­трук­ции и дан­ные, может быть свя­зан с дру­гими переме­щаемы­ми фай­лами или раз­деля­емы­ми объ­ектны­ми фай­лами, в резуль­тате чего будет соз­дан новый объ­ектный файл. Такие фай­лы могут выпол­нять фун­кции раз­деля­емых биб­лиотек (по ана­логии с DLL-биб­лиоте­ками Windows). При этом в момент запус­ка прог­раммы на выпол­нение опе­раци­онная сис­тема динами­чес­ки свя­зыва­ет эту раз­деля­емую биб­лиоте­ку с исполня­емым фай­лом прог­раммы, и соз­дает­ся исполня­емый образ при­ложе­ния. Опять же тра­дици­онно раз­деля­емые биб­лиоте­ки име­ют рас­ширение *.so (от англий­ско­го Shared Object).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">Ис­полня­емый файл</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> — файл, который содер­жит образ памяти того или ино­го про­цес­са на момент его завер­шения. В опре­делен­ных ситу­ациях ядро может соз­давать файл с обра­зом памяти ава­рий­но завер­шивше­гося про­цес­са. Этот файл так­же соз­дает­ся в фор­мате ELF, одна­ко мы о такого рода фай­лах говорить не будем, пос­коль­ку задача иссле­дова­ния дам­пов и содер­жимого памяти дос­таточ­но объ­емна и тре­бует отдель­ной статьи.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Для наших изыс­каний нам желатель­но иметь все воз­можные вари­анты исполня­емых фай­лов из перечис­ленных выше, чем мы сей­час и зай­мем­ся.</span></p>
<h3 style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="sozdanie-ispolnyaemogo-fayla"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">С</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">оздание исполняемого файла</span></h3>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Не будем выдумы­вать что‑то свер­хориги­наль­ное, а оста­новим­ся на клас­сичес­ком хел­ловор­лде на С:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<table border="0" style=" border-style:solid; margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" align="center" width="80%" cellspacing="-1" cellpadding="0" bgcolor="#ffffff">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22020886560696"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">5 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22020886560696-1"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">#</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">include </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22020886560696-2"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">i</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">nt main(int argc, char* argv[]) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22020886560696-3"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> printf(&quot;Hello world&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22020886560696-4"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> return 0;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22020886560696-5"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">}</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Ком­пилиро­вать это дело мы будем с помощью GCC. Сов­ремен­ные вер­сии Linux, как пра­вило, 64-раз­рядные, и вхо­дящие в их сос­тав по умол­чанию средс­тва раз­работ­ки (в том чис­ле и ком­пилятор GCC) генери­руют 64-раз­рядные при­ложе­ния. Мы в сво­их иссле­дова­ниях не будем отдель­но вни­кать в 32-раз­рядные ELF-фай­лы (по боль­шому сче­ту отли­чий от 64-раз­рядных ELF-фай­лов в них не очень мно­го) и основные уси­лия сос­редото­чим имен­но на 64-раз­рядных вер­сиях прог­рамм. Если у тебя воз­никнет желание поэк­спе­римен­тировать с 32-раз­рядны­ми фай­лами, то при ком­пиляции в GCC нуж­но добавить опцию -m32, при этом, воз­можно, пот­ребу­ется уста­новить биб­лиоте­ку gcc-multilib. Сде­лать это мож­но при­мер­но вот так:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<table border="0" style=" border-style:solid; margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" align="center" width="80%" cellspacing="-1" cellpadding="0" bgcolor="#ffffff">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22024852540292"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">1</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22024852540292-1"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">s</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">udo apt-get install gcc-multilib</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Итак, назовем наш хел­ловорлд </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">example.c</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> (кста­ти, здесь как раз один из нем­ногих слу­чаев, ког­да в Linux рас­ширение име­ет зна­чение) и нач­нем с исполня­емо­го позици­онно зависи­мого кода:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<table border="0" style=" border-style:solid; margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" align="center" width="80%" cellspacing="-1" cellpadding="0" bgcolor="#ffffff">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22026337324463"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">1</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22026337324463-1"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">g</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">cc -no-pie example.c -o example_no_pie</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Как ты уже догадал­ся, опция </span><a name="crayon-63ca3a4e22027382641810"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">-</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">no-pie как раз и говорит ком­пилято­ру соб­рать не позици­онно незави­симый код.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Во­обще, если говорить пра­виль­но, то GCC — это не сов­сем ком­пилятор. Это ком­плексная ути­лита, которая в зависи­мос­ти от рас­ширения вход­ного фай­ла и опций вызыва­ет нуж­ный ком­пилятор или ком­понов­щик с соот­ветс­тву­ющи­ми вход­ными дан­ными. При­чем из С или дру­гого высоко­уров­невого язы­ка сна­чала исходник тран­сли­рует­ся в ассем­блер­ный код, а уже затем все это окон­чатель­но пре­обра­зует­ся в объ­ектный код и собира­ется в нуж­ный нам ELF-файл.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">В целом мож­но выделить четыре эта­па работы GCC:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">преп­роцес­сирова­ние;</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">тран­сля­ция в ассем­блер­ный код;</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">пре­обра­зова­ние ассем­блер­ного кода в объ­ектный;</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">ком­понов­ка объ­ектно­го кода.</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Что­бы пос­мотреть на про­межу­точ­ный резуль­тат, к при­меру в виде ассем­блер­ного кода, исполь­зуй в GCC опцию </span><a name="crayon-63ca3a4e22028584828347"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">-</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">S:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<table border="0" style=" border-style:solid; margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" align="center" width="80%" cellspacing="-1" cellpadding="0" bgcolor="#ffffff">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e2202a990656711"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">1</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e2202a990656711-1"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">g</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">cc -S -masm=intel example.c</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Об­рати вни­мание на два момен­та. Пер­вый — мы в дан­ном слу­чае не зада­ем имя выход­ного фай­ла с помощью опции -o (GCC сам опре­делит его из исходно­го, добавив рас­ширение *.s, что и озна­чает при­сутс­твие в фай­ле ассем­блер­ного кода). Вто­рой момент — опция -masm=intel, которая говорит о том, что ассем­блер­ный код в выход­ном фай­ле необ­ходимо генери­ровать с исполь­зовани­ем син­такси­са Intel (по умол­чанию будет син­таксис AT&amp;T, мне же, как и, навер­ное, боль­шинс­тву, син­таксис Intel бли­же). Так­же в этом слу­чае опция -no-pie не име­ет смыс­ла, пос­коль­ку ассем­блер­ный код в любом слу­чае будет оди­нако­вый, а перено­симость обес­печива­ется на эта­пе получе­ния объ­ектно­го фай­ла и сбор­ки прог­раммы.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">На выходе получим файл example.s с таким вот содер­жимым (пол­ностью весь файл показы­вать не будем, что­бы не занимать мно­го мес­та):</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<table border="0" style=" border-style:solid; margin-top:0px; margin-bottom:0px; margin-left:-31px; margin-right:0px;" align="center" width="80%" cellspacing="-1" cellpadding="0" bgcolor="#ffffff">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e2202b211805889"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">5</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">6</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">7</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">9</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">10</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">11</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">12</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">13</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">14</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">15</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">16</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">17</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">18</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">19</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">20</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">21</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">22 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e2202b211805889-1"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">.</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">file &quot;example.c&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2202b211805889-2"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> .intel_syntax noprefix</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2202b211805889-3"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> .text</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2202b211805889-4"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> .section  .rodata</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2202b211805889-5"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">.</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">LC0:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2202b211805889-6"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> .string &quot;Hello world&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2202b211805889-7"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> .text</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2202b211805889-8"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> .globl  main</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2202b211805889-9"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> .type main, @function</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2202b211805889-10"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">m</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">ain:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2202b211805889-11"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">.</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">LFB0:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2202b211805889-12"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> .cfi_startproc</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2202b211805889-13"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> endbr64</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2202b211805889-14"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> push  rbp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2202b211805889-15"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> .cfi_def_cfa_offset 16</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2202b211805889-16"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> .cfi_offset 6, -16</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2202b211805889-17"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> mov rbp, rsp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2202b211805889-18"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> .cfi_def_cfa_register 6</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2202b211805889-19"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> lea rdi, .LC0[rip]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2202b211805889-20"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> call  puts@PLT</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2202b211805889-21"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> mov eax, 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2202b211805889-22"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> ...</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Об­рати вни­мание на стро­ку </span><a name="crayon-63ca3a4e2202c601021890"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">c</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">all puts@PLT — это вызов сиш­ной фун­кции </span><a name="crayon-63ca3a4e2202e467039621"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">p</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">uts(). Нес­мотря на то что в исходни­ке мы при­мени­ли фун­кцию </span><a name="crayon-63ca3a4e2202f571240998"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">p</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">rintf(), ком­пилятор самос­тоятель­но про­вел неболь­шую опти­миза­цию и заменил ее </span><a name="crayon-63ca3a4e22030079002034"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">p</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">uts(), пос­коль­ку в </span><a name="crayon-63ca3a4e22032477870017"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">p</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">rintf() мы не исполь­зовали какие‑либо спе­цифи­като­ры фор­матиро­вания вывода стро­ки, а </span><a name="crayon-63ca3a4e22033902532955"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">p</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">uts() работа­ет быс­трее, чем</span><span style=" color:#000000;"> </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">printf()</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">В целом поэтап­ная работа GCC при ком­пиляции фай­ла exmple.c пред­став­лена в виде схе­мы на рисунке.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image16742002381dptjv6r6w.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="attachment_15452"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">Э</span><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">та­пы про­цес­са ком­пиляции фай­ла example.c </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Ис­поль­зуя опции </span><a name="crayon-63ca3a4e22035887703132"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">-</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">E, </span><a name="crayon-63ca3a4e22036917924797"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">-</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">S и </span><a name="crayon-63ca3a4e22038869819706"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">-</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">c, мож­но оста­новить про­цесс ком­пиляции в нуж­ном мес­те и зафик­сировать резуль­тат каж­дого эта­па в виде выход­ного фай­ла.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Да­лее сде­лаем позици­онно незави­симый исполня­емый ELF-файл (здесь все прос­то и никаких допол­нитель­ных опций не нуж­но):</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<table border="0" style=" border-style:solid; margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" align="center" width="80%" cellspacing="-1" cellpadding="0" bgcolor="#ffffff">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22039200371361"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">1</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22039200371361-1"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">g</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">cc example.c -o example</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Так­же для раз­нооб­разия сто­ит написать хел­ловорлд на ассем­бле­ре с исполь­зовани­ем сис­темных вызовов Linux, а не фун­кций из сиш­ных биб­лиотек. Исполь­зуем для это­го Fasm. Сов­сем недав­но мы уже обра­щались к это­му язы­ку (прав­да, под Windows) и разоб­рались, что это такое. Сегод­ня при­меним получен­ные зна­ния в Linux. Для прос­тоты возь­мем при­мер прог­раммы hello64.asm, которая идет в ком­плек­те с</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<table border="0" style=" border-style:solid; margin-top:0px; margin-bottom:0px; margin-left:-31px; margin-right:0px;" align="center" width="80%" cellspacing="-1" cellpadding="0" bgcolor="#ffffff">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e2203a833147569"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">5</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">6</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">7</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">9</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">10</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">11</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">12</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">13</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">14</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">15 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e2203a833147569-1"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">F</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">asm:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2203a833147569-2"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">f</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">ormat ELF64 executable 3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2203a833147569-3"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">s</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">egment readable executable</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2203a833147569-4"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">e</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">ntry $</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2203a833147569-5"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">m</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">ov  edx, msg_size ;размер строки</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2203a833147569-6"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">l</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">ea  rsi, [msg]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2203a833147569-7"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">m</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">ov  edi, 1        ; Номер стандартного потока вывода stdout</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2203a833147569-8"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">m</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">ov  eax, 1        ; Код вызова системной функции sys_write</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2203a833147569-9"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">s</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">yscall</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2203a833147569-10"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">x</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">or  edi, edi      ; Код возврата из системной функции sys_exit</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2203a833147569-11"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">m</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">ov  eax, 60       ; Код вызова системной функции sys_exit</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2203a833147569-12"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">s</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">yscall</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2203a833147569-13"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">s</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">egment readable writeable</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2203a833147569-14"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">m</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">sg db 'Hello world!', 0xA</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2203a833147569-15"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">m</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">sg_size = $-msg      ; Длина выводимой строки</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Ском­пилиру­ем это все с помощью Flat Assembler:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<table border="0" style=" border-style:solid; margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" align="center" width="80%" cellspacing="-1" cellpadding="0" bgcolor="#ffffff">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e2203b974377513"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">1</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e2203b974377513-1"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">f</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">asm hello64.asm example_asm</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">На выходе получим позици­онно зависи­мый исполня­емый файл, который не исполь­зует фун­кции из сто­рон­них биб­лиотек.</span></p>
<h3 style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="sozdanie-peremeschaemogo-fayla-i-razdelyaemuyu"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">С</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">оздание перемещаемого файла и разделяемую библиотеку</span></h3>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Для переме­щаемо­го или раз­деля­емо­го (в виде динами­чес­кой биб­лиоте­ки) ELF-фай­ла необ­ходимо нем­ножко изме­нить наш хел­ловорлд:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<table border="0" style=" border-style:solid; margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" align="center" width="80%" cellspacing="-1" cellpadding="0" bgcolor="#ffffff">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e2203d139679188"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">5 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e2203d139679188-1"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">#</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">include </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2203d139679188-2"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">e</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">xtern int hello_world_function() {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2203d139679188-3"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> printf(&quot;Hello world\n&quot;);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2203d139679188-4"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> return 0;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2203d139679188-5"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">}</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">;</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">На­зовем этот исходник, к при­меру, exmple_lib.c и ском­пилиру­ем (без лин­ковки) с при­мене­нием опции -c:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<table border="0" style=" border-style:solid; margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" align="center" width="80%" cellspacing="-1" cellpadding="0" bgcolor="#ffffff">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e2203e673704925"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">1</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e2203e673704925-1"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">g</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">cc -c example_lib.c -o example_lib.o</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Да­лее напишем и выпол­ним в тер­минале сле­дующее:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<table border="0" style=" border-style:solid; margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" align="center" width="80%" cellspacing="-1" cellpadding="0" bgcolor="#ffffff">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e2203f341404463"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">1</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e2203f341404463-1"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">a</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">r rc libstatic_example.a example_lib.o</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Ес­ли ты погуг­лишь наз­начение ути­литы ar, то уви­дишь, что это архи­ватор. Так сло­жилось, что по сво­ему пря­мому пред­назна­чению (соз­давать архи­вы из фай­лов) он при­меня­ется край­не ред­ко, а вот для соз­дания ста­тичес­ки при­лино­ковы­ваемых биб­лиотек — поч­ти всег­да. Дело в том, что ста­тичес­кие биб­лиоте­ки (те самые, с рас­ширени­ем *.a и пре­фик­сом lib в име­ни фай­ла) — это не что иное, как архив, сос­тоящий из нес­коль­ких ском­пилиро­ван­ных (без лин­ковки) ELF-фай­лов, а так­же информа­ции об индекса­ции этих фай­лов для быс­тро­го поис­ка нуж­ных фун­кций при общей лин­ковке при­ложе­ния. Кста­ти, про­индекси­ровать нашу биб­лиоте­ку мож­но такой вот коман­дой:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">ranlib libstatic_example.a</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Итак, с переме­щаемым ELF разоб­рались, теперь сде­лаем раз­деля­емый. Возь­мем уже готовый ском­пилиро­ван­ный без лин­ковки объ­ектный файл example_lib.o и скор­мим его GCC с опци­ей -shared:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<table border="0" style=" border-style:solid; margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" align="center" width="80%" cellspacing="-1" cellpadding="0" bgcolor="#ffffff">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22040620048089"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">1</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22040620048089-1"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">g</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">cc -shared example_lib.o -o libdynamic_example.so</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Пос­коль­ку Linux в слу­чае необ­ходимос­ти ищет биб­лиоте­ки в спе­циаль­но отве­ден­ных катало­гах, то получив­ший­ся в резуль­тате файл нуж­но сло­жить в какой‑либо из этих катало­гов, к при­меру </span><a name="crayon-63ca3a4e22042196663021"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">/</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">usr/lib или </span><span style=" color:#000000;">/lib:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<table border="0" style=" border-style:solid; margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" align="center" width="80%" cellspacing="-1" cellpadding="0" bgcolor="#ffffff">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22044361191091"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">1</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22044361191091-1"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">s</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">udo cp libdynamic_example.so /usr/lib</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Те­перь нуж­но про­верить работос­пособ­ность наших биб­лиотек. Для это­го напишем прог­рамму, которая будет вызывать фун­кцию </span><a name="crayon-63ca3a4e22045552664353"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">h</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">ello_world_function() из этих биб­лиотек:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<table border="0" style=" border-style:solid; margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" align="center" width="80%" cellspacing="-1" cellpadding="0" bgcolor="#ffffff">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22047841266339"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">5 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22047841266339-1"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">i</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">nt hello_world_function();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22047841266339-2"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">i</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">nt main(int argc, char* argv[]) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22047841266339-3"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> int return_code = hello_world_function();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22047841266339-4"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> return return_code;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22047841266339-5"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">}</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Ском­пилиру­ем ее со ста­тичес­кой биб­лиоте­кой:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<table border="0" style=" border-style:solid; margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" align="center" width="80%" cellspacing="-1" cellpadding="0" bgcolor="#ffffff">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22048189854885"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">1</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22048189854885-1"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">g</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">cc example_ext_func.c lib_static_example.a -o example_static</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">И сде­лаем то же самое с динами­чес­кой биб­лиоте­кой:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<table border="0" style=" border-style:solid; margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" align="center" width="80%" cellspacing="-1" cellpadding="0" bgcolor="#ffffff">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22049713458276"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">1</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22049713458276-1"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">g</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">cc example_ext_func.c -ldynamic_example -o example_dynamic</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Об­рати вни­мание, что при ком­пиляции с раз­деля­емой биб­лиоте­кой не ука­зыва­ется ее пре­фикс lib, а так­же рас­ширение и пред­варя­ется все это опци­ей -l.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Те­перь у нас есть образцы прак­тичес­ки всех воз­можных вари­антов ELF-фай­лов и мы можем прис­тупить к иссле­дова­ниям устрой­ства ELF-фай­лов раз­личных типов.</span></p>
<h2 style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="struktura-elf-fayla"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">С</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">труктура ELF-файла</span></h2>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">ELF-файл сос­тоит из заголов­ка и дан­ных, которые вклю­чают в себя область так называ­емых заголов­ков прог­рамм, область заголов­ков сек­ций и самих сек­ций. В пос­ледних как раз и содер­жатся код, дан­ные и все осталь­ное, необ­ходимое для исполь­зования это­го ELF-фай­ла по наз­начению. Струк­тура 64-раз­рядно­го ELF-фай­ла схе­матич­но показа­на на рисун­ке ниже.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1674200658jjl2zr3zsg.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="attachment_15453"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">О</span><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">б­щая струк­тура 64-раз­рядно­го ELF-фай­ла </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">При­сутс­твие заголов­ка и сек­ций с кодом, дан­ными и всем осталь­ным для ELF-фай­лов обя­затель­но, тог­да как одновре­мен­ное наличие заголов­ков прог­рамм и заголов­ков сек­ций — нет. В фай­ле могут одновре­мен­но при­сутс­тво­вать обе этих области с заголов­ками прог­рамм и сек­ций либо одна из них. Чуть поз­же мы раз­берем­ся, от чего это зависит.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Спе­цифи­кацию фор­мата ELF-фай­лов мож­но взять </span><a href="https://uclibc.org/docs/elf.pdf"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">здесь</span></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">, а отли­чия 64-раз­рядных «эль­фов» от 32-раз­рядных пос­мотреть </span><a href="https://uclibc.org/docs/elf-64-gen.pdf"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">вот здесь</span></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">.</span></p>
<h3 style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="zagolovok-elf-fayla"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">З</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">аголовок ELF-файла</span></h3>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Как мы уже выяс­нили, любой ELF-файл начина­ется с заголов­ка, который пред­став­ляет струк­туру, содер­жащую информа­цию о типе фай­ла, его раз­ряднос­ти, типе архи­тек­туры, вер­сии ABI (Application Binary Interface), а так­же о том, где в фай­ле искать все осталь­ное. Фор­мат струк­тур заголов­ка как для 32-раз­рядных, так и для 64-раз­рядных ELF-фай­лов (как, впро­чем, и фор­маты всех осталь­ных струк­тур ELF-фай­лов) мож­но пос­мотреть в фай­ле: </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<table border="0" style=" border-style:solid; margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" align="center" width="80%" cellspacing="-1" cellpadding="0" bgcolor="#ffffff">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e2204b955991356"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">1</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e2204b955991356-1"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">/</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">usr/include/elf.h</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Пер­вые 16 байт заголов­ка (мас­сив e_ident) слу­жат для иден­тифика­ции ELF-фай­ла. Пер­вые четыре бай­та — это магичес­кая кон­стан­та, сос­тоящая из бай­та 0x7f, за которым идут ASCII-коды сим­волов E, L и F. По наличию этих бай­тов заг­рузчик Linux (или, к при­меру, ути­лита file) опре­деля­ет, что перед ним имен­но ELF-файл (в PE-фай­лах Windows ана­логич­ную фун­кцию выпол­няет ком­бинация из ASCII-кодов сим­волов M и Z). Сле­дующие в этом мас­сиве бай­ты в фай­ле elf.h обоз­нача­ются такими кон­стан­тами:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2204c323454039"></a><span style=" font-size:15px;">E</span><span style=" font-size:15px;">I_CLASS</span> — байт опре­деля­ет раз­рядность ELF-фай­ла (зна­чение 0x01 соот­ветс­тву­ет 32 раз­рядам, зна­чение 0x02 — 64);</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22051622878626"></a><span style=" font-size:15px;">E</span><span style=" font-size:15px;">I_DATA</span> — зна­чение это­го бай­та опре­деля­ет <a href="https://ru.wikipedia.org/wiki/%D0%9F%D0%BE%D1%80%D1%8F%D0%B4%D0%BE%D0%BA_%D0%B1%D0%B0%D0%B9%D1%82%D0%BE%D0%B2"><span style=" text-decoration: underline; color:#0000ff;">по­рядок сле­дова­ния бай­тов дан­ных</span></a> при раз­мещении их в памяти (Little Endian или Big Endian). Архи­тек­тура x86 исполь­зует раз­мещение бай­тов Little Endian, поэто­му зна­чение это­го бай­та будет рав­но 0x01;</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22052676224597"></a><span style=" font-size:15px;">E</span><span style=" font-size:15px;">I_VERSION</span> — вер­сия спе­цифи­кации ELF-фор­мата. Кор­рек­тное зна­чение в нас­тоящее вре­мя — 0x01;</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22053453977478"></a><span style=" font-size:15px;">E</span><span style=" font-size:15px;">I_OSABI</span> и <a name="crayon-63ca3a4e22055596579637"></a><span style=" font-size:15px;">E</span><span style=" font-size:15px;">I_ABIVERSION</span> опре­деля­ют вер­сию дво­ично­го интерфей­са и опе­раци­онную сис­тему, для которой откомпи­лиро­ван файл. Для Linux пер­вый из этих двух бай­тов обыч­но име­ет зна­чение 0x00 или 0x03, вто­рой — 0x00. Общую спе­цифи­кацию ABI (так называ­емую ABI System V) мож­но взять <a href="https://uclibc.org/docs/SysV-ABI.pdf"><span style=" text-decoration: underline; color:#0000ff;">от­сюда</span></a>, рас­ширение этой спе­цифи­кации для архи­тек­туры i386 (это все, что каса­ется 32-раз­рядных ELF-фай­лов) лежит <a href="https://uclibc.org/docs/psABI-i386.pdf"><span style=" text-decoration: underline; color:#0000ff;">здесь</span></a>. Рас­ширение для x86-64 (это для 64-раз­рядных прог­рамм) — <a href="https://uclibc.org/docs/psABI-x86_64.pdf"><span style=" text-decoration: underline; color:#0000ff;">тут</span></a>;</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22056428455321"></a><span style=" font-size:15px;">E</span><span style=" font-size:15px;">I_PAD</span> в нас­тоящее вре­мя не несет никакой наг­рузки и запол­нено нулевы­ми зна­чени­ями (в мес­тах с индекса­ми от 9 по 15).</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Да­лее пос­ле мас­сива e_ident рас­положе­ны сле­дующие поля:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22058173951638"></a><span style=" font-size:15px;">e</span><span style=" font-size:15px;">_type</span> — зна­чение это­го поля, как мож­но пред­положить, опре­деля­ет тип ELF-фай­ла (име­ются в виду те типы, о которых мы говори­ли перед соз­дани­ем при­меров для нашего иссле­дова­ния). Некото­рые инте­ресу­ющие нас в пер­вую оче­редь зна­чения это­го поля: </li>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22059153454221"></a><span style=" font-size:15px;">E</span><span style=" font-size:15px;">T_EXEC</span> — исполня­емый файл (зна­чение рав­но 0x02). Дан­ное зна­чение исполь­зует­ся толь­ко для позици­онно зависи­мых исполня­емых ELF-фай­лов (нап­ример, тех, которые были ском­пилиро­ваны GCC с опци­ей -no-pie);</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2205a331752747"></a><span style=" font-size:15px;">E</span><span style=" font-size:15px;">T_REL</span> — переме­щаемый файл (зна­чение в этом слу­чае — 0x01);</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2205b423855978"></a><span style=" font-size:15px;">E</span><span style=" font-size:15px;">T_DYN</span> — раз­деля­емый объ­ектный файл (зна­чение рав­но 0x03). Дан­ное зна­чение харак­терно как для динами­чес­ки под­клю­чаемых биб­лиотек (тех самых, которые обыч­но име­ют рас­ширение *.so), так и для позици­онно незави­симых исполня­емых фай­лов. Как они раз­лича­ются, мы обсу­дим чуть поз­же;</li></ul>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2205c883546234"></a><span style=" font-size:15px;">e</span><span style=" font-size:15px;">_machine</span> — зна­чени­ем это­го поля опре­деля­ется архи­тек­тура, для которой собс­твен­но и соз­дан ELF-файл. Пос­коль­ку мы в пер­вую оче­редь говорим об архи­тек­туре x86 в 64-раз­рядном исполне­нии, то зна­чение это­го поля будет EM_X86_64 (рав­но 0x42). Понят­но, что мож­но встре­тить и дру­гое зна­чение, нап­ример EM_386 (для 32-раз­рядно­го слу­чая архи­тек­туры x86, рав­но 0x03) или, к при­меру, EM_ARM (для про­цес­соров ARM и рав­ное 0x28);</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2205e872431676"></a><span style=" font-size:15px;">e</span><span style=" font-size:15px;">_version</span> — дуб­лиру­ет зна­чение бай­та EI_VERSION из мас­сива e_dent;</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2205f490131322"></a><span style=" font-size:15px;">e</span><span style=" font-size:15px;">_entry</span> — точ­ка вхо­да в ELF-файл, с которой начина­ется выпол­нение прог­раммы. Для позици­онно зависи­мых фай­лов здесь лежит абсо­лют­ный вир­туаль­ный адрес начала выпол­нения прог­раммы, для позици­онно незави­симо­го кода сюда пишет­ся сме­щение отно­ситель­но вир­туаль­ного адре­са начала обра­за ELF-фай­ла, заг­ружен­ного в память;</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22060122494700"></a><span style=" font-size:15px;">e</span><span style=" font-size:15px;">_phoff</span> — сме­щение начала заголов­ков прог­рамм (обра­ти вни­мание: здесь, в отли­чие от точ­ки вхо­да, сме­щение отно­ситель­но начала фай­ла, а не вир­туаль­ный адрес);</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22061975389359"></a><span style=" font-size:15px;">e</span><span style=" font-size:15px;">_shoff</span> — сме­щение начала заголов­ков сек­ций (так­же отно­ситель­но начала фай­ла);</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22063989514662"></a><span style=" font-size:15px;">e</span><span style=" font-size:15px;">_flags</span> — это поле содер­жит фла­ги, спе­цифич­ные для кон­крет­ной архи­тек­туры, для которой пред­назна­чен файл. В нашем слу­чае (име­ется в виду архи­тек­тура x86) поле име­ет зна­чение 0x00;</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22064979255289"></a><span style=" font-size:15px;">e</span><span style=" font-size:15px;">_ehsize</span> — раз­мер заголов­ка ELF-фай­ла (для 32-раз­рядно­го он равен 52 бай­там, для 64-раз­рядно­го — 64 бай­там);</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22065547156079"></a><span style=" font-size:15px;">e</span><span style=" font-size:15px;">_phentsize</span> — раз­мер одной записи в раз­деле заголов­ков прог­рамм (раз­мер одно­го заголов­ка);</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22066254047815"></a><span style=" font-size:15px;">e</span><span style=" font-size:15px;">_phnum</span> — чис­ло записей в раз­деле заголов­ков прог­рамм (чис­ло заголов­ков прог­рамм);</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22067669084935"></a><span style=" font-size:15px;">e</span><span style=" font-size:15px;">_shentsize</span> — раз­мер одной записи в раз­деле заголов­ков сек­ций (раз­мер одно­го заголов­ка);</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22069764824561"></a><span style=" font-size:15px;">e</span><span style=" font-size:15px;">_shnum</span> — чис­ло записей в раз­деле заголов­ков сек­ций (чис­ло заголов­ков прог­рамм);</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2206a100697228"></a><span style=" font-size:15px;">e</span><span style=" font-size:15px;">_shstrndx</span> — это поле содер­жит индекс (то есть поряд­ковый номер в раз­деле заголов­ков сек­ций) заголов­ка одной из сек­ций, которая называ­ется <a name="crayon-63ca3a4e2206b432148048"></a><span style=" font-size:15px;">.</span><span style=" font-size:15px;">shstrtab</span>. Эта сек­ция содер­жит име­на всех осталь­ных сек­ций ELF-фай­ла в кодиров­ке ASCII с завер­шающим нулем.</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Что­бы пос­мотреть на заголо­вок ELF-фай­ла воочию, вос­поль­зуем­ся ути­литой readelf (здесь опция </span><a name="crayon-63ca3a4e2206c318504663"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">-</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">W ука­зыва­ет, что необ­ходимо выводить пол­ные стро­ки, без огра­ниче­ния в 80 сим­волов в стро­ке, а опция </span><a name="crayon-63ca3a4e2206d808176011"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">-</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">h говорит, что вывес­ти нуж­но имен­но заголо­вок): </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<table border="0" style=" border-style:solid; margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" align="center" width="80%" cellspacing="-1" cellpadding="0" bgcolor="#ffffff">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e2206f175640812"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">1</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e2206f175640812-1"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">r</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">eadelf -W -h example_asm</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">На выходе получим сле­дующую кар­тину.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1674200736w2rh46polx.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="attachment_15454"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">В</span><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">ы­вод заголов­ка ELF-фай­ла с помощью readelf </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Так­же пос­мотреть на заголо­вок ELF-фай­ла мож­но с помощью любого шес­тнад­цатерич­ного редак­тора (к при­меру, на рисун­ке с hex-редак­тором 010 Editor выделен заголо­вок ELF-фай­ла с нашим хел­ловор­лдом на ассем­бле­ре) или прив­лечь к это­му делу «Иду» (на рисун­ке выше вид­но заголо­вок это­го же фай­ла).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">На Python мож­но написать прос­той скрипт (с исполь­зовани­ем </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">lief</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">), который может вывес­ти как заголо­вок пол­ностью, так и отдель­ные его эле­мен­ты:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<table border="0" style=" border-style:solid; margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" align="center" width="80%" cellspacing="-1" cellpadding="0" bgcolor="#ffffff">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22070263554001"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">5</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">6 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22070263554001-1"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">i</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">mport lief</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22070263554001-2"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">e</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">lf_object = lief.parse('example_asm')</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22070263554001-3"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">h</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">eader = elf_object.header</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22070263554001-4"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">p</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">rint(header)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22070263554001-5"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">#</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> Отдельно выведем точку входа</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22070263554001-6"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">p</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">rint('Entry point: %08x' % header.entrypoint)</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Ну и наконец, мож­но написать в тер­минале (в дан­ном слу­чае информа­ции будет нес­коль­ко мень­ше по срав­нению с readelf):</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<table border="0" style=" border-style:solid; margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" align="center" width="80%" cellspacing="-1" cellpadding="0" bgcolor="#ffffff">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22071951220671"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">1</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22071951220671-1"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">o</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">bjdump -f example_asm</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1674200783s0ujye632r.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="attachment_15455"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">Р</span><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">е­зуль­тат работы objdump: вывод информа­ции о заголов­ке ELF-фай­ла</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<h2 style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="sektsionnoe-predstavlenie-elf-faylov"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">С</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">екционное представление ELF-файлов</span></h2>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Код и дан­ные в ELF-фай­ле логичес­ки раз­делены на сек­ции, которые пред­став­ляют собой непере­сека­ющиеся смеж­ные бло­ки, рас­положен­ные в фай­ле друг за дру­гом без про­межут­ков. У сек­ций нет опре­делен­ной общей струк­туры: в каж­дой сек­ции орга­низа­ция раз­мещения дан­ных или кода зависит от ее наз­начения. Более того, некото­рые сек­ции вооб­ще могут не иметь какой‑либо струк­туры, а пред­став­лять собой нес­трук­туриро­ван­ный блок кода или дан­ных. Каж­дая сек­ция опи­сыва­ется сво­им заголов­ком, который хра­нит­ся в таб­лице заголов­ков сек­ций. В заголов­ке перечис­лены свой­ства сек­ции, а так­же мес­тонахож­дение содер­жимого самой сек­ции в фай­ле.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Во­обще, если вни­матель­но пос­мотреть спе­цифи­кацию ELF-фай­ла, то мож­но уви­деть, что деление на сек­ции пред­назна­чено для орга­низа­ции работы ком­понов­щика, а с точ­ки зре­ния исполне­ния фай­ла сек­цион­ная орга­низа­ция не несет никакой полез­ной информа­ции. То есть не нуж­дающиеся в ком­понов­ке ELF-фай­лы (непере­меща­емые исполня­емые фай­лы) могут не иметь таб­лицы заголов­ков сек­ций (и во мно­гих слу­чаях ее не име­ют). Для заг­рузки в память про­цес­са и выпол­нения ELF-фай­лов исполь­зует­ся еще одна логичес­кая орга­низа­ция — сег­мен­тная, о которой мы погово­рим ниже. Если в ELF-фай­ле нет таб­лицы заголов­ков сек­ций, поле e_shoff в заголов­ке будет рав­но нулю.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">К при­меру, если поп­робовать вывес­ти информа­цию о сек­циях для нашего непере­меща­емо­го исполня­емо­го фай­ла, получен­ного в начале статьи из исходни­ков при­мера Fasm (напом­ню, что файл мы наз­вали example_asm):</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<table border="0" style=" border-style:solid; margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" align="center" width="80%" cellspacing="-1" cellpadding="0" bgcolor="#ffffff">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22073485736793"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">1</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22073485736793-1"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">r</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">eadelf -S -W example_asm</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">то мы уви­дим, что раз­дела с таб­лицей заголов­ков сек­ций в этом фай­ле нет.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1674200826tq43aiiwl0.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="attachment_15456"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">П</span><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">о­пыт­ка вывес­ти таб­лицу заголов­ков сек­ций для исполня­емо­го непере­меща­емо­го ELF-фай­ла </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Ес­ли же мы про­изве­дем ана­логич­ную опе­рацию с любым дру­гим фай­лом из чис­ла наших подопыт­ных экзем­пля­ров (к при­меру, фай­лом </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">example_pie</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">), то раз­дел с таб­лицей заголов­ков сек­ций будет при­сутс­тво­вать.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1674200876hqala03sw4.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="attachment_15457"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">Т</span><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">аб­лица заголов­ков сек­ций в фай­ле example_pie </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Кста­ти, вывес­ти информа­цию из раз­дела заголов­ков сек­ций мож­но и с помощью Python (сов­мес­тно с lief), написав при­мер­но вот такой скрипт:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<table border="0" style=" border-style:solid; margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" align="center" width="80%" cellspacing="-1" cellpadding="0" bgcolor="#ffffff">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22074619441858"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">4 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22074619441858-1"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">i</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">mport lief</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22074619441858-2"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">e</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">lf_object = lief.parse('example_pie')</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22074619441858-3"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">f</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">or section in elf_object.sections:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22074619441858-4"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> print('Section {name} - size: {size} bytes'.format(name=section.name, size=section.size))</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Ис­ходя из ска­зан­ного выше, необ­ходимо пом­нить, что о сек­цион­ном пред­став­лении и орга­низа­ции ELF-фай­ла име­ет смысл говорить на эта­пе ком­понов­ки, а при заг­рузке фай­ла в память про­цес­са для его пос­леду­юще­го выпол­нения исполь­зует­ся сег­мен­тное пред­став­ление и орга­низа­ция фай­ла.</span></p>
<h3 style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="zagolovki-sektsiy"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">З</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">аголовки секций</span></h3>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Итак, как мы выяс­нили, в заголов­ках сек­ций (если в ELF-фай­ле есть раз­дел с таб­лицей заголов­ков сек­ций) содер­жится информа­ция о свой­ствах и мес­тонахож­дении той или иной сек­ции. Заголов­ки сек­ций пред­став­ляют собой струк­туру, опи­сание которой мож­но най­ти в фай­ле </span><a name="crayon-63ca3a4e22076945063989"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">/</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">usr/include/elf.h (там эти струк­туры носят име­на Elf64_Shdr и Elf32_Shdr для 64- и 32-раз­рядных фай­лов соот­ветс­твен­но).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Раз­берем­ся с наз­начени­ем каж­дого из полей этой струк­туры:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22077120078550"></a><span style=" font-size:15px;">s</span><span style=" font-size:15px;">h_name</span> — содер­жит индекс име­ни сек­ции (здесь име­ется в виду номер бай­та, с которо­го начина­ется имя сек­ции) в таб­лице строк, которая, в свою оче­редь, содер­жится в сек­ции .shstrtab. Дру­гими сло­вами, все име­на сек­ций хра­нят­ся в спе­циаль­ной сек­ции <a name="crayon-63ca3a4e22078763971055"></a><span style=" font-size:15px;">.</span><span style=" font-size:15px;">shstrtab</span> (о ней мы уже говори­ли, ког­да рас­смат­ривали заголо­вок ELF-фай­ла), а в поле <a name="crayon-63ca3a4e2207a536086617"></a><span style=" font-size:15px;">s</span><span style=" font-size:15px;">h_name</span> находит­ся зна­чение сме­щения начала стро­ки с име­нем сек­ции, к которой отно­сит­ся дан­ный заголо­вок, от начала сек­ции <a name="crayon-63ca3a4e2207b180425319"></a><span style=" font-size:15px;">s</span><span style=" font-size:15px;">h_strtab</span>;</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2207c769212250"></a><span style=" font-size:15px;">s</span><span style=" font-size:15px;">h_type</span> — тип сек­ции, который опре­деля­ет ее содер­жимое. Из всех воз­можных типов (а они так­же опре­деле­ны в /usr/include/elf.h) наиболь­ший инте­рес пред­став­ляют сле­дующие: </li>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2207d985409872"></a><span style=" font-size:15px;">S</span><span style=" font-size:15px;">HT_NULL</span> — неис­поль­зуемая (пус­тая) сек­ция. Сог­ласно спе­цифи­кации, пер­вая запись в таб­лице заголов­ков сек­ций дол­жна быть имен­но такой (зна­чение, как нет­рудно догадать­ся, рав­но 0x00);</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2207e670046881"></a><span style=" font-size:15px;">S</span><span style=" font-size:15px;">HT_PROGBITS</span> — сек­ция содер­жит дан­ные или код для выпол­нения (зна­чение рав­но <a name="crayon-63ca3a4e22080817000186"></a><span style=" font-size:15px;">0</span><span style=" font-size:15px;">x01</span>);</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22081502433109"></a><span style=" font-size:15px;">S</span><span style=" font-size:15px;">HT_SYMTAB</span> — сек­ция содер­жит так называ­емую таб­лицу ста­тичес­ких сим­волов (под сим­волами в дан­ном слу­чае понима­ются име­на фун­кций или перемен­ных). Каж­дая запись в этой сек­ции пред­став­ляет собой струк­туру Elf64_Sym (или Elf32_Sym для 32-раз­рядных фай­лов), которая опре­деле­на в usr/include/elf.h. Как пра­вило, сек­ция с таб­лицей ста­тичес­ких сим­волов носит имя .symtab, каж­дая запись в этой сек­ции нуж­на для сопос­тавле­ния того или ино­го сим­вола с мес­тонахож­дени­ем фун­кции или перемен­ной, имя которой и опре­деле­но дан­ным сим­волом. Все это в подав­ляющем боль­шинс­тве слу­чаев нуж­но, что­бы облегчить отладку прог­раммы, а непос­редс­твен­но для выпол­нения ELF-фай­ла эта сек­ция не исполь­зует­ся (и во мно­гих слу­чаях пос­ле отладки прог­раммы ее из фай­ла уда­ляют с помощью ути­литы <span style=" font-weight:600;">strip</span>). Зна­чение рав­но <a name="crayon-63ca3a4e22082655926163"></a><span style=" font-size:15px;">0</span><span style=" font-size:15px;">x02</span>;</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22083366841356"></a><span style=" font-size:15px;">S</span><span style=" font-size:15px;">HT_DYNSYM</span> — таб­лица сим­волов, исполь­зуемая динами­чес­ким ком­понов­щиком при ком­понов­ке прог­раммы (чис­ловое зна­чение рав­но 0x0b). Каж­дая запись этой сек­ции так­же пред­став­ляет собой струк­туру Elf64_Sym (или Elf32_Sym). Как пра­вило, сек­ция с таб­лицей динами­чес­ких сим­волов носит имя <a name="crayon-63ca3a4e22084744962810"></a><span style=" font-size:15px;">.</span><span style=" font-size:15px;">dynsym</span>. Более под­робно о сек­циях .symtab и .dynsym погово­рим чуть поз­же;</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22086822120500"></a><span style=" font-size:15px;">S</span><span style=" font-size:15px;">HT_STRTAB</span> — в сек­циях такого типа хра­нят­ся стро­ки в кодиров­ке ASCII с завер­шающим нулем (в час­тнос­ти, уже зна­комая нам сек­ция .shstrtab име­ет имен­но такой тип). Зна­чение рав­но 0x03;</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22087966781626"></a><span style=" font-size:15px;">S</span><span style=" font-size:15px;">HT_REL, SHT_RELA</span> — сек­ции это­го типа содер­жат записи о переме­щени­ях, при­чем фор­мат каж­дой записи опре­делен струк­турами Elf64_Rel (Elf32_Rel) и Elf64_Rela (Elf32_Rela), опять же опи­сан­ными в elf.h. Непос­редс­твен­но с орга­низа­цией переме­щений мы раз­берем­ся чуть поз­же;</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22088533224242"></a><span style=" font-size:15px;">S</span><span style=" font-size:15px;">HT_DYNAMIC</span> — сек­ция это­го типа хра­нит информа­цию, необ­ходимую для динами­чес­кой ком­понов­ки (чис­ловое зна­чение — 0x06). Фор­мат одной записи в такой сек­ции опи­сыва­ется струк­турой Elf64_Dyn (Elf32_Dyn) в фай­ле elf.h;</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22089643392758"></a><span style=" font-size:15px;">S</span><span style=" font-size:15px;">HT_NOBITS</span> — сек­ция такого типа не занима­ет мес­та в фай­ле. По сути, наличие такой сек­ции явля­ется дирек­тивой о выделе­нии необ­ходимо­го количес­тва памяти для неини­циали­зиро­ван­ных перемен­ных на эта­пе заг­рузки ELF-фай­ла в память и под­готов­ки его к выпол­нению (обыч­но такая сек­ция носит имя .bss). Чис­ловое зна­чение дан­ной кон­стан­ты рав­но 0x08;</li></ul>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2208b823443354"></a><span style=" font-size:15px;">s</span><span style=" font-size:15px;">h_flags</span> — содер­жит допол­нитель­ную информа­цию о сек­ции. Из все­го мно­гооб­разия зна­чений в пер­вую оче­редь инте­рес­ны фла­ги: </li>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2208c981086392"></a><span style=" font-size:15px;">S</span><span style=" font-size:15px;">HF_WRITE</span> — флаг, име­ющий зна­чение 0x01 и говоря­щий о том, что в сек­цию воз­можна запись дан­ных (здесь необ­ходимо учи­тывать воз­можность объ­еди­нить нес­коль­ко фла­гов пос­редс­твом опе­рации «или»);</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2208d464517815"></a><span style=" font-size:15px;">S</span><span style=" font-size:15px;">HF_ALLOC</span> — наличие это­го фла­га говорит о том, что содер­жимое сек­ции дол­жно быть заг­ружено в вир­туаль­ную память при под­готов­ке прог­раммы к выпол­нению (хотя нуж­но пом­нить, что ELF-файл заг­ружа­ется в память с при­мене­нием сег­мен­тно­го пред­став­ления фай­ла, ну а сег­мент есть не что иное, как объ­еди­нение нес­коль­ких сек­ций). Чис­ловое зна­чение рав­но 0x02;</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2208e206884337"></a><span style=" font-size:15px;">S</span><span style=" font-size:15px;">HF_EXECINSTR</span> — такой флаг показы­вает, что сек­ция содер­жит исполня­емый код (зна­чение рав­но 0x04);</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2208f187654094"></a><span style=" font-size:15px;">S</span><span style=" font-size:15px;">HF_STRINGS</span> — эле­мен­ты дан­ных в сек­ции с таким фла­гом сос­тоят из сим­воль­ных строк, завер­шающих­ся нулевым сим­волом (зна­чение — 0x20);</li></ul>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22091786641892"></a><span style=" font-size:15px;">s</span><span style=" font-size:15px;">h_addr</span> — вир­туаль­ный адрес сек­ции. Хоть мы и говори­ли, что сек­цион­ное пред­став­ление не исполь­зует­ся при раз­мещении фай­ла в памяти, в некото­рых слу­чаях ком­понов­щику необ­ходимо знать, по каким адре­сам будут раз­мещены те или иные учас­тки кода или дан­ных на эта­пе выпол­нения, что­бы обес­печивать переме­щения. Для это­го и пре­дус­мотре­но дан­ное поле. Если сек­ция не дол­жна гру­зить­ся в память при выпол­нении фай­ла, то зна­чение это­го поля рав­но нулю;</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22092989958902"></a><span style=" font-size:15px;">s</span><span style=" font-size:15px;">h_offset</span> — сме­щение сек­ции в фай­ле (отно­ситель­но его начала);</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22093631873658"></a><span style=" font-size:15px;">s</span><span style=" font-size:15px;">h_size</span> — раз­мер сек­ции в бай­тах;</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22094607933549"></a><span style=" font-size:15px;">s</span><span style=" font-size:15px;">h_linc</span> — содер­жит индекс (в таб­лице заголов­ков сек­ций) сек­ции, с которой свя­зана дан­ная сек­ция;</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22096664368183"></a><span style=" font-size:15px;">s</span><span style=" font-size:15px;">h_info</span> — допол­нитель­ная информа­ция о сек­ции (зна­чение зависит от типа сек­ции);</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22097627821803"></a><span style=" font-size:15px;">s</span><span style=" font-size:15px;">h_addralign</span> — здесь зада­ются тре­бова­ния к вырав­ниванию сек­ции в памяти (если содер­жит зна­чения 0x00 или 0x01, то вырав­нивание не тре­бует­ся);</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e22098901370568"></a><span style=" font-size:15px;">s</span><span style=" font-size:15px;">h_entsize</span> — в некото­рых сек­циях, нап­ример таб­лице сим­волов .symtab, лежат записи опре­делен­ных струк­тур (к при­меру, Elf64_Sym), и для таких сек­ций поле содер­жит раз­мер одной записи сек­ции в бай­тах.</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Если сек­ция не отно­сит­ся к такому виду, то поле содер­жит нулевое зна­чение.</span></p>
<h3 style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="naznachenie-i-soderzhimoe-osnovnyh-sektsiy"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">Н</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">азначение и содержимое основных секций</span></h3>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Се­год­ня мы не будем под­робно раз­бирать наз­начение и струк­туру всех воз­можных сек­ций в ELF-фай­ле, их доволь­но мно­го. На рисун­ке с общей струк­турой ELF-фай­ла перечис­лены стан­дар­тные име­на всех воз­можных сек­ций, опре­делен­ных в спе­цифи­каци­ях, в том чис­ле и при­мени­тель­но к ABI архи­тек­туры x86-64. Рас­смот­рим наибо­лее зна­чимые с точ­ки зре­ния пер­воначаль­ного ана­лиза ELF-фай­лов сек­ции.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Секция .interp</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">В этой сек­ции лежит путь к динами­чес­кому ком­понов­щику, который ком­пону­ет ELF-файл при заг­рузке его в память и под­готав­лива­ет его к выпол­нению. Динами­чес­кий ком­понов­щик содер­жит стар­товый код, отоб­ража­ющий раз­деля­емые биб­лиоте­ки на адресное прос­транс­тво заг­ружен­ного в память ELF-фай­ла.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Так­же он выпол­няет все под­готови­тель­ные эта­пы, свя­зан­ные с раз­решени­ем ссы­лок на фун­кции, опре­делен­ные во внеш­них биб­лиоте­ках. Пос­ле все­го это­го динами­чес­кий ком­понов­щик переда­ет управле­ние заг­ружен­ному при­ложе­нию. Пос­мотреть содер­жимое сек­ции .interp мож­но сле­дующим обра­зом (опция -p ути­литы readelf выводит ука­зан­ную сек­цию в стро­ковом пред­став­лении):</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<table border="0" style=" border-style:solid; margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" align="center" width="80%" cellspacing="-1" cellpadding="0" bgcolor="#ffffff">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22099521652083"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">1</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e22099521652083-1"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">r</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">eadelf -p .interp -W example_pie</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1674200920w7g69qmsyy.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="attachment_15458"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">П</span><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">уть к динами­чес­кому ком­понов­щику в сек­ции `.interp` фай­ла *example_pie*</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Ес­ли же мы поп­робу­ем пос­мотреть содер­жимое этой сек­ции не в исполня­емом фай­ле, а в раз­деля­емой биб­лиоте­ке (один из наших подопыт­ных фай­лов libdynamic_example.so), то уви­дим сле­дующую кар­тину.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1674200989bpc8v1yxux.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="attachment_15459"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">П</span><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">о­пыт­ка вывес­ти сек­цию `.interp` фай­ла с раз­деля­емой биб­лиоте­кой </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">На­личие (или отсутс­твие) сек­ции .interp как раз и явля­ется одним из отли­чий исполня­емо­го переме­щаемо­го фай­ла от раз­деля­емой биб­лиоте­ки (как мы отме­тили выше, оба этих типа ELF-фай­лов име­ют зна­чение ET_DYN в поле e_type заголов­ка). Вто­рое отли­чие — пра­ва на выпол­нение у фай­ла (те самые, которые уста­нав­лива­ются коман­дой chmod с парамет­ром -x). В подав­ляющем боль­шинс­тве слу­чаев в раз­деля­емой биб­лиоте­ке нет ни сек­ции .interp, ни прав на выпол­нение фай­ла. Из это­го пра­вила могут быть исклю­чения. Нап­ример, биб­лиоте­ка с основны­ми фун­кци­ями С libc (на нынеш­них сис­темах это файл libc.so.6) впол­не запус­кает­ся и выводит информа­цию о себе.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1674201027wdcoloqjlk.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="attachment_15460"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">З</span><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">а­пуск раз­деля­емой биб­лиоте­ки `libc` </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Секции .init и .fini</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">В сек­ции .init находит­ся код, выпол­няющий­ся перед запус­ком кода, который начина­ется в точ­ке вхо­да (этот код рас­положен в сек­ции .text, и об этой сек­ции мы погово­рим ниже). Если дизас­сем­бли­ровать какой‑нибудь ELF-файл (нап­ример, исполь­зуя objdump) и пос­мотреть внутрь этой сек­ции, то мож­но уви­деть две фун­кции: _init и __gmon_start__.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image16742010938ew03hotgq.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="attachment_15461"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">Д</span><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">и­зас­сем­бли­рован­ная сек­ция `.init` (вид­но, что внут­ри лежат фун­кции `_init` и `__gmon_start__`) </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">За­дача этих фун­кций — ини­циали­зиро­вать и попытать­ся запус­тить про­фили­ров­щик gprof. Что­бы эта попыт­ка ока­залась удач­ной и ELF-файл запус­тился под про­фили­ров­щиком, этот файл дол­жен быть ском­пилиро­ван с опци­ей -pg. В дан­ном слу­чае (если вни­матель­но пос­мотреть на дизас­сем­бли­рован­ный код фун­кции) в регис­тре rax будет находить­ся адрес фун­кции __gmon_start__, которая и вызовет gprof перед выпол­нени­ем основно­го кода прог­раммы. В про­тив­ном слу­чае в rax будет 0, вызова __gmon_start__ и, соот­ветс­твен­но, про­фили­ров­щика, не про­изой­дет, а выпол­нение будет переда­но сра­зу на код в сек­ции text.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Сек­ция .fini содер­жит в себе фун­кцию _fini, которая выпол­няет­ся пос­ле выпол­нения основно­го кода прог­раммы.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1674201141mhnihqf6zc.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="attachment_15462"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">Д</span><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">и­зас­сем­бли­рован­ная сек­ция `.fini` </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">Секция .text</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Здесь как раз и находит­ся весь тот код, ради выпол­нения которо­го и была написа­на прог­рамма и на который ука­зыва­ет поле e_entry заголов­ка ELF-фай­ла. Одна­ко если пос­мотреть дизас­сем­бли­рован­ный лис­тинг этой сек­ции, то воп­реки ожи­дани­ям мы уви­дим, что по адре­су, на который ука­зыва­ет точ­ка вхо­да, лежит не фун­кция main(), а некая фун­кция _start, пос­ле которой при­сутс­тву­ет еще нес­коль­ко фун­кций, выпол­няющих под­готов­ку к запус­ку прог­раммы (нап­ример, deregister_tm_clones, register_tm_clones и frame_dummy).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Фун­кция _start счи­тыва­ет парамет­ры коман­дной стро­ки (если они есть) и вызыва­ет фун­кцию __libc_start_main. И уже эта фун­кция вызыва­ет на выпол­нение фун­кцию main(), где содер­жится основной код прог­раммы.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image16742012071fppd7v9tb.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="attachment_15463"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">Д</span><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">и­зас­сем­бли­рован­ная сек­ция `.text` </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">Секция .data</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Сек­ция для хра­нения ини­циали­зиро­ван­ных перемен­ных, изме­нение которых воз­можно в ходе выпол­нения прог­раммы (соот­ветс­твен­но, эта сек­ция име­ет флаг SHF_WRITE).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">Секция .rodata</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">В этой сек­ции хра­нят­ся кон­стантные зна­чения, то есть зна­чения, которые не под­лежат изме­нению в ходе выпол­нения прог­раммы.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">Секция .bss</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Сек­ция .bss пред­назна­чена для неини­циали­зиро­ван­ных перемен­ных. Если сек­ции .data и .rodata име­ют тип SHT_PROGBITS, эта сек­ция, как мы уже отме­чали выше, име­ет тип SHT_NOBITS. Дан­ная сек­ция не занима­ет мес­то в ELF-фай­ле, пос­коль­ку и так понят­но, что неини­циали­зиро­ван­ные перемен­ные рав­ны нулю, а хра­нить эти нули в ELF-фай­ле нет никако­го смыс­ла.</span></p>
<h2 style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="segmentnoe-predstavlenie-elf-faylov"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">С</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">егментное представление ELF-файлов</span></h2>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Как мы уже говори­ли, сег­мен­тное пред­став­ление исполь­зует­ся ком­понов­щиком при заг­рузке ELF-фай­ла в про­цесс для выпол­нения. Этот тип пред­став­ления дает таб­лица заголов­ков прог­раммы (пов­торюсь, если иссле­дуемый файл не пред­назна­чен для выпол­нения, то эта таб­лица может отсутс­тво­вать). Таб­лица заголов­ков прог­раммы опи­сыва­ется струк­турой Elf32_Phdr или Elf64_Phdr из уже зна­комо­го нам фай­ла /usr/include/elf.h.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">В целом сег­мент может вклю­чать в себя ноль и более сек­ций, то есть объ­еди­няет сек­ции в один блок. Здесь может воз­никнуть спра­вед­ливый воп­рос: почему же тог­да в сег­менте может быть ноль сек­ций?</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Дело в том, что некото­рые типы сег­ментов при опи­сании их в ELF-фай­ле не име­ют внут­ри себя никаких сек­ций (то есть они пус­тые). К при­меру, пус­тые сек­ции име­ет заголо­вок, с которо­го начина­ется таб­лица заголов­ков прог­раммы (он самый пер­вый в таб­лице и как раз и сиг­нализи­рует о том, что с это­го мес­та начина­ется таб­лица заголов­ков), или сег­мент, хра­нящий информа­цию о сте­ке (име­ет тип заголов­ка PT_GNU_STACK).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Вы­вес­ти информа­цию о сег­ментах мож­но сле­дующим обра­зом: </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<table border="0" style=" border-style:solid; margin-top:0px; margin-bottom:0px; margin-left:-21px; margin-right:0px;" align="center" width="80%" cellspacing="-1" cellpadding="0" bgcolor="#ffffff">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e2209c311918763"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">1</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e2209c311918763-1"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">r</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">eadelf -W --segments example_pie</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1674201258g7u5cnsnw1.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="attachment_15464"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">В</span><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">ы­вод информа­ции о сег­ментах с помощью `readelf`</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Ес­ли пос­мотреть вни­матель­но на рисунок, то вид­но, что, помимо самих заголов­ков прог­раммы, выводит­ся и информа­ция о соот­ветс­твии тому или ино­му сег­менту тех или иных сек­ций (при этом так­же вид­но, что в сег­ментах с номера­ми 00 и 07 сек­ции отсутс­тву­ют).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Итак, основные поля заголов­ка прог­раммы таковы:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2209e583449872"></a><span style=" font-size:15px;">p</span><span style=" font-size:15px;">_type</span> — это поле опре­деля­ет тип сег­мента. Воз­можные зна­чения так­же пред­став­лены в фай­ле /usr/include/elf.h. Наибо­лее важ­ные зна­чения: </li>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e2209f036408171"></a><span style=" font-size:15px;">P</span><span style=" font-size:15px;">T_HDR</span> — с дан­ного заголов­ка начина­ется таб­лица заголов­ков прог­раммы (как мы уже говори­ли, опи­сан­ный этим заголов­ком сег­мент пус­той);</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e220a1411475083"></a><span style=" font-size:15px;">P</span><span style=" font-size:15px;">T_LOAD</span> — сег­мент это­го типа пред­назна­чен для заг­рузки в память на эта­пе под­готов­ки про­цес­са к выпол­нению;</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e220a2586966080"></a><span style=" font-size:15px;">P</span><span style=" font-size:15px;">T_INTERP</span> — этот сег­мент содер­жит сек­цию .interp, в которой лежит имя интер­пре­тато­ра, исполь­зуемо­го при заг­рузке ELF-фай­ла;</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e220a3071825282"></a><span style=" font-size:15px;">P</span><span style=" font-size:15px;">T_DYNAMIC</span> — в этом сег­менте содер­жится сек­ция .dynamic с информа­цией о динами­чес­ких свя­зях, которая говорит, как раз­бирать и под­готав­ливать ELF-файл к выпол­нению (более под­робно об этой сек­ции погово­рим в сле­дующий раз);</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e220a4329159634"></a><span style=" font-size:15px;">P</span><span style=" font-size:15px;">T_GNU_STACK</span> — здесь хра­нит­ся информа­ция о сте­ке, которая опре­деля­ется зна­чени­ем фла­га pt_flags и показы­вает, что стек не дол­жен исполнять­ся (зна­чение pt_flags рав­но PF_R и PF_W). Отсутс­твие дан­ного сег­мента говорит о том, что содер­жимое сте­ка может быть исполне­но (что, как ты навер­няка зна­ешь, не есть хорошо);</li></ul>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e220a5760070096"></a><span style=" font-size:15px;">p</span><span style=" font-size:15px;">_flags</span> — опре­деля­ет пра­ва дос­тупа к сег­менту во вре­мя выпол­нения ELF-фай­ла (самые глав­ные зна­чения это­го поля: PF_R — чте­ние, PF_W — запись, PF_X — выпол­нение);</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e220a7238424229"></a><span style=" font-size:15px;">p</span><span style=" font-size:15px;">_offset</span>, <a name="crayon-63ca3a4e220a8006666716"></a><span style=" font-size:15px;">p</span><span style=" font-size:15px;">_vaddr</span> и <a name="crayon-63ca3a4e220a9383972612"></a><span style=" font-size:15px;">p</span><span style=" font-size:15px;">_filesz</span> — зна­чения этих полей ана­логич­ны зна­чени­ям полей sh_offset, sh_addr и sh_size в заголов­ке сек­ции;</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e220aa587468753"></a><span style=" font-size:15px;">p</span><span style=" font-size:15px;">_addr</span> — обыч­но зна­чение это­го поля для сов­ремен­ных вер­сий Linux рав­но нулю (хотя изна­чаль­но здесь хра­нил­ся адрес в физичес­кой памяти, по которо­му дол­жен быть заг­ружен сег­мент);</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e220ab375946960"></a><span style=" font-size:15px;">p</span><span style=" font-size:15px;">_memsz</span> — раз­мер сег­мента в памяти (если вспом­нить о наличии сек­ции .bss, которая может вхо­дить в сос­тав сег­мента, то ста­нет понят­но, почему раз­мер сег­мента в фай­ле может быть мень­ше, чем раз­мер сег­мента в памяти);</li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e220ad390198350"></a><span style=" font-size:15px;">p</span><span style=" font-size:15px;">_align</span> — это поле ана­логич­но полю sh_addralign в заголов­ке сек­ции.</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Ну а скрипт на Python (с исполь­зовани­ем модуля lief) для прос­мотра информа­ции о сег­ментах ELF-фай­ла может выг­лядеть при­мер­но так:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<table border="0" style=" border-style:solid; margin-top:0px; margin-bottom:0px; margin-left:-31px; margin-right:0px;" align="center" width="80%" cellspacing="-1" cellpadding="0" bgcolor="#ffffff">
<tr>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e220ae161449148"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">5</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">6</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">7</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">9</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">10</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">11</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">12</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">13</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">14</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">15</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">16 </span></p></td>
<td>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:20px;"><a name="crayon-63ca3a4e220ae161449148-1"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">i</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">mport lief</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e220ae161449148-2"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">f</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">rom lief import ELF</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e220ae161449148-3"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">e</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">lf_object = lief.parse('example_pie')</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e220ae161449148-4"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">s</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">egments = elf_object.segments</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e220ae161449148-5"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">f</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">or segment in segments:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e220ae161449148-6"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> sections = segment.sections</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e220ae161449148-7"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> section_names = &quot;, &quot;.join([section.name for section in sections])</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e220ae161449148-8"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> flags_str = [&quot;-&quot;] * 3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e220ae161449148-9"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> if ELF.SEGMENT_FLAGS.R in segment:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e220ae161449148-10"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">   flags_str[0] = &quot;R&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e220ae161449148-11"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> if ELF.SEGMENT_FLAGS.W in segment:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e220ae161449148-12"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">   flags_str[1] = &quot;W&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e220ae161449148-13"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> if ELF.SEGMENT_FLAGS.X in segment:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e220ae161449148-14"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">   flags_str[2] = &quot;X&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e220ae161449148-15"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> flags_str = &quot;&quot;.join(flags_str)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="crayon-63ca3a4e220ae161449148-16"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> print(str(segment.type).split(&quot;.&quot;)[-1], flags_str, section_names)</span></p></td></tr></table>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<h2 style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="zaklyuchenie"></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">З</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">аключение</span></h2>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Этой стать­ей мы начали пог­ружение во все тон­кости фор­мата ELF-фай­лов. Мы разоб­рались с фор­матом заголов­ка, с таб­лицами заголов­ков сек­ций и сег­ментов, а так­же заг­лянули внутрь некото­рых из них. Как видишь, отли­чия от PE-фор­мата весь­ма сущес­твен­ные, хотя некото­рые ана­логии все же прос­лежива­ются.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">В сле­дующий раз мы изу­чим более под­робно содер­жание и наз­начение дру­гих сек­ций, а так­же раз­берем­ся с ком­понов­кой и свя­зыва­нием раз­личных фун­кций из биб­лиотек с исполня­емым фай­лом.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p></body></html>