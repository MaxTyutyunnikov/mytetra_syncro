<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Вопрос</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">DjVu — это же ведь формат для сканированных документов, правильно? Программа что, распознаёт сканы и делает из них текст?</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Ответ</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Не текст, а скорее алфавит изображений символов и «текст» из них.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Документ DjVu состоит из страниц. Страницы содержат (опционально) 2 слоя: <span style=" font-family:'FreeMono'; color:#6a1009;">foreground</span> - слой иллюстраций и изображений сжатых с помощью <span style=" font-family:'FreeMono'; color:#6a1009;">IW44 wavelet encoder</span> (c44 из пакета <span style=" font-family:'FreeMono'; color:#6a1009;">DjVuLibre</span>); и <span style=" font-family:'FreeMono'; color:#6a1009;">background</span> - слой «текста». Слой текста представляет собой изображение формата <span style=" font-family:'FreeMono'; color:#6a1009;">JB2</span> (<span style=" font-family:'FreeMono'; color:#6a1009;">cjb2</span> из пакета <span style=" font-family:'FreeMono'; color:#6a1009;">DjVuLibre</span>).</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Кодировщик берет ч/б изображение с текстом (скан), режет его на изображения символов (по белому цвету отделяет). Далее из них выкидывается слишком мелкий мусор. Далее символы приемлемого размера сравниваются друг с другом и тем самым классифицируются по степени похожести на n классов. Далее для каждого класса выбирается его представитель (усредненное изображение обычно). Из всего этого формируется локальный словарь (<span style=" font-family:'FreeMono'; color:#6a1009;">Sjbz</span>) и набор инструкций. Каждая инструкция выводит символ из локального словаря, либо просто символ (если он уникален и в словарь не попал), по заданным координатам. Т.о. отсканированному тексту по сути делают алфавит типовых изображений и этим алфавитом заново его набирают. Просмотрщик DjVu документа (напр. <span style=" font-family:'FreeMono'; color:#6a1009;">DjView4</span>) рендерит <span style=" font-family:'FreeMono'; color:#6a1009;">JB2</span> изображение опираясь на локальный словарь (<span style=" font-family:'FreeMono'; color:#6a1009;">Sjbz</span>) и набор инструкций к нему.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Очевидно, что можно взять несколько страниц, и сделать общий для них словарь (+ локальный для того, что встречается только на одной странице, но по нескольку раз). Это будет словарь <span style=" font-family:'FreeMono'; color:#6a1009;">Djbz</span>, который по сути является локальным словарем виртуального <span style=" font-family:'FreeMono'; color:#6a1009;">JB2</span> изображением размера (0,0) и без инструкций. Т.о. при рендеринге страницы, если она использует общий словарь, то берется словарь <span style=" font-family:'FreeMono'; color:#6a1009;">Djbz</span>, на который она ссылается, добавляется к нему её личный <span style=" font-family:'FreeMono'; color:#6a1009;">Sjbz</span> словарь и читаются её инструкции по отрисовке, которые ссылаются на символы этого общего составного словаря по индексам.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">(На самом деле все немножко сложнее, т.к. символ может быть закодирован с использованием «прототипа», т.е. представлять собой другой символ с примененной к нему маской. Ну, типа «В» и «Р» могут одно из другого выводится. И нужно оговориться, что DjVu опирается только на внешний вид символов при реконструкции исходной страницы. Т.е. А и А курсивом или другим шрифтом или другим размером шрифта - это будут разные entry в словаре.)</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Так вот, штатный <span style=" font-family:'FreeMono'; color:#6a1009;">cjb2</span> кодировщик ч.б. изображений (скана) в <span style=" font-family:'FreeMono'; color:#6a1009;">jb2</span> слой из пакета <span style=" font-family:'FreeMono'; color:#6a1009;">DjVuLibre</span> умеет работать только с 1 изображением за раз и делает только <span style=" font-family:'FreeMono'; color:#6a1009;">Sjbz</span>. <span style=" font-family:'FreeMono'; color:#6a1009;">Djbz</span> словари он делать не умеет.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">А <span style=" font-family:'FreeMono'; color:#6a1009;">minidjvu-mod</span> - это аналог <span style=" font-family:'FreeMono'; color:#6a1009;">cjb2</span>, который это умеет.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>