<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Схемы синхронизации каталогов бывают разными. Самая простая схема - это синхронизация каталогов на двух компьютерах. Но бывают и более экзотические схемы синхронизации, например если компьютеры с синхронизируемыми каталогами недоступны друг другу напрямую. В таком случае синхронизацию можно организовывать через промежуточный компьютер, на котором размещается синхронизируемый каталог с файлами, в который &quot;прилетают&quot; изменения с обеих сторон, и из которого &quot;вытягиваются&quot; изменения в обе стороны.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14pt; font-weight:600;">Почему для синхронизации не подходит rsync?</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Rsync - это утилита резервного копирования. Она умеет делать полный дубликат директории-источника в директорию приемника. И такое простое поведение не подходит для организации процесса синхронизации в случае, если файлы в директории изменяются как на стороне источника, так и на стороне приемника. По-сути, при применении <span style=" font-family:'FreeMono'; color:#6a1009;">rsync</span>, все изменения в файлах приемника просто перезатрутся содержимым файла источника, если файлы будут различаться.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Поэтому для организации настоящего процесса синхронизации нужно пользоваться другим классом программ, которые специально предназначены для .</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14pt; font-weight:600;">Что такое утилита Unison</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.cis.upenn.edu/~bcpierce/unison/"><span style=" text-decoration: underline; color:#0000ff;">Unison</span></a> - это замечательная кроссплатформенная утилита, предназначенная для двусторонней синхронизации директорий. Она написана на языке <span style=" font-family:'FreeMono'; color:#6a1009;">ocalm</span>. Так как язык в некоторой степени экзотичен, авторы выкладывают статические сборки на странице проекта на GitHub:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://github.com/bcpierce00/unison/releases"><span style=" text-decoration: underline; color:#0000ff;">https://github.com/bcpierce00/unison/releases</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Там можно подобрать версию, подходящую для различных дистрибутивов Linux, имеющих различные версии ядер и библиотеки LIBC. Этой утилитой можно пользоваться как в консоли, так и через GTK-интерфейс, поставляемый в виде дополнительного бинарника. Помимо Linux-платформ, утилита unison имеет статические сборки для Windows и MacOs.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В процессе работы утилита <span style=" font-family:'FreeMono'; color:#6a1009;">unison</span> создает в пользовательской директории каталог с названием &quot;.unison&quot;, в котором скапливается информация о состоянии файлов в директориях, которые участвуют в синхронизации. По-сути, <span style=" font-family:'FreeMono'; color:#6a1009;">unison</span> запоминает информацию о том, в каком состоянии файл был, и в случае его изменения на любой стороне синхронизации, копирует в нужную сторону состояние именно измененного файла. Для процесса передачи содержимого файлов <span style=" font-family:'FreeMono'; color:#6a1009;">unison</span> использует механизм утилиты <span style=" font-family:'FreeMono'; color:#6a1009;">rsync</span>, как наиболее быстродействующий из открытых реализаций процесса копирования файлов.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Далее будет рассматриваться настройка консольного варианта. Настройка в консоли наиболее кроссплатформенна и поддерживает весь набор возможностей этой программы.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14pt; font-weight:600;">Синхронизация двух компьютеров через третий</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Чтобы говорить предметно, далее будет описана схема синхронизации директорий, расположенных на двух разных компьютерах, через третий, промежуточный. На самом деле, ничего не мешает настроить синхронизацию просто между двумя компьютерами: на первом запускается синхронизация со вторым, на втором - с первым. Однако здесь рассматривается более сложный случай. Как он может возникнуть?</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Имеется сеть предприятия, в которой выделены два напрямую несвязанных между собой сегмента сети: &quot;защищенный&quot; и &quot;для всех&quot;. В &quot;защищенной&quot; сети имеется хост с Linux. В &quot;сети для всех&quot; имеется хост с Windows. Между сетями находится Linux-сервер, на который имеется доступ в качестве непривелегированного пользователя по протоколу SSH. К этому серверу можно коннектиться как в защищенной сети, так и из &quot;сети для всех&quot;. Размещение компьютеров выглядит примерно так:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1613819705pfzi4ey3se.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Задача: получить синхронизацию файлового каталога между <span style=" font-family:'FreeMono'; color:#6a1009;">linuxhost</span> и <span style=" font-family:'FreeMono'; color:#6a1009;">winhost</span>. Сложность в том, что server находится не под нашим контролем, мы просто пользователи, имеющие SSH-доступ на <span style=" font-family:'FreeMono'; color:#6a1009;">server</span>, и не более того. А это значит, что установить нужное дополнительное системное ПО на сервер (тот же unison) не представляется возможным.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Тем не менее, даже в таких условиях сделать синхронизацию через <span style=" font-family:'FreeMono'; color:#6a1009;">unison</span> возможно.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14pt; font-weight:600;">Настройка server</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Мы не является администраторами <span style=" font-family:'FreeMono'; color:#6a1009;">server</span>, но можем произвести нужные настройки у себя в каталоге пользователя. Для правильной работы <span style=" font-family:'FreeMono'; color:#6a1009;">unison</span> необходимо, чтобы он был установлен на обоих компьютерах, участвующих в синхронизации. В нашем случае синхронизируются пары <span style=" font-family:'FreeMono'; color:#6a1009;">server-winhost</span> и <span style=" font-family:'FreeMono'; color:#6a1009;">server-linuxhost</span>. А это значит, что на всех трех компьютерах должен быть установлен <span style=" font-family:'FreeMono'; color:#6a1009;">unison</span>.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Хорошая новость в том, что, как было сказано выше, сборки <span style=" font-family:'FreeMono'; color:#6a1009;">unison</span> распространяются статически, и могут быть запущены из любого каталога операционной системы.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для настройки сервера, надо залить в каталог пользователя статический дистрибутив <span style=" font-family:'FreeMono'; color:#6a1009;">unison</span> и проверить как он работает. Заливку можно сделать из Linux с помощью Midnight Commander через пункт меню &quot;Shell-соединение&quot;. Заливку из Windows можно сделать через утилиту WinSCP. В любом случае, после заливки надо войти своим пользователем на сервер через SSH и проверить как выполняется <span style=" font-family:'FreeMono'; color:#6a1009;">unison</span>. Например, если дистрибутив <span style=" font-family:'FreeMono'; color:#6a1009;">unison</span> был залит в каталог:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">/home/user/portableSoft/unison</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">... то для проверки можно запустить команду:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">/home/user/portableSoft/unison/bin/unison -help</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если команда выполнилась без ошибок, небыло сообщений о неподходящей версии ядра или неподдерживаемой версии LIBC, то настройку можно продолжать дальше. Если же <span style=" font-family:'FreeMono'; color:#6a1009;">unison</span> не запустился, надо подобрать версию дистрибутива этой утилиты. Возможно, что надо попробовать более старую. Как было сказано выше, авторы делают официальные сборки и в более старых окружениях.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">На этом настройка <span style=" font-family:'FreeMono'; color:#6a1009;">server</span> закончена.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14pt; font-weight:600;">Настройка winhost</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вначале лучше заняться настройкой Windows-машины, потому что соединение linux-linux сделать достаточно просто, а вот с windows-linux придется поковыряться.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Настройка ключей SSH</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для начала в Windows нужно установить пакет OpenSSH. Он необходим, чтобы соединение winhost-server устанавливалось с помощью ключей шифрования, и не требовало ввода логина-пароля. Автор статьи устанавливает OpenSSH вместе с Git for Windows, так как OpenSSH сразу идет в комплекте с этой системой контроля версий. Но можно поставить OpenSSH и отдельно по следующей ссылке:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">https://remoteshaman.com/project/openssh-for-windows</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В любом случае после установки OpenSSH необходимо убедиться, что исполнимые файлы типа <span style=" font-family:'FreeMono'; color:#6a1009;">ssh.exe</span> и <span style=" font-family:'FreeMono'; color:#6a1009;">ssh-keygen.exe</span> были доступны на исполнение. Для этого в переменную PATH пользователя (или в системный PATH) должен быть прописан путь до директории, в которой расположены эти исполняемые файлы.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Далее необходимо сгенерировать пару открытого и закрытого ключа. Для этого необходимо запустить утилиту <span style=" font-family:'FreeMono'; color:#6a1009;">ssh-keygen</span>:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1614602352gk21axyigt.png" /></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">На все запросы, в том числе на запрос ввести passphrase, надо нажимать Enter. В результате в каталоге пользователя будет создан каталог <span style=" font-family:'FreeMono'; color:#6a1009;">/.ssh</span>, в котором будет лежать два файла: <span style=" font-family:'FreeMono'; color:#6a1009;">id_rsa</span> и <span style=" font-family:'FreeMono'; color:#6a1009;">id_rsa.pub</span>. Это закрытый и открытый ключи шифрования SSH-сессии.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Публичный ключ надо прописать на <span style=" font-family:'FreeMono'; color:#6a1009;">server</span> в файл <span style=" font-family:'FreeMono'; color:#6a1009;">/home/user/.ssh/authorized_keys</span>. Если этого файла нет, его можно создать. Публичный ключ пlinkedinользователя прописывается в виде одной строки в данном файле. Либо же можно воспользоваться утилитой <span style=" font-family:'FreeMono'; color:#6a1009;">ssh-copy-id</span> , если таковая присутствует в системе:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">&gt; ssh-copy-id user@server</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">После этого надо проверить вход на сервер без пароля:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">&gt; ssh user@server</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если вход произведен, и видно приглашение командной строки Linux, то дальнейшая настройка должна пройти без каких-либо проблем. Для выхода из удаленной консоли можно дать команду <span style=" font-family:'FreeMono'; color:#6a1009;">exit</span>.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Настройка unison в Windows</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для работы unison необходимо, чтобы дистрибутив этой утилиты был установлен в Windows. Далее предполагается, что unison установлен в каталог <span style=" font-family:'FreeMono'; color:#6a1009;">C:\tools\unison</span>, а исполнимый файл unison находится по пути <span style=" font-family:'FreeMono'; color:#6a1009;">C:\tools\unison\bin\unison.exe</span>.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для запуска синхронизации используется команда, которую можно прописать в bat-файл:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">C:\tools\unison\bin\unison.exe C:\Users\user\data ^</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;"> ssh://user@server//home/user ^</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;"> -ignore=&quot;Path .git/*&quot; ^</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;"> -ignore=&quot;Regex ^\.git.*&quot; ^</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;"> -servercmd=&quot;/home/user/portableSoft/unison/bin/unison&quot; ^</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;"> -auto -batch -terse</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В первом параметре команды указывается каталог, который должен быть засинхронизирован.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Во втором параметре команды указывается каталог на удаленном сервере, в котором будет размещаться копия данных. Следует обратить внимание, что в этом пути не указывается непосредственно конечный каталог синхронизации. То есть, не пишется <span style=" font-family:'FreeMono'; color:#6a1009;">/home/user/data</span>, а пишется просто <span style=" font-family:'FreeMono'; color:#6a1009;">/home/user</span>. Тем не менее, так как в первом параметре указан каталог-источник <span style=" font-family:'FreeMono'; color:#6a1009;">data</span>, то конечный каталог на удаленном сервере получится <span style=" font-family:'FreeMono'; color:#6a1009;">/home/user/data</span>.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Следующие две опции показывают, как исключить файлы и каталоги, которые не должны попадать в синхронизируемые данные. В данном случае отключается синхронизация подкаталога <span style=" font-family:'FreeMono'; color:#6a1009;">\.git</span> и всего его содержимого.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Следующая опция <span style=" font-family:'FreeMono'; color:#6a1009;">-servercmd</span> показывает, какая команда на удаленном сервере будет использоваться для запуска утилиты unison на удаленном сервере. Именно эта опция и позволяет использовать не системную утилиту unison (которой может и не быть в системе), а утилиту, установленную в пользовательский каталог.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Завершающие опции нужны для того, чтобы unison делал синхронизацию не задавая лишних вопросов. Однако следует учесть, что <span style=" text-decoration: underline;">первый</span> запуск <span style=" font-family:'FreeMono'; color:#6a1009;">unison</span> будет сопровождаться различными вопросами, независимо от наличия данных опций.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если все сделано правильно, то на <span style=" font-family:'FreeMono'; color:#6a1009;">server</span> появится полная копия каталога <span style=" font-family:'FreeMono'; color:#6a1009;">C:\Users\user\data</span>.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">После этого можно будет менять как файлы на <span style=" font-family:'FreeMono'; color:#6a1009;">server</span>, так файлы и на <span style=" font-family:'FreeMono'; color:#6a1009;">winhost</span>, и после запуска вышеприведенной команды эти изменения будут применяться на соответствующей стороне. При этом, запускать <span style=" font-family:'FreeMono'; color:#6a1009;">unison</span> надо только на <span style=" font-family:'FreeMono'; color:#6a1009;">winhost</span>.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14pt; font-weight:600;">Настройка linuxhost</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Настройку linuxhost провести гораздо проще, чем компьютер с Windows, потому что все сетевые SSH-утилиты обычно заранее присутствуют в Linux-системе.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Настройка ключей SSH</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Настройка ключей SSH производится стандартным для Linux способом. Вначале через <span style=" font-family:'FreeMono'; color:#6a1009;">ssh-keygen</span> создается пара ключей для текущего пользователя. Затем через утилиту <span style=" font-family:'FreeMono'; color:#6a1009;">ssh-copy-id</span> публичный ключ прописывается на <span style=" font-family:'FreeMono'; color:#6a1009;">server</span>. Через утилиту <span style=" font-family:'FreeMono'; color:#6a1009;">ssh</span> проверяется вход на <span style=" font-family:'FreeMono'; color:#6a1009;">server</span>, он должен будет произвестись без пароля.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Настройка unison на linuxhost</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Утилита unison устанавливается на <span style=" font-family:'FreeMono'; color:#6a1009;">linuxhost</span> точно так же как и на <span style=" font-family:'FreeMono'; color:#6a1009;">server</span>. Предполагается, что на <span style=" font-family:'FreeMono'; color:#6a1009;">linuxhost</span> утилита <span style=" font-family:'FreeMono'; color:#6a1009;">unison</span> установлена в каталог <span style=" font-family:'FreeMono'; color:#6a1009;">/opt/unison</span>. Далее, для удобства, создается исполнимый sh-файл со следующими командами:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">#!/bin/bash</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">/opt/unison/bin/unison /home/user/work/data \</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;"> ssh://user@server//home/user \</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;"> -ignore=&quot;Path .git/*&quot; \</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;"> -ignore=&quot;Regex ^\.git.*&quot; \</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;"> -servercmd=&quot;/home/user/portableSoft/unison/bin/unison&quot; \</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;"> -auto -batch -terse</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">exit 0</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">По сути, здесь используются абсолютно те же опции, которые применялись на <span style=" font-family:'FreeMono'; color:#6a1009;">winhost</span>, только путь к синхронизируемому каталогу на <span style=" font-family:'FreeMono'; color:#6a1009;">linuxhost</span> другой.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Здесь следует обратить внимание на команду <span style=" font-family:'FreeMono'; color:#6a1009;">exit 0</span>. Она нужна потому, что <span style=" font-family:'FreeMono'; color:#6a1009;">unison</span> в Linux по какой-то причине генерирует код ошибки в случае, если были обнаружены изменения в файлах. Если данный bash-скрипт планируется использовать в составе другого ПО, которое обрабатывает коды ошибок и показывает предупреждения в случае ненулевого кода выхода, то лучше принудительно устанавливать нуливой код ошибки, так как изменения в файлах - это нормальное состояние системы синхронизации.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14pt; font-weight:600;">Разрешение конфликтов</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если данными в синхронизируемом каталоге управляет один человек, а периодичность запуска команды синхронизации меньше времени, за которое человек успевает перейти с &quot;рабочего места 1&quot; на &quot;рабочее место 2&quot;, то никаких конфликтов синхронизации возникнуть не может при условии, что сеть работает стабильно. Но в реальной жизни соблюдать такие идеальные условия не всегда возможно. И кроме того, существуют задачи, когда разные люди или программы работают с одним и тем же каталогом, синхронизирующемся через Unison.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Поэтому может возникнуть ситуация, когда один и тот же файл был по-разному изменен одновременно и на одном и на втором рабочем месте, и только потом запущена синхронизация. Что в этом случае будет делать Unison? Если в опциях присутствует опция <span style=" font-family:'FreeMono'; color:#6a1009;">-auto</span> (что эквивалентно <span style=" font-family:'FreeMono'; color:#6a1009;">-auto=true</span>), то конфликтующие файлы будут пропущены. И для этих файлов, по-сути, никакой синхронизации не произойдет. И это явно не то поведение, которое ожидается от системы синхронизации файловых каталогов.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если убрать опцию <span style=" font-family:'FreeMono'; color:#6a1009;">-auto</span>, то в случае обнаружения конфликта, будет запущен консольный диалог выбора, какой вариант файла нужно считать правильным. Такое поведение тоже не подходит для синхронизации, которая, например, периодически запускается в виде фонового процесса.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для решения вопроса о том, как синхронизировать конфликтующие файлы, в Unison сделана опция <span style=" font-family:'FreeMono'; color:#6a1009;">-prefer</span> (предпочтение). Значения этой опции могут быть следующими:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">путь к локальному каталогу - говорит о том, что предпочтительный будет локальный файл</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">путь к удаленному каталогу - говорит о том, что предпочтительный будет файл, находящийся &quot;На другой стороне&quot;</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">newer</span> - говорит о том, что предпочтительным надо считать файл с более новой меткой времени</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">older</span> - говорит о том, что предпочтительным надо считать файл с более старой меткой времени</li></ul>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В случае с синхронизацией через промежуточный хост, правильней всего работает стратегия отдавать предпочтение изменениям, полученным с этого промежуточного хоста. То есть, промежуточный хост считается своеобразным &quot;центральным сервером&quot; который собирает изменения с синхронизируемых каталогов, и после того как он изменения принял, они должны быть обязательно доставлены в остальные синхронизируемые каталоги.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Поэтому, в случае схемы синхронизации двух хостов через промежуточный, в опции предпочтения должен быть указан путь к удаленному каталогу и на winhost, и на linuxhost:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">-prefer=ssh://user@server//home/user</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Примечание:</span> помимо опции <span style=" font-family:'FreeMono'; color:#6a1009;">-prefer</span>, в Unison есть похожая опция <span style=" font-family:'FreeMono'; color:#6a1009;">-force</span>, у которой возможные значения либо имя пользователя, либо <span style=" font-family:'FreeMono'; color:#6a1009;">newer</span> / <span style=" font-family:'FreeMono'; color:#6a1009;">older</span>. (Что будет происходить, если в системе присутствуют пользователи с именами <span style=" font-family:'FreeMono'; color:#6a1009;">newer</span> или <span style=" font-family:'FreeMono'; color:#6a1009;">older</span> - непонятно). В любом случае, при использовании значений <span style=" font-family:'FreeMono'; color:#6a1009;">newer</span> или <span style=" font-family:'FreeMono'; color:#6a1009;">older</span>, действие опции <span style=" font-family:'FreeMono'; color:#6a1009;">-force</span> аналогично действию <span style=" font-family:'FreeMono'; color:#6a1009;">-prefer</span>, но чтобы <span style=" font-family:'FreeMono'; color:#6a1009;">-force</span> сработало, необходимо наличие опции <span style=" font-family:'FreeMono'; color:#6a1009;">-times</span>. Поэтому, если понадобится указывать предпочтение более нового или более старого файла, проще воспользоваться <span style=" font-family:'FreeMono'; color:#6a1009;">-prefer</span> опцией.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14pt; font-weight:600;">Завершающие действия</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Далее можно прописать вызовы вышеуказанных скриптов на <span style=" font-family:'FreeMono'; color:#6a1009;">winhost</span> и на <span style=" font-family:'FreeMono'; color:#6a1009;">linuxhost</span> в систему запуска программ по расписанию, установить необходимый период синхронизации, и получится три идентичных копии каталога на компьютерах <span style=" font-family:'FreeMono'; color:#6a1009;">winhost</span>, <span style=" font-family:'FreeMono'; color:#6a1009;">linuxhost</span> и <span style=" font-family:'FreeMono'; color:#6a1009;">server</span>. По сути, получается система трехточечной синхронизации: любое изменение в каталоге синхронизации на любом компьютере будет перекидываться на другие. И для организации такой синхронизирующейся системы не требуются даже административные права.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>