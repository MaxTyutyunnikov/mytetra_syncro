<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:8.25pt; color:#333333; background-color:#ffffff;">В одном проекте, понадобилось много битовых флагов Выделять на каждый флаг по байту — это роскошь. имея в STM32 bit-band, написал макрос, может кому то пригодится </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; font-size:8.25pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">// Сама переменная, где будут наши флаги,можно заранее проинициализировать</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000088; background-color:transparent;">unsigned</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000088; background-color:transparent;">int</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#660066; background-color:transparent;">BitBandArray</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">=</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">0</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">;</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">// SRAM_BASE начало памяти</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">// SRAM_BB_BASE  -  где начинается битбанд алиас памяти </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">// Объявлено тут stm32f10x.h </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">// Сам макрос  первый параметр - номер бита, второй  имя перемененной, где биты хранятся</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#define BitBand(b,a)  (*((char *)SRAM_BB_BASE+(((int)&amp;a)SRAM_BASE )*32+b*4))</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">// Сами флаги</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#define AxelFlag  BitBand(0,BitBandArray)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#define PowerGood BitBand(1,BitBandArray)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#define BatFlag   BitBand(2,BitBandArray)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">// И так 32 раза</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">////////////////</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">// Теперь можем к ним обращаться как к обычным переменным</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">////////////////</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">// Присвоение</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#660066; background-color:transparent;">AxelFlag</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">=</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">1</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">;</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">// Чтение</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000088; background-color:transparent;">if</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">(</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#660066; background-color:transparent;">PowerGood</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">==</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">1</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    <span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">{</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    <span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; font-size:8.25pt; color:#666600;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; font-size:8.25pt; color:#666600;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Примечание</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="comment_id_153349"></a><span style=" font-family:'Tahoma,Arial,sans-serif'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">В</span><span style=" font-family:'Tahoma,Arial,sans-serif'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;"> приведенном макросе есть ошибка, должно быть:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Tahoma,Arial,sans-serif'; font-size:8.25pt; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:20px; margin-right:30px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#define BitBand(b, a)  (*((char *)SRAM_BB_BASE + (((unsigned)&amp;a) - SRAM_BASE )*32+b*4))</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'MS Shell Dlg 2'; font-size:8.25pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Попробовал скомпилить, посмотрел, что вышло. Оказалось битовые поля даже быстрее, на такт. Компилятор почему-то не смог вычилить адрес во время компиляции, может LTO поможет, мне лень пробовать. Но он все равно не атомарны, в отличии от bit-band.</p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:20px; margin-right:30px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000088; background-color:transparent;">struct</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#660066; background-color:transparent;">Foo</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">{</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        <span style=" font-family:'Courier New'; font-size:8.25pt; color:#000088; background-color:transparent;">unsigned</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> flag1</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">:</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">1</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        <span style=" font-family:'Courier New'; font-size:8.25pt; color:#000088; background-color:transparent;">unsigned</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> flag2</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">:</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">1</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        <span style=" font-family:'Courier New'; font-size:8.25pt; color:#000088; background-color:transparent;">unsigned</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> flag3</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">:</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">1</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">        <span style=" font-family:'Courier New'; font-size:8.25pt; color:#000088; background-color:transparent;">unsigned</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> flag4</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">:</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">1</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">}</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">foo</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000088; background-color:transparent;">unsigned</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000088; background-color:transparent;">int</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#660066; background-color:transparent;">BitBandArray</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">=</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">0</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#define BitBand(b, a)  (*((char *)SRAM_BB_BASE + (((unsigned)&amp;a)-SRAM_BASE )*32+b*4))</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#define AxelFlag  BitBand(0,BitBandArray)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#define PowerGood BitBand(1,BitBandArray)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#define BatFlag   BitBand(2,BitBandArray)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000088; background-color:transparent;">void</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#660066; background-color:transparent;">Bar</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">()</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">{</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    <span style=" font-family:'Courier New'; font-size:8.25pt; color:#660066; background-color:transparent;">AxelFlag</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">=</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">1</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    <span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">803e594</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">:</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">    </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">4b05</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">            ldr     r3</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">,</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">[</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">pc</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">,</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#20]   ; (803e5ac &lt;Bar+0x18&gt;)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    <span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">803e596</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">:</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">    </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">015b</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">            lsls    r3</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">,</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> r3</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">,</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#5</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    <span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">803e598</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">:</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">    f103 </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">5308</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">       add</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">.</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">w   r3</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">,</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> r3</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">,</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#570425344      ; 0x22000000</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    <span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">803e59c</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">:</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">    </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">2201</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">            movs    r2</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">,</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#1</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    <span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">803e59e</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">:</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">    </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">701a</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">            strb    r2</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">,</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">[</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">r3</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">,</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#0]</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    foo<span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">.</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">flag2 </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">=</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">1</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    <span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">803e5a0</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">:</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">    </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">4b03</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">            ldr     r3</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">,</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">[</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">pc</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">,</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#12]   ; (803e5b0 &lt;Bar+0x1c&gt;)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    <span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">803e5a2</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">:</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">    </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">781a</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">            ldrb    r2</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">,</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">[</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">r3</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">,</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#0]</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    <span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">803e5a4</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">:</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">    f042 </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">0202</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">       orr</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">.</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">w   r2</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">,</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> r2</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">,</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#2</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    <span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">803e5a8</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">:</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">    </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">701a</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">            strb    r2</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">,</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">[</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">r3</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">,</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#0]</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    <span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">803e5aa</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">:</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">    </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">4770</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">            bx      lr</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    <span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">803e5ac</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">:</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">    </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">20000000</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">        </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">.</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">word   </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">0x20000000</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    <span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">803e5b0</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">:</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">    </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">200008c8</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">        </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">.</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">word   </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">0x200008c8</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">}</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В случае bit-band идет вычисление адреса и запись, с битовым полем — чтение, модификация, запись.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:30px; -qt-block-indent:0; text-indent:0px; font-family:'MS Shell Dlg 2'; font-size:8.25pt; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><a name="comment_wrapper_id_153357"></a><span style=" font-family:'Tahoma,Arial,sans-serif'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">Т</span><span style=" font-family:'Tahoma,Arial,sans-serif'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">о есть, если нет потребности в атомарности, то битовые поля — норм? Ну, то есть других особых каких-то у них проблем нет? (я просто сам недавно о них узнал и начал применять, да и в Сях я очень новичок… А как увидел, подумал — «какая удобная штука!» Так что благодарю за информацию!)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Примечание 2</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="comment_id_153361"></a><span style=" font-family:'Tahoma,Arial,sans-serif'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">А</span><span style=" font-family:'Tahoma,Arial,sans-serif'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;"> так не проще?</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:20px; margin-right:30px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#define     BIT_SET(var,mask)   { var |= (mask); }</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#define     BIT_CLEAR(var,mask) { var &amp;= ~(mask); }</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#define     BIT_TOGGLE(var,mask) { var ^= (mask); }</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#define     IS_BIT_SET(var,mask)      ( (var) &amp; (mask) )</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#define     IS_BIT_CLEARED(var,mask)  (!( (var) &amp; (mask) ))</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:30px; -qt-block-indent:0; text-indent:0px; font-family:'MS Shell Dlg 2'; font-size:8.25pt; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><a name="comment_wrapper_id_153430"></a><span style=" font-family:'Tahoma,Arial,sans-serif'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">о</span><span style=" font-family:'Tahoma,Arial,sans-serif'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">чень интересно, но стоит переписать так:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:30px; -qt-block-indent:0; text-indent:0px; font-family:'Tahoma,Arial,sans-serif'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;"><br /></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:20px; margin-right:30px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#define     BIT_SET(var,mask)   do{ var |= (mask); }while(0)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#define     BIT_CLEAR(var,mask) do{ var &amp;= ~(mask); }while(0)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#define     BIT_TOGGLE(var,mask) do{ var ^= (mask); }while(0)</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:30px; -qt-block-indent:0; text-indent:0px; background-color:#f7f7f7;"><a name="comment_wrapper_id_153431"></a><span style=" font-family:'Tahoma,Arial,sans-serif'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;">в</span><span style=" font-family:'Tahoma,Arial,sans-serif'; font-size:8.25pt; color:#000000; background-color:#f7f7f7;"> этом случае не будет проблем в следующем построении:</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:20px; margin-right:30px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000088; background-color:transparent;">if</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">(</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">cond</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    BIT_SET<span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">(</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000088; background-color:transparent;">var</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">,</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">mask</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">);</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000088; background-color:transparent;">else</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    BIT_CLEAR<span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">(</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000088; background-color:transparent;">var</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">,</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;">mask</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:30px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; font-size:8.25pt; color:#666600;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>