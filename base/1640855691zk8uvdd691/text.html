<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:8.25pt; color:#333333; background-color:#ffffff;">В одном проекте, понадобилось много битовых флагов Выделять на каждый флаг по байту — это роскошь. имея в STM32 bit-band, написал макрос, может кому то пригодится </span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"><br /></span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">//сама переменная, где будут наши флаги,можно заранее проинициализировать</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"><br /></span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000088; background-color:transparent;">unsigned</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000088; background-color:transparent;">int</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#660066; background-color:transparent;">BitBandArray</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">=</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">0</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">;</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"><br /></span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">//SRAM_BASE начало памяти</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"><br /></span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">//SRAM_BB_BASE  -  где начинается битбанд алиас памяти </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"><br /></span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">//объявлено тут stm32f10x.h </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"><br /></span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">//сам макрос  первый параметр - номер бита, второй  имя перемененной, где биты хранятся</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"><br /></span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#define BitBand(b,a)  (*((char *)SRAM_BB_BASE+(((int)&amp;a)SRAM_BASE )*32+b*4))</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"><br /></span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">//сами флаги</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"><br /></span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#define AxelFlag  BitBand(0,BitBandArray)</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"><br /></span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#define PowerGood BitBand(1,BitBandArray)</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"><br /></span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">#define BatFlag   BitBand(2,BitBandArray)</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"><br /></span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">// и так 32 раза</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"><br /><br /></span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">////////////////</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"><br /></span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">///теперь можем к ним обращаться как к обычным переменным</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"><br /></span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">//присвоение</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"><br /></span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#660066; background-color:transparent;">AxelFlag</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">=</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">1</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">;</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"><br /></span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#880000; background-color:transparent;">//чтение</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"><br /></span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000088; background-color:transparent;">if</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">(</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#660066; background-color:transparent;">PowerGood</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"> </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">==</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#006666; background-color:transparent;">1</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">)</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"><br />    </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">{</span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#000000; background-color:transparent;"><br />    </span><span style=" font-family:'Courier New'; font-size:8.25pt; color:#666600; background-color:transparent;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; font-size:8.25pt; color:#666600;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; font-size:8.25pt; color:#666600;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Примечание</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-weight:600;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; font-size:8.25pt; color:#666600;"><br /></p></body></html>