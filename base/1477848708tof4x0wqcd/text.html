<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Стендарт MPEG-4 итерации 2, известный так же как MPEG-4, Xvid и DivX - это видео-кодек, который широко использовался до распространения кодека H.264.<span style=" color:#000000;"> Конвертор FFmpeg имеет два энкодера для вывода видео в формате MPEG-4. Это внешнее кодирование с помощью библиотеки libxvid:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans Mono'; color:#6a0e07;">ffmpeg -i input.avi -c:v libxvid output.avi</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">и встроенный энкодер Mpeg-4:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans Mono'; color:#6a0e07;">ffmpeg -i input.avi -c:v mpeg4 -vtag xvid output.avi</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Встроенный энкодер имеет то преимущество, что не требует дополнительных библиотек. Оба энкодера обеспечивают выходной поток примерно одинакового качества, но для более низких битрейтов (например, для 1000 Кби/сек для формата 720p), libxvid будет давать более лучшее качество чем mpeg4.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">По-умолчанию, четырехбайтовая сигнатура стандарта FourCC, прописываемая в файл формата Mpeg4, будет FMP4. Если необходимо прописать другой код FourCC, можно воспользоваться опцией -vtag. Например, опция <span style=" font-family:'DejaVu Sans Mono'; color:#6a0e07;">-vtag xvid</span> заставит FFmpeg сохранить в сигнатуре FourCC формат XVID, а не формат по-умолчанию.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Примечание: в этом руководстве описывается использование контейнера AVI для содержимого формата Xvid, так как такая связка поддерживается всеми, даже достаточно старыми устройствами. Для современных устройств лучше подходят форматы H.264 для видео и AAC для аудио.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14pt; font-weight:600;">Настройка переменного битрейта через опцию qscale</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вы можете установить уровень качества генерируемого видеопотока через опцию <span style=" font-family:'DejaVu Sans Mono'; color:#6a0e07;">-qscale:v n</span> (данная опция имеет так же сокращенное обозначение <span style=" font-family:'DejaVu Sans Mono'; color:#6a0e07;">-q:v n</span>), где <span style=" font-family:'DejaVu Sans Mono'; font-weight:600; color:#6a0e07;">n</span> - это число от 1 до 31. Значение 1 обозначает лучшее качество и более большую длину результирующего файла, а 31 - более низкое качество и, соответственно, более малый размер файла. Эта опция задает режим с переменным битрейтом, и примерно аналогична опции <span style=" font-family:'DejaVu Sans Mono'; color:#6a0e07;">-qp</span> (постоянный параметр квантизации QP) для кодека x264. Использование переменного битрейта является предпочтительным способом, по сравнению с постоянным (константным) битрейтом.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Так же, можно указывать уровень качества для аудио-потока с помощью опции <span style=" font-family:'DejaVu Sans Mono'; color:#6a0e07;">-qscale:a n</span> (или, используя сокращение, <span style=" font-family:'DejaVu Sans Mono'; color:#6a0e07;">-q:a n</span>). Значение n меняется в зависимости от используемого энкодера. Для кодирования звука в MP3 нужно указывать значение, воспринимаемое енкодером <a name="result_box"></a>libmp3lame</p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="VariableBitRatewithqscale"></a><span style=" font-size:x-large; font-weight:600;">V</span><span style=" font-size:x-large; font-weight:600;">ariable Bit Rate with </span><span style=" font-family:'Courier New,courier'; font-size:x-large; font-weight:600;">qscale</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">You can select a video quality level with <span style=" font-family:'Courier New,courier';">-qscale:v n</span> (or the alias <span style=" font-family:'Courier New,courier';">-q:v n</span>), where <span style=" font-style:italic;">n</span> is a number from 1-31, with 1 being highest quality/largest filesize and 31 being the lowest quality/smallest filesize. This is a variable bit rate mode, roughly analogous to using <span style=" font-family:'Courier New,courier';">-qp</span> (constant QP [quantization parameter]) with x264. Most of the time this should be the preferred method. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">You can select an audio quality level with <span style=" font-family:'Courier New,courier';">-qscale:a</span> (or the alias <span style=" font-family:'Courier New,courier';">-q:a</span>). The value changes depending on the audio encoder. Since this guide uses libmp3lame see the <a href="https://trac.ffmpeg.org/wiki/Encode/MP3"><span style=" text-decoration: underline; color:#0000ff;">MP3 Encoding Guide</span></a> for examples and more information. </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Example: </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">ffmpeg -i input.avi -c:v mpeg4 -vtag xvid -qscale:v 3 -c:a libmp3lame -qscale:a 4 output.avi</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">There is rarely a need to use <span style=" font-family:'Courier New,courier';">-qscale:v 1</span>. Note that if you choose it, libxvid will take much more space than the same video compressed with the native mpeg4 encoder. </p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="ConstantBitRate"></a><span style=" font-size:x-large; font-weight:600;">C</span><span style=" font-size:x-large; font-weight:600;">onstant Bit Rate</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">You can target a bitrate with <span style=" font-family:'Courier New,courier';">-b:v</span>. This is best used with two-pass encoding. Adapting an example from the x264 encoding guide: your video is 10 minutes (600 seconds) long and an output of 50 MB is desired. Since bitrate = file size / duration: </p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">(50 MB * 8192 [converts MB to kilobits]) / 600 seconds = ~683 kilobits/s total bitrate</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">683k - 128k (desired audio bitrate) = 555k video bitrate</span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="Two-passexample"></a><span style=" font-size:large; font-weight:600;">T</span><span style=" font-size:large; font-weight:600;">wo-pass example</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">ffmpeg -y -i input.avi -c:v mpeg4 -vtag xvid -b:v 555k -pass 1 -an -f avi /dev/null</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">ffmpeg -i input.avi -c:v mpeg4 -vtag xvid -b:v 555k -pass 2 -c:a libmp3lame -b:a 128k output.avi</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Note: Windows users should use <span style=" font-family:'Courier New,courier';">NUL</span> instead of <span style=" font-family:'Courier New,courier';">/dev/null</span>. </p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>