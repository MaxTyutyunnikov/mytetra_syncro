<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-weight:600;">Однопоточный вариант</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans';">При работе Qt-приложения, для центрального объекта приложения </span><span style=" font-family:'FreeMono'; color:#6a1009;">QCoreApplication</span><span style=" font-family:'DejaVu Sans';"> создается объект основного цикла приложения в виде инстанса класса </span><span style=" font-family:'FreeMono'; color:#6a1009;">QEventLoop</span><span style=" font-family:'DejaVu Sans';">. Другими словами, это объект обработки цикла событий. У данного объекта есть два метода:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'DejaVu Sans';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">exec() </li>
<li style=" font-family:'DejaVu Sans';" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">processEvents()</li></ul>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans';">Метод </span><span style=" font-family:'FreeMono'; color:#6a1009;">exec()</span><span style=" font-family:'DejaVu Sans';"> содержит бесконечный цикл обработки событий (который работает до получения QEventLoop-события </span><span style=" font-family:'FreeMono'; color:#6a1009;">quit()</span><span style=" font-family:'DejaVu Sans';"> ). А метод </span><span style=" font-family:'FreeMono'; color:#6a1009;">processEvents()</span><span style=" font-family:'DejaVu Sans';"> ограничивается тем что обрабатывает накопившиеся в очереди события и завершает свою работу.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans';">В этом объяснении нет объекта потока QThread. Однако, для полного понимания, следует разобрать многопоточный вариант приложения.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-weight:600;">Многопоточный вариант</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans';">Каждый QObject строго привязан к какому-то потоку QThread который, собственно, и занимается обслуживанием слотов и прочих событий данного объекта. Один поток может обслуживать сразу множество QObject или вообще ни одного, а вот QObject всегда имеет родительский поток и он всегда ровно один. По сути можно считать что каждый QThread «владеет» каким-то набором QObject. В терминологии Qt это называется Thread Affinity (потоковая связанность). Для наглядности, эту особенность можно визуализировать так:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans'; font-size:10pt;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1572435988zegffuwe41.png" width="518" height="361" /></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans'; font-size:10pt;"><br /></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans'; font-size:10pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans';">Внутри каждого </span><span style=" font-family:'FreeMono'; color:#6a1009;">QThread</span><span style=" font-family:'DejaVu Sans';"> спрятана очередь сообщений адресованных к объектам которыми данный </span><span style=" font-family:'FreeMono'; color:#6a1009;">QThread</span><span style=" font-family:'DejaVu Sans';"> «владеет». В модели Qt предполагается что если мы хотим чтобы </span><span style=" font-family:'FreeMono'; color:#6a1009;">QObject</span><span style=" font-family:'DejaVu Sans';"> сделал какое-либо действие, то мы «посылаем» данному </span><span style=" font-family:'FreeMono'; color:#6a1009;">QObject</span><span style=" font-family:'DejaVu Sans';"> сообщение </span><span style=" font-family:'FreeMono'; color:#6a1009;">QEvent</span><span style=" font-family:'DejaVu Sans';">:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">QCoreApplication::postEvent(QObject *receiver, QEvent *event, int priority);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans';">В этом потоково-безопасном вызове Qt находит </span><span style=" font-family:'FreeMono'; color:#6a1009;">QThread</span><span style=" font-family:'DejaVu Sans';"> которому принадлежит объект </span><span style=" font-family:'FreeMono'; color:#6a1009;">receiver</span><span style=" font-family:'DejaVu Sans';">, записывает </span><span style=" font-family:'FreeMono'; color:#6a1009;">QEvent</span><span style=" font-family:'DejaVu Sans';"> в очередь сообщений этого потока и при необходимости «будит» этот поток. При этом ожидается что код работающий в данном </span><span style=" font-family:'FreeMono'; color:#6a1009;">QThread</span><span style=" font-family:'DejaVu Sans';"> в какой-то момент после этого прочитает сообщение из очереди и выполнит соответствующее действие. Чтобы это действительно произошло, код в </span><span style=" font-family:'FreeMono'; color:#6a1009;">QThread</span><span style=" font-family:'DejaVu Sans';"> должен войти в цикл обработки событий </span><span style=" font-family:'FreeMono'; color:#6a1009;">QEventLoop</span><span style=" font-family:'DejaVu Sans';">, создав соответствующий объект и вызвав у него либо метод </span><span style=" font-family:'FreeMono'; color:#6a1009;">exec()</span><span style=" font-family:'DejaVu Sans';">, либо метод </span><span style=" font-family:'FreeMono'; color:#6a1009;">processEvents()</span><span style=" font-family:'DejaVu Sans';">.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans';">Метод QThread::run() по умолчанию вызывает QThread::exec(), внутри которого как раз реализована стандартная обработка цикла событий.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p></body></html>