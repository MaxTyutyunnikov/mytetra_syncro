<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">В огромном количестве игр про военную технику немаловажную роль играет упреждение. Обычно это остается на плечах игрока - где-то вы методом проб и ошибок развиваете навык сами, где-то вам помогает кружочек. Но в любом случае это весьма сложно - если вы конечно не андроид. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">А андроидам полезно знать, как это упреждение вычислять. Хотя в этой статье и не рассматривается задача поиска упреждения в трех измерениях, на плоскости веселья будет не меньше.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1694525183ks02dab4ze.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Как вы уже наверняка поняли, эта публикация посвящена стрельбе на упреждение по движущемся на плоскости объектам. Тема несложная, поэтому и высоких материй вы тут не встретите. Если же три измерения - это ваш случай, то на хабре уже рассматривали похожую тему: </span><a href="https://habr.com/ru/articles/538952/"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">Вычисляем баллистические траектории в играх</span></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Работать будем как всегда в годо, а именно </span><a href="https://godotengine.org/download/windows/"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">Godot </span></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">v4.1. Начнем с исследования обычного квадратного уравнения и его параболы, закончим численным решением задачи в общем виде, по пути не забыв про приятное векторное решение. Уверен, будет интересно!</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<h2 style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">Собственно задача</span></h2>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Для начала рассмотрим наиболее простую и распространенную задачу: цель, как и снаряд, движутся равномерно и прямолинейно, то есть с постоянными векторами скорости. Так же давайте сразу отбросим тривиальный вариант, когда стрелок и цель в начальном положении находятся в одной точке и примем расстояние в начальный момент времени строго положительной величиной.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Обычно задача состоит только в том, чтобы найти направление выстрела и попасть в цель, поэтому будем считать что нам дано все, кроме этого самого направления. Изобразим на рисунке начальное положение системы:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1694525044fgwayxra51.png" /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">Начальное состояние системы</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Уравнения координат цели будут выглядеть таким образом:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1694525132dc15u9bpn7.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Тут все величины известны, поэтому мы можем в любой момент времени узнать, где находится цель. А вот с уравнениями координат снаряда не все так гладко, ведь нам неизвестен угол. Можно, конечно, записать уравнения с неизвестным, приравнять координаты снаряда и цели и попробовать решить получившеюся систему, но это даже звучит противно. Тем более есть варианты гораздо проще и изящнее. Рассмотрим два - алгебраический и геометрический.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<h2 style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">Снаряд в суперпозиции?</span></h2>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Начнем с алгебраического. Идея прозвучит парадоксально, но чтобы найти угол, от него надо сначала избавиться. Мы как бы выстрелим сразу во все стороны: тогда нам не придется учитывать направление. Для этого вместо прямой будем рассматривать окружность с центром в позиции стрелка и радиусом</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1694525229acmaegl500.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Эта окружность - «фронт» всех возможных снарядов, так что если в какой то момент времени расстояние от стрелка до цели сравняется с радиусом «фронта», это будет означать поражение цели каким то снарядом. Останется только найти этот снаряд, то есть направление выстрела:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://raw.github.com/xintrea/mytetra_syncro/master/base/169452504650mxfx942b/1694525319rrbkuqcelo.gif"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">См. Есть пробитие - вычисление по окружности.gif</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Итак, найдем расстояние от стрелка до цели и приравняем его к радиусу «фронта»:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1694525457934inylx1j.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">После подстановки значений </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">x(t)</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> и </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">y(t)</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> и упрощения выражения получим уравнение:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1694525512hi4l07z15g.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">В котором многие могут увидеть некоторые векторные операции, но векторами будем баловаться позже. Замечу, что в левой части стоит разность именно </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">квадратов</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> расстояния и радиуса, так что оценивать по этой величине расстояние нельзя. На самом деле это уравнение можно получить многими способами, но я выбрал этот потому что он пригодится и позже, но пока не об этом.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Полученное уравнение, вообще говоря, не всегда квадратное и даже не всегда линейное. Но пока давайте предположим, что </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">a = V</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic; vertical-align:super;">2</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;"> - U</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic; vertical-align:super;">2</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;"> ≠ 0 </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">и перед нами обыкновенное квадратное уравнение. Так как мы ищем время, положим </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">t ⩾ 0</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">. Решать уравнение аналитически я не вижу смысла, поэтому лучше исследуем его на предмет всяких интересностей.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Рассмотрим случай, когда дискриминант этого уравнения положителен </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">D &gt; 0</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">. Тогда существует два вещественных решения, которые обозначим через:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image16945264763di7eyut0z.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Разобьем анализ на два случая - отрицательный и положительный старший коэффициент. Для начала положим </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">a &gt; 0</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">. Так как существуют действительные решения, они подчиняются </span><a href="https://ru.wikipedia.org/wiki/%D0%A4%D0%BE%D1%80%D0%BC%D1%83%D0%BB%D1%8B_%D0%92%D0%B8%D0%B5%D1%82%D0%B0"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">теореме Виета</span></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1694526516bb0tye8s88.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Из которой видно, что корни в нашем случае имеют одинаковый знак, а это значит, что </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">t</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic; vertical-align:sub;">2</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> нас фактически не интересует - ведь он либо отрицателен (тогда и </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">t</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic; vertical-align:sub;">1</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;"> &lt; 0</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">), либо больше первого (лучше поразить цель раньше, не так ли?). Тогда искомое время будет равно </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">t</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic; vertical-align:sub;">1</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Теперь пусть </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">a &lt; 0</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">. Снова применим теорему Виета:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1694526559agzapd5x5d.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">И увидим, что на сей раз произведение корней отрицательно, а значит их знаки уже различны, что, однако, даже лучше - ведь среди них один точно окажется положительным. Взглянув на формулы корней увидим, что таковым всегда будет снова </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">t</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic; vertical-align:sub;">1</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">, так как в силу </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">a &lt; 0</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> он больше </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">t</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic; vertical-align:sub;">2</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Таким образом, нам в принципе не важно значение корня </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">t</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic; vertical-align:sub;">2</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> и мы даже не будем его вычислять. Однако перед тем как перейти к коду, рассмотрим еще один интересный факт.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Пусть теперь дискриминант этого уравнение отрицателен </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">D &lt; 0</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">. Это означает, вся парабола </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">y =F(x)</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> лежит с одной стороны от оси OX, а так как </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">c = Δx</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic; vertical-align:super;">2</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;"> + Δy</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic; vertical-align:super;">2</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;"> &gt; 0</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> то она находится в верхней полуплоскости, а значит смотрит &quot;рогами&quot; вверх, то есть </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">a &gt; 0</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Получаем занимательный факт: если нет решений, то скорость цели больше скорости снаряда. Обратное, вообще говоря, неверно. Если угодно, назовем это </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">необходимым условием отсутствия решения</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Так вот, это означает, что если скорость снаряда больше скорости цели (т.е. </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">a &lt; 0</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">), то решения уравнения всегда существуют (</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">D &gt; 0</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">) и в силу рассуждений выше одно из них окажется положительным, а значит стрелок всегда сможет поразить цель. Здорово, правда?</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">Ну нашли мы время, а что дальше то?</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> - промелькнуло у кого-то в голове. То время, которое мы нашли - это время пересечения гипотетического снаряда и цели. Стрелок просто выстрелит в том направлении, в котором окажется цель через найденное время, и попадет точно в нее.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Ах да, чуть не забыл про случай </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">a = 0</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">, при котором наше уравнение перестает быть квадратным. Можно, конечно, записать уравнение, проверить является ли оно линейным… Но как по мне уже достаточно душно, не находите?</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Вместо этого, так как мы собираемся записать все эти выкладки в коде, я напомню, что проверять вещественные числа на равенство штука неблагородная, поэтому условие вроде if (a == 0) в большинстве случаев некорректно. Поэтому все что я могу сказать: не делайте скорости одинаковыми при использовании данного метода, и все будет хорошо ;)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Тем более что это вовсе не проблема, ведь векторный способ лишен этого существенного недостатка. Однако давайте пока опишем в коде хотя бы этот. Оказывается что я рассказал уже все что нужно для написания алгоритма, осталось собрать это в кучу в виде такой функции на GDScript:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">func get_shoot_vector2(u:float, v:Vector2, x0:float, y0:float, xs:float, ys:float):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	var dx : float = x0-xs</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	var dy : float = y0-ys</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	var a : float = v.length()**2 - u**2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	var b : float = 2*(v.x*dx + v.y*dy) # да, это скалярное произведение</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	var c : float = dx**2 + dy**2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	var D : float = b**2 - 4*a*c</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	if D &lt; 0: # решений не существует</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">		return Vector2.ZERO </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	var t : float = (-b - sqrt(D)) / (2*a)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	# условие может быть выполнено только при a &gt; 0, а это означает что</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	if t &lt; 0: #                      при t &lt; 0 оба решения отрицательны</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">		return Vector2.ZERO</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	# находим направление стрелбы</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	return ((Vector2(x0, y0) + v*t) - Vector2(xs, ys)).normalized()</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Которая возвращает направление для стрельбы с позиции </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">{x</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic; vertical-align:sub;">s</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">; y</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic; vertical-align:sub;">s</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">}</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> снарядом со скоростью </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">u</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> по мишени, находящейся в позиции </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">{x</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic; vertical-align:sub;">0</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">; y</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic; vertical-align:sub;">0</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">}</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> и движущейся по вектору </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">V</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">. Давайте полюбуемся результатом и наконец перейдем к более интересному и изящному векторному методу решения той же задачи:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://raw.github.com/xintrea/mytetra_syncro/master/base/169452504650mxfx942b/1694526651j4uau27hu1.gif"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">См. Попадание по годотам.gif</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">Второе решение</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Так как это геометрическая задача, тут прямо таки напрашивается использовать векторы. Напомню, что условия задачи остаются теми же - нужно только найти направление выстрела. Давайте немного пересмотрим начальное состояние, заменив координаты на вектор </span><a href="https://ru.wikipedia.org/wiki/%D0%9F%D0%B5%D1%80%D0%B5%D0%BC%D0%B5%D1%89%D0%B5%D0%BD%D0%B8%D0%B5"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">перемещения </span></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">r</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic; vertical-align:sub;">0</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1694526842ugfdgs8u60.png" /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">На ответ влияет только взаимное расположение стрелка и цели</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">На самом деле, уравнения координат цели из аналитического решения - это лишь проекции вот этого векторного уравнения, только в абсолютных координатах:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1694526879280i1waarw.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Здесь </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">r(t)</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> - это вектор перемещения от стрелка к цели в момент времени </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">t</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">, иначе говоря стрелка от стрелка до цели (</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; text-decoration: line-through;">каламбур</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">). И было бы хорошо, если бы в какой то момент времени снаряд оказался на том же месте, тогда это означало бы, что он попал в цель.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Давайте рассмотрим вектор скорости снаряда </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">U</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">, который пока что направлен не весть куда. Тогда вектор перемещения от стрелка до снаряда будет равен:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1694526940k1ukjvg9ln.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">И, приравняв его к </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">r(t)</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">, получаем векторное уравнение:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1694526972155vp46les.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Которое, кстати говоря, если спроецировать на оси и немного пошаманить, то получится то самое квадратное уравнение. Давайте немного преобразуем:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image16945270039jyvu3zgpt.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">И заметим, что правая и левая части отличаются лишь множителем, а это значит, что они параллельны, а в нашем случае даже сонаправлены (</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">t &gt; 0</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">). На самом деле разность в скобке в левой части - это скорость цели относительно снаряда, и так как изначально их разделяет </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">r</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic; vertical-align:sub;">0</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">, нам нужно найти время, через которое цель прилетит прямо в горячие объятия снаряда. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Но если бы было так просто, то я бы тут не распинался. Давайте рассуждать дальше и вспомним, что если векторы параллельны, то их </span><a href="https://ru.wikipedia.org/wiki/%D0%92%D0%B5%D0%BA%D1%82%D0%BE%D1%80%D0%BD%D0%BE%D0%B5_%D0%BF%D1%80%D0%BE%D0%B8%D0%B7%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">векторное произведение</span></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> равняется нулевому вектору. Запишем и преобразуем:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1694527038jx8isil8zq.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Заметим, что произведение в правой части нам известно, а вот что делать с левой до сих пор не ясно. Давайте введем ось </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">OZ</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">, направленную на рисунке на нас и спроецируем уравнение на нее. Запишем проекции:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image16945270877u8fs0eeod.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">И вуаля - мы избавились от вектора и перешли к углу, найдя который выстрелим по направлению к цели. Найдем отсюда </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">sin φ</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1694527124fubnq334xs.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Теперь все, что нам осталось, получить вектор </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">U</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">. Длина нам дана, а направление мы узнаем, повернув вектор </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">r</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic; vertical-align:sub;">0</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> на угол </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">φ</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">. Однако есть три проблемы:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выражение справа может оказаться по модулю больше единицы - тогда просто считаем, что решения нет. </li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Эта формула не учитывает время, иначе говоря она видит прошлое, как бы странно это не звучало. </li>
<li style=" font-family:'DejaVu LGC Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">φ </span>- угол поворота от вектора <span style=" font-style:italic;">U</span> к вектору <span style=" font-style:italic;">r</span><span style=" font-style:italic; vertical-align:sub;">0</span><span style=" font-style:italic;">,</span> но мы ищем <span style=" font-style:italic;">U</span> и вращаем <span style=" font-style:italic;">r</span><span style=" font-style:italic; vertical-align:sub;">0</span>, так что нужно не забыть добавить к углу минус.</li></ol>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Перед тем как приступить к решению второй проблемы, предлагаю немного посмотреть на эту &quot;стрельбу в прошлое&quot;. Справа - то, как выстрел видит формула, слева - куда она стреляет на самом деле:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://raw.github.com/xintrea/mytetra_syncro/master/base/169452504650mxfx942b/1694527189fufx7mcdey.gif"><span style=" text-decoration: underline; color:#0000ff;">См. Довод привет.gif</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Но, к сожалению, в прошлое умею смотреть только я, поэтому давайте отучим формулу его видеть. Для этого предлагаю спроецировать изначальное векторное уравнение на вектор </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">r</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic; vertical-align:sub;">0 </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">и затем выразить оттуда время, которое и будем сравнивать с нулем:</span></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1694527281aszfqggq12.png" /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">Величины проекций</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Найдем косинус через основное тождество:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1694527328prk6sjbwut.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Знак косинуса нас не интересует лишь по той причине, что </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">arcsin φ</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> возвращает значение из правой части тригонометрической окружности, в которой косинус неотрицателен. Итак, запишем спроецированное уравнение:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1694527360er4exxx89s.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">И заметим, что множитель перед </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">t</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> опять может равняться нулю. И что, снова выпадает какой то вариант? Оказывается, что нет, ведь в данном случае нас не интересует точное значение времени, нам нужно определить его знак. Правая часть уравнения всегда положительна, а это значит, что знак </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">t</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> определяется множителем перед ним, так что сравним с нулем именно его, и пусть он будет даже ноль - ничего страшного.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Как видите, векторное решение оказалось гораздо проще и изящнее, как я и обещал, причем без всяких ограничений. Наконец запишем все наши выкладки в коде в виде небольшой функции:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">func get_shoot_vector(u:float, v:Vector2, r0:Vector2):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	# cross - проекция векторного произведения на ось OZ</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	var sin_phi : float = v.cross(r0) / (r0.length() * u)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	if abs(sin_phi) &gt; 1: # нет решений</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">		return Vector2.ZERO</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	var cos_phi : float = sqrt(1 - sin_phi**2)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	# знак tsing такой же, как и у времени</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	var tsign : float = u*r0.length()*cos_phi - v.dot(r0)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	if tsign &lt; 0:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">		return Vector2.ZERO</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	# не забываем про минус</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	return r0.rotated(-asin(sin_phi)).normalized()</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Теперь мы можем то, чего не могли ранее - делать скорость снаряда и цели одинаковой:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://raw.github.com/xintrea/mytetra_syncro/master/base/169452504650mxfx942b/16945274134im11nxsxa.gif"><span style=" text-decoration: underline; color:#0000ff;">См. Кажется где то я это уже видел.gif</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Несмотря на хороший результат, этот метод можно применять только для прямолинейного движения цели. Честно говоря не знаю, где может пригодиться поиск упреждения по цели, движущейся, скажем, по синусоиде, но это тоже более чем возможно.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<h2 style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">Задача поиска упреждения в общем виде</span></h2>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Теперь пусть объект двигается вдоль некоторой кривой, заданной параметрически:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image16945274848mzd59wgqs.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Которую мы будем считать непрерывной по условию задачи, ведь она описывает движение &quot;реального&quot; объекта. А снаряд все так же движется равномерно и прямолинейно.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Первое, что лично мне пришло в голову - это составить функцию расстояния, зависящую от двух переменных - времени и угла выстрела - и уже анализировать ее. Сначала я так и сделал, но скорость работы была весьма скудной - </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">~2ms</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> даже для простых случаев.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Былого потом я вспомнил про первый метод, который никто не мешает применить и в общем случае, и он позволил снова избавиться от угла и свести решение к задачи оптимизации функции одной переменной.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Итак, составим функцию расстояния от цели до &quot;фронта&quot; всех снарядов:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image169452751697v90gyxw4.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Тогда решив уравнение </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">ρ(t) = 0</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> мы нашли бы время, через которое объект окажется в точке в которую следует сделать выстрел для попадания. Однако и при прямолинейном движении решение этого уравнение не всегда существует, чего уже говорить про общий случай.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Поэтому мы будем искать глобальный минимум этой функции на некотором отрезке </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">(0; t</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic; vertical-align:sub;">max</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">]</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">, и если это будет не ноль, то стрелок выстрелит хотя бы так, чтобы снаряд пролетел максимально близко к цели.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Стоит заметить, что функция </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">ρ(t)</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> не обязательно является гладкой из-за модуля, так что для оптимизации я буду использовать метод нулевого порядка, а именно </span><a href="https://ru.wikipedia.org/wiki/%D0%9C%D0%B5%D1%82%D0%BE%D0%B4_%D0%B7%D0%BE%D0%BB%D0%BE%D1%82%D0%BE%D0%B3%D0%BE_%D1%81%D0%B5%D1%87%D0%B5%D0%BD%D0%B8%D1%8F"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">метод золотого сечения</span></a><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">, в первую очередь в силу его простоты, скорости и несильной требовательности к локализации задачи.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Если кратко, как работает этот метод: рассматриваем две точки </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">x</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic; vertical-align:sub;">1</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> и </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">x</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic; vertical-align:sub;">2</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> между </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">a</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> и </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">b</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">, удовлетворяющих правилу золотого сечения деления отрезка </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">[a; b]</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">. Если в левой точке значение функции меньше, чем в правой, то перемещаем правую границу поиска на правую точку, иначе перемещаем левую границу на левую точку, и так до тех пор, пока длина отрезка поиска не станет удовлетворять заданной точности. Метод как бы &quot;скатывается&quot; в яму, а затем просто уточняет результат. Вот только не надо говорить, что так работает почти любой метод оптимизации.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Реализуется метод так же просто, как и звучит:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;"># f - &quot;ссылка&quot; на оптимизируемую функцию</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;"># a, b - границы изначального отрезка, eps - точность</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">func optimize(f:Callable, a:float, b:float, eps:float):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	const PHI : float = 1.618033988749</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	# можно смотреть и на разность значений функции,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">    # просто тогда код удлиняется из-за запоминаний значений</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	while (b-a) &gt; eps:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">		var x1 = b - (b-a)/PHI # левая точка</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">		var x2 = a + (b-a)/PHI # правая точка</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">		</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">		if f(x1) &lt; f(x2):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">			b = x2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">		else:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">			a = x1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	return (a+b)/2</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Передаем в него функцию </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">ρ</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">, промежуток </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">(0; t</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic; vertical-align:sub;">max</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">]</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">, требуемую точность и получаем время, через которое объект будет в месте поражения. Давайте отбросим вопросы реализации движения объектов, нахождения направления и прочего и просто полюбуемся этой красотой:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://raw.github.com/xintrea/mytetra_syncro/master/base/169452504650mxfx942b/1694527588gb3rq1qfj3.gif"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">См. И правда стреляем в будущее.gif</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">В этом случае цель двигалась по вот такой кривой:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1694527651n506io75ej.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Теперь давайте рассмотрим немного более значимый пример. Чтобы еще сильнее не утомлять вас числами, точные параметры системы я писать не буду, рассмотрим его качественно. Выглядит это дело как то так:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://raw.github.com/xintrea/mytetra_syncro/master/base/169452504650mxfx942b/16945276816aky7mbbsp.gif"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">См. Да как так то.gif</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Если вы посмотрите повнимательнее, то заметите, что попадания не было. Расчет показывает, что расстояние до цели было ~90 игровых пикселей. Почему так? Видно же, что попасть точно можно было.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">В начале я заикнулся про глобальный минимум, а любой метод оптимизации ищет локальный и при большом количестве таковых поиск глобального затрудняется. Тут проблема именно в этом, достаточно взглянуть на график </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">y = ρ(x)</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> и все сразу станет ясно:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image16945277314nq16kr5nb.png" /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:10pt;">Масштаб я и сам не знаю какой</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Блеклая зеленая прямая указывает на минимум, найденный нашим методом. У нас было целых три различных варианта для выстрела с точным попаданием, а метод нашел непойми что! На самом деле это просто крайне удачное стечение обстоятельств: если поменять значение </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">t</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic; vertical-align:sub;">max</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> с </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">30</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> до, хотя бы, </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">30.1</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> то метод сразу находит верное, хоть и не наилучшее решение (третий ноль).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Тут, на самом деле, что делать с этим уже решать вам, ведь все упирается в оптимизацию, я лишь могу предложить простейший вариант: разбить исходный отрезок на </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">N</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> других, на каждом из них найти минимум, а затем из всех выбрать наименьший.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Но тогда количество вызовов optimize возрастает и вычисления замедляются, так что тут зависит от того, что вам нужно - точность или скорость. Однако стоит сказать, что в играх точность вычислений обычно не сильно нужна - ну будет минимальное расстояние не 0.00008px, а 1.2px, что так что так попадание по модельке будет. Поэтому погрешность вычислений достаточно взять что-то вроде </span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-style:italic;">0.1</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> и не переживать.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Код этого способа не сложнее метода оптимизации:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">func global_optimize(f:Callable, a:float, b:float, eps:float):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	const N : int = 5</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	var tmin : float = 0.0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	var d : float = (b-a)/N</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	for i in range(0, N):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">		var ires : float = optimize(f, a + d*i, a + d*(i+1), eps)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">		</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">		if f(ires) &lt; f(tmin):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">			tmin = ires</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">	return tmin</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Теперь минимум находится нормально уже при N = 2, то есть всего на один вызов больше. Давайте посмотрим:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">См. В яблочко.gif</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Если вы хотите находить всегда наилучшее решение, то есть самый левый ноль, то тут уже придется что-то шаманить с точностью и опять таки повторными вызовами optimize, но это пускай остается за ширмой. Вместо этого давайте напоследок посмотрим еще примеры. Не знаю, что насчет вас, но для меня этот почти как котики - не мило, но смотреть можно бесконечно:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">См. Окружность.gif</span></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1694527944ae2vhjpemg.png" /></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">См. Бесконечность.gif</span></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1694528074mi9cv0vor0.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">См. Экспонента.gif</span></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1694528166z18br6k765.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt; font-weight:600;">Кажется все</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Как можно заметить по мере чтения, чем новее способ - тем меньше трудозатрат. Вначале огромный анализ квадратного уравнения с кучей различных вариантов, затем несложное решение векторного уравнения лишь с парочкой шероховатостей, а в конце простейшее решение с очень приятным результатом в виде поиска минимума, а не просто &quot;извини, решений нет&quot;. Это что-то да значит.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Никакого кода проекта не будет, потому что эта статья скорее про математику - а она то точно не нуждается в исходниках. Хочется верить, что обильное снабжение картинками сделало ее не такой скучной, какой она обычно представляется.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p></body></html>