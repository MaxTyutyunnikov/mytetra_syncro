<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">В этой статье мы проложим наше погружение в gdb, исследуя его возможности с точки зрения хакера, отлаживающего двоичные файлы без исходных текстов. мы рассмотрим технику изменения потока выполнения программы, точки останова и наблюдения, механизмы трассировки и средства работы с памятью. в общем, все то, что делает взломщиков счастливыми людьми.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; font-style:italic; color:#000000;">Изменение потока выполнения</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Программа, загруженная командой &quot;</span><span style=" font-family:'Courier New'; color:#000000;">file</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (или указанная в командной строке), находится в бесформенном состоянии, представляющим собой всего лишь совокупность байт, записанных в выделенном регионе адресного пространства. Новый процесс для нее еще не создан и трассировать ее невозможно. Во всяком случае до тех пор, пока мы не дадим команду &quot;</span><span style=" font-family:'Courier New'; color:#000000;">run</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; или &quot;</span><span style=" font-family:'Courier New'; color:#000000;">r</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (которой обычно предшествует установка точки останова на функцию </span><span style=" font-family:'Courier New'; color:#000000;">main</span><span style=" font-family:'Times New Roman'; color:#000000;"> или </span><span style=" font-family:'Courier New'; color:#000000;">start</span><span style=" font-family:'Times New Roman'; color:#000000;">). Будучи запущенной, программа будет работать до тех пор, пока не встретит точку останова или не получит no-stop сигнал (см. &quot;обработка сигналов&quot;). Применение команды &quot;</span><span style=" font-family:'Courier New'; color:#000000;">run</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; к уже запущенной программе, приведет к ее перезапуску (в конфигурации по умолчанию отладчик запрашивает подтверждение).</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Продолжить работу программы, остановленной по точке останова или сигналу, можно командой &quot;</span><span style=" font-family:'Courier New'; color:#000000;">continue</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (&quot;</span><span style=" font-family:'Courier New'; color:#000000;">c</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;), действующей так же, как и &quot;</span><span style=" font-family:'Courier New'; color:#000000;">run</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (т. е. работающей до точки останова/сигнала).</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Чтобы передать управление по произвольному адресу, необходимо сделать &quot;</span><span style=" font-family:'Courier New'; color:#000000;">jump</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (&quot;</span><span style=" font-family:'Courier New'; color:#000000;">j</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;) за которым следует адрес, имя функции или регистр. В частности, &quot;</span><span style=" font-family:'Courier New'; color:#000000;">j *$pc</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; по своему действию аналогична команде &quot;</span><span style=" font-family:'Courier New'; color:#000000;">continue</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, &quot;</span><span style=" font-family:'Courier New'; color:#000000;">j foo</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; передает управление на метку/функцию </span><span style=" font-family:'Courier New'; color:#000000;">foo</span><span style=" font-family:'Times New Roman'; color:#000000;"> (если только она присутствует в таблице символов), а &quot;</span><span style=" font-family:'Courier New'; color:#000000;">j *0x80484AA</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; – прыгает на адрес </span><span style=" font-family:'Courier New'; color:#000000;">80484AAh</span><span style=" font-family:'Times New Roman'; color:#000000;">. Если одни и те же адреса используются многократно, их можно загнать в пользовательскую переменную командой &quot;</span><span style=" font-family:'Courier New'; color:#000000;">set $my_foo=0x80484AA</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, а затем использовать ее в качестве параметра команды </span><span style=" font-family:'Courier New'; color:#000000;">jump</span><span style=" font-family:'Times New Roman'; color:#000000;"> – &quot;</span><span style=" font-family:'Courier New'; color:#000000;">j *$my_foo</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;. Отладчик soft-ice, кстати, ничего подобного делать не умеет!</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Команда &quot;</span><span style=" font-family:'Courier New'; color:#000000;">until</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (&quot;</span><span style=" font-family:'Courier New'; color:#000000;">u</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;) продолжает выполнение программы вплоть до указанного адреса (например, &quot;</span><span style=" font-family:'Courier New'; color:#000000;">u *0x080484ED</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;), при достижении которого останавливается и передает управление отладчику. Как и &quot;</span><span style=" font-family:'Courier New'; color:#000000;">jump</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, команда &quot;</span><span style=" font-family:'Courier New'; color:#000000;">until</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; поддерживает работу не только с метками и адресами, но и переменными, значительно упрощая взлом. Без аргументов &quot;</span><span style=" font-family:'Courier New'; color:#000000;">until</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; аналогична команде &quot;</span><span style=" font-family:'Courier New'; color:#000000;">nexti</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (см. &quot;трассировка&quot;) — она переходит на следующую машинную команду, пропуская функции и циклы.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Рассмотрим следующий код:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">.text:080484EB             jb     short loc_80484EF   ; à на выход из цикла</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">.text:080484ED             jmp    short loc_8048532   ; à к началу тела цикла</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">.text:080484EF             lea    eax, [ebp + var_28] ; первая команда за концом цикла</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; color:#000000;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 1 фрагмент цикла, демонстрирующего сущность команды until</span></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; font-weight:600; color:#000000;"><br /></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; font-weight:600; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Команда &quot;</span><span style=" font-family:'Courier New'; color:#000000;">until</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, отданная на строке 80484EBh, равносильна &quot;</span><span style=" font-family:'Courier New'; color:#000000;">u *0x80484EF</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; — она выполняет цикл и передает управление отладчику только по выходу из него. Очень удобно!</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Если нам необходимо дождаться выхода из функции, автоматически остановившись при встрече c </span><span style=" font-family:'Courier New'; color:#000000;">RET</span><span style=" font-family:'Times New Roman'; color:#000000;"> — на этот случай предусмотрена команда &quot;</span><span style=" font-family:'Courier New'; color:#000000;">finish</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, аналогичная команде &quot;</span><span style=" font-family:'Courier New'; color:#000000;">P RET</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; отладчика soft-ice. Вместо пошаговой трассировки программы, gdb просматривает фрейм предыдущей функции (что можно сделать командой &quot;</span><span style=" font-family:'Courier New'; color:#000000;">backtrace</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; или &quot;</span><span style=" font-family:'Courier New'; color:#000000;">bt</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;) и устанавливает точку останова на адрес возврата, что обеспечивает максимальную эффективность выполнения, но… если раскрутить стек и восстановить цепочку фреймов отладчику не удается, команда &quot;</span><span style=" font-family:'Courier New'; color:#000000;">finish</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; отказывает в работе.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Команда &quot;</span><span style=" font-family:'Courier New'; color:#000000;">return</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, в отличии от &quot;</span><span style=" font-family:'Courier New'; color:#000000;">finish</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, приводит к немедленному возвращению в материнскую функцию без выполнения оставшегося &quot;хвоста&quot;. soft-ice этого делать не умеет, а зря! &quot;</span><span style=" font-family:'Courier New'; color:#000000;">return</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; очень полезная и довольно часто используемая команда.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Еще soft-ice не умеет вызывать функции, а gdb это делает без всякого напряжения командой &quot;</span><span style=" font-family:'Courier New'; color:#000000;">call</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; за которой следует имя функции/переменная/регистр или адрес. Аргументы (если они есть) передаются в круглых скобах по Си-соглашению, то есть заносятся в стек справа налево, которые выталкиваются из стека все той же командой &quot;</span><span style=" font-family:'Courier New'; color:#000000;">call</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;. Например, &quot;</span><span style=" font-family:'Courier New'; color:#000000;">call foo(1,2,3)</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; или &quot;</span><span style=" font-family:'Courier New'; color:#000000;">call 0x8048384(1,2,3)</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">При желании можно даже выполнить команду оболочки, не выходя из отладчика. Это делается так: &quot;</span><span style=" font-family:'Courier New'; color:#000000;">shell ls</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; или &quot;</span><span style=" font-family:'Courier New'; color:#000000;">shell man open</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;. Просто фанатически удобно! Впрочем, аналогичного результата можно добиться, открыв дополнительную консоль. Поскольку, gdb – это отладчик прикладного уровня, он, в отличии от gdb, не замораживает систему, позволяя использовать естественную многозадачность без извращения с &quot;</span><span style=" font-family:'Courier New'; color:#000000;">shell</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<h2 style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; font-style:italic; color:#000000;">Трассировка</span></h2>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">С трассировкой связны всего две команды: &quot;</span><span style=" font-family:'Courier New'; color:#000000;">stepi n</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (&quot;</span><span style=" font-family:'Courier New'; color:#000000;">si n</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;) выполняет n следующих инструкций с заходом в циклы и функции, а &quot;</span><span style=" font-family:'Courier New'; color:#000000;">nexti n</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (&quot;</span><span style=" font-family:'Courier New'; color:#000000;">ni n</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;) – без захода. При запуске без аргументов выполняется только одна инструкция. Нажатие на &lt;ENTER&gt; автоматически повторяет последнюю команду (&quot;</span><span style=" font-family:'Courier New'; color:#000000;">stepi</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; или &quot;</span><span style=" font-family:'Courier New'; color:#000000;">nexti</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;), что значительно ускоряет трассировку (кстати, лупить по &lt;ENTER'у&gt; намного удобнее, чем давить на любую из функциональных клавиш, используемых для трассировки Windows-отладчиками).</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Команды &quot;</span><span style=" font-family:'Courier New'; color:#000000;">step n</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;/&quot;</span><span style=" font-family:'Courier New'; color:#000000;">next n</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (упоминание о которых можно найти в документации на gdb) ориентированы на работу с исходными текстами и выполняют n строк, а в отсутствии символьной информации трассируют программу вплоть до ее завершения, что не есть хорошо.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1638520625e37ez935uz.png" /></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Рисунок 1 пример сеанса трассировки</span></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; font-weight:600; color:#000000;"><br /></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; font-weight:600; color:#000000;"><br /></p>
<h2 style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; font-style:italic; color:#000000;">Точки останова</span></h2>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Отладчик gdb поддерживает два типа точек останова: </span><span style=" font-family:'Times New Roman'; font-style:italic; color:#000000;">останов по выполнению кода</span><span style=" font-family:'Times New Roman'; color:#000000;"> – </span><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">breakpoint</span><span style=" font-family:'Times New Roman'; color:#000000;">, и </span><span style=" font-family:'Times New Roman'; font-style:italic; color:#000000;">останов по обращению к данным</span><span style=" font-family:'Times New Roman'; color:#000000;"> (так же называемый </span><span style=" font-family:'Times New Roman'; font-style:italic; color:#000000;">точками наблюдения</span><span style=" font-family:'Times New Roman'; color:#000000;">) — </span><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">watch-point</span><span style=" font-family:'Times New Roman'; color:#000000;">. (Еще gdb поддерживает точки перехвата, но для отладки программ без исходных текстов они практически бесполезны).</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Точки останова могут быть как программными, так и аппаратными. Программная точка останова по выполнению на x86-платформе представляет собой однобайтовую инструкцию CCh (</span><span style=" font-family:'Courier New'; color:#000000;">INT 03h</span><span style=" font-family:'Times New Roman'; color:#000000;">), а программный watch-point реализуется путем пошаговой трассировки программы с отслеживанием обращений к подопытной ячейке, что, во-первых, крайне непроизводительно, а, во-вторых, некоторые программы просто не позволяют себя трассировать. Аппаратных точек останова на x86 всего четыре, программных же можно устанавливать сколько угодно.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Программная точка останова по исполнению задается командой &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">break</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (&quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">b</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;) за которой следует имя функции/адрес/регистр или переменная. Например, &quot;</span><span style=" font-family:'Courier New'; color:#000000;">b main</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, &quot;</span><span style=" font-family:'Courier New'; color:#000000;">b *0x80484BC</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;. Команда &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">tbreak</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (&quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">tb</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;) устанавливает одноразовую точку останова, которая автоматически удаляется при срабатывании. Аппаратная точка останова задается командой &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">hbreak</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (&quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">hb</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;), а временная аппаратная точка — &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">thbreak</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (&quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">thb</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;). После установки аппаратной точки останова отладит сообщает &quot;</span><span style=" font-family:'Times New Roman'; font-style:italic; color:#000000;">Hardware assisted breakpoint N at адрес</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, однако, это еще не значит, что операция завершилась успешно. Для проверки можно установить хоть тысячу аппаратных точек останова и все будет ОК, но вот только при запуске программы командами &quot;</span><span style=" font-family:'Courier New'; color:#000000;">run</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; или &quot;</span><span style=" font-family:'Courier New'; color:#000000;">continue</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; отладчик может сообщить: &quot;</span><span style=" font-family:'Times New Roman'; font-style:italic; color:#000000;">Warning: Cannot insert hardware breakpoint N</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;.</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1638520679cigamvex9k.png" /></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Рисунок 2 реальная установка точек останова происходит только при начале выполнения программы</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Аппаратные точки наблюдения на запись ячейки задаются командой &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">watch</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (&quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">wa</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;), команды &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">rwatch</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (&quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">rw</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;) и &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">awatch</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (&quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">aw</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;) устанавливают точки наблюдения на чтение и чтение/запись соответственно (например, &quot;</span><span style=" font-family:'Courier New'; color:#000000;">rw *0xBFFFFA50</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, а вот &quot;</span><span style=" font-family:'Courier New'; color:#000000;">rw *$esp</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; уже не срабатывает и отладчик сообщает &quot;</span><span style=" font-family:'Times New Roman'; font-style:italic; color:#000000;">Attempt to dereference a generic pointer</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;) . Как и в случае с точками останова по выполнению, сообщение &quot;</span><span style=" font-family:'Times New Roman'; font-style:italic; color:#000000;">Hardware read watchpoint N: адрес</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; не означает ровным счетом ничего и при попытке запуска/продолжения выполнения программы отладчик может сказать: &quot;</span><span style=" font-family:'Times New Roman'; font-style:italic; color:#000000;">Could not insert hardware watchpoint N</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, обламывая нас по полной программе.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Все точки наблюдения/останова могут быть условными, то есть срабатывать только в том случае, если значение выражения, стоящего после &quot;if&quot;, истинно. Например, &quot;</span><span style=" font-family:'Courier New'; color:#000000;">b if $eax==0</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, или &quot;</span><span style=" font-family:'Courier New'; color:#000000;">rw *0xBFFFFA60 if (*((unsigned int*)$esp)!=0x669)</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">При установке всякой точки наблюдения/останова отладчик присваивает ей номер, который, во-первых, высвечивается при ее срабатывании, а, во-вторых, может быть использован в командах управления точками наблюдения/останова. Номер последней сработавшей точки останова автоматически заносится в переменную </span><span style=" font-family:'Courier New'; color:#000000;">$bpnum</span><span style=" font-family:'Times New Roman'; color:#000000;">.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">(gdb) hb main</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">Hardware assisted breakpoint 1 at 0x80483ef</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">(gdb) r</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">Starting program: /home/kpnc/gdb/gdb_demo</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">Breakpoint 1, 0x080483ef in main ()</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; color:#000000;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 2 при установке точки наблюдения/останова, отладчик автоматически присваивает ей своей собственный номер (в данном случае равный единице)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Команда &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">ignore n x</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; устанавливает счетчик игнорирования точки наблюдения/останова n, пропуская первые x срабатываний, что особенно полезно в циклах.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Если при срабатывании точки останова/наблюдения необходимо выполнить некоторую последовательность операций, можно воспользоваться командой &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">commands n</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (где n – номер точки наблюдения/останова), пример использования которой показан ниже:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; font-weight:600; color:#6a1009;">commands 6</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">printf &quot;hello, world\n&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; font-weight:600; color:#6a1009;">ends</span></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 3 автоматическое исполнение последовательности команд при срабатывании точки останова (в данном случае при срабатывании точки номер 6 будет выведено приветствие &quot;hello, world!&quot;)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Получить информацию по точкам останова поможет команда &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">info break</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (&quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">i b</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; или &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">info watchpoints</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;). При запуске без аргументов она выдаст данные о состоянии всех точек наблюдения/останова. Если же необходимо &quot;проэкзаменовать&quot; какую-то конкретную точку наблюдения/останова, достаточно указать ее номер, например:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">(gdb) i b 13</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">Num Type           Disp Enb Address    What</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">13  read watchpoint keep y              *134513676</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">        stop only if $eax == 4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">(gdb)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 4 просмотр информации о точке наблюдения номер 13</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Команда &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">clear</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (она же &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">delete</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;) используется для удаления точек наблюдения/останова. При запуске без аргументов она удаляет _все_ точки (при этом отладчик запрашивает подтверждение), если же необходимо удалить какую-то одну конкретную точку — достаточно задать ее номер, например: &quot;</span><span style=" font-family:'Courier New'; color:#000000;">delete 13</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, так же можно удалить целый диапазон точек останова/наблюдения: &quot;</span><span style=" font-family:'Courier New'; color:#000000;">delete 1-6</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; удаляет точки наблюдения с первой по шестую включительно и никакого подтверждения при этом не запрашивается, так что будьте на чеку!</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Команды &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">enable</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; и &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">disable</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; используются для временного включения/выключения точек наблюдения/останова и имеют тот же самый синтаксис, что и &quot;</span><span style=" font-family:'Courier New'; color:#000000;">delete</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<h2 style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; font-style:italic; color:#000000;">Работа с памятью и регистрами</span></h2>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Дамп памяти для хакеров — это святое. Без него не обходится ни один взлом. Просматривать/модифицировать память можно разными способами. Например, с помощью команды &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">print</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;/&quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">printf</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">(gdb) p $esp         # вывод содержимого регистра esp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">$1 = (void *) 0xbffffa50</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">(gdb) p (char) $esp  # вывод младшего байта регистра esp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">$2 = 80 'P'</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">(gdb) p *0x80483ef   # вывод содержимого двойного слова в десятичном знаковом виде</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">$3 = -1192172413</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">(gdb) p/x *0x80483ef # вывод содержимого двойного слова в hex-виде</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">$4 = 0xb8f0e483</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">(gdb) p/u *0x80483ef # вывод содержимого двойного слова в десятичном беззнаковом виде</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">$5 = 3102794883</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">(gdb) p $esp = 0     # присвоение регистру esp значения 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">$6 = (void *) 0x0</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">(gdb) p/x *((char*)0x8048413)=0x90</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">$7 = 0x90            # присвоение значение 90h байту по адресу 8048413h</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; color:#000000;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 5 чтение и модификация памяти при помощи команды p (print)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Однако, при просмотре большого количества ячеек памяти выгоднее использовать специальную команду &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">x</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, позволяющую задавать длину отображаемого блока памяти, смотрите:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">(gdb) x/16x $pc      # просмотр 16 двойных слов в hex-виде, начиная от $pc</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">0x80483ef &lt;main+9&gt;:     0xb8f0e483      0x00000000      0x04c7c429      0x00000624</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">0x80483ff &lt;main+25&gt;:    0xffbfe800      0x458dffff      0x24048988      0xfffeb4e8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">0x804840f &lt;main+41&gt;:    0x90c3c9ff      0x90909090      0x90909090      0x90909090</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">0x804841f &lt;main+57&gt;:    0xe5895590      0xf6315657      0x0cec8353      0x0000a0e8</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">(gdb) x/16xb $pc     # просмотр 16 байт слов в hex-виде, начиная от $pc</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">0x80483ef &lt;main+9&gt;:     0x83    0xe4    0xf0    0xb8    0x00    0x00    0x00    0x00</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">0x80483f7 &lt;main+17&gt;:    0x29    0xc4    0xc7    0x04    0x24    0x06    0x00    0x00</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 6 отображение дампа программы с помощью команды &quot;x&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Хакеров, начинающих свой жизненный путь с gdb такая форма подачи информации, быть может и устроит, но пользователям soft-ice она покажется слишком расточительной. Хорошо бы получить классический hex-дамп… И это действительно можно сделать! Достаточно создать реализацию своей собственной команды (назовем ее &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">ddd</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;), отображающий дамп с помощью функции &quot;</span><span style=" font-family:'Courier New'; color:#000000;">printf</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;. В отличии от soft-ice, отладчик gdb бесконечно расширяем и если нас что-то не устаивает, практически всегда возможно переделать это под свой вкус.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Исходный код команды &quot;</span><span style=" font-family:'Courier New'; color:#000000;">ddd</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; выглядит так:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">define ddd</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">set $ddd_p = 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">printf &quot;%08Xh:&quot;,$arg0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">while $ddd_p++ &lt; 16</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">printf &quot; %02X&quot;,*(unsigned char*)$arg0++</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">end</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">printf &quot;\n&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">end</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 7 исходный код пользовательской команды ddd, выводящий дамп в стиле soft-ice и turbo-debugger</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">А вот пример ее использования:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">(gdb) set $t = $esp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">(gdb) ddd $t</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">BFFFFA50h: 8E FF 77 01 E0 FA FF BF 38 6E</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">BFFFFA5Ah: 01 40 34 FB FF BF 94 FA FF BF</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">BFFFFA64h: D0 42 03 40 88 77 01 40 2F 00</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 8 дамп памяти, выведенный пользовательской командой &quot;ddd&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Необходимость введения дополнительной переменной (в данном случае это переменная &quot;</span><span style=" font-family:'Courier New'; color:#000000;">$t</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;) объясняется тем, что команда &quot;</span><span style=" font-family:'Courier New'; color:#000000;">ddd</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; спроектирована так, чтобы отображать по 10h байт за раз, начиная с указанного адреса, а по нажатию на &lt;ENTER&gt; (в gdb – повтор последней команды) — следующие 10h байт и т. д., при этом переданный команде аргумент используется для хранения последнего отображенного адреса. Вызов &quot;</span><span style=" font-family:'Courier New'; color:#000000;">ddd $esp</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; приведет к тому, что значение регистра $esp окажется увеличенным на 10h, что развалит программу.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Естественно, при желании можно переписать команду &quot;</span><span style=" font-family:'Courier New'; color:#000000;">ddd</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; так, чтобы она не имела никаких побочных эффектов и отображала не 10h байт памяти, а ровно столько, сколько ей скажут.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<h2 style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; font-style:italic; color:#000000;">Обработка сигналов</span></h2>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Сигналом — называется асинхронное событие, происходящее в программе и чем-то напоминающее структурные исключения в Windows. Сигналы делятся на фатальные и не фатальные. Пример не фатального сигнала является SIGALRM, возбуждаемый при срабатывании интервального таймера. А вот при нарушения доступа к памяти генерируется сигнал SIGSEGV, завершающий программу в аварийной режиме (если только программист не предусмотрел специальный обработчик).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Отладчик gdb перехватывает все сигналы и в зависимости от своей конфигурации либо передает сигнал программе, либо &quot;поглощает&quot; его, делая вид, что ничего интересного не происходит.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Посмотреть текущую конфигурацию gdb можно с помощью команды &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">info signals</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (она же &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">info handle</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;), а для изменения реакции gdb необходимо воспользоваться &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">handle сигнал поведение</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, где </span><span style=" font-family:'Times New Roman'; font-style:italic; color:#000000;">сигнал</span><span style=" font-family:'Times New Roman'; color:#000000;"> — название сигнала (например, &quot;SIGSEGV&quot;), а </span><span style=" font-family:'Times New Roman'; font-style:italic; color:#000000;">поведение</span><span style=" font-family:'Times New Roman'; color:#000000;"> — реакция отладчика на возникновения сигнала, описываемая следующими ключевыми словами:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">nostop   при получении этого сигнала GDB не останавливает программу;</span></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">stop        при получении этого сигнала GDB останавливает программу;</span></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">print        при получении данного сигнала GDB выводит сообщение о нем на экран;</span></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">noprint   GDB не замечает этот сигнал;</span></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">pass        GDB позволяет программе увидеть этот сигнал;</span></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">nopass   GDB массирует этот сигнал, не позволяя программе увидеть его.</span></li></ul>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1638520930x9prrnyrv6.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Рисунок 3 просмотр реакции отладчика gdb на различные сигналы</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Некоторые сигналы (например, сигнал SIGTRAP, возникающий при достижении программной точки останова) отладчик резервирует для своих собственных нужд. Этим обстоятельством пользуются многие защищенные программы, определяющие находятся ли они под отладкой или нет. Они устанавливают свой собственный обработчик SIGTRAP и затем выполняют инструкцию INT 03h. При выполнении без gdb управление получает обработчик, в противном случае сигнал поглощается отладчиком и обработчик уже не получает управление.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">В частности, файлы, упакованные протектором burneye содержат следующий код:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">0x053714a7:   mov    $0x5,%ebx</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">0x053714ac:   mov    $0x5371a0c,%ecx</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">0x053714b1:   mov    $0x30,%edx</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">0x053714b6:   mov    %edx,%eax</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">0x053714b8:   int    $0x80</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">0x053714ba:   add    $0x5375a00,%esi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">0x053714c0:   mov    %esi,0xfffffd24(%ebp)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">0x053714c6:   int3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">0x053714c7:   cmpl   $0x0,0x5375748</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">0x053714ce:   jne    0x53714e2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">…</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">0x05371a0c:   push   %ebp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">0x05371a0d:   mov    %esp,%ebp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">0x05371a0f:   incl   0x5375748</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">0x05371a15:   leave</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">0x05371a16:   ret</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 9 дизассемблерный фрагмент файла, защищенного протектором burneye</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Попытка отладки программы в нормальном режиме приводит к ее краху (см. рис. 4), если, конечно, в момент возбуждения сигнала не увеличить содержимое ячейки 5375748h на единицу.</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1638520980e7ljpx2d3r.png" /></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Рисунок 4 попытка отладки программы, защищенной протектором burneye, с реакцией на сигналы по умолчанию, заканчивается полным провалом</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Но существует гораздо более простой и элегантный путь. Дождавшись &quot;ругательства&quot; отладчика по поводу поимки сигнала SIGTRAP мы даем команду &quot;</span><span style=" font-family:'Courier New'; color:#000000;">handle SIGTRAP pass</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; и передаем программе управление командой &quot;continue&quot;. И все будет работать как часы!</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1638520999xg5k0jf1e1.png" /></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Рисунок 5 передача сигнала SIGTRAP программе вводит защиту в заблуждение и отладка проходит успешно</span></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; font-weight:600; color:#000000;"><br /></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; font-weight:600; color:#000000;"><br /></p>
<h2 style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; font-style:italic; color:#000000;">Заключение</span></h2>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Вот мы и познакомились с основными возможностями могучего отладчика gdb. Однако, это лишь малая часть того, на что он способен. Все остальное — содержится в штатной документации и… исходных текстах (документация, как водится, содержит множество упущений). Тем не менее, для большинства хакерских задач рассмотренных нами команд будет вполне достаточно.</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>