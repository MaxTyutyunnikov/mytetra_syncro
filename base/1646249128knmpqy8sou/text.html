<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Сегодня я расскажу, как подготовить рабочую среду для разработки под ARM Cortex-M3 микроконтроллеры STM32F10x. Среда должна в себя включать компилятор, редактор кода, отладчик, прошивалку микроконтроллера, а также должна быть удобна для использования. Ну и должна дружить с платами </span><a href="https://robocraft.ru/shop/index.php?route=product/product&amp;path=55&amp;product_id=156"><span style=" font-family:'Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">STM32VLDiscovery</span></a><span style=" font-family:'Sans'; font-size:12pt;"> и STM32L-Discovery, само собой.Выбор IDE для ARM довольно большой, и можно их условно разделить на две группы — коммерческие и некоммерческие.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Коммерческие:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.keil.com/arm/mdk.asp"><span style=" text-decoration: underline; color:#0000ff;">Keil для ARM</span></a> и <a href="https://www.arm.com/products/tools/software-tools/ds-5/index.php"><span style=" text-decoration: underline; color:#0000ff;">ARM Development Studio 5</span></a>, ARM Ltd.</li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.iar.com/en/Products/IAR-Embedded-Workbench/ARM/"><span style=" text-decoration: underline; color:#0000ff;">Embedded Workbench for ARM</span></a>, IAR Systems</li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.atollic.com/index.php/targets/stm32"><span style=" text-decoration: underline; color:#0000ff;">TrueSTUDIO для STM32</span></a>, Atollic</li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.rowley.co.uk/arm/index.htm"><span style=" text-decoration: underline; color:#0000ff;">CrossWorks for ARM</span></a>, Rowley Associates</li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.oasistechsol.com/triton_ide.aspx"><span style=" text-decoration: underline; color:#0000ff;">Triton IDE</span></a>, Oasis technologies Pvt. Ltd.</li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://microcross.com/html/visual_x-tools.html"><span style=" text-decoration: underline; color:#0000ff;">Visual X-Tools</span></a>, Microcross</li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.embedinfo.com/english/product/idemain.asp"><span style=" text-decoration: underline; color:#0000ff;">Embest IDE for ARM</span></a>, Embest</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Некоммерческие:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.coocox.org/CooCox_CoIDE.htm"><span style=" text-decoration: underline; color:#0000ff;">CoIDE</span></a>, CooCox</li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Конструктор самоделкина: <a href="https://eclipse.org/"><span style=" text-decoration: underline; color:#0000ff;">Eclipse</span></a> + <a href="https://sourceforge.net/apps/mediawiki/gnuarmeclipse/index.php?title=Main_Page"><span style=" text-decoration: underline; color:#0000ff;">GNU ARM Eclipse Plug-in</span></a> + <a href="http://www.mentor.com/embedded-software/sourcery-tools/sourcery-codebench/lite-edition"><span style=" text-decoration: underline; color:#0000ff;">Sourcery CodeBench Lite Edition</span></a> (версия ARM EABI) + <a href="https://github.com/texane/stlink"><span style=" text-decoration: underline; color:#0000ff;">stlink</span></a></li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Наверняка есть ещё, ведь IDE для ARM не сделал, похоже, только ленивый. Коммерческие IDE обычно довольно хороши, и большая их часть основана на Eclipse, но у всех них есть общие недостатки: они стоят денег (вот это новость!), их бесплатные версии имеют ограничения по объёму кода, не все поддерживают плату STM32VLDiscovery, а версии для Linux почти никто не делает (есть пара 30-дневных trial-версий). А в популярной, не знаю, почему, среде Keil ещё и редактор кода, судя по его виду и удобству, написан во времена Windows 95.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099ys42nge5ja.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">У кого много денег (или начальство на работе купило IDE), и кто не собирается слезать с Windows — спокойно берите эти жлобские поделки (: и мучайтесь/радуйтесь с ними, а я, не будучи буржуем de facto, предлагаю обратить внимание на бесплатные среды разработки. Конечно же, у них тоже есть и плюсы, и минусы — о них я расскажу в первую очередь.</span></p>
<h4 style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Конструктор самоделкина</span></h4>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099gfz4i7894s.png" /><span style=" font-family:'Sans'; font-size:12pt;"> </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">[Eclipse] </span><span style=" font-family:'Sans'; font-size:12pt;">Офигенный редактор кода: подсветка синтаксиса, авто-дополнение и авто-завершение кода, всплывающие подсказки, рефакторинг (легко заменить название функции/переменной во всём проекте сразу).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099gfz4i7894s.png" /><span style=" font-family:'Sans'; font-size:12pt;"> </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">[Eclipse/ARM Plugin] </span><span style=" font-family:'Sans'; font-size:12pt;">Интеграция с отладчиком: можно устанавливать точки останова в программе (breakpoints), выполнять программу пошагово, менять содержимое регистров и памяти, смотреть ассемблерный листинг… Всё, как положено.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099gfz4i7894s.png" /><span style=" font-family:'Sans'; font-size:12pt;"> </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">[CodeBench] </span><span style=" font-family:'Sans'; font-size:12pt;">Сочетание компилятора GCC и отладчика GDB, а также других программ из этой сборки, даёт компактный, быстрый код и отличные возможности отладки и анализа кода.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099gfz4i7894s.png" /><span style=" font-family:'Sans'; font-size:12pt;"> Всё компоненты «конструктора» есть под Windows и Linux. Думаю, вполне реально собрать и для Mac OS X, если сильно захотеть.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099gfz4i7894s.png" /><span style=" font-family:'Sans'; font-size:12pt;"> Не заточен под какие-либо определённые семейства МК. В будущем можно будет писать хоть под полноценные процы вроде Cortex-A9.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099gdnoaxe0x6.png" /><span style=" font-family:'Sans'; font-size:12pt;"> Большой объём работы при первоначальной настройке. Большая часть статьи будет посвящена этому, но для ленивых в конце статьи ссылки на готовые сборки IDE (:</span></p>
<h4 style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">CoIDE</span></h4>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Судя по всему, сделана китайцами, но на удивление качественно.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099gfz4i7894s.png" /><span style=" font-family:'Sans'; font-size:12pt;"> Эта среда основана на Eclipse, так что имеет все плюсы оной.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099gfz4i7894s.png" /><span style=" font-family:'Sans'; font-size:12pt;"> Создавать проекты очень легко, пользуясь мастером — всего в несколько шагов.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099gfz4i7894s.png" /><span style=" font-family:'Sans'; font-size:12pt;"> Добавление новых библиотек в проект реализовано проще некуда.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099gfz4i7894s.png" /><span style=" font-family:'Sans'; font-size:12pt;"> Настроить свойства проекта и отладки — пару раз клацнуть мышкой.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099gfz4i7894s.png" /><span style=" font-family:'Sans'; font-size:12pt;"> Скачал, установил, пользуешься. Никакой возни с настройкой.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099gdnoaxe0x6.png" /><span style=" font-family:'Sans'; font-size:12pt;"> Нет версий для Linux или MacOS (пишут, для Linux что когда-нибудь сделают).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099gdnoaxe0x6.png" /><span style=" font-family:'Sans'; font-size:12pt;"> Пути к файлам в проекте забиты как абсолютные, а не относительные, так что простой перенос папки с проектом в другое место не прокатит — проект не соберётся.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099gdnoaxe0x6.png" /><span style=" font-family:'Sans'; font-size:12pt;"> Тонкие настройки Eclipse спрятаны так глубоко, что для их поиска может понадобиться помощь проктолога.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Такие дела, коллеги. Ну что ж, сделаем так: по умолчанию будем использовать «конструктор», а если у кого не заработает — ставьте CoIDE. Для обоих вариантов я опишу настройку и создание проекта.</span></p>
<h2 style="-qt-paragraph-type:empty; margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:x-large; font-weight:600;"><br /></h2>
<h2 style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Конструктор: покрасноглазим</span></h2>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Внимание: потребуются навыки более чем продвинутого пользователя. У кого их нет, ну или времени и/или желания собирать всё это — в конце статьи вас ждут ссылки на готовые сборки конструктора для Windows и Linux, можете переходить к разделу «Создание скелетного проекта» (пользователям Windows ещё нужно прочитать про установку драйвера WinUSB ниже). Остальным советую поставить на воспроизведение что-то вроде плейлиста боссовских тем из игры Painkiller или другую спокойную добрую музыку. Кто доберётся до финиша без мухляжа, получит стопицот очков опыта.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Для начала объясню, почему конструктор состоит именно из таких деталей, как написано выше:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Чтобы в принципе разрабатывать софт для каких-либо МК, нам нужен компилятор и отладчик. Это Sourcery CodeBench Lite Edition — компилятор GCC, отладчик GDB и ещё несколько полезных утилит для работы с исполняемыми файлами.</li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Наши бесценные программы нужно как-то заливать на МК, да и сам GDB ничего не знает о внутренностях конкретных МК. Проект stlink служит посредником между GDB и отладчиком ST-Link, установленным на плате STM32VLDiscovery, а также содержит утилиту для прошивки.</li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Нужна приличная IDE, на дворе 2011 год, как-никак — не в Notepad/vim же код писать и отлаживать? Eclipse — отличная IDE, но настраивать её с нуля для разработки под ARM не очень весело, да и специфика тут своя, а для этого есть ARM Plugin для Eclipse.</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Далее, для сборки и тестирования софта нам нужно будет работать в консоли в Unix-окружении. В Linux для этого всё изначально есть, а в Windows нужно установить </span><a href="http://www.mingw.org/wiki/Getting_Started"><span style=" font-family:'Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">MinGW</span></a><span style=" font-family:'Sans'; font-size:12pt;"> с MSYS, после чего запустить MSYS.</span></p>
<h3 style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Sourcery CodeBench Lite Edition</span></h3>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Итак, начнём с того, без чего процесс сборки может потерять всякий смысл — это набор софта для компиляции и отладки наших будущих программ, и это в данном случае Sourcery CodeBench Lite Edition (бывшая Sourcery G++ Lite). В нём для нас заботливо собраны (и протестированы) GCC, GDB и прочие стандартные утилиты GNU для работы с кодом и исполняемыми файлами. В принципе, всё это можно собрать и самому из исходников, но это два часа возни и ожидания на ПК средней мощности, а за нас всё сделали задаром.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Скачать CodeBench можно </span><a href="https://sourcery.mentor.com/sgpp/lite/arm/portal/subscription?@template=lite"><span style=" font-family:'Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">на сайте компании-разработчика</span></a><span style=" font-family:'Sans'; font-size:12pt;"> как в виде инсталлятора (рекомендую), так и простым архивом, но если у вас Arch Linux, то можно поставить пакет из AUR:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">yaourt -S aur/arm-2011-arm-none-eabi</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">После установки проверьте, что компилятор запускается и работает, откомпилировав незатейливый исходник на C, назвав его, скажем, x.c:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">int main()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">}</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">командой</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">arm-none-eabi-gcc x.c</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">В результате вы увидите сообщение типа:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">/usr/bin/../lib/gcc/arm-none-eabi/4.5.2/../../../../arm-none-eabi/bin/ld:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">warning: cannot find entry symbol _start; defaulting to 00008018</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Тут компилятор всего лишь жалуется, что не определена точка входа, ведь для МК недостаточно просто написать функцию main(), чтобы она начала выполняться. Впрочем, сейчас это неважно.</span></p>
<h3 style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">stlink</span></h3>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Далее нам нужно средство отладки и прошивки для нашей платы. На STM32VLDiscovery установлен отладчик ST-Link версии 1, а на STM32L-Discovery — ST-Link 2, которые поддерживаются в нескольких IDE и утилитах для прошивки МК, но, как это обычно бывает, только под Windows. Но в мире есть добрые люди! Один такой добрый человек — Fabien Le Mentec — относительно недавно при поддержке компании ST Microelectronics начал работу по поддержке ST-Link в Linux, и его проект </span><a href="https://github.com/texane/stlink"><span style=" font-family:'Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">stlink</span></a><span style=" font-family:'Sans'; font-size:12pt;"> содержит GDB-сервер и утилиту для прошивки. Если кто не в курсе: отладчик GDB умеет отлаживать удалённо, подключаясь по сети (по TCP/IP) к программе-серверу, которая работает с реальным железом. Разработчик Karl Palsson допилил поддержку ST-Link v1 в своём </span><a href="https://github.com/karlp/stlink"><span style=" font-family:'Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">форке</span></a><span style=" font-family:'Sans'; font-size:12pt;">, ну а я </span><a href="https://github.com/burjui/stlink"><span style=" font-family:'Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">портировал</span></a><span style=" font-family:'Sans'; font-size:12pt;"> этот проект под Windows, заодно поправив косяки с работой по сети и добавив поддержку рестарта при отключении клиента.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Для сборки stlink необходима библиотека libusb-1.0 с заголовочными файлами, которую в Linux можно установить из репозиториев:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;"># Ubuntu</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">sudo apt-get install libusb-1.0-0-dev</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;"># Arch Linux</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">sudo pacman -S libusb</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Версию libusb-1.0.8 для Windows можно скачать </span><a href="https://robocraft.ru/files/software/libusb-1.0.8-windows.tar.bz2"><span style=" font-family:'Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">с нашего сервера</span></a><span style=" font-family:'Sans'; font-size:12pt;">, установить её можно так:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">tar jxvf libusb-1.0.8-windows.tar.bz2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">cd libusb-1.0.8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">./configure --prefix=/mingw</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">make</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">make install</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Если у вас ещё не установлена система контроля версий Git, то самое время её установить — скачав с </span><a href="https://git-scm.com/download"><span style=" font-family:'Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">официального сайта или</span></a><span style=" font-family:'Sans'; font-size:12pt;">, в Linux, через пакетный менеджер:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;"># Ubuntu</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">sudo apt-get install git</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;"># Arch Linux</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">sudo pacman -S git</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Перейдите в папку, где вы хотите держать stlink (у меня это </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">/home/burjui/devel</span><span style=" font-family:'Sans'; font-size:12pt;"> в Linux и </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">c:\tmp</span><span style=" font-family:'Sans'; font-size:12pt;"> в Windows), клонируйте stlink из репозитория, перейдите в папку проекта, скомпилируйте проект и установите GDB-сервер:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;"># Windows</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">cd c: mp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">git clone git://github.com/burjui/stlink.git -b server-restart</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">cd stlink</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">make CC=gcc CONFIG_WIN32=1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">cp ./gdbserver/st-util.exe /mingw/bin</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;"># Linux</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">cd /home/burjui/devel</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">git clone git://github.com/burjui/stlink.git -b server-restart</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">cd stlink</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">make</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">sudo ln -s /home/burjui/devel/stlink/gdbserver/st-util /usr/local/bin</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">В Linux вам ещё потребуется сделать пару действий, чтобы устройство корректно определялось:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Нужны права на запись в устройство ST-Link для обычного пользователя: </li>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">sudo cp 49-stlinkv* /etc/udev/rules.d/</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">sudo udevadm control --reload-rules</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Демон udevd перечитает правила из </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">/etc/udev/rules.d/</span><span style=" font-family:'Sans'; font-size:12pt;"> и при подключении платы создаст в </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">/dev</span><span style=" font-family:'Sans'; font-size:12pt;"> файл устройства с осмысленным именем типа </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">stlinkv1_4</span><span style=" font-family:'Sans'; font-size:12pt;"> и с нужными правами.</span></p>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">ST-Link версии 1 использует кривую эмуляцию SCSI, чтобы притворяться флешкой, а нам это — лишняя палка в колесо. Устраняем: </li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">sudo cp stlink_v1.modprobe.conf /etc/modprobe.d</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">sudo modprobe -r usb-storage &amp;&amp; sudo modprobe usb-storage</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Драйвер usb-storage перезагрузился, а modprobe, прочитав /etc/modprobe.d/stlink_v1.modprobe.conf, попросила драйвер не работать с ST-Link. Драйвер на просьбу отреагирует отладочным сообщением ядра:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">$ dmesg | tail -n 2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">[82914.808449] usb 6-4: new full speed USB device number 4 using ohci_hcd</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">[82914.981001] usb-storage 6-4:1.0: device ignored</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">А в Windows потребуется немного шаманства, чтобы установить </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">драйвер WinUSB</span><span style=" font-family:'Sans'; font-size:12pt;">, необходимый для работы libusb в этой ОС. Подключите плату STM32VLDiscovery, далее скачайте программу </span><a href="https://robocraft.ru/files/software/zadig_v2.0.1.154.7z"><span style=" font-family:'Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">Zadig</span></a><span style=" font-family:'Sans'; font-size:12pt;"> и запустите её с правами администратора. В меню </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Options</span><span style=" font-family:'Sans'; font-size:12pt;"> поставьте галочку </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">List All Devices</span><span style=" font-family:'Sans'; font-size:12pt;">:</span></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099jbenehjs22.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Выберите из выпадающего списка устройство USB Mass Storage Device с USB ID, равным </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">0483 3744</span><span style=" font-family:'Sans'; font-size:12pt;"> (ST-Link) или </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">0483 3748</span><span style=" font-family:'Sans'; font-size:12pt;"> (ST-Link 2), и нажмите кнопку </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Replace Driver</span><span style=" font-family:'Sans'; font-size:12pt;">:</span></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099ijxxng5c5p.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Программа предупредит, что это опасно, но мы не боимся опасностей и жмём </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Yes</span><span style=" font-family:'Sans'; font-size:12pt;">:</span></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099k1i7ps5482.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Если ничего «опасного» не произойдёт, можно будет порадоваться успешной установке:</span></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099qruku82dg4.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Осталось переподключить плату — и можно испытывать GDB-сервер и в Windows, и в Linux. Наберите команду:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">st-util -1</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Ключ «-1» указывает, что нам нужно подключить ST-Link именно версии 1. Если у вас STM32L-Discovery, на которой ST-Link 2, то этот ключ указывать не нужно. Если всё пройдёт успешно, вывод программы будет выглядеть так:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">2011-11-23T18:29:57 INFO src/stlink-common.c: Loading device parameters....</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">2011-11-23T18:29:57 INFO src/stlink-common.c: Device connected is: F1 Medium-density Value Line device</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">2011-11-23T18:29:57 INFO src/stlink-common.c: SRAM size: 0x2000 bytes (8 KiB),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Flash: 0x20000 bytes (128 KiB) in pages of 1024 bytes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">2011-11-23T18:29:57 INFO src/stlink-sg.c: Successfully opened a stlink v1 debugger</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Chip ID is 10016420, Core ID is 1ba01477.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">KARL - should read back as 0x03, not 60 02 00 00</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">init watchpoints</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Listening at *:4242...</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Сервер запущен, попробуем к нему подключиться. В другом окне с консолью запустите GDB для ARM:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">arm-none-eabi-gdb</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">В появившемся приглашении наберите команду:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">target extended-remote localhost:4242</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;"># GDB понимает и сокращения:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;"># tar ext :4242</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">В GDB результат будет выглядеть так:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">(gdb) target extended-remote localhost:4242</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Remote debugging using localhost:4242</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">0x0800061c in ?? ()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">(gdb)</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">В st-util:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">GDB connected. -- ключевой момент!</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">recv: qSupported:multiprocess+;qRelocInsn+</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">query: Supported;multiprocess+;qRelocInsn+</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">send: PacketSize=3fff;qXfer:memory-map:read+</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">recv: !</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">send: OK</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">recv: Hg0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">...</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Чтобы в будущем не набирать каждый раз в консоли ‘st-util -1’ для запуска GDB-сервера, советую сделать ярлык с аргументом «-1» после пути к .exe’шнику (или shell script в Linux).</span></p>
<h3 style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Eclipse + ARM plugin</span></h3>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Вы ещё живы? Ничего, осталось совсем немного.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Так как ARM Plugin поддерживает Eclipse версии не старше, чем Helios (3.6.x), то её и поставим с официального сайта, взяв самую свежую версию на данный момент — </span><a href="https://www.eclipse.org/downloads/packages/release/helios/sr2"><span style=" font-family:'Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">3.6.2 (Helios SR2)</span></a><span style=" font-family:'Sans'; font-size:12pt;">. Нам нужна Eclipse IDE for C/C++ Developers, которая также широко известна по более короткому названию — Eclipse CDT. Качайте версию под свою ОС и распаковывайте, куда захочется. Мне захотелось в </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">/home/burjui/apps/eclipse</span><span style=" font-family:'Sans'; font-size:12pt;">, например.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Запускайте Eclipse и выбирайте пункт меню </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Help→Install New Software…</span><span style=" font-family:'Sans'; font-size:12pt;"> Не слишком очевидно, не правда ли? Далее действуем в соответствии с </span><a href="https://sourceforge.net/apps/mediawiki/gnuarmeclipse/index.php?title=Plug-in_Installation"><span style=" font-family:'Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">инструкциями</span></a><span style=" font-family:'Sans'; font-size:12pt;"> по установке плагина, а именно жмём кнопку </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Add</span><span style=" font-family:'Sans'; font-size:12pt;"> и в появившемся окне </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Add Repository</span><span style=" font-family:'Sans'; font-size:12pt;"> вписываем имя плагина — например, ARM Plugin. Качаем </span><a href="https://sourceforge.net/projects/gnuarmeclipse/files/gnuarmeclipse/0.5.3/org.eclipse.cdt.cross.arm.gnu_0.5.3.201010141144.zip/download"><span style=" font-family:'Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">zip-архив</span></a><span style=" font-family:'Sans'; font-size:12pt;"> с плагином (нам нужна именно версия 0.5.3, более свежая требует Eclipse 3.7.x, а там поломали отладку), жмём кнопку </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Archive</span><span style=" font-family:'Sans'; font-size:12pt;"> и выбираем скачанный архив, после чего жмём ОК.</span></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099vf3ssroxju.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Eclipse скачает с сервера информацию о доступных пакетах и покажет нам доступный к установке плагин. Ставим напротив него галочку и жмём </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Next</span><span style=" font-family:'Sans'; font-size:12pt;">:</span></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image164624909923vka1sv50.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">После этого мы увидим типичное малоинформативное окно в стиле «просто нажми Next», а следом — лицензионное соглашение, с которым мы, разумеется, уже согласны — просто жмём </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Finish</span><span style=" font-family:'Sans'; font-size:12pt;">:</span></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099yv78f1wxes.png" /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099i97li0s6db.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">После этого процесс установки, наконец, начнётся:</span></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099gwusw5t50y.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Но посреди него нас попросят подтвердить, что мы абсолютно безбашенные и действительно хотим установить софт без цифровой подписи:</span></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image16462490995e9t24uy2p.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Когда установка завершится, Eclipse предложит перезапуск:</span></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099rkeelwuejo.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Ну вот, теперь у нас есть полноценная среда разработки для ARM.</span></p>
<h3 style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Создаём скелетный проект</span></h3>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Поди, уже расслабились? Самое интересное — впереди.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans'; font-size:12pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image16462490995zk07wl011.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Опять же, для ленивых в конце статьи есть ссылка на архив с проектом, а самые смелые могут продолжить сеанс интеллектуального мазохизма за компанию.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">В Eclipse на стартовой странице выбираем </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Workbench</span><span style=" font-family:'Sans'; font-size:12pt;">, в меню выбираем пункт </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">File→New→C Project</span><span style=" font-family:'Sans'; font-size:12pt;">. В появившемся окне слева выбираем </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">ARM Cross Target Application/Empty Project</span><span style=" font-family:'Sans'; font-size:12pt;">, справа — </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Sourcery G++ Lite</span><span style=" font-family:'Sans'; font-size:12pt;">:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099ynwngysqda.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Проект я назвал так для STM32VLDiscovery, а для STM32L-Discovery я бы назвал его stm32ld_template.</span></p>
<h4 style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">STM32VLDiscovery</span></h4>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Для работы с этой платой скачаем библиотеку STM32F10x Standard Peripheral Library с </span><a href="http://www.st.com/internet/com/SOFTWARE_RESOURCES/SW_COMPONENT/FIRMWARE/stm32f10x_stdperiph_lib.zip"><span style=" font-family:'Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">сайта ST</span></a><span style=" font-family:'Sans'; font-size:12pt;"> (</span><a href="https://robocraft.ru/files/software/stm32f10x_stdperiph_lib.zip"><span style=" font-family:'Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">копия у нас</span></a><span style=" font-family:'Sans'; font-size:12pt;">). Последняя на данный момент версия для STM32F10x — 3.5.0, так что после распаковки у нас будет папка </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">STM32F10x_StdPeriph_Lib_V3.5.0</span><span style=" font-family:'Sans'; font-size:12pt;">. Создайте в папке с проектом подпапки </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">CMSIS</span><span style=" font-family:'Sans'; font-size:12pt;"> и </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">StdPeripheralDriver</span><span style=" font-family:'Sans'; font-size:12pt;">, скопируйте в них указанные файлы и папки из </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">STM32F10x_StdPeriph_Lib_V3.5.0</span><span style=" font-family:'Sans'; font-size:12pt;">:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">В </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">CMSIS</span><span style=" font-family:'Sans'; font-size:12pt;">:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">core_cm3.h</span> и <span style=" font-weight:600;">core_cm3.c</span><br />из <span style=" font-style:italic;">Libraries/CMSIS/CM3/CoreSupport</span></li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">stm32f10x.h</span>, <span style=" font-weight:600;">system_stm32f10x.c</span> и <span style=" font-weight:600;">system_stm32f10x.h</span><br />из <span style=" font-style:italic;">Libraries/CMSIS/CM3/DeviceSupport/ST/STM32F10x</span></li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">startup_stm32f10x_md_vl.s</span><br />из <span style=" font-style:italic;">Libraries/CMSIS/CM3/DeviceSupport/ST/STM32F10x/startup/gcc_ride7</span><br />При этом расширение имени файла <span style=" font-weight:600;">нужно сменить с ‘.s’ на ‘.S’</span> — это нужно, чтобы Eclipse понял, что это файл с кодом на ассемблере.</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">В </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">StdPeripheralDriver</span><span style=" font-family:'Sans'; font-size:12pt;">:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Папки <span style=" font-style:italic;">inc</span> и <span style=" font-style:italic;">src</span> из <span style=" font-style:italic;">Libraries/STM32F10x_StdPeriph_Driver</span></li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Также в </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">CMSIS</span><span style=" font-family:'Sans'; font-size:12pt;"> нужно создать файл </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">stm32f10x_conf.h</span><span style=" font-family:'Sans'; font-size:12pt;"> следующего содержания:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">#ifndef STM32F10X_CONF_H_</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">#define STM32F10X_CONF_H_</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">/* ------------------- */</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">#ifndef USE_FULL_ASSERT</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">#define assert_param(x)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">#endif</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">/* ------------------- */</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">#endif</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">В папке с проектом создайте файл </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">main.c</span><span style=" font-family:'Sans'; font-size:12pt;"> с минимальным кодом бесконечного цикла:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">#include &lt;stm32f10x.h&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">int main()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">do __NOP(); while (1);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">}</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Туда же закиньте файл </span><a href="https://robocraft.ru/files/stm32/lesson-1-ide/stm32f100rb.ld"><span style=" font-family:'Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">stm32f100rb.ld</span></a><span style=" font-family:'Sans'; font-size:12pt;">. Щёлкните правой кнопкой по проекту в Eclipse, и в контекстном меню нажмите </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Refresh</span><span style=" font-family:'Sans'; font-size:12pt;"> — тогда Eclipse увидит новые файлы и папки и добавит их в проект.</span></p>
<h4 style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">STM32L-Discovery</span></h4>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Для этой платы последовательность действий такая же, только будут меняться имена папок и файлов, а местами и содержимое.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Так как на этой плате установлен микроконтроллер STM32L152RBT6, то и качать мы будем </span><a href="http://www.st.com/internet/com/SOFTWARE_RESOURCES/SW_COMPONENT/FIRMWARE/stm32l1xx_stdperiph_lib.zip"><span style=" font-family:'Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">STM32L1XX Standard Peripheral Library</span></a><span style=" font-family:'Sans'; font-size:12pt;"> (</span><a href="https://robocraft.ru/files/software/stm32l1xx_stdperiph_lib.zip"><span style=" font-family:'Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">копия</span></a><span style=" font-family:'Sans'; font-size:12pt;">). Распаковываем архив, получаем папку </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">STM32L1xx_StdPeriph_Lib_V1.0.0</span><span style=" font-family:'Sans'; font-size:12pt;"> и копируем из неё:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">В </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">CMSIS</span><span style=" font-family:'Sans'; font-size:12pt;">:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">core_cm3.h</span> и <span style=" font-weight:600;">core_cm3.c</span><br />из <span style=" font-style:italic;">Libraries/CMSIS/CM3/CoreSupport</span></li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">stm32l1xx.h</span>, <span style=" font-weight:600;">system_stm32l1xx.h</span> и <span style=" font-weight:600;">system_stm32l1xx.с</span><br />из <span style=" font-style:italic;">Libraries/CMSIS/CM3/DeviceSupport/ST/STM32L1xx</span></li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">startup_stm32l1xx_md.s</span><br />из <span style=" font-style:italic;">Libraries/CMSIS/CM3/DeviceSupport/ST/STM32L1xx/startup/gcc_ride7</span><br />Не забываем сменить расширение имени файла <span style=" font-weight:600;">с ‘.s’ на ‘.S’</span>.</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">В </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">StdPeripheralDriver</span><span style=" font-family:'Sans'; font-size:12pt;">:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Папки <span style=" font-style:italic;">inc</span> и <span style=" font-style:italic;">src</span> из <span style=" font-style:italic;">Libraries/STM32L1xx_StdPeriph_Driver</span></li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">В </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">CMSIS</span><span style=" font-family:'Sans'; font-size:12pt;"> нужно создать файл </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">stm32l1xx_conf.h</span><span style=" font-family:'Sans'; font-size:12pt;"> следующего содержания:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">#ifndef STM32L1XX_CONF_H_</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">#define STM32L1XX_CONF_H_</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">/* ------------------- */</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">#ifndef USE_FULL_ASSERT</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">#define assert_param(x)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">#endif</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">/* ------------------- */</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">#endif</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">В папке с проектом создайте файл </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">main.c</span><span style=" font-family:'Sans'; font-size:12pt;"> с минимальным кодом бесконечного цикла:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">#include &lt;stm32l1xx.h&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">int main()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">do __NOP(); while (1);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">}</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Туда же закиньте файл </span><a href="https://robocraft.ru/files/stm32/lesson-1-ide/stm32l152rb.ld"><span style=" font-family:'Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">stm32l152rb.ld</span></a><span style=" font-family:'Sans'; font-size:12pt;">. Щёлкните правой кнопкой по проекту в Eclipse, и в контекстном меню нажмите </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Refresh</span><span style=" font-family:'Sans'; font-size:12pt;"> — тогда Eclipse увидит новые файлы и папки и добавит их в проект.</span></p>
<h4 style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Общая настройка</span></h4>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Настроим проект так, чтобы всё это компилировалось, заливалось на МК и отлаживалось. Выбираем в меню пункт </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Project→Properties</span><span style=" font-family:'Sans'; font-size:12pt;">, в окне в левой панели выбираем раздел </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">C/C++ Build→Settings</span><span style=" font-family:'Sans'; font-size:12pt;">, справа вверху из списка </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Configuration</span><span style=" font-family:'Sans'; font-size:12pt;"> выбираем пункт </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">[ All configurations ]</span><span style=" font-family:'Sans'; font-size:12pt;"> и начинаем шерстить по подразделам настроек.</span></p>
<h4 style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Target Processor</span></h4>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Выбираем Processor — </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">cortex-m3</span><span style=" font-family:'Sans'; font-size:12pt;">, ставим галочку </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Thumb (-mthumb)</span><span style=" font-family:'Sans'; font-size:12pt;">.</span></p>
<h4 style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">C Compiler/Preprocessor</span></h4>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Добавим два определения для препроцессора языка C, которые необходимы для библиотек в </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">StdPeripheralDriver</span><span style=" font-family:'Sans'; font-size:12pt;">: </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">USE_STDPERIPH_DRIVER</span><span style=" font-family:'Sans'; font-size:12pt;">, а также </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">STM32F10X_MD_VL</span><span style=" font-family:'Sans'; font-size:12pt;"> или </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">STM32L1XX_MD</span><span style=" font-family:'Sans'; font-size:12pt;"> для STM32VLDiscovery и STM32L-Discovery, соответственно. Щёлкаем плюсик и вводим первое значение, второе — так же.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099fkaayvmtp5.png" /></p>
<h4 style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">C Compiler/Directories</span></h4>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Здесь укажем, в каких папках проекта у нас лежат заголовочные файлы библиотек. Жмём плюсик и, чтобы пути к папкам считались относительно папки с проектом, жмём кнопку </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Workspace…</span><span style=" font-family:'Sans'; font-size:12pt;"> и выбираем в проекте папку </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">CMSIS</span><span style=" font-family:'Sans'; font-size:12pt;">:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099xblxrststv.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Аналогично добавляем папку </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">StdPeripheralDriver/inc</span><span style=" font-family:'Sans'; font-size:12pt;">.</span></p>
<h4 style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">C Compiler/Optimization</span></h4>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Здесь ставим галочки:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Function sections (-ffunction-sections)</li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Data sections (-fdata-sections)</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099t7i5bek34d.png" /></p>
<h4 style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">C Linker/General</span></h4>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">В поле Script file (-T) указываем путь к скрипту </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">stm32f100rb.ld</span><span style=" font-family:'Sans'; font-size:12pt;"> или </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">stm32f152rb.ld</span><span style=" font-family:'Sans'; font-size:12pt;"> для STM32VLDiscovery и STM32L-Discovery, соответственно — желательно, в таком же формате, как и папки в предыдущем случае, но </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">без кавычек</span><span style=" font-family:'Sans'; font-size:12pt;">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Ставим галочки:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Do not use standart start files (-nostartfiles)</li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Remove unused sections (-Xlinker —gc-sections)</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099t0x3avew44.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Здесь всё, жмём </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">ОК</span><span style=" font-family:'Sans'; font-size:12pt;">.<br />Протестируем сборку проекта. Выбираем в меню отладочную сборку — </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Project→Build Configurations→Debug</span><span style=" font-family:'Sans'; font-size:12pt;">, запускаем сборку — </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Project→Build Project</span><span style=" font-family:'Sans'; font-size:12pt;">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099i1f3y6bsyk.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Если после окончания сборки в нижней панели на вкладке </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Problems</span><span style=" font-family:'Sans'; font-size:12pt;"> ничего не написано, значит, сборка прошла успешно.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Теперь осталось только настроить отладчик. Создаём в папке проекта файл </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">gdb_commands_debug</span><span style=" font-family:'Sans'; font-size:12pt;"> следующего содержания:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">tar ext :4242</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">load Debug/stm32vld_template.elf</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">и ещё один похожий — </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">gdb_commands_release</span><span style=" font-family:'Sans'; font-size:12pt;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">tar ext :4242</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">load Release/stm32vld_template.elf</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Идём в </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Run→Debug Configurations…</span><span style=" font-family:'Sans'; font-size:12pt;">, правым кликом на разделе </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">C/C++ Application</span><span style=" font-family:'Sans'; font-size:12pt;"> вызываем меню, в котором выбираем пункт </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">New</span><span style=" font-family:'Sans'; font-size:12pt;">. Настроим созданную конфигурацию.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Раздел </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Main</span><span style=" font-family:'Sans'; font-size:12pt;">:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Name: <span style=" font-style:italic;">Debug</span></li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">C/C++ Application: <span style=" font-style:italic;">Debug/stm32vld_template.elf</span></li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Build Configuration: <span style=" font-style:italic;">Debug</span></li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выбираем опцию <span style=" font-style:italic;">Enable auto build</span></li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Раздел </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Debugger</span><span style=" font-family:'Sans'; font-size:12pt;">, вкладка </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Main</span><span style=" font-family:'Sans'; font-size:12pt;">:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">GDB debugger: <span style=" font-style:italic;">arm-none-eabi-gdb</span></li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">GDB command file: <span style=" font-style:italic;">gdb_commands_debug</span></li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image16462490993781tjft2z.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Жмём </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Apply</span><span style=" font-family:'Sans'; font-size:12pt;">. Полученная конфигурация будет у нас отладочной: после сборки проекта в прошивке будет много «лишнего» кода, который необходим для отладки, но заметно раздувает размер прошивки.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Аналогично создаём релизную конфигурацию, при сборке которой прошивка будет содержать только необходимый код:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Name: <span style=" font-style:italic;">Release</span></li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">C/C++ Application: <span style=" font-style:italic;">Release/stm32vld_template.elf</span></li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Build Configuration: <span style=" font-style:italic;">Release</span></li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выбираем опцию <span style=" font-style:italic;">Enable auto build</span></li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">GDB debugger: <span style=" font-style:italic;">arm-none-eabi-gdb</span></li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">GDB command file: <span style=" font-style:italic;">gdb_commands_release</span></li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">И в приведённых выше файлах, и в настройке конфигураций вместо stm32vld_template нужно написать имя проекта, если оно у вас отличается.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Ну, теперь-то с настройкой покончено! Напоследок проверим, как работает отладка. Для этого запускаем GDB-сервер (‘st-util -1’) и в меню жмём </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Run-&gt;Debug Configurations…</span><span style=" font-family:'Sans'; font-size:12pt;">, выбираем конфигурацию </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">Debug</span><span style=" font-family:'Sans'; font-size:12pt;"> и жмём кнопку </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Debug</span><span style=" font-family:'Sans'; font-size:12pt;"> внизу окна. Сервер должен отреагировать кучей сообщений в консоли:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image16462490996vz3e9esmj.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Eclipse же в это время попросит разрешения открыть «отладочную перспективу». Рекомендую не только согласиться, но и поставить галочку, чтобы IDE больше не спрашивала, а сразу открывала перспективу. «Перспективами» в Eclipse называются наборы настроек расположения окон: положение, стиль (отдельно или табом в родительском окне) и пр. Отладочная перспектива, возникшая перед нами, отличается наличием окон, специфичных для отладки — </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">Breakpoints</span><span style=" font-family:'Sans'; font-size:12pt;">, </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">Registers</span><span style=" font-family:'Sans'; font-size:12pt;">, </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">Disassembly</span><span style=" font-family:'Sans'; font-size:12pt;">, </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">Debug</span><span style=" font-family:'Sans'; font-size:12pt;">, </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">Memory</span><span style=" font-family:'Sans'; font-size:12pt;"> и пр. Перечисленные мной окна наиболее информативны и полезны для отладки. Расположение окон по умолчанию ужасно, поэтому я при первой же отладке привёл всё вот к такому виду:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099c40rnzdy7r.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Если вы дошли до этого момента, и всё заработало — честь вам и хвала. Теперь понимаете, за что просят деньги разработчики коммерческих IDE?</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">А вот я ещё нет. Пойму, когда:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Будут версии для Linux.</li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Когда не надо будет писать письмо, чтобы узнать цену IDE (цена будет написана большими буквами на сайте, и чтоб не более 50$).</li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Когда будут поддерживаться все популярные программаторы-отладчики. Для этого всего-то нужно дописать поддержку трёх-четырёх в проект OpenOCD.</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Ибо настроил я всю эту бодягу за денёк, а остальные две недели патчил stlink, писал статью и тестировал сборки, так что мне не понятно, за что тут платить бабло, если работы от силы на день, и то — без руководства (;</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Но если вдруг у вас ничего не заработает даже в приготовленной мной сборке IDE, тогда следующий раздел — для вас.</span></p>
<h2 style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">CoIDE: как два пальца об асфальт</span></h2>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Ну, тут полная халява. Если провести аналогию с автомобилями, то CoIDE нельзя превратить в бульдозер или велосипед по выбору, зато тачка очень удобная — сел и поехал.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Идём на страничку </span><a href="http://www.coocox.org/CooCox_CoIDE.htm"><span style=" font-family:'Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">IDE</span></a><span style=" font-family:'Sans'; font-size:12pt;">, качаем по ссылке «Download directly» внизу страницы, устанавливаем, куда душе угодно, и запускаем. При первом запуске CoIDE покажет мастер создания проекта, в котором нужно выбрать производителя нашего микроконтроллера — ST:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099jqfrroamhs.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Далее появится список МК, в котором нужно выбрать STM32F100RB, установленный на плате STM32VLDisvovery:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image16462490991nn161qk9c.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Появится окно так называемого «репозитория», в котором установкой галочек можно выбирать подключаемые к проекту библиотеки. При этом учитываются зависимости между библиотеками, что не может не радовать. В следующем уроке мы будем разбирать порты ввода-вывода (GPIO) так что отметим соответствующую библиотеку. Так как мы ещё не создали ни одного проекта, CoIDE предложит нам создать новый, на что мы согласимся:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image16462490993mwktjj7i6.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">По умолчанию папка для проектов располагается в установочной папке CoIDE и называется «workspace». Вообще, это не очень хороший вариант, я бы советовал создать отдельную папку где-нибудь в «Моих документах» или ещё где, но это личное дело каждого, а я решил ничего не трогать — в своей виртуальной машине в VirtualBox я могу мусорить сколько душе угодно (:<br />Скелетный проект по причине, изложенной в начале статьи (про плюсы и минусы), создавать бессмысленно, так что сразу сделаем проект для следующей статьи и назовём его </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">stm32vld_quickstart</span><span style=" font-family:'Sans'; font-size:12pt;">:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099e1c983xy5e.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Вот и всё, первый проект создан, можно даже приступать к кодингу. Но приступим мы к нему в следующей статье, а пока можете глянуть на файловую структуру проекта:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">cmsis</span> — тут лежит стандартная библиотека CMSIS, общая для всех Cortex-M3</li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">cmsis_boot</span> — название странноватое, ведь там лежит не только код первичной инициализации микроконтроллера, но и пара заголовочных файлов от стандартной библиотеки STM32F10x</li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">stm_lib</span> — STM32F10x Standart Peripheral Library, уже описанная при настройке Eclipse</li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">build.xml</span> — настройки сборки проекта, руками туда лучше не лазить, да и CoIDE сама этот файл не открывает, а показывает окно настроек проекта.</li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">link.ld</span> и <span style=" font-style:italic;">memory.ld</span> — скрипты линковщика, как stm32f100rb.ld, упоминавшийся выше, только зачем-то разделённый на два файла.</li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-style:italic;">main.c</span> — исходный код, пока ещё девственно чистый</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099q6hdnnue83.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Слева, кроме структуры проекта, так же показывается модель МК, для которой мы пишем, и список подключенных библиотек — идеально для склеротиков вроде меня (:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Теперь нужно зайти в Debug→Debug Configuration… и установить параметры отладки/прошивки:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Adapter: ST-Link</li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Port: SWD</li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Max Clock(Hz): 1M (1 МГц)</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image16462490996rp3bjma6k.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Теперь выбираем в меню </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Debug→Debug</span><span style=" font-family:'Sans'; font-size:12pt;"> и CoIDE скомпилирует проект, зальёт прошивку на МК и запустит отладку:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1646249099w018a9r77w.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Вот и вся настройка. Конечно, за простоту приходится платить, но в данном случае не деньгами, а минусами, перечисленными в начале статьи. Ну да ладно, зато оно работает сразу (:</span></p>
<h2 style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Ссылки и прочее</span></h2>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Итак, на данный момент я сделал и протестировал три сборки IDE — для 32- и 64-битной Linux 32-битной Windows, а для 64-битной Windows будет чуть позже — нужно собрать GCC и компанию.<br />Среду разработки я назвал, не мудрствуя лукаво — RoboCraft ARM IDE (для краткости просто RC-ARM), версия 0.1<br />Впрочем, это не официальное название, оно пока просто для удобства — чтобы не писать «ну вон та первая сборка IDE, которую я слепил во второй статье» (:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Linux: <a href="https://robocraft.ru/files/software/robocraft-arm-ide/0.1/robocraft-arm-ide-0.1-linux-i686.tar.xz"><span style=" text-decoration: underline; color:#0000ff;">32-bit (i686)</span></a>, <a href="https://robocraft.ru/files/software/robocraft-arm-ide/0.1/robocraft-arm-ide-0.1-linux-x86_64.tar.xz"><span style=" text-decoration: underline; color:#0000ff;">64-bit (x86_64)</span></a><br />Распаковываем, заходим в консоли в папку с IDE, в подпапку <span style=" font-style:italic;">stlink</span> и выполняем команды (все флешки и прочие mass-storage устройства должны быть размонтированы):</li>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">sudo cp 49-stlinkv* /etc/udev/rules.d/</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">sudo udevadm control --reload-rules</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">sudo cp stlink_v1.modprobe.conf /etc/modprobe.d</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">sudo modprobe -r usb-storage &amp;&amp; sudo modprobe usb-storage</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Также нужно установить </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">libusb-1.0</span><span style=" font-family:'Sans'; font-size:12pt;">, 32-битную версию </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">libncurses-5</span><span style=" font-family:'Sans'; font-size:12pt;"> (для GDB) и </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">make</span><span style=" font-family:'Sans'; font-size:12pt;">.<br />Всё, отныне больше ничего для настройки делать не придётся. В папке с IDE лежат два скрипта — </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">start-ide.sh</span><span style=" font-family:'Sans'; font-size:12pt;"> и </span><span style=" font-family:'Sans'; font-size:12pt; font-style:italic;">start-stlink.sh</span><span style=" font-family:'Sans'; font-size:12pt;">. Первый устанавливает переменные окружения, чтобы Eclipse увидел GCC для ARM, и запускает Eclipse, в котором уже установлен ARM Plugin. Второй запускает утилиту stlink, которая должна быть запущена всё время, пока вы пользуетесь отладкой и прошивкой. Самые хитрые могут добавить вызов второго скрипта в первый и не париться (:</span></p>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Windows: <a href="https://robocraft.ru/files/software/robocraft-arm-ide/0.1/robocraft-arm-ide-0.1-windows-i686.7z"><span style=" text-decoration: underline; color:#0000ff;">32-bit (i686)</span></a><br />Распаковываем и устанавливаем драйвер <span style=" font-weight:600;">WinUSB</span> по инструкции в статье. По идее, больше ничего делать не надо. В папке лежат два bat-файла, аналогичные упомянутым выше скриптам: <span style=" font-style:italic;">start-ide.bat</span> запускает Eclipse, <span style=" font-style:italic;">start-stlink.bat</span> — утилиту stlink. Библиотеку <span style=" font-style:italic;">libusb-1.0</span> я положил в дистрибутив, т.к. в Windows нет пакетного менеджера и готового пакета для её установки. Так же включена утилита <span style=" font-style:italic;">make</span>, используемая Eclipse для сборки проектов.</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Во всех сборках присутствует Java Runtime Environment 6 update 29, необходимая для работы Eclipse, и IDE подхватывает JRE автоматически.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Об ошибках в работе IDE прошу писать </span><a href="https://robocraft.ru/forum/viewtopic.php?f=19&amp;t=122"><span style=" font-family:'Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">в соответствующую тему на форуме</span></a><span style=" font-family:'Sans'; font-size:12pt;">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Все необходимые файлы для скелетного проекта:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://robocraft.ru/files/software/robocraft-arm-ide/0.1/stm32vld_template.zip"><span style=" text-decoration: underline; color:#0000ff;">STMVLDiscovery</span></a></li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://robocraft.ru/files/software/robocraft-arm-ide/0.1/stm32ld_template.zip"><span style=" text-decoration: underline; color:#0000ff;">STML-Discovery</span></a></li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Распакуйте нужный архив и настройте проект, как написано в статье, только без копирования файлов. После настройки проект соберётся и в Windows, и в Linux, при условии, что IDE настроена правильно. При смене IDE на другую версию (точнее, ARM Toolchain) могут перестать собираться уже настроенные проекты из-за того, что ARM Plugin хранит в настройках проекта пути к стандартным заголовочным файлам компилятора — в этом случае нужно удалить файлы настроек из папки с проектом (их имена начинаются с точки) и выполнить настройку заново.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Чтобы добавить проект в свой workspace, в Eclipse выберите в меню </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">Project→Import</span><span style=" font-family:'Sans'; font-size:12pt;">, а в появившемся окне выбрать </span><span style=" font-family:'Sans'; font-size:12pt; font-weight:600;">General→Filesystem</span><span style=" font-family:'Sans'; font-size:12pt;"> и указать распакованную из архива папку или сам архив. Как я уже упоминал, для CoIDE скелетный проект создавать смысла нет, т.к. в CoIDE создать проект не сложнее, чем подумать об этом, ну, и с копированием проектов в ней проблемы.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Для тех, кто решил когда-нибудь потом приготовить IDE по этому рецепту, привожу список ингредиентов:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://www.eclipse.org/downloads/packages/release/helios/sr2"><span style=" text-decoration: underline; color:#0000ff;">Eclipse 3.6.2</span></a> (Helios SR2)<br />Это последняя стабильная версия Eclipse на данный момент.</li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://java.com/en/download/manual.jsp"><span style=" text-decoration: underline; color:#0000ff;">Java Runtime Environment 6u29</span></a><br />По ссылке доступна самая свежая версия JRE, на данный момент это 6u29. Oracle уверяет, что последующие версии JRE будут совместимы с текущей — ну что ж, поверим на слово (как будто выбор есть).</li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://sourceforge.net/projects/gnuarmeclipse/files/gnuarmeclipse/0.5.3/org.eclipse.cdt.cross.arm.gnu_0.5.3.201010141144.zip/download"><span style=" text-decoration: underline; color:#0000ff;">GNU ARM Eclipse Plugin 0.5.3</span></a><br />Нужна именно эта версия, т.к. более поздние уже требуют Eclipse 3.7.x, а там поломали отладку. Ну или что-то я не так делал, хотя и то же самое, что для Eclipse 3.6. На всякий случай сохранил <a href="https://robocraft.ru/files/software/org.eclipse.cdt.cross.arm.gnu_0.5.3.201010141144.zip"><span style=" text-decoration: underline; color:#0000ff;">в укромном месте</span></a> (:</li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://sourcery.mentor.com/sgpp/lite/arm/portal/subscription?@template=lite"><span style=" text-decoration: underline; color:#0000ff;">Sourcery CodeBench Lite Edition 2011.03-42</span></a>, arm-none-eabi<br />Пойдёт, по-хорошему, любая другая правильная сборка GCC + GDB + binutils для ARM — например, <a href="http://www.yagarto.de/"><span style=" text-decoration: underline; color:#0000ff;">Yagarto</span></a> или вообще собранная из исходников собственноручно. Лишь бы работала правильно.</li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://github.com/burjui/stlink"><span style=" text-decoration: underline; color:#0000ff;">stlink</span></a> на GitHub, ветка server-restart<br />Забирать так:</li>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">git clone git://github.com/burjui/stlink.git -b server-restart</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Сборки:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://robocraft.ru/files/software/stlink-linux-i686.tar.gz"><span style=" text-decoration: underline; color:#0000ff;">Linux i686</span></a></li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://robocraft.ru/files/software/stlink-linux-x86_64.tar.gz"><span style=" text-decoration: underline; color:#0000ff;">Linux x86_64</span></a></li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://robocraft.ru/files/software/stlink-windows-i686.zip"><span style=" text-decoration: underline; color:#0000ff;">Windows 32 бит</span></a></li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">На данный момент нужен именно мой репозиторий, а не </span><a href="https://github.com/texane/stlink"><span style=" font-family:'Sans'; font-size:12pt; text-decoration: underline; color:#0000ff;">оригинал</span></a><span style=" font-family:'Sans'; font-size:12pt;">, и именно ветка server-restart — в ней есть патчи, позволяющие утилите работать непрерывно, а не завершаться после каждого дисконнекта. В будущем, когда мои патчи попадут в основную ветку, я обновлю пост.<br />Сейчас утилита работает довольно медленно — прошивает всего около 500 байт в секунду, но это пока не начали работу по оптимизации.</span></p>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://sourceforge.net/projects/libwdi/files/zadig/"><span style=" text-decoration: underline; color:#0000ff;">Zadig</span></a><br />Там лежат все версии этой утилиты. Если кто забыл, она для установки драйвера WinUSB под Windows, чтобы библиотека libusb-1.0 имела прямой доступ к ST-Link.</li>
<li style=" font-family:'Sans'; font-size:12pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://sourceforge.net/projects/mingw/"><span style=" text-decoration: underline; color:#0000ff;">MinGW + MSYS</span></a><br />Unix-like среда для разработки под Windows с использованием GCC.</li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:12pt;">Уфф… Вроде, всё. Ошибки, неточности, советы, вопросы принимаются. За сим откланиваюсь и лечу писать quickstart.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans'; font-size:12pt;"><br /></p></body></html>