<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#494949; background-color:#ffffff;">Рассмотрим синтаксические особенности ассемблера AVR на примере небольшой тестовой программы для микроконтроллера ATmega8, приведенной ниже. Программа формирует на выводе PB2 импульсы с частотой следования ≈ 2.5 Гц при частоте внутреннего RC-генератора 1 МГц.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:13px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#d4d0c8;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="0" cellpadding="0">
<tr>
<td bgcolor="#ffffff" style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">1.</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;  Тестовая программа для ATmega8.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">2. // Светодиод подключен к выводу PB0 микроконтроллера.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">3. /* Биты конфигурации:  </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#494949;">        </span><span style=" font-family:'FreeMono'; color:#ff1493;">Low</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#000000;">Fuse                     </span><span style=" font-family:'FreeMono'; color:#ff1493;">High</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#000000;">Fuse     </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#494949;">      </span><span style=" font-family:'FreeMono'; color:#000000;">BODLEVEL = 1                  RSTDISBL = 1      </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#494949;">      </span><span style=" font-family:'FreeMono'; color:#000000;">BODEN    = 1                  WDTON    = 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#494949;">      </span><span style=" font-family:'FreeMono'; color:#000000;">SUT1     = 1                  SPIEN    = 1   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#494949;">      </span><span style=" font-family:'FreeMono'; color:#000000;">SUT0     = 0                  CKOPT    = 1   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#494949;">      </span><span style=" font-family:'FreeMono'; color:#000000;">CKSEL3   = 0 |                EESAVE   = 1   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#494949;">      </span><span style=" font-family:'FreeMono'; color:#000000;">CKSEL2   = 0 |_ RC-генератор  BOOTSZ1  = 1         </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#494949;">      </span><span style=" font-family:'FreeMono'; color:#000000;">CKSEL1   = 0 |     1 МГц      BOOTSZ0  = 1      </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#494949;">      </span><span style=" font-family:'FreeMono'; color:#000000;">CKSEL0   = 1 |                BOOTRST  = 1   */ </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#494949;">     </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">4.        .nolist </span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;подключение стандартного заголовочного файла</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">5.        .</span><span style=" font-family:'FreeMono'; color:#ff1493;">include</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#2a00ff;">&quot;m8def.inc&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">6.        .list </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#494949;">                      </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">7.        .</span><span style=" font-family:'FreeMono'; color:#ff1493;">equ</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#ff1493;">PAUSE</span><span style=" font-family:'FreeMono'; color:#494949;">  </span><span style=" font-family:'FreeMono'; color:#000000;">= 50000</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;задержка времени</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">8.        .</span><span style=" font-family:'FreeMono'; color:#ff1493;">equ</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#000000;">LED    = PB2  </span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;вывод для подключения светодиода</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#494949;">             </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">9.        .def temp   = R16 </span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;регистр для промежуточных операций</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">10.       .def buffer = R17 </span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;регистр для чтения порта</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#494949; background-color:#ffffff;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">11.              .cseg</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">12.             .</span><span style=" font-family:'FreeMono'; color:#ff1493;">org</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#000000;">0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">13.          rjmp  initial                                         </span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;0xC01F</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">14.          rjmp  0</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;rjmp  service_INT0 ;внешнее прерывание 0      0xCFFE</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">15.          rjmp  0</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;rjmp  service_INT1 ;внешнее прерывание 1     0xCFFD</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">16.          rjmp  0</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;rjmp  service_OC2  ;совпадение TCNT2 и OCR2   0xCFFC</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">17.          rjmp  0</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;rjmp  service_OVF2 ;переполнение TCNT2        0xCFFB</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">18.          rjmp  0</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;rjmp  service_ICP1 ;захват в ICP1           0xCFFA</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">19.          rjmp  0</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;rjmp  service_OC1A ;совпадение TCNT1 и OCR1A  0xCFF9</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">20.          rjmp  0</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;rjmp  service_OC1B ;совпадение TCNT1 и OCR1B  0xCFF8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">21.          rjmp  0</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;rjmp  service_OVF1 ;переполнение TCNT1       0xCFF7</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">22.          rjmp  0</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;rjmp  service_OVF0 ;переполнение TCNT0         0xCFF6</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">23.          rjmp  0</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;rjmp  service_SPI  ;прерывание от модуля SPI  0xCFF5</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">24.          rjmp  0</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;rjmp  service_URXC ;получение байта по USART   0xCFF4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">25.          rjmp  0</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;rjmp  service_UDRE ;опустошение UDR в USART    0xCFF3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">26.          rjmp  0</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;rjmp  service_UTXC ;передача байта по USART    0xCFF2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">27.          rjmp  0</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;rjmp  service_ADCC ;прерывание от АЦП          0xCFF1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">28.          rjmp  0</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;rjmp  service_ERDY ;завершение записи в EEPROM 0xCFF0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">29.          rjmp  0</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;rjmp  service_ACI  ;прерывание от компаратора  0xCFEF</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">30.          rjmp  0</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;rjmp  service_TWI  ;прерывание от модуля TWI   0xCFEE</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">31.          rjmp  0</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;rjmp  service_SPMR ;завершение выполнения spm  0xCFED</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#494949; background-color:#ffffff;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">32.             .</span><span style=" font-family:'FreeMono'; color:#ff1493;">org</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#000000;">0x20</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">33. initial: </span><span style=" font-family:'FreeMono'; color:#ff1493;">ldi</span><span style=" font-family:'FreeMono'; color:#494949;">   </span><span style=" font-family:'FreeMono'; color:#000000;">temp,</span><span style=" font-family:'FreeMono'; color:#ff1493;">low</span><span style=" font-family:'FreeMono'; color:#000000;">(RAMEND)                                  </span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;0xE50F</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">34.          </span><span style=" font-family:'FreeMono'; color:#ff1493;">out</span><span style=" font-family:'FreeMono'; color:#494949;">   </span><span style=" font-family:'FreeMono'; color:#000000;">SPL,temp                                          </span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;0xBF0D</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">35.          </span><span style=" font-family:'FreeMono'; color:#ff1493;">ldi</span><span style=" font-family:'FreeMono'; color:#494949;">   </span><span style=" font-family:'FreeMono'; color:#000000;">temp,</span><span style=" font-family:'FreeMono'; color:#ff1493;">high</span><span style=" font-family:'FreeMono'; color:#000000;">(RAMEND)                                 </span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;0xE004</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">36.          </span><span style=" font-family:'FreeMono'; color:#ff1493;">out</span><span style=" font-family:'FreeMono'; color:#494949;">   </span><span style=" font-family:'FreeMono'; color:#000000;">SPH,temp                                          </span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;0xBF0E</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">37.          </span><span style=" font-family:'FreeMono'; color:#ff1493;">cbi</span><span style=" font-family:'FreeMono'; color:#494949;">   </span><span style=" font-family:'FreeMono'; color:#000000;">PORTB,LED                                         </span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;0x98C2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">38.          </span><span style=" font-family:'FreeMono'; color:#ff1493;">sbi</span><span style=" font-family:'FreeMono'; color:#494949;">   </span><span style=" font-family:'FreeMono'; color:#000000;">DDRB,LED                                          </span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;0x9ABA</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">39.          </span><span style=" font-family:'FreeMono'; color:#ff1493;">ldi</span><span style=" font-family:'FreeMono'; color:#494949;">   </span><span style=" font-family:'FreeMono'; color:#000000;">temp,1«LED                                        </span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;0xE004</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#494949; background-color:#ffffff;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">40. main:    </span><span style=" font-family:'FreeMono'; color:#ff1493;">in</span><span style=" font-family:'FreeMono'; color:#494949;">    </span><span style=" font-family:'FreeMono'; color:#000000;">buffer,PORTB                                      </span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;0xB318</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">41.          eor   buffer,temp                                       </span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;0x2710</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">42.          </span><span style=" font-family:'FreeMono'; color:#ff1493;">out</span><span style=" font-family:'FreeMono'; color:#494949;">   </span><span style=" font-family:'FreeMono'; color:#000000;">PORTB,buffer                                      </span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;0xBB18</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">43.          </span><span style=" font-family:'FreeMono'; color:#ff1493;">rcall</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#000000;">delay                                             </span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;0xD001</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">44.          rjmp  main                                              </span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;0xCFFB</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#494949; background-color:#ffffff;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">45. delay:   </span><span style=" font-family:'FreeMono'; color:#ff1493;">ldi</span><span style=" font-family:'FreeMono'; color:#494949;">   </span><span style=" font-family:'FreeMono'; color:#000000;">XH,</span><span style=" font-family:'FreeMono'; color:#ff1493;">high</span><span style=" font-family:'FreeMono'; color:#000000;">(</span><span style=" font-family:'FreeMono'; color:#ff1493;">PAUSE</span><span style=" font-family:'FreeMono'; color:#000000;">)                                    </span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;0xECB3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">46.          </span><span style=" font-family:'FreeMono'; color:#ff1493;">ldi</span><span style=" font-family:'FreeMono'; color:#494949;">   </span><span style=" font-family:'FreeMono'; color:#000000;">XL,</span><span style=" font-family:'FreeMono'; color:#ff1493;">low</span><span style=" font-family:'FreeMono'; color:#000000;">(</span><span style=" font-family:'FreeMono'; color:#ff1493;">PAUSE</span><span style=" font-family:'FreeMono'; color:#000000;">)                                     </span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;0xE5A0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">47.          sbiw  XH:XL,1                                           </span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;0x9711</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">48.          brne  PC-1                                              </span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;0xF7F1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#000000;">49.          </span><span style=" font-family:'FreeMono'; color:#ff1493;">ret</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#494949; background-color:#ffffff;">В строках 1…3 приведено 3 возможных варианта оформления комментариев. Комментарий в строке 1, начинающийся со знака “;”, распознается любым ассемблером и поэтому является наиболее предпочтительным. Комментарии в строках 2 и 3 подобны тем, которые используются в нотациях языков высокого уровня. Последний из них дает возможность выделить сразу несколько строк (маркерами начала и конца фрагмента текста является “/*” и “*/” соответственно).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#494949; background-color:#ffffff;">В строке 5 директивой .include к программе подключается стандартный заголовочный файл &quot;m8def.inc&quot;. Необязательные директивы .nolist и .list (строки 4 и 6 соответственно) запрещают вывод содержимого подключаемого файла в файл листинга.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#494949; background-color:#ffffff;">Все директивы допускается размещать в одной строке. Так, например, можно было бы записать</span><span style=" color:#494949; background-color:transparent;"><br /></span><span style=" color:#494949;">.nolist .include &quot;m8def.inc&quot; .list</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#494949; background-color:#ffffff;">Несмотря на это, желательно придерживаться правильного стиля программирования, в соответствии с которым в одной строке должна быть расположена только одна директива ассемблера.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#494949; background-color:#ffffff;">Объявление констант находится в строках 7 и 8. Константе LED присваивается номер линии ввода-вывода PB2 = 2, описание которой находится в заголовочном файле. В строках 9 и 10 двум рабочим РОНам назначаются пользовательские имена.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#494949; background-color:#ffffff;">Секция рабочего кода открывается директивой .cseg в строке 11. Директива .org 0 (строка 12) устанавливает начальный адрес в памяти программ. В строке 13 должна находиться инструкция перехода на метку начала основной программы initial.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#494949; background-color:#ffffff;">Метка представляет собой адрес в пределах секции кода или данных. В ассемблере AVR она должна быть записана в начале строки и завершаться в конце двоеточием.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#494949; background-color:#ffffff;">Конечно, адрес в команде может быть указан и явно. В данном примере его можно задать безошибочно (rjmp 0x20 вместо rjmp initial). Но, это возможно только потому, что директива .org 0x20 (строка 32) заставляет компилятор поместить команду в строке 33 по адресу 32-го слова FLASH-памяти программ. Однако, в большинстве случаев, адрес размещения той или иной команды заранее неизвестен и, кроме того, он может изменяться по мере того, как в программу будут вноситься изменения. Именно поэтому предпочтительней использовать метки. Назначение их адресов производится автоматически на этапе компиляции. Да и символьные имена меток, предоставляют об объектах намного больше информации, чем просо какие-то числа.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#494949; background-color:#ffffff;">На месте каждого неиспользуемого в программе прерывания желательно поставить “заглушки” в виде команды возврата rjmp 0 или reti, как это сделано в строках 14…31.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#494949; background-color:#ffffff;">В строках 33…39 производится инициализация ресурсов микроконтроллера. Любая программа обязательно должна начинаться с установки начального значения указателя стека (если он имеется). В строках 33…36 в SPH:SPL заносится значение RAMEND = 0x045F (вершина стека перемещается в самый верх SRAM). Для выделения младшего и старшего полубайтов константы RAMEND используются встроенные функции low(RAMEND)=0x5F и high(RAMEND)=0x04 соответственно.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#494949; background-color:#ffffff;">Далее разряд LED в регистре данных порта B сбрасывается на 0 (стока 37), а сама линия управления светодиодом настраивается на вывод (стока 38). В строке 39 в регистр temp заносится константа 1&lt;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:13px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#d4d0c8;"><br /></p>
<table border="0" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px;" cellspacing="0" cellpadding="0">
<tr>
<td bgcolor="#ffffff" style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p align="right" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#787878; background-color:#ffffff;">1</span></p>
<p align="right" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#787878; background-color:#ffffff;">2</span></p></td>
<td bgcolor="#ffffff" style=" padding-left:0; padding-right:0; padding-top:0; padding-bottom:0;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#ff1493;">ldi</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#000000;">temp,(1«PB0)|(1«PB5) или </span><span style=" font-family:'FreeMono'; color:#ff1493;">ldi</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#000000;">temp,(1«PB0)+(1«PB5)   </span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;temp &lt;- 0b00100001</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'FreeMono'; color:#ff1493;">out</span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#000000;">DDRB,temp                                           </span><span style=" font-family:'FreeMono'; color:#494949;"> </span><span style=" font-family:'FreeMono'; color:#3f5fbf;">;DDRB &lt;- temp</span></p></td></tr></table>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#494949; background-color:#ffffff;">Код в строках 40…44 представляет собой тело основной программы. В регистр buffer считывается текущее состояние порта данных PORTB (строка 40). Далее между содержимым buffer и temp производится операция “Исключающее ИЛИ” (строка 41), после чего модифицированное содержимое buffer снова выводится в порт (строках 42). В результате такого действия логический уровень на линии PB2 изменится на противоположный. В строке 43 происходит вызов подпрограммы задержки времени delay (≈200 мс), а в строке 44 расположена инструкция перехода на метку main. Так образуется основной цикл программы, в котором происходит постоянное повторение операторов в строках 40…44: инвертирование уровня на выводе LED, задержка, затем снова инвертирование и т.д.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#494949; background-color:#ffffff;">Внутри подпрограммы delay в регистровую пару XH:XL заносится число PAUSE = 50000, определяющее длительность задержки времени (строки 45, 46). В строке 47 из содержимого XH:XL вычитается 1. Команда условного перехода в строке 48 проверяет, значение флага Z из SREG. Если Z = 1 (результат предыдущей операции не равен нулю), то управление передается на строку 47. Так будет повторяться до тех пор, пока не выполнится условие XH:XL = 0 (т.е. пока не пройдет 50000 циклов вычитания). Команда выхода ret в строке 49 возвращает управление в то место основной программы, с которого произошел вызов delay.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#494949; background-color:#ffffff;">Отдельно стоит обратить внимание на встроенную в ассемблер переменную PC в строке 48. Она представляет собой текущее содержимое программного счетчика. Адрес PC-1 будет указывать на предыдущее слово в памяти программ микроконтроллера. В данном случае в этом слове находится команда sbiw XH:XL,1. Использовать PC очень удобно для программных переходов в небольших пределах. Однако здесь всегда необходимо помнить, что у микроконтроллеров AVR имеются команды, которые имеют размер в 2 16-разрядных слова программ (lds Rd,k, jmp k и др.), из-за чего при вычислении смещения необходимо будет добавлять\отнимать к PC значение 2 вместо 1 на каждую такую инструкцию.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#494949; background-color:#ffffff;">Справа, в листинге приведен машинный код, который будет сгенерирован после компиляции программы.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><br /></p></body></html>