<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Что можно подумать, увидев ключевое слово <span style=" font-family:'FreeMono'; color:#6a1009;">constinit</span> в тексте программы на каком-нибудь новом языке программирования? Можно было бы предположить, что в данном месте происходит инициализация константы. В любом случае, слова <span style=" font-family:'FreeMono'; color:#6a1009;">const</span> и <span style=" font-family:'FreeMono'; color:#6a1009;">init</span> говорят человеку о том, что некое действие связано с инициализацией, и, скорее всего, инициализацией чего-то постоянного. Правильно?</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Конечно, нет! Вы имеете дело с профессионалами из комитета по стандартизации языка Си++. Туда кого попало с улицы не набирают. Поэтому если вы расчитывали на то, что в языке будут логичные конструкции, которые (о, боже!) сами объясняют своей структурой и именованием что они делают, то убирайтесь к черту! Этим суровым ребятам нужен язык с ловушками, в которые будут попадать простаки, чтобы с позором их изгонять из своих рядов. Чем больше ловушек - тем лучше! Ключевое слово <span style=" font-family:'FreeMono'; color:#6a1009;">constinit</span> - это еще один сюрприз от разработчиков языка, чтобы программист не расслаблялся и умел видеть за определенным названием совершенно другие смыслы.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">* * *</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">По своей сути, <span style=" font-family:'FreeMono'; color:#6a1009;">constinit</span> гарантирует, что переменная, к которой он применяется, будет инициализирована во время компиляции. Такое поведение полезно для глобальных и статических переменных, поскольку позволяет избежать проблем с порядком динамической инициализации.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Ключевое слово <span style=" font-family:'FreeMono'; color:#6a1009;">constinit</span> о<span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">беспечивает инициализацию переменных во время компиляции, вот и все! Почему бы этот спецификатор не назвать </span><span style=" font-family:'FreeMono'; color:#6a1009;">compiletimeinit</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">, совершенно непонятно.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Рассмотрим следующий пример:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">#include &lt;array&gt;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">// Инициализация на этапе компиляции</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">constexpr int compute(int v) { return v*v*v; }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">constinit int global = compute(10);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">// Это не будет работать:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">// constinit int another = global;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">int main() {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">    // Но допускает изменения в дальнейшем...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">    global = 100;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">    // global не является константой!</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">    // std::array&lt;int, global&gt; arr;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В приведенном выше коде глобальная переменная инициализируется во время компиляции с помощью функции <span style=" font-family:'FreeMono'; color:#6a1009;">compute()</span>. Однако, в отличие от <span style=" font-family:'FreeMono'; color:#6a1009;">const</span> и <span style=" font-family:'FreeMono'; color:#6a1009;">constexpr</span>, спецификатор <span style=" font-family:'FreeMono'; color:#6a1009;">constinit</span> не делает переменную константой. Он означает, что, хотя начальное значение и задается во время компиляции, оно может быть изменено во время выполнения. Это показано в коде функции <span style=" font-family:'FreeMono'; color:#6a1009;">main()</span>. Кроме того, поскольку переменная <span style=" font-family:'FreeMono'; color:#6a1009;">constinit</span> не является <span style=" font-family:'FreeMono'; color:#6a1009;">constexpr</span>, ее нельзя использовать для инициализации другого <span style=" font-family:'FreeMono'; color:#6a1009;">constinit</span>-объекта (в коде выше - это закомментированная строка с <span style=" font-family:'FreeMono'; color:#6a1009;">int another</span>, которая может вызвать ошибку).</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>