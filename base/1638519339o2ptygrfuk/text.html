<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">GDB – один из самых мощных отладчиков из всех когда-либо созданных, однако, переход с soft-ice на gdb обычно протекает очень болезненно. запустив gdb, мы попадаем в совершенно иной мир, похожий на дремучий лес, в котором очень легко заблудиться, но мыщъх покажет как обустроить gdb для хакерский целей, вырыть уютную нору и сделать свои первые шаги на пути к истинному Дао gdb.</span></p>
<h2 style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:x-large; font-weight:600;"><br /></h2>
<h2 style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; font-style:italic; color:#000000;">Введение</span></h2>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Под LINUX/BSD существует множество отладчиков, но общепризнанный лидер это, бесспорно, GDB, входящий в состав практически любого дистрибутива. Внешне (только внешне!) схожий с debug.com, он так и дышит мощью, поражающей воображение и потрясающей создание по мере его освоения.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Да-да, именно </span><span style=" font-family:'Times New Roman'; font-weight:600; font-style:italic; color:#000000;">освоения</span><span style=" font-family:'Times New Roman'; color:#000000;">! В отличии от soft-ice, gdb основан на </span><span style=" font-family:'Times New Roman'; font-style:italic; color:#000000;">невизуальных концепциях </span><span style=" font-family:'Times New Roman'; color:#000000;">и ориентирован на удобство работы, а совсем не на легкость освоения. В нем заложено _столько_ возможностей, что их совершенно невозможно загнать в прокрустово ложе визуального интерфейса. По количеству органов управления gdb сравним разве что с истребителем и прежде, чем эта махина стронется с места, приходится перетрахать сотни страниц документации, отказаться от всех прежних привычек и понятий, вывернуть сознание наизнанку и поехать крышей. Зато потом soft-ice покажется жалкой поделкой, на которую невозможно смотреть без содрогания.</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1638519362idwt4k60p9.png" /></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Рисунок 1 www.gnu.org/software/gdb — официальный сайт отладчика gdb (русская документация находится на mitya.pp.ru/gdb)</span></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1638519386jlugxyrx90.png" /></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Рисунок 2 собственная интерактивная &quot;морда&quot; отладчика gdb</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Все графические морды (типа DDD) идут в топку, поскольку дискредитируют философию интерактивной отладки и превращают gdb в некоторое подобие морской свинки (и не свинки, и не морской), к тому же gdb имеет свою собственную встроенную &quot;морду&quot;, вызываемую ключом &quot;</span><span style=" font-family:'Courier New'; color:#000000;">-tui</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; командой строки и ориентированную преимущественно на отладку приложений с исходными текстами. Для хакеров же она практически бесполезна.</span></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image16385194094e4wih26ue.png" /></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Рисунок 3 родная стихия профессионалов</span></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; font-weight:600; color:#000000;"><br /></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; font-weight:600; color:#000000;"><br /></p>
<h2 style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; font-style:italic; color:#000000;">Подготовка к отладке</span></h2>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Загрузка исполняемых файлов в отладчик </span><span style=" font-family:'Times New Roman'; color:#000000;">обычно осуществляется заданием их имени (при необходимости – с путем) в командной строке. При этом полезно указывать ключ &quot;</span><span style=" font-family:'Courier New'; color:#000000;">‑quiet</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (или, сокращенно, &quot;</span><span style=" font-family:'Courier New'; color:#000000;">-q</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;) для подавления надоедливого копирайта.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Для передачи программе аргументов, используйте ключ &quot;</span><span style=" font-family:'Courier New'; color:#000000;">--args</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; за которым следует имя отлаживаемого файла с его аргументами (обработка ключей gdb при этом прекращается, поэтому &quot;</span><span style=" font-family:'Courier New'; color:#000000;">--args</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; должен стоять последним в строке).</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">#gdb -q gdb-demo</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 1 загрузка файла gdb-demo в отладчик из командной строки без аргументов</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"> </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">#gdb -q --args gdb-demo arg1 arg2...argN</span></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 2 загрузка файла gdb-demo в отладчик из командной строки с аргументами</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Отладчик печатает приглашение &quot;</span><span style=" font-family:'Courier New'; color:#000000;">(gdb)</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, ожидая ввода команд. При желании, отлаживаемый файл можно загрузить непосредственно из отладчика командой &quot;</span><span style=" font-family:'Courier New'; color:#000000;">file</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">#gdb -q</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">(gdb)file gdb-demo</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">Reading symbols from gdb-demo...done</span></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 3 загрузка файла gdb-demo из отладчика</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Внимание!</span><span style=" font-family:'Times New Roman'; color:#000000;"> </span><span style=" font-family:'Times New Roman'; font-style:italic; color:#000000;">В отличие от soft-ice/turbo-debugger/ollydbg и прочих windows-отладчиков, в gdb программа после загрузки еще _не_ готова к работе!</span><span style=" font-family:'Times New Roman'; color:#000000;"> Она не имеет регистрового контекста и потому команды трассировки нам недоступны, однако, мы можем устанавливать точки останова внутри программы (не на библиотечные функции!), просматривать/модифицировать память, дизассемблировать код и т. д.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Обычно, первым (разумным) действием после загрузки становится установка точки останова на функцию </span><span style=" font-family:'Courier New'; color:#000000;">main</span><span style=" font-family:'Times New Roman'; color:#000000;"> (главную функцию языка Си) или </span><span style=" font-family:'Courier New'; color:#000000;">_start</span><span style=" font-family:'Times New Roman'; color:#000000;"> – точку входа в программу, что осуществляется командой &quot;</span><span style=" font-family:'Courier New'; color:#000000;">tb адрес/имя</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, устанавливающей &quot;одноразовую&quot; точку останова, после чего можно смело пускать программу командой &quot;</span><span style=" font-family:'Courier New'; color:#000000;">run</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (или &quot;</span><span style=" font-family:'Courier New'; color:#000000;">r</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;), зная, что отладчик &quot;всплывет&quot; в точке останова.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; color:#000000;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">#gdb -q gdb-demo</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">(gdb) </span><span style=" font-family:'FreeMono'; font-weight:600; color:#6a1009;">tb main</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">Breakpoint 1 at 0x8048473</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">(gdb) r</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">Starting program: /home/kpnc/gdb/gdb-demo</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">0x08048473 in main ()</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 4 установка точки останова на main</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Загрузка исполняемых файлов без символьной информации.</span><span style=" font-family:'Times New Roman'; color:#000000;"> Если символьная информация отсутствует (например, была отрезана утилитой </span><span style=" font-family:'Courier New'; color:#000000;">strip</span><span style=" font-family:'Times New Roman'; color:#000000;">, как _очень_ часто и бывает), то установка точек останова на </span><span style=" font-family:'Courier New'; color:#000000;">_start</span><span style=" font-family:'Times New Roman'; color:#000000;">/</span><span style=" font-family:'Courier New'; color:#000000;">main</span><span style=" font-family:'Times New Roman'; color:#000000;"> становится невозможной и мы должны указать отладчику &quot;физический&quot; адрес точки входа, который можно получить, например, при помощи утилиты </span><span style=" font-family:'Courier New'; color:#000000;">objdump</span><span style=" font-family:'Times New Roman'; color:#000000;">, запущенной с ключом </span><span style=" font-family:'Courier New'; color:#000000;">-f</span><span style=" font-family:'Times New Roman'; color:#000000;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">#strip gdb-demo</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">#objdump -f gdb-demo</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">gdb-demo:     O : i386, EXEC_P, HAS_SYMS, D_PAGED</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">архитектура:  i386, флаги 0x00000112:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">EXEC_P, HAS_SYMS, D_PAGED</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">начальный адрес </span><span style=" font-family:'Courier New'; font-weight:600; text-decoration: underline; color:#000000;">0x08048300</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"># gdb -q gdb-demo</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(no debugging symbols found)...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) </span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">b main</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">Function &quot;main&quot; not defined.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">Make breakpoint pending on future shared library load? (y or [n]) n</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-weight:600; color:#000000;"># ^ установка точки останова на main провалилась, (т.к. символьной информации нет)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">#   отладчик предложил установить ее позднее, когда такой символ станет доступен,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">#   но мы от этого отказались, поскольку такой символ не станет доступен никогда</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) </span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">tb *0x8048300</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">Breakpoint 1 at 0x8048300</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-weight:600; color:#000000;"># ^ установка точки останова по непосредственному адресу прошла успешно</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) r</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">Starting program: /home/kpnc/gdb/gdb-demo</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(no debugging symbols found)...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x08048300 in ?? ()</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 5 загрузка программы со стрипнутой символьной инфой</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Подключение к уже запущенному процессу.</span><span style=" font-family:'Times New Roman'; color:#000000;"> Если процесс, который необходимо отлаживать, _уже_ запущен, к нему можно подключиться либо указав его идентификатор вместе с ключом &quot;</span><span style=" font-family:'Courier New'; color:#000000;">-pid</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; в командной строке, либо воспользовавшись командой &quot;</span><span style=" font-family:'Courier New'; color:#000000;">attach идентификатор</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, непосредственно из самого отладчика. Отсоединиться от процесса можно либо командой &quot;</span><span style=" font-family:'Courier New'; color:#000000;">detach</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (запущенной без аргументов) или же выходом из отладчика по команде &quot;</span><span style=" font-family:'Courier New'; color:#000000;">quit</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (или &quot;</span><span style=" font-family:'Courier New'; color:#000000;">q</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;). После отсоединения процесс продолжает свою работу в нормальном режиме, а если его необходимо завершить, на помощь приходит команда &quot;</span><span style=" font-family:'Courier New'; color:#000000;">kill</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, убивающая текущий отлаживаемый процесс.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">#ps -a</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">PID    TTY    TIME          CMD</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">8189   pts/7  00:00:00      gdb_demo</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">8200   pts/5  00:00:00      ps</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"># gdb -q </span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">-pid 8189</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">Attaching to process 8189</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">Reading symbols from /home/kpnc/gdb/gdb_demo...done.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">Reading symbols from /lib/libc.so.6...done.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">Reading symbols from /lib/ld-linux.so.2...done.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x400f2ab8 in read () from /lib/libc.so.6</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb)</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 6 подключение к уже запущенному процессу через командную строку</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">#gdb -q</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb)</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;"> attach 8189</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">Attaching to process 8189</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">Reading symbols from /home/kpnc/gdb/gdb_demo...done.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">Reading symbols from /lib/libc.so.6...done.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">Reading symbols from /lib/ld-linux.so.2...done.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x400f2ab8 in read () from /lib/libc.so.6</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb)</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 7 подключение к уже запущенному процессу командной attach</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Загрузка программ с потрепанными заголовками.</span><span style=" font-family:'Times New Roman'; color:#000000;"> Если заголовок elf-файла умышленно искажен (как, например, в случае, описанным в статье &quot;особенности дизассемблирования под LINUX на примере tiny-crackme&quot;, опубликованной в &quot;хакере&quot;), то gdb наотрез откажется загружать его. Пример такого файла можно найти на: www.crackmes.de/users/yanisto/tiny_crackme/.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Выход — циклим elf в точке входа, запускаем и подключаемся к процессу командой &quot;</span><span style=" font-family:'Courier New'; color:#000000;">attach</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (или &quot;</span><span style=" font-family:'Courier New'; color:#000000;">gdb -pid идентификатор</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;), а после попадания в отладчик восстанавливаем оригинальные байты и приступаем к трассировке в обычном режиме. Покажем, как это осуществить на практике.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Загружаем tiny-crackme в любой hex-редактор (например, в hte или hiew), переходим в точку входа (в hiew'е это осуществляется нажатием &lt;ENTER&gt; (для перехода в hex-режим), &lt;F8&gt; [header], &lt;F5&gt; [entry]). Запоминаем (записываем на бумажку) содержимое двух байт под курсором (в нашем случае они равны B3h 2Ah) и заменяем их на </span><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">EBh FEh</span><span style=" font-family:'Times New Roman'; color:#000000;">, что соответствует инструкции </span><span style=" font-family:'Courier New'; color:#000000;">jumps $</span><span style=" font-family:'Times New Roman'; color:#000000;">.</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image16385193128ru6rkb2il.png" /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Рисунок 4 зацикливание программы в hiew'e</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Сохраняем изменения, запускам файл, определяет его pid, подключаем к процессу отладчик. На этот раз gdb хоть и ругается на неверный формат, но все-таки подключается к процессу, предоставляя нам полную свободу действий. Но прежде, чем начать трассировку, необходимо расциклить файл, вернув пару байт из точки входа на место.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Модификация памяти (регистров и переменных) осуществляется командой &quot;</span><span style=" font-family:'Courier New'; color:#000000;">set</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, в нашем случае вызываемой следующим образом:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">./tiny-crackme</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"># запускаем зацикленный tiny-crackme и переходим на соседней консоли</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"># ps -a</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">PID    TTY    TIME          CMD</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">13414  pts/7  00:00:03      tiny-crackme</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">13419  pts/5  00:00:00      ps</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"># gdb -q</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) attach </span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">13414</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">Attaching to process 13414</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">&quot;/home/kpnc/gdb/tiny-crackme&quot;: not in executable format:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">File format not recognized</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-weight:600; color:#000000;"># ^ gdb ругается на неверный формат файла,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">#   но все-таки аттачится к процессу</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) set *(unsigned char*)$pc = 0xB3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) set *(unsigned char*)($pc+1) = 0x2A</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-weight:600; color:#000000;"># ^ восстановление оригинальных байт командой set</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 8 загрузка зацикленного файла с потрепанным заголовком и восстановление оригинальных байт</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Здесь &quot;</span><span style=" font-family:'Courier New'; color:#000000;">$pc</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (с учетом регистра!) – условное обозначение регистра-счетчика команд (program count), а &quot;</span><span style=" font-family:'Courier New'; color:#000000;">*(unsigned char*)</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; – явное преобразование типа, без которого gdb ни за что не сможет определить размер записываемой ячейки. Довольно длинная конструкция и у нас возникает естественное желание ее сократить.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Отладчик помнит историю команд и чтобы не вводить уже введенную команду, достаточно нажать &quot;стрелку вверх&quot; и отредактировать строку. В нашем случае — заменить &quot;</span><span style=" font-family:'Courier New'; color:#000000;">$pc = 0xB3</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; на &quot;</span><span style=" font-family:'Courier New'; color:#000000;">($pc+1) = 0x2A</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;. Уже короче! Но… все равно длинно. (</span><span style=" font-family:'Times New Roman'; font-style:italic; color:#000000;">Примечание: по умолчанию gdb не сохраняет историю команд и она действительна только в пределах одного сеанса, чтобы задействовать автоматическое сохранение, необходимо набрать &quot;</span><span style=" font-family:'Courier New'; font-style:italic; color:#000000;">set history save on</span><span style=" font-family:'Times New Roman'; font-style:italic; color:#000000;">&quot;, чтобы не делать это при каждом запуске gdb, можно занести это последовательность в .gdbinit файл расположенный в HOME или текущей директории</span><span style=" font-family:'Times New Roman'; color:#000000;">).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">И вот тут мы подходим к одному из главных преимуществ gdb над soft-ice. Отладчик gdb неограниченно расширяем и поддерживает продвинутый интерпретатор, позволяющий среди прочего объявлять свои переменные, начинающиеся со знака &quot;$&quot;, с которыми можно делать что угодно.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Улучшенный вариант выглядит так:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb)set $i = $pc</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb)set *(unsigned char*)$i++ = 0xB3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb)set *(unsigned char*)$i++ = 0x2A</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 9 восстановление ячеек памяти с использованием переменной $i</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Здесь, после ввода &quot;</span><span style=" font-family:'Courier New'; color:#000000;">set *(unsigned char*)$i++ = 0xB3</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; мы нажимаем &quot;стрелку вверх&quot; и всего лишь меняем 0xB3 на 0x2A (переменная $i увеличивается сама), что намного короче, но... все равно длинно и нудно.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">А давайте объявим свою собственную пользовательскую команду! Это делается с помощью &quot;</span><span style=" font-family:'Courier New'; color:#000000;">define</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; и в нашем случае выглядит так:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb)define dd</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">type command for definition of &quot;dd&quot;.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">end with a line saying just &quot;end&quot;.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">&gt;set *(unsigned char*) $arg0 = $arg1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">&gt;end</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 10 объявление пользовательской переменной dd, записывающей байт по указанному адресу</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Обратите внимание, как gdb изменил тип приглашения (&quot;</span><span style=" font-family:'Courier New'; color:#000000;">&gt;</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;), когда началось определение команды! Закончив писать, мы говорим &quot;</span><span style=" font-family:'Courier New'; color:#000000;">end</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; и новая команда добавляется в память gdb наряду со всеми остальными. Она принимает два аргумента </span><span style=" font-family:'Courier New'; color:#000000;">$arg0</span><span style=" font-family:'Times New Roman'; color:#000000;"> – адрес по которому писать и </span><span style=" font-family:'Courier New'; color:#000000;">$arg1</span><span style=" font-family:'Times New Roman'; color:#000000;"> – записываемый байт.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Теперь для восстановления байт в точке входа, достаточно дать следующую последовательность команд (</span><span style=" font-family:'Times New Roman'; font-weight:600; font-style:italic; color:#000000;">внимание</span><span style=" font-family:'Times New Roman'; font-style:italic; color:#000000;">! если написать &quot;</span><span style=" font-family:'Courier New'; font-style:italic; color:#000000;">dd $pc++ 0xB3</span><span style=" font-family:'Times New Roman'; font-style:italic; color:#000000;">&quot;, то после выполнения команды регистр $pc увеличится на единицу, что никак не входит в наши планы!</span><span style=" font-family:'Times New Roman'; color:#000000;">):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb)set $i = $pc</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb)dd $i++ 0xB3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb)dd $i++ 0x2A</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 11 восстановление ячеек памяти через пользовательскую команду</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Пользовательские команды существуют только на протяжении текущего сеанса, погибая при выходе из gdb, что не есть хорошо, однако, мы можем загнать их в командный файл, который в нашем случае выглядит так:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">define dd</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">set *(unsigned char*)$arg0 = $arg1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">end</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 12 файл n2k_cmd, содержащий определение команды dd</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Загрузка командного файла в память осуществляется командой &quot;</span><span style=" font-family:'Courier New'; color:#000000;">source имя_файла</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (в нашем случае: &quot;</span><span style=" font-family:'Courier New'; color:#000000;">source n2k_cmd</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;), причем, поскольку gdb поддерживает автозавершение ввода (свойственное практически всем UNIX-программам) совершенно необязательно выписывать &quot;</span><span style=" font-family:'Courier New'; color:#000000;">source</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; целиком. Достаточно набрать &quot;</span><span style=" font-family:'Courier New'; color:#000000;">so</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; и нажать &lt;TAB&gt;. Отладчик самостоятельно допишет остальное. Если существует несколько команд, начинающихся с &quot;</span><span style=" font-family:'Courier New'; color:#000000;">so</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, вместо автозавершения раздастся мерзкий писк, сигнализирующей о неоднозначности. Повторное нажатие TAB'а приводит к выводу всех возможных вариантов.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Создавая свои собственные команды (загружаемые из .gdbinit файла или вручную), мы не только обеспечиваем комфортную работу, но и увеличиваем производительность труда! Те, кто обвиняют gdb в неудобстве, просто не умеют затачивать его под себя, но мы, мыщъх'и, — умеем! Кстати, сейчас как раз время чтобы что-нибудь заточить.</span></p>
<h2 style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; font-style:italic; color:#000000;">прежде, чем начинать трассировку</span></h2>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">В отличии от soft-ice (и даже debug.com!), gdb не показывает мнемоники машинных инструкций при трассировке, если его об этом не просят, что сильно смущает новичков, но идеологически так намного правильнее. Отобразить машинную команду по произвольному адресу можно с помощью команды &quot;x/i адрес&quot;, например:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb)x/i 0x200008</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x200008:     jmp 0x200008</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 13 отображение машинной команды по заданному адресу</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Вместо адреса можно использовать любое другое выражение, переменную или регистр (если регистры доступны), однако, отлаживать программу в таком режиме _крайне_ неудобно и лучше задействовать режим автоматического отображения, задаваемый командой &quot;</span><span style=" font-family:'Courier New'; color:#000000;">display</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Режим автоматического отображения позволяет выводить значение любого выражения, регистра, ячейки памяти, машинной инструкции при каждой остановке gdb (например, при пошаговом выполнении). Команда &quot;</span><span style=" font-family:'Courier New'; color:#000000;">display/i $pc</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (которую достаточно дать один раз за весь сеанс), будет отображать одну машинную инструкцию под $pc за раз, однако, это не очень удобно и на практике постоянно возникает необходимость узнать — какая же будет следующая инструкция за выполняемой. Мыщъх обычно выводит по три инструкции за раз: &quot;</span><span style=" font-family:'Courier New'; color:#000000;">display/3i $pc</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; и довольствуется жизнью в полный рост.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) display/3i $pc</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">1: x/3i $pc</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x200008:     mov    $0x2a,%bl</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x20000a:     jmp    0x200040</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x20000f:     add    %al,(%edx)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) ni</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x0020000a in ?? ()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">1: x/3i $pc</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x20000a:     jmp    0x200040</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x20000f:     add    %al,(%edx)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x200011:     add    %al,(%ebx)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) ni</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x00200040 in ?? ()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">1: x/3i $pc</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x200040:     jmp    0x200046</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x200045:     mov    $0xe8,%al</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x200047:     movsl  %ds:(%esi),%es:(%edi)</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 14 автоматическое отображение 3х инструкций при трассировке в формате AT&amp;T</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Для автоматического отображения значения регистров достаточно дать команду &quot;</span><span style=" font-family:'Courier New'; color:#000000;">display регистр</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, где регистр — $eax, $ebx, $ecx и т. д. Для регистра-указателя текущего положения стека существует специальное имя — $sp, которое можно использовать наравне с $esp (точно так же, как $pc &lt;--&gt; $eip). Автоматических отображений может быть создано сколько угодно и любое из них всегда может быть уделено командой &quot;</span><span style=" font-family:'Courier New'; color:#000000;">undisplay n1 n2 .. nn</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, где nx – номер отображения, которой можно узнать по команде &quot;</span><span style=" font-family:'Courier New'; color:#000000;">info display</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;. Временно выключить отображение помогает команда &quot;</span><span style=" font-family:'Courier New'; color:#000000;">disable display n1 n2 ... nn</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, а </span><span style=" font-family:'Courier New'; color:#000000;">enable display</span><span style=" font-family:'Times New Roman'; color:#000000;"> – включает обратно.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Переключение режима дизассемблирования ATT&amp;T|Intel. </span><span style=" font-family:'Times New Roman'; color:#000000;">По умолчанию, gdb использует синтаксис AT&amp;T, но может выводить инструкции и в формате Intel, для чего достаточно дать команду &quot;</span><span style=" font-family:'Courier New'; color:#000000;">set disassembly-flavor intel</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, а чтобы вернуться назад: &quot;</span><span style=" font-family:'Courier New'; color:#000000;">set disassembly-flavor att</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;. Вот, сравните это с листингом 14.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) set disassembly-flavor intel</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) display/3i $pc</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">1: x/3i $pc</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x200008:     mov    bl,0x2a</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x20000a:     jmp    0x200040</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x20000f:     add    BYTE PTR [edx],al</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) ni</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x0020000a in ?? ()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">1: x/3i $pc</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x20000a:     jmp    0x200040</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x20000f:     add    BYTE PTR [edx],al</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x200011:     add    BYTE PTR [ebx],al</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x00200040 in ?? ()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">1: x/3i $pc</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x200040:     jmp    0x200046</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x200045:     mov    al,0xe8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x200047:     movs   es:[edi],ds:[esi]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 15 автоматическое отображение 3х инструкций при трассировке в формате Intel</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Перенаправление ввода/вывода</span><span style=" font-family:'Times New Roman'; color:#000000;">. По умолчанию, gdb связывает со стандартным вводом/выводом отлаживаемой программы текущую консоль, в результате чего сообщения программы перемешиваются с сообщениями отладчика. Чтобы навести порядок, необходимо перенаправить в/в программы в отдельную консоль, что осуществляется командой &quot;</span><span style=" font-family:'Courier New'; color:#000000;">tty консоль</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;. Открываем новую консоль, даем UNIX-команду &quot;</span><span style=" font-family:'Courier New'; color:#000000;">tty</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; для определения ее имени (например, &quot;</span><span style=" font-family:'Courier New'; color:#000000;">/dev/ps/6</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;), возвращаемся к консоли отладчика и говорим: &quot;</span><span style=" font-family:'Courier New'; color:#000000;">tty /dev/ps/6</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Вывод выражение на экран.</span><span style=" font-family:'Times New Roman'; color:#000000;"> Для вывода выражений используется команда &quot;</span><span style=" font-family:'Courier New'; color:#000000;">print</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; или ее более короткий псевдоним &quot;</span><span style=" font-family:'Courier New'; color:#000000;">p</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; за которым следует выражение.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Например:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) p 2*2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">$1 = 4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) p $1 + 3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">$2 = 7</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) p $sp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">$3 = (void *) 0xbffffb40</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"># вывод значение $sp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) p/x *(unsigned int*) $sp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">$4 = 0x1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"># вывод ячейки, на которую указывает $sp в hex-формате</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) p/u *(unsigned int*) $sp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">$5 = 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"># вывод ячейки, на которую указывает $sp в unsigned dec-формате</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) p *0xbffffB3F</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">$6 = 256</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"># вывод содержимого ячейки в dec-формате (по умолчанию)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) p/x *0xbffffB3F</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">$7 = 0x100</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"># вывод содержимого ячейки в hex-формате</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 16 демонстрация возможностей print</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Как видно, при каждом выводе значения, &quot;</span><span style=" font-family:'Courier New'; color:#000000;">print</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; создает переменную, которую можно использовать в последующих выражениях, что _очень_ удобно. Так же доступа функция &quot;</span><span style=" font-family:'Courier New'; color:#000000;">printf</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; со стандартным набором спецификаторов, которая особенно удобна в командных файлах. Например: '</span><span style=" font-family:'Courier New'; color:#000000;">printf &quot;%x %x %x\n&quot;,$eax,$ebx,$ebx</span><span style=" font-family:'Times New Roman'; color:#000000;">', выводит значение сразу трех регистров. Обратите внимание на отсутствие круглых скобок вокруг нее!</span></p>
<h2 style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; font-style:italic; color:#000000;">заключение</span></h2>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Мы успешно загрузили исполняемый файл внутрь gdb, вплотную приблизившись к трассировке и в следующей статье покажем как работать с машинным кодом, устанавливать точки останова, изменять поток выполнения программы и делать много других удивительных вещей. Потенциал gdb только начинает раскрываться…</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<h1 align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:xx-large; font-weight:600; color:#000000;">погружение в технику и философию gdb<br />(окончание)</span></h1>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">крис касперски ака мыщъх, no-email</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">в этой статье мы проложим наше погружение в gdb, исследуя его возможности с точки зрения хакера, отлаживающего двоичные файлы без исходных текстов. мы рассмотрим технику изменения потока выполнения программы, точки останова и наблюдения, механизмы трассировки и средства работы с памятью. в общем, все то, что делает взломщиков счастливыми людьми</span></p>
<h2 style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; font-style:italic; color:#000000;">изменение потока выполнения</span></h2>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Программа, загруженная командой &quot;</span><span style=" font-family:'Courier New'; color:#000000;">file</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (или указанная в командной строке), находится в бесформенном состоянии, представляющим собой всего лишь совокупность байт, записанных в выделенном регионе адресного пространства. Новый процесс для нее еще не создан и трассировать ее невозможно. Во всяком случае до тех пор, пока мы не дадим команду &quot;</span><span style=" font-family:'Courier New'; color:#000000;">run</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; или &quot;</span><span style=" font-family:'Courier New'; color:#000000;">r</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (которой обычно предшествует установка точки останова на функцию </span><span style=" font-family:'Courier New'; color:#000000;">main</span><span style=" font-family:'Times New Roman'; color:#000000;"> или </span><span style=" font-family:'Courier New'; color:#000000;">start</span><span style=" font-family:'Times New Roman'; color:#000000;">). Будучи запущенной, программа будет работать до тех пор, пока не встретит точку останова или не получит no-stop сигнал (см. &quot;обработка сигналов&quot;). Применение команды &quot;</span><span style=" font-family:'Courier New'; color:#000000;">run</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; к уже запущенной программе, приведет к ее перезапуску (в конфигурации по умолчанию отладчик запрашивает подтверждение).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Продолжить работу программы, остановленной по точке останова или сигналу, можно командой &quot;</span><span style=" font-family:'Courier New'; color:#000000;">continue</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (&quot;</span><span style=" font-family:'Courier New'; color:#000000;">c</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;), действующей так же, как и &quot;</span><span style=" font-family:'Courier New'; color:#000000;">run</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (т. е. работающей до точки останова/сигнала).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Чтобы передать управление по произвольному адресу, необходимо сделать &quot;</span><span style=" font-family:'Courier New'; color:#000000;">jump</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (&quot;</span><span style=" font-family:'Courier New'; color:#000000;">j</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;) за которым следует адрес, имя функции или регистр. В частности, &quot;</span><span style=" font-family:'Courier New'; color:#000000;">j *$pc</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; по своему действию аналогична команде &quot;</span><span style=" font-family:'Courier New'; color:#000000;">continue</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, &quot;</span><span style=" font-family:'Courier New'; color:#000000;">j foo</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; передает управление на метку/функцию </span><span style=" font-family:'Courier New'; color:#000000;">foo</span><span style=" font-family:'Times New Roman'; color:#000000;"> (если только она присутствует в таблице символов), а &quot;</span><span style=" font-family:'Courier New'; color:#000000;">j *0x80484AA</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; – прыгает на адрес </span><span style=" font-family:'Courier New'; color:#000000;">80484AAh</span><span style=" font-family:'Times New Roman'; color:#000000;">. Если одни и те же адреса используются многократно, их можно загнать в пользовательскую переменную командой &quot;</span><span style=" font-family:'Courier New'; color:#000000;">set $my_foo=0x80484AA</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, а затем использовать ее в качестве параметра команды </span><span style=" font-family:'Courier New'; color:#000000;">jump</span><span style=" font-family:'Times New Roman'; color:#000000;"> – &quot;</span><span style=" font-family:'Courier New'; color:#000000;">j *$my_foo</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;. Отладчик soft-ice, кстати, ничего подобного делать не умеет!</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Команда &quot;</span><span style=" font-family:'Courier New'; color:#000000;">until</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (&quot;</span><span style=" font-family:'Courier New'; color:#000000;">u</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;) продолжает выполнение программы вплоть до указанного адреса (например, &quot;</span><span style=" font-family:'Courier New'; color:#000000;">u *0x080484ED</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;), при достижении которого останавливается и передает управление отладчику. Как и &quot;</span><span style=" font-family:'Courier New'; color:#000000;">jump</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, команда &quot;</span><span style=" font-family:'Courier New'; color:#000000;">until</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; поддерживает работу не только с метками и адресами, но и переменными, значительно упрощая взлом. Без аргументов &quot;</span><span style=" font-family:'Courier New'; color:#000000;">until</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; аналогична команде &quot;</span><span style=" font-family:'Courier New'; color:#000000;">nexti</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (см. &quot;трассировка&quot;) — она переходит на следующую машинную команду, пропуская функции и циклы.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Рассмотрим следующий код:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">.text:080484EB             jb     short loc_80484EF    ; </span><span style=" font-family:'Wingdings'; color:#000000;">à</span><span style=" font-family:'Courier New'; color:#000000;"> на выход из цикла</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">.text:080484ED             jmp    short loc_8048532    ; </span><span style=" font-family:'Wingdings'; color:#000000;">à</span><span style=" font-family:'Courier New'; color:#000000;"> к началу тела цикла</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">.text:080484EF             lea    eax, [ebp + var_28]  ; первая команда за концом цикла</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 1 фрагмент цикла, демонстрирующего сущность команды until</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Команда &quot;</span><span style=" font-family:'Courier New'; color:#000000;">until</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, отданная на строке 80484EBh, равносильна &quot;</span><span style=" font-family:'Courier New'; color:#000000;">u *0x80484EF</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; — она выполняет цикл и передает управление отладчику только по выходу из него. Очень удобно!</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Если нам необходимо дождаться выхода из функции, автоматически остановившись при встрече c </span><span style=" font-family:'Courier New'; color:#000000;">RET</span><span style=" font-family:'Times New Roman'; color:#000000;"> — на этот случай предусмотрена команда &quot;</span><span style=" font-family:'Courier New'; color:#000000;">finish</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, аналогичная команде &quot;</span><span style=" font-family:'Courier New'; color:#000000;">P RET</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; отладчика soft-ice. Вместо пошаговой трассировки программы, gdb просматривает фрейм предыдущей функции (что можно сделать командой &quot;</span><span style=" font-family:'Courier New'; color:#000000;">backtrace</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; или &quot;</span><span style=" font-family:'Courier New'; color:#000000;">bt</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;) и устанавливает точку останова на адрес возврата, что обеспечивает максимальную эффективность выполнения, но… если раскрутить стек и восстановить цепочку фреймов отладчику не удается, команда &quot;</span><span style=" font-family:'Courier New'; color:#000000;">finish</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; отказывает в работе.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Команда &quot;</span><span style=" font-family:'Courier New'; color:#000000;">return</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, в отличии от &quot;</span><span style=" font-family:'Courier New'; color:#000000;">finish</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, приводит к немедленному возвращению в материнскую функцию без выполнения оставшегося &quot;хвоста&quot;. soft-ice этого делать не умеет, а зря! &quot;</span><span style=" font-family:'Courier New'; color:#000000;">return</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; очень полезная и довольно часто используемая команда.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Еще soft-ice не умеет вызывать функции, а gdb это делает без всякого напряжения командой &quot;</span><span style=" font-family:'Courier New'; color:#000000;">call</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; за которой следует имя функции/переменная/регистр или адрес. Аргументы (если они есть) передаются в круглых скобах по Си-соглашению, то есть заносятся в стек справа налево, которые выталкиваются из стека все той же командой &quot;</span><span style=" font-family:'Courier New'; color:#000000;">call</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;. Например, &quot;</span><span style=" font-family:'Courier New'; color:#000000;">call foo(1,2,3)</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; или &quot;</span><span style=" font-family:'Courier New'; color:#000000;">call 0x8048384(1,2,3)</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">При желании можно даже выполнить команду оболочки, не выходя из отладчика. Это делается так: &quot;</span><span style=" font-family:'Courier New'; color:#000000;">shell ls</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; или &quot;</span><span style=" font-family:'Courier New'; color:#000000;">shell man open</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;. Просто фанатически удобно! Впрочем, аналогичного результата можно добиться, открыв дополнительную консоль. Поскольку, gdb – это отладчик прикладного уровня, он, в отличии от gdb, не замораживает систему, позволяя использовать естественную многозадачность без извращения с &quot;</span><span style=" font-family:'Courier New'; color:#000000;">shell</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;.</span></p>
<h2 style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; font-style:italic; color:#000000;">трассировка</span></h2>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">С трассировкой связны всего две команды: &quot;</span><span style=" font-family:'Courier New'; color:#000000;">stepi n</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (&quot;</span><span style=" font-family:'Courier New'; color:#000000;">si n</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;) выполняет n следующих инструкций с заходом в циклы и функции, а &quot;</span><span style=" font-family:'Courier New'; color:#000000;">nexti n</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (&quot;</span><span style=" font-family:'Courier New'; color:#000000;">ni n</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;) – без захода. При запуске без аргументов выполняется только одна инструкция. Нажатие на &lt;ENTER&gt; автоматически повторяет последнюю команду (&quot;</span><span style=" font-family:'Courier New'; color:#000000;">stepi</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; или &quot;</span><span style=" font-family:'Courier New'; color:#000000;">nexti</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;), что значительно ускоряет трассировку (кстати, лупить по &lt;ENTER'у&gt; намного удобнее, чем давить на любую из функциональных клавиш, используемых для трассировки Windows-отладчиками).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Команды &quot;</span><span style=" font-family:'Courier New'; color:#000000;">step n</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;/&quot;</span><span style=" font-family:'Courier New'; color:#000000;">next n</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (упоминание о которых можно найти в документации на gdb) ориентированы на работу с исходными текстами и выполняют n строк, а в отсутствии символьной информации трассируют программу вплоть до ее завершения, что не есть хорошо.</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1638519312lxpaq8or0e.png" /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Рисунок 1 пример сеанса трассировки</span></p>
<h2 style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; font-style:italic; color:#000000;">точки останова</span></h2>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Отладчик gdb поддерживает два типа точек останова: </span><span style=" font-family:'Times New Roman'; font-style:italic; color:#000000;">останов по выполнению кода</span><span style=" font-family:'Times New Roman'; color:#000000;"> – </span><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">breakpoint</span><span style=" font-family:'Times New Roman'; color:#000000;">, и </span><span style=" font-family:'Times New Roman'; font-style:italic; color:#000000;">останов по обращению к данным</span><span style=" font-family:'Times New Roman'; color:#000000;"> (так же называемый </span><span style=" font-family:'Times New Roman'; font-style:italic; color:#000000;">точками наблюдения</span><span style=" font-family:'Times New Roman'; color:#000000;">) — </span><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">watch-point</span><span style=" font-family:'Times New Roman'; color:#000000;">. (Еще gdb поддерживает точки перехвата, но для отладки программ без исходных текстов они практически бесполезны).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Точки останова могут быть как программными, так и аппаратными. Программная точка останова по выполнению на x86-платформе представляет собой однобайтовую инструкцию CCh (</span><span style=" font-family:'Courier New'; color:#000000;">INT 03h</span><span style=" font-family:'Times New Roman'; color:#000000;">), а программный watch-point реализуется путем пошаговой трассировки программы с отслеживанием обращений к подопытной ячейке, что, во-первых, крайне непроизводительно, а, во-вторых, некоторые программы просто не позволяют себя трассировать. Аппаратных точек останова на x86 всего четыре, программных же можно устанавливать сколько угодно.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Программная точка останова по исполнению задается командой &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">break</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (&quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">b</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;) за которой следует имя функции/адрес/регистр или переменная. Например, &quot;</span><span style=" font-family:'Courier New'; color:#000000;">b main</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, &quot;</span><span style=" font-family:'Courier New'; color:#000000;">b *0x80484BC</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;. Команда &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">tbreak</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (&quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">tb</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;) устанавливает одноразовую точку останова, которая автоматически удаляется при срабатывании. Аппаратная точка останова задается командой &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">hbreak</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (&quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">hb</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;), а временная аппаратная точка — &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">thbreak</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (&quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">thb</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;). После установки аппаратной точки останова отладит сообщает &quot;</span><span style=" font-family:'Times New Roman'; font-style:italic; color:#000000;">Hardware assisted breakpoint N at адрес</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, однако, это еще не значит, что операция завершилась успешно. Для проверки можно установить хоть тысячу аппаратных точек останова и все будет ОК, но вот только при запуске программы командами &quot;</span><span style=" font-family:'Courier New'; color:#000000;">run</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; или &quot;</span><span style=" font-family:'Courier New'; color:#000000;">continue</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; отладчик может сообщить: &quot;</span><span style=" font-family:'Times New Roman'; font-style:italic; color:#000000;">Warning: Cannot insert hardware breakpoint N</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;.</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1638519312f97fqpdycn.png" /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Рисунок 2 реальная установка точек останова происходит только при начале выполнения программы</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Аппаратные точки наблюдения на запись ячейки задаются командой &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">watch</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (&quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">wa</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;), команды &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">rwatch</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (&quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">rw</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;) и &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">awatch</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (&quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">aw</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;) устанавливают точки наблюдения на чтение и чтение/запись соответственно (например, &quot;</span><span style=" font-family:'Courier New'; color:#000000;">rw *0xBFFFFA50</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, а вот &quot;</span><span style=" font-family:'Courier New'; color:#000000;">rw *$esp</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; уже не срабатывает и отладчик сообщает &quot;</span><span style=" font-family:'Times New Roman'; font-style:italic; color:#000000;">Attempt to dereference a generic pointer</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;) . Как и в случае с точками останова по выполнению, сообщение &quot;</span><span style=" font-family:'Times New Roman'; font-style:italic; color:#000000;">Hardware read watchpoint N: адрес</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; не означает ровным счетом ничего и при попытке запуска/продолжения выполнения программы отладчик может сказать: &quot;</span><span style=" font-family:'Times New Roman'; font-style:italic; color:#000000;">Could not insert hardware watchpoint N</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, обламывая нас по полной программе.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Все точки наблюдения/останова могут быть условными, то есть срабатывать только в том случае, если значение выражения, стоящего после &quot;if&quot;, истинно. Например, &quot;</span><span style=" font-family:'Courier New'; color:#000000;">b if $eax==0</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, или &quot;</span><span style=" font-family:'Courier New'; color:#000000;">rw *0xBFFFFA60 if (*((unsigned int*)$esp)!=0x669)</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">При установке всякой точки наблюдения/останова отладчик присваивает ей номер, который, во-первых, высвечивается при ее срабатывании, а, во-вторых, может быть использован в командах управления точками наблюдения/останова. Номер последней сработавшей точки останова автоматически заносится в переменную </span><span style=" font-family:'Courier New'; color:#000000;">$bpnum</span><span style=" font-family:'Times New Roman'; color:#000000;">.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) hb main</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">Hardware assisted breakpoint 1 at 0x80483ef</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) r</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">Starting program: /home/kpnc/gdb/gdb_demo</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">Breakpoint 1, 0x080483ef in main ()</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 2 при установке точки наблюдения/останова, отладчик автоматически присваивает ей своей собственный номер (в данном случае равный единице)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Команда &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">ignore n x</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; устанавливает счетчик игнорирования точки наблюдения/останова n, пропуская первые x срабатываний, что особенно полезно в циклах.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Если при срабатывании точки останова/наблюдения необходимо выполнить некоторую последовательность операций, можно воспользоваться командой &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">commands n</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (где n – номер точки наблюдения/останова), пример использования которой показан ниже:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">commands 6</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">printf &quot;hello, world\n&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">ends</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 3 автоматическое исполнение последовательности команд при срабатывании точки останова (в данном случае при срабатывании точки номер 6 будет выведено приветствие &quot;hello, world!&quot;)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Получить информацию по точкам останова поможет команда &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">info break</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (&quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">i b</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; или &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">info watchpoints</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;). При запуске без аргументов она выдаст данные о состоянии всех точек наблюдения/останова. Если же необходимо &quot;проэкзаменовать&quot; какую-то конкретную точку наблюдения/останова, достаточно указать ее номер, например:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) i b 13</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">Num Type           Disp Enb Address    What</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">13  read watchpoint keep y              *134513676</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">        stop only if $eax == 4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb)</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 4 просмотр информации о точке наблюдения номер 13</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Команда &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">clear</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (она же &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">delete</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;) используется для удаления точек наблюдения/останова. При запуске без аргументов она удаляет _все_ точки (при этом отладчик запрашивает подтверждение), если же необходимо удалить какую-то одну конкретную точку — достаточно задать ее номер, например: &quot;</span><span style=" font-family:'Courier New'; color:#000000;">delete 13</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, так же можно удалить целый диапазон точек останова/наблюдения: &quot;</span><span style=" font-family:'Courier New'; color:#000000;">delete 1-6</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; удаляет точки наблюдения с первой по шестую включительно и никакого подтверждения при этом не запрашивается, так что будьте на чеку!</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Команды &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">enable</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; и &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">disable</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; используются для временного включения/выключения точек наблюдения/останова и имеют тот же самый синтаксис, что и &quot;</span><span style=" font-family:'Courier New'; color:#000000;">delete</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;.</span></p>
<h2 style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; font-style:italic; color:#000000;">работа с памятью и регистрами</span></h2>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Дамп памяти для хакеров — это святое. Без него не обходится ни один взлом. Просматривать/модифицировать память можно разными способами. Например, с помощью команды &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">print</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;/&quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">printf</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) p $esp         # вывод содержимого регистра esp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">$1 = (void *) 0xbffffa50</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) p (char) $esp  # вывод младшего байта регистра esp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">$2 = 80 'P'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) p *0x80483ef   # вывод содержимого двойного слова в десятичном знаковом виде</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">$3 = -1192172413</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) p/x *0x80483ef # вывод содержимого двойного слова в hex-виде</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">$4 = 0xb8f0e483</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) p/u *0x80483ef # вывод содержимого двойного слова в десятичном беззнаковом виде</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">$5 = 3102794883</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) p $esp = 0     # присвоение регистру esp значения 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">$6 = (void *) 0x0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) p/x *((char*)0x8048413)=0x90</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">$7 = 0x90            # присвоение значение 90h байту по адресу 8048413h</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 5 чтение и модификация памяти при помощи команды p (print)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Однако, при просмотре большого количества ячеек памяти выгоднее использовать специальную команду &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">x</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, позволяющую задавать длину отображаемого блока памяти, смотрите:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) x/16x $pc      # просмотр 16 двойных слов в hex-виде, начиная от $pc</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x80483ef &lt;main+9&gt;:     0xb8f0e483      0x00000000      0x04c7c429      0x00000624</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x80483ff &lt;main+25&gt;:    0xffbfe800      0x458dffff      0x24048988      0xfffeb4e8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x804840f &lt;main+41&gt;:    0x90c3c9ff      0x90909090      0x90909090      0x90909090</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x804841f &lt;main+57&gt;:    0xe5895590      0xf6315657      0x0cec8353      0x0000a0e8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) x/16xb $pc     # просмотр 16 байт слов в hex-виде, начиная от $pc</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x80483ef &lt;main+9&gt;:     0x83    0xe4    0xf0    0xb8    0x00    0x00    0x00    0x00</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x80483f7 &lt;main+17&gt;:    0x29    0xc4    0xc7    0x04    0x24    0x06    0x00    0x00</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 6 отображение дампа программы с помощью команды &quot;x&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Хакеров, начинающих свой жизненный путь с gdb такая форма подачи информации, быть может и устроит, но пользователям soft-ice она покажется слишком расточительной. Хорошо бы получить классический hex-дамп… И это действительно можно сделать! Достаточно создать реализацию своей собственной команды (назовем ее &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">ddd</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;), отображающий дамп с помощью функции &quot;</span><span style=" font-family:'Courier New'; color:#000000;">printf</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;. В отличии от soft-ice, отладчик gdb бесконечно расширяем и если нас что-то не устаивает, практически всегда возможно переделать это под свой вкус.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Исходный код команды &quot;</span><span style=" font-family:'Courier New'; color:#000000;">ddd</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; выглядит так:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">define ddd</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">set $ddd_p = 0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">printf &quot;%08Xh:&quot;,$arg0</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">while $ddd_p++ &lt; 16</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">printf &quot; %02X&quot;,*(unsigned char*)$arg0++</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">end</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">printf &quot;\n&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">end</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 7 исходный код пользовательской команды ddd, выводящий дамп в стиле soft-ice и turbo-debugger</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">А вот пример ее использования:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) set $t = $esp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">(gdb) ddd $t</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">BFFFFA50h: 8E FF 77 01 E0 FA FF BF 38 6E</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">BFFFFA5Ah: 01 40 34 FB FF BF 94 FA FF BF</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">BFFFFA64h: D0 42 03 40 88 77 01 40 2F 00</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 8 дамп памяти, выведенный пользовательской командой &quot;ddd&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Необходимость введения дополнительной переменной (в данном случае это переменная &quot;</span><span style=" font-family:'Courier New'; color:#000000;">$t</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;) объясняется тем, что команда &quot;</span><span style=" font-family:'Courier New'; color:#000000;">ddd</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; спроектирована так, чтобы отображать по 10h байт за раз, начиная с указанного адреса, а по нажатию на &lt;ENTER&gt; (в gdb – повтор последней команды) — следующие 10h байт и т. д., при этом переданный команде аргумент используется для хранения последнего отображенного адреса. Вызов &quot;</span><span style=" font-family:'Courier New'; color:#000000;">ddd $esp</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; приведет к тому, что значение регистра $esp окажется увеличенным на 10h, что развалит программу.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Естественно, при желании можно переписать команду &quot;</span><span style=" font-family:'Courier New'; color:#000000;">ddd</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; так, чтобы она не имела никаких побочных эффектов и отображала не 10h байт памяти, а ровно столько, сколько ей скажут.</span></p>
<h2 style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; font-style:italic; color:#000000;">обработка сигналов</span></h2>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Сигналом — называется асинхронное событие, происходящее в программе и чем-то напоминающее структурные исключения в Windows. Сигналы делятся на фатальные и не фатальные. Пример не фатального сигнала является SIGALRM, возбуждаемый при срабатывании интервального таймера. А вот при нарушения доступа к памяти генерируется сигнал SIGSEGV, завершающий программу в аварийной режиме (если только программист не предусмотрел специальный обработчик).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Отладчик gdb перехватывает все сигналы и в зависимости от своей конфигурации либо передает сигнал программе, либо &quot;поглощает&quot; его, делая вид, что ничего интересного не происходит.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Посмотреть текущую конфигурацию gdb можно с помощью команды &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">info signals</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; (она же &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">info handle</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;), а для изменения реакции gdb необходимо воспользоваться &quot;</span><span style=" font-family:'Courier New'; font-weight:600; color:#000000;">handle сигнал поведение</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot;, где </span><span style=" font-family:'Times New Roman'; font-style:italic; color:#000000;">сигнал</span><span style=" font-family:'Times New Roman'; color:#000000;"> — название сигнала (например, &quot;SIGSEGV&quot;), а </span><span style=" font-family:'Times New Roman'; font-style:italic; color:#000000;">поведение</span><span style=" font-family:'Times New Roman'; color:#000000;"> — реакция отладчика на возникновения сигнала, описываемая следующими ключевыми словами:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">nostop   при получении этого сигнала GDB не останавливает программу;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">stop        при получении этого сигнала GDB останавливает программу;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">print        при получении данного сигнала GDB выводит сообщение о нем на экран;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">noprint   GDB не замечает этот сигнал;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">pass        GDB позволяет программе увидеть этот сигнал;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">nopass   GDB массирует этот сигнал, не позволяя программе увидеть его.</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image16385193124q5kkm9hto.png" /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Рисунок 3 просмотр реакции отладчика gdb на различные сигналы</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Некоторые сигналы (например, сигнал SIGTRAP, возникающий при достижении программной точки останова) отладчик резервирует для своих собственных нужд. Этим обстоятельством пользуются многие защищенные программы, определяющие находятся ли они под отладкой или нет. Они устанавливают свой собственный обработчик SIGTRAP и затем выполняют инструкцию INT 03h. При выполнении без gdb управление получает обработчик, в противном случае сигнал поглощается отладчиком и обработчик уже не получает управление.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">В частности, файлы, упакованные протектором burneye содержат следующий код:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x053714a7:   mov    $0x5,%ebx</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x053714ac:   mov    $0x5371a0c,%ecx</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x053714b1:   mov    $0x30,%edx</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x053714b6:   mov    %edx,%eax</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x053714b8:   int    $0x80</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x053714ba:   add    $0x5375a00,%esi</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x053714c0:   mov    %esi,0xfffffd24(%ebp)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x053714c6:   int3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x053714c7:   cmpl   $0x0,0x5375748</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x053714ce:   jne    0x53714e2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">…</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x05371a0c:   push   %ebp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x05371a0d:   mov    %esp,%ebp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x05371a0f:   incl   0x5375748</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x05371a15:   leave</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#000000;">0x05371a16:   ret</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Листинг 9 дизассемблерный фрагмент файла, защищенного протектором burneye</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Попытка отладки программы в нормальном режиме приводит к ее краху (см. рис. 4), если, конечно, в момент возбуждения сигнала не увеличить содержимое ячейки 5375748h на единицу.</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1638519312zhczugpzm2.png" /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Рисунок 4 попытка отладки программы, защищенной протектором burneye, с реакцией на сигналы по умолчанию, заканчивается полным провалом</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Но существует гораздо более простой и элегантный путь. Дождавшись &quot;ругательства&quot; отладчика по поводу поимки сигнала SIGTRAP мы даем команду &quot;</span><span style=" font-family:'Courier New'; color:#000000;">handle SIGTRAP pass</span><span style=" font-family:'Times New Roman'; color:#000000;">&quot; и передаем программе управление командой &quot;continue&quot;. И все будет работать как часы!</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image16385193127gaf3dtwqg.png" /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Рисунок 5 передача сигнала SIGTRAP программе вводит защиту в заблуждение и отладка проходит успешно</span></p>
<h2 style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Arial'; font-size:x-large; font-weight:600; font-style:italic; color:#000000;">заключение</span></h2>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;">Вот мы и познакомились с основными возможностями могучего отладчика gdb. Однако, это лишь малая часть того, на что он способен. Все остальное — содержится в штатной документации и… исходных текстах (документация, как водится, содержит множество упущений). Тем не менее, для большинства хакерских задач рассмотренных нами команд будет вполне достаточно.</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1638519312rfufaanckl.png" /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-weight:600; color:#000000;">Рисунок 6 документация на gdb – кладезь знаний</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; color:#000000;"> </span></p></body></html>