<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:10pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:11pt;">Если происходит приведение типа-наследника к одному из базовых типов, то это называется </span><span style=" font-size:11pt; font-weight:600;">upcast</span><span style=" font-size:11pt;">. При таком приведении использование методов вида </span><span style=" font-family:'Courier New'; color:#6a1009;">static_cast/dynamic_cast</span><span style=" font-size:11pt; color:#000000;"> </span><span style=" font-size:11pt; font-weight:600; color:#000000;">не требуется</span><span style=" font-size:11pt; color:#000000;">.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:11pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:11pt;">Обратное действие, когда происходит приведение базового типа к типу-наследнику, называется </span><span style=" font-size:11pt; font-weight:600;">downcast</span><span style=" font-size:11pt;">. При таком приведении явный вызов методов </span><span style=" font-family:'Courier New'; color:#6a1009;">***_cast</span><span style=" font-size:11pt;"> </span><span style=" font-size:11pt; font-weight:600;">обязателен</span><span style=" font-size:11pt;">.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:11pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:11pt;">При </span><span style=" font-size:11pt; font-weight:600;">downcast</span><span style=" font-size:11pt;"> вопрос только в том, какой каст применить. Быстрее - </span><span style=" font-family:'Courier New'; color:#6a1009;">static_cast</span><span style=" font-size:11pt;">, но программист должен точно знать, что указатель/ссылка указывает на объект конкретного типа. Если программист ошибется - в рантайме может произойти все, что угодно. Если же программист не может знать, на что указывает указатель (например, метод возвращает объекты разных производных типов) - придется использовать </span><span style=" font-family:'Courier New'; color:#6a1009;">dynamic_cast</span><span style=" font-size:11pt;">, но он работает медленнее, ибо использует механизм RTTI.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:11pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:11pt;">Пример кода:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-size:11pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a1009;">QAbstractItemModel *base; // Объект класса QAbstractItemModel</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a1009;">TreeModel *child = new TreeModel; // Объект класса, унаследованного от </span><span style=" font-family:'Courier New'; color:#6a1009;">QAbstractItemModel</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a1009;">// Upcast</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a1009;">base</span><span style=" font-family:'Courier New'; color:#6a1009;"> = </span><span style=" font-family:'Courier New'; color:#6a1009;">child</span><span style=" font-family:'Courier New'; color:#6a1009;">; // так можно (ибо child содержит все данные для base и даже больше)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a1009;">// Downcast</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New'; color:#6a1009;">child</span><span style=" font-family:'Courier New'; color:#6a1009;"> = </span><span style=" font-family:'Courier New'; color:#6a1009;">base</span><span style=" font-family:'Courier New'; color:#6a1009;">;  // так без преобразования нельзя (base не имеет всех данных для child)</span></p>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier';"><br /></pre></body></html>