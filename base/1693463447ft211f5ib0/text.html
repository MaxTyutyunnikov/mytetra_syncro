<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Надо разобраться, что конкретно обозначают термины recovery, bootloader, twrp и т. д.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для начала нужно знать, как происходит загрузка стандартного Android-устройства. Цепочка загрузки примерно следующая:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">ROM -&gt; aboot -&gt; ядро -&gt; система Android</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Где:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">ROM</span> - это стартовое ПЗУ устройства, в больших компьютерах обычно называется BIOS;</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">aboot</span> - это Android Boot, низкоуровневая программа-загрузчик, которая располагается в начале Flash-диска, т. е. в начале постоянной внутренней памяти телефона. (Надо уточнить, располагается ли aboot прямо в стартовой записи, или для него на диске создается отдельный маленький раздел, и его запуск напоминает запуск GRUB, состоящий из двух частей, где первая часть - в загрузочной записи, вторая часть - в разделе жесткого диска);<br />Помимо загрузчика <span style=" font-family:'FreeMono'; color:#6a1009;">aboot</span> производители могут использовать собственные загрузчики - <span style=" font-family:'FreeMono'; color:#6a1009;">uboot</span>, <span style=" font-family:'FreeMono'; color:#6a1009;">hboot</span>, <span style=" font-family:'FreeMono'; color:#6a1009;">preloader.bin+lk.bin</span> и другие.</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Ядро</span> - ядро Android;</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Система Android</span> - непосредстванно сама ОС Android со своей графической оболочкой.</li></ul>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вроде как, на флешке телефона, помимо раздела с <span style=" font-family:'FreeMono'; color:#6a1009;">aboot</span> есть, как минимум, еще два раздела, которые условно называются <span style=" font-family:'FreeMono'; color:#6a1009;">boot</span> и <span style=" font-family:'FreeMono'; color:#6a1009;">recovery</span>.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Раздел boot</span> - содержит ядро Android. На него <span style=" font-family:'FreeMono'; color:#6a1009;">aboot</span> передает загрузку при обычной загрузке телефона</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Раздел recovery</span> - содержит низкоуровневую программу, которая так и называется - <span style=" font-family:'FreeMono'; color:#6a1009;">recovery</span>. Программа предназначена для восстановления или сервисного обслуживания телефона. Передача управления от <span style=" font-family:'FreeMono'; color:#6a1009;">aboot</span> на <span style=" font-family:'FreeMono'; color:#6a1009;">recovery</span> происходит в случае включения телефона с зажатой кнопкой увеличения (уменьшения) громкости.</li></ul>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Структура раздела <span style=" font-family:'FreeMono'; color:#6a1009;">boot</span> не совсем обычна. Сам раздел <span style=" font-family:'FreeMono'; color:#6a1009;">boot</span> не содержит никакой файловой системы, а представляет собой сжатые с помощью <span style=" font-family:'FreeMono'; color:#6a1009;">gzip</span> и записанные друг за другом ядро и RAM-диск, предваренные небольшим заголовком размером в два килобайта (он содержит опции загрузки ядра, а также адреса расположения образов и другую информацию). RAM-диск, в свою очередь, представляет собой небольшую виртуальную файловую систему, содержащую набор каталогов, к которым Android подключит файловые системы других разделов (<span style=" font-family:'FreeMono'; color:#6a1009;">system</span>, <span style=" font-family:'FreeMono'; color:#6a1009;">data</span>, <span style=" font-family:'FreeMono'; color:#6a1009;">sdcard</span>), а также систему и скрипт инициализации и <span style=" font-family:'FreeMono'; color:#6a1009;">init.rc</span>. RAM-диск загружается прямо в оперативку и продолжает существовать все время, пока смартфон включен.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14pt; font-weight:600;">Что такое fastboot?</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Ключевой особенностью <span style=" font-family:'FreeMono'; color:#6a1009;">aboot</span> является то, что эта программа-загрузчик имеет модули, которые могут даже работать параллельно друг другу. Один из таких модулей - <span style=" font-family:'FreeMono'; color:#6a1009;">fastboot</span>. Он позволяет подключиться к телефону по USB-кабелю и произвести действия над разделами Flash-диска через консольную утилиту, которая тоже называется <span style=" font-family:'FreeMono'; color:#6a1009;">fastboot</span>. Например, можно записать на выбранный раздел заданный образ:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">$ fastboot flash recovery образ-recovery.img</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">А можно даже дать команду продолжения загрузки, но не просто перепрыгнуть на раздел <span style=" font-family:'FreeMono'; color:#6a1009;">boot</span> или <span style=" font-family:'FreeMono'; color:#6a1009;">recovery</span>, а продолжить загрузку, используя переданный образ:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">$ fastboot boot образ-recovery.img</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Внимание!</span> Многие команды <span style=" font-family:'FreeMono'; color:#6a1009;">fastboot</span> не будут работать если загрузчик залочен. Для полноценного использования <span style=" font-family:'FreeMono'; color:#6a1009;">fastboot</span> надо сначала провести процедуру разлочивания загрузчика телефона, и только после этого появится возможность плоноценно пользоваться модулем <span style=" font-family:'FreeMono'; color:#6a1009;">fastboot</span>.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14pt; font-weight:600;">Что такое recovery?</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Раздел <span style=" font-family:'FreeMono'; color:#6a1009;">recovery</span> имеет точно такую же структуру что и раздел <span style=" font-family:'FreeMono'; color:#6a1009;">boot</span>, но в нем записано ядро и RAM-диск с таким содержимым, чтобы после запуска ядра запустилась на исполнение только одна команда <span style=" font-family:'FreeMono'; color:#6a1009;">/sbin/recovery</span>.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Содержимое раздела со стандартным (стоковым) <span style=" font-family:'FreeMono'; color:#6a1009;">recovery</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> очень простое. Все, что содержится в RAM-диск, — это исполняемый файл </span><span style=" font-family:'FreeMono'; color:#6a1009;">/sbin/recovery</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> и (не всегда) набор фоновых изображений в каталоге </span><span style=" font-family:'FreeMono'; color:#6a1009;">/res</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;"> или любом другом. При загрузке ядро Linux запускает </span><span style=" font-family:'FreeMono'; color:#6a1009;">/sbin/recovery</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">, а тот выводит на экран простенькое меню, с помощью которого можно установить прошивку, подписанную цифровым ключом производителя, или произвести сброс до заводских настроек.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">recovery</span> - это ...</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">bootloader</span> - это ...</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">twrp</span> - это одна из реализация bootloader, самая популярная. Поэтому в статьях часто путается понятие twrp и bootloader.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>