<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Zswap - это функция ядра Linux (представленная в версии, начиная с 3.8), которая при её включении позволяет системе на лету сжимать данные, попадающие в кэш подкачки, что приводит к повышению производительности системы Linux в целом. Кроме того, Zswap держит в ОЗУ некоторых размеров пул, при заполнении которого данные пишутся на диск.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">Данная система хорошо работает в случае если для подкачки используется HDD. Более низкий, но достаточно заметный эффект (+7 % производительности системы) получается и при размещении раздела подкачки на SSD-диске.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Чтобы включить Zswap, надо отредактировать параметры запуска ядра. Делается это в файле <span style=" font-family:'FreeMono'; color:#6a1009;">/etc/default/grub</span> путем редактирования значения параметра <span style=" font-family:'FreeMono'; color:#6a1009;">GRUB_CMDLINE_LINUX_DEFAULT</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">. В него надо добавить опции:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">zswap.enabled=1 zswap.zpool=zsmalloc zswap.compressor=zstd zswap.max_pool_percent=10</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Где:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Параметр <span style=" font-family:'FreeMono'; color:#6a1009;">zpool</span> можно задавать как <span style=" font-family:'FreeMono'; color:#6a1009;">zsmalloc</span> или как <span style=" font-family:'FreeMono'; color:#6a1009;">z3fold</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">. Это метод аллокации пула в памяти. Говоря, что лучше использовать </span><span style=" font-family:'FreeMono'; color:#6a1009;">z3fold</span><span style=" font-family:'DejaVu LGC Sans'; font-size:12pt;">, так как он дает большую отзывчивость при сбросе данных из пула в своп.</span></li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Разные источники рекомендуют разные алгоритмы упаковки данных (compressor). Можно выбирать из <span style=" font-family:'FreeMono'; color:#6a1009;">zstd</span> и <span style=" font-family:'FreeMono'; color:#6a1009;">lz4</span>. В случае с <span style=" font-family:'FreeMono'; color:#6a1009;">lz4</span> потребуется дополнительная настройка подключения модуля ядра, чтобы ядро могло использовать данный алгоритм при упаковке. Подробности здесь: https://askubuntu.com/questions/877178/enabling-lz4-compression-in-zswap-ie-making-zswap-more-efficient/877322#877322</li>
<li style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Значение <span style=" font-family:'FreeMono'; color:#6a1009;">max_pool_percent</span> - это размер пула в процентах от размера всей оперативной памяти (ОЗУ). Обычно рекомендуется указывать не более 20%.</li></ul>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">После внесения измениний в файл настройки Grub, эти изменения надо применить командой, запущенной от суперпользователя:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;"># update-grub</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Чтобы изменения вступили в силу, компьютер следует перезагрузить.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Обсуждение использования Zswap с замерами производительности есть на ЛОР-е: https://www.linux.org.ru/articles/desktop/17080055</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>