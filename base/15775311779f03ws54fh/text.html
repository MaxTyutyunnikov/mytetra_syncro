<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans';">В ОС Linux, в составе пакета imagemagick, поставляется программа </span><span style=" font-family:'FreeMono'; color:#6a1009;">convert</span><span style=" font-family:'DejaVu Sans';">.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans';">Чаще всего, создать PDF-файл в консоли можно с помощью одной простой команды:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">convert *.png output.pdf</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p align="justify" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans';">Данная команда возьмет в текущей директории все *.png-файлы и создаст из них один PDF-файл. Проблема в том, что команда </span><span style=" font-family:'FreeMono'; color:#6a1009;">convert</span><span style=" font-family:'DejaVu Sans';"> даже в 2019 году не может нормально работать с файлами в хорошем разрешении. Например если исходные файлы будут иметь размер около 3200 x 2400 pix, то существует большая вероятность, что </span><span style=" font-family:'FreeMono'; color:#6a1009;">convert</span><span style=" font-family:'DejaVu Sans';"> вывалится в середине создания PDF-файла с ошибками:</span></p>
<p align="justify" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p align="justify" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">convert-im6.q16: DistributedPixelCache '127.0.0.1' @ error/distribute-cache.c/ConnectPixelCacheServer/244. <br />convert-im6.q16: cache resources exhausted `/tmp/magick-16385LJRuV0C4tBkl1' @ error/cache.c/OpenPixelCache/3945. <br />convert-im6.q16: DistributedPixelCache '127.0.0.1' @ error/distribute-cache.c/ConnectPixelCacheServer/244. <br />convert-im6.q16: cache resources exhausted `/tmp/magick-16385sVqjhxhs16qG1' @ error/cache.c/OpenPixelCache/3945.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans';">Как можно обойти эти ошибки? Для этого можно воспользоваться альтернативным путем.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans';">В составе </span><span style=" font-family:'FreeMono'; color:#6a1009;">imagemagick</span><span style=" font-family:'DejaVu Sans';"> есть еще программа </span><span style=" font-family:'FreeMono'; color:#6a1009;">mogrify</span><span style=" font-family:'DejaVu Sans';">. Она позиционируется как полная альтернатива </span><span style=" font-family:'FreeMono'; color:#6a1009;">convert</span><span style=" font-family:'DejaVu Sans';">, но которая молча переписывает исходные файлы, если опции команды предполагают перезапись файла. На деле </span><span style=" font-family:'FreeMono'; color:#6a1009;">mogrify</span><span style=" font-family:'DejaVu Sans';"> иногда срабатывает лучше </span><span style=" font-family:'FreeMono'; color:#6a1009;">convert</span><span style=" font-family:'DejaVu Sans';">, например она может переконвертировать те отдельные файлы, которые не смог обработать </span><span style=" font-family:'FreeMono'; color:#6a1009;">convert</span><span style=" font-family:'DejaVu Sans';">.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans'; font-weight:600;">Внимание!</span><span style=" font-family:'DejaVu Sans';"> Mogrify - это очень неоднозначная утилита! Ее синтаксис во многих моментах отличается от convert, но эти особенности не отражены в документации. Например, нельзя давать такую команду:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">mogrify *.png outputfile.pdf</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:40px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans';">Вместо генерации pdf-файла, данная команда будет перегенерировать *.png-файлы, и в конце никакого outputfile.pdf не создаст!</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans';">Поэтому </span><span style=" font-family:'DejaVu Sans'; font-weight:600;">шаг №1</span><span style=" font-family:'DejaVu Sans';">: надо создать одностраничные PDF-файлы из PNG-файлов с помощью </span><span style=" font-family:'FreeMono'; color:#6a1009;">mogrify</span><span style=" font-family:'DejaVu Sans';">:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">mogrify -format pdf *.png</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans';">Далее, надо создать многостраничный PDF-файл из одностраничных PDF-файлов. Это можно сделать с помощью команды </span><span style=" font-family:'FreeMono'; color:#6a1009;">pdftk</span><span style=" font-family:'DejaVu Sans';"> (она находится в LInux-пакете </span><span style=" font-family:'FreeMono'; color:#6a1009;">pdftk</span><span style=" font-family:'DejaVu Sans';">, и этот пакет должен быть установлен в систему).</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans';">Таким образом, </span><span style=" font-family:'DejaVu Sans'; font-weight:600;">шаг №2</span><span style=" font-family:'DejaVu Sans';">:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">pdftk *.pdf cat output myOutput.pdf</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans';">В результате будет создан правильный PDF-файл с исходным разрешением картинок. Кстати, </span><span style=" font-family:'FreeMono'; color:#6a1009;">pdftk</span><span style=" font-family:'DejaVu Sans';"> при склейке PDF-файлов работает в разы быстрее, чем </span><span style=" font-family:'FreeMono'; color:#6a1009;">convert</span><span style=" font-family:'DejaVu Sans';">. Так что в Linux для создания PDF-файлов через консоль, можно и нужно использовать </span><span style=" font-family:'FreeMono'; color:#6a1009;">pdftk</span><span style=" font-family:'DejaVu Sans';">, это очень хорошая утилита.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans';">Недостаток подхода &quot;сделать одностраничные pdf-документы и собрать из них книгу&quot; в том, что каждый pdf-документ больше чем исходная картинка, часто на 10-20кб. А pdftk просто &quot;склеивает&quot; такие документы. ДЛя книг на 1000 страниц это может быть большим бессмысленным расходованием размера файла.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu Sans';">Вместо </span><span style=" font-family:'DejaVu Sans'; font-weight:600;">pdftk</span><span style=" font-family:'DejaVu Sans';"> можно попробовать утилиту </span><span style=" font-family:'DejaVu Sans'; font-weight:600;">qpdf</span><span style=" font-family:'DejaVu Sans';">. И сравнить полученный размер. Вроде как утлита </span><span style=" font-family:'DejaVu Sans'; font-weight:600;">qpdf</span><span style=" font-family:'DejaVu Sans';"> не просто склеивает pdf-файл, а делает многостраничный pdf-файл, корректно вытягивая картинку страницы из каждого входного pdf-файла. Используется данная команда так:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">qpdf --empty --pages *.pdf -- </span><span style=" font-family:'FreeMono'; color:#6a1009;">myOutput</span><span style=" font-family:'FreeMono'; color:#6a1009;">.pdf</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu Sans';"><br /></p></body></html>