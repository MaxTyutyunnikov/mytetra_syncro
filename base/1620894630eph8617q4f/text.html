<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">В этой статье вы узнаете, как разобрать арифметическое выражение в привычном формате из строки в структуру данных “дерево”, а затем путём обхода дерева вычислить выражение. Другими словами, мы пишем калькулятор.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" font-style:italic; color:#323232;">У статьи есть </span><a href="https://github.com/ps-group/procedural_calculator"><span style=" font-style:italic; text-decoration: underline; color:#2a7ae2;">пример на github</span></a><span style=" font-style:italic; color:#323232;">, он написан в процедурном стиле на C++.</span></p>
<h2 align="center" style=" margin-top:32px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><a name="wow0"></a><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">B</span><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">NF-нотация арифметических выражений</span></h2>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Нас интересуют арифметические выражения без скобок и с пятью операторами:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px; background-color:#fefefe;">&quot;+&quot;</span><span style=" font-size:18px;"> - сложение</span></li>
<li style=" color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px; background-color:#fefefe;">&quot;-&quot;</span><span style=" font-size:18px;"> - вычитание</span></li>
<li style=" color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px; background-color:#fefefe;">&quot;*&quot;</span><span style=" font-size:18px;"> - умножение</span></li>
<li style=" color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px; background-color:#fefefe;">&quot;/&quot;</span><span style=" font-size:18px;"> - деление (получение частного от деления)</span></li>
<li style=" color:#000000;" style=" margin-top:0px; margin-bottom:15px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px; background-color:#fefefe;">&quot;%&quot;</span><span style=" font-size:18px;"> - деление по модулю (получение остатка от деления)</span></li></ul>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Примеры таких выражений:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">12 / 12 / 12 =&gt; 0.0833333</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">25 + 17 / 45 / 2 =&gt; 25.1889</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Синтаксис выражений можно описать в BNF-нотации (также известной как нотация Бекуса-Наура). Такая нотация ещё называется грамматикой, и выглядит как набор правил:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">expression ::= add_sub_expr</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">add_sub_expr ::= mul_div_expr '+' add_sub_expr</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    | mul_div_expr '-' add_sub_expr</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    | mul_div_expr</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">mul_div_expr ::= atom_expr '*' mul_div_expr</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    | atom_expr '/' mul_div_expr</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    | atom_expr '%' mul_div_expr</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    | atom_expr</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">atom_expr ::= [0-9]+</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Данная грамматика учитывает неравный приоритет операторов: в выражении</span><span style=" color:#000000;"> </span><span style=" color:#000000; background-color:#fefefe;">1 + 2 * 2</span><span style=" color:#000000;"> вы сначала должны свернуть </span><span style=" color:#000000; background-color:#fefefe;">2 * 2</span><span style=" color:#000000;"> как mul_div_expr по правилу </span><span style=" color:#000000; background-color:#fefefe;">atom_expr '*' mul_div_expr</span><span style=" color:#000000;">, а потом уже свернуть </span><span style=" color:#000000; background-color:#fefefe;">1 + mul_div_expr</span><span style=" color:#000000;"> в </span><span style=" color:#000000; background-color:#fefefe;">add_sub_expr</span><span style=" color:#000000;">. Раскроем эту мысль подробнее с помощью пошаговой трассировки сворачивания правил грамматики:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">1</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">)</span><span style=" color:#000000; background-color:#ffffff;"> 17 + 25 / 7</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">2</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">)</span><span style=" color:#000000; background-color:#ffffff;"> atom_expr + 25 / 7 </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;"># правило atom_expr ::= [0-9]+</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">3</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">)</span><span style=" color:#000000; background-color:#ffffff;"> atom_expr + atom_expr / 7 </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;"># правило atom_expr ::= [0-9]+</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">4</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">)</span><span style=" color:#000000; background-color:#ffffff;"> atom_expr + atom_expr / atom_expr </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;"># правило atom_expr ::= [0-9]+</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">5</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">)</span><span style=" color:#000000; background-color:#ffffff;"> mul_div_expr + atom_expr / atom_expr </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;"># правило mul_div_expr ::= atom_expr</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">6</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">)</span><span style=" color:#000000; background-color:#ffffff;"> mul_div_expr + atom_expr / mul_div_expr </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;"># правило mul_div_expr ::= atom_expr</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">7</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">)</span><span style=" color:#000000; background-color:#ffffff;"> mul_div_expr + mul_div_expr </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;"># правило mul_div_expr ::= atom_expr '/' mul_div_expr</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">8</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">)</span><span style=" color:#000000; background-color:#ffffff;"> mul_div_expr + add_sub_expr </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;"># правило add_sub_expr ::= mul_div_expr</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">9</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">)</span><span style=" color:#000000; background-color:#ffffff;"> add_sub_expr </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;"># add_sub_expr ::= mul_div_expr '+' add_sub_expr</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-style:italic; color:#999988; background-color:#ffffff;"><br /></p>
<h2 align="center" style=" margin-top:32px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><a name="wow1"></a><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">С</span><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">верху вниз: строим и обходим дерево выражения</span></h2>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Дерево выражения — это вот такая прикольная штука:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><img src="image1620894660kg2j1l51up.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Способ превращения выражения в дерево зависит от приоритета операторов, который можно сменить расстановкой скобок. В качестве упражнения попробуйте восстановить тексты двух выражений, деревья которых нарисованы ниже:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><img src="image1620894690h9giwr5ts8.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Вычислить выражение по дереву легко и просто, достаточно обойти слева направо в глубину, применяя оператор в каждом нелистовом узле к дочерним узлам. Главный вопрос — как собрать дерево, имея строковое выражение?</span></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Мы воспользуемся принципом нисходящего разбора, и применим нисходящий подход к проектированию программы. Сначала опишем функцию, которая получает выражение в виде строки и вычисляет его как число с плавающей точкой:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#445588; background-color:#ffffff;">double</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#990000; background-color:#ffffff;">Calculate</span><span style=" color:#000000; background-color:#ffffff;">(</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">const</span><span style=" color:#000000; background-color:#ffffff;"> std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">string </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&amp;</span><span style=" color:#000000; background-color:#ffffff;">expression)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    Expression </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">pExpression </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> CreateExpression(expression);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">const</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">double</span><span style=" color:#000000; background-color:#ffffff;"> result </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> CalculateExpression(pExpression);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    DisposeExpression(pExpression);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">return</span><span style=" color:#000000; background-color:#ffffff;"> result;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Expression</span><span style=" color:#000000;"> — это узел дерева. Интересно, что узел дерева сам является деревом, ведь дерево — это рекурсивное понятие, не так ли? В листьях дерева находятся</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#000000; background-color:#ffffff;">struct</span><span style=" color:#000000; background-color:#ffffff;"> Expression;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Expression tree node operation code.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#000000; background-color:#ffffff;">enum</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">class</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">Operation</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    NOP, </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// just a value</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    ADD, </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// +</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    SUB, </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// -</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    MUL, </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// *</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    DIV, </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// /</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    MOD, </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// %</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">};</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Expression tree node is expression itself,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  since expressions are recursively defined.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#000000; background-color:#ffffff;">struct</span><span style=" color:#000000; background-color:#ffffff;"> Expression</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">double</span><span style=" color:#000000; background-color:#ffffff;"> value </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#009999; background-color:#ffffff;">0</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    Operation op </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> Operation</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">NOP;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    Expression </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">pLeft </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#0086b3; background-color:#ffffff;">nullptr</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    Expression </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">pRight </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#0086b3; background-color:#ffffff;">nullptr</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">};</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Вычисление выражения по дереву:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#445588; background-color:#ffffff;">double</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#990000; background-color:#ffffff;">CalculateExpression</span><span style=" color:#000000; background-color:#ffffff;">(Expression </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">pExpr)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Для листовых узлов возвращаем их численное значение</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  если бы у нас была поддержка переменных, мы бы выполнили</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  запрос значения переменной по имени в ассоциативном массиве переменных</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">if</span><span style=" color:#000000; background-color:#ffffff;"> (pExpr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">op </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">==</span><span style=" color:#000000; background-color:#ffffff;"> Operation</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">NOP)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">return</span><span style=" color:#000000; background-color:#ffffff;"> pExpr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">value;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Вычисляем выражения в левом и в правом поддеревьях</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    assert(pExpr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">pLeft);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    assert(pExpr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">pRight);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    CalculateExpression(pExpr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">pLeft);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    CalculateExpression(pExpr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">pRight);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Применяем операцию текущего узла</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">switch</span><span style=" color:#000000; background-color:#ffffff;"> (pExpr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">op)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">case</span><span style=" color:#000000; background-color:#ffffff;"> Operation:</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">:</span><span style=" color:#000000; background-color:#ffffff;">ADD</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        pExpr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">value </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> pExpr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">pLeft</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">value </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">+</span><span style=" color:#000000; background-color:#ffffff;"> pExpr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">pRight</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">value;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">break</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">case</span><span style=" color:#000000; background-color:#ffffff;"> Operation:</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">:</span><span style=" color:#000000; background-color:#ffffff;">SUB</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        pExpr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">value </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> pExpr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">pLeft</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">value </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-</span><span style=" color:#000000; background-color:#ffffff;"> pExpr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">pRight</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">value;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">break</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">case</span><span style=" color:#000000; background-color:#ffffff;"> Operation:</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">:</span><span style=" color:#000000; background-color:#ffffff;">MUL</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        pExpr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">value </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> pExpr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">pLeft</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">value </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;"> pExpr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">pRight</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">value;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">break</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">case</span><span style=" color:#000000; background-color:#ffffff;"> Operation:</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">:</span><span style=" color:#000000; background-color:#ffffff;">DIV</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        pExpr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">value </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> pExpr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">pLeft</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">value </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">/</span><span style=" color:#000000; background-color:#ffffff;"> pExpr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">pRight</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">value;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">break</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">case</span><span style=" color:#000000; background-color:#ffffff;"> Operation:</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">:</span><span style=" color:#000000; background-color:#ffffff;">MOD</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        pExpr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">value </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> fmod(pExpr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">pLeft</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">value, pExpr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">pRight</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">value);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">break</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">case</span><span style=" color:#000000; background-color:#ffffff;"> Operation:</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">:</span><span style=" color:#000000; background-color:#ffffff;">NOP</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        assert(</span><span style=" color:#0086b3; background-color:#ffffff;">false</span><span style=" color:#000000; background-color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">break</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">return</span><span style=" color:#000000; background-color:#ffffff;"> pExpr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">value;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<h2 align="center" style=" margin-top:32px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><a name="wow2"></a><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">П</span><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">ревращаем правила в функции</span></h2>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Мы хотим реализовать функцию</span><span style=" color:#000000;"> </span><span style=" color:#000000; background-color:#fefefe;">Expression *CreateExpression(const std::string &amp;expression);</span><span style=" color:#000000;">, которая выполняет разбор строки и в случае успеха возвращает указатель на выражение. Для этого на каждое из правил в BNF-нотации объявим по одной функции. Соглашения будут таковы:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px;">В случае успешного разбора функция возвращает </span><span style=" font-size:16px; background-color:#fefefe;">Expression *</span><span style=" font-size:18px;">, то есть стек вызовов функций уменьшается на одну запись</span></li>
<li style=" color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px;">В случае ошибки функция корректно удаляет выделенную память и выбрасывает исключение, то есть начинается экстренная раскрутка стека вызовов функций</span></li>
<li style=" color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px;">Функция может рекурсивно вызывать себя или другие функции</span></li>
<li style=" color:#000000;" style=" margin-top:0px; margin-bottom:15px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px;">Функция принимает изменяемую ссылку на строку, и в случае успешного разбора своего участка отсекает этот участок из строки, оставляя всё, что находится правее. Например, в выражении </span><span style=" font-size:16px; background-color:#fefefe;">18 - 7</span><span style=" font-size:18px;"> после успешного разбора первого </span><span style=" font-size:16px; background-color:#fefefe;">atom_expr</span><span style=" font-size:18px;"> подстрока “18” должна быть убрана из строки</span></li></ul>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">Expression *ParseAtom(std::string &amp;str);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">Expression *ParseMulDiv(std::string &amp;str);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">Expression *ParseAddSub(std::string &amp;str);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">В псевдокоде реализация разбора atom должна выглядеть так:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">Expression </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" font-weight:600; color:#990000; background-color:#ffffff;">ParseAtom</span><span style=" color:#000000; background-color:#ffffff;">(std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">string </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&amp;</span><span style=" color:#000000; background-color:#ffffff;">str)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Попытаться считать число.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Если удалось, пропустить считанную часть str,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  создать Expression* и вернуть его.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Иначе бросаем исключение</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Наивная реализация разбора expr_mul_div могла бы выглядеть так:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">Expression </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" font-weight:600; color:#990000; background-color:#ffffff;">ParseMulDiv</span><span style=" color:#000000; background-color:#ffffff;">(std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">string </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&amp;</span><span style=" color:#000000; background-color:#ffffff;">str)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Попытаться считать atom (не удалось - бросаем исключение).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Проверить, есть ли впереди оператор *, / или %</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  если нет, возвращаем Expression* от atom</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  если да, считываем и пропускаем оператор</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Попытаться считать atom (не удалось - бросаем исключение).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Формируем Expression из двух atom и оператора</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">К сожалению, такая реализация не сможет разобрать выражение “a</span><span style=" font-style:italic; color:#000000;">b</span><span style=" color:#000000;">c”, в котором число операций одного уровня — 3 или более. Сразу заметим, что в разборе таких выражений надо учитывать жестокие правила ассоциативности, например, «2/2/2» правильно вычисляется как «(2/2)/2=0,5», а не «2/(2/2)=2»</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><img src="image1620894734psn9zjqpjd.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Именно из-за левой ассоциативности деления такая реализация не подходит (но она подошла бы для правоассоциативных правил, таких как присваивание):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">Expression </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" font-weight:600; color:#990000; background-color:#ffffff;">ParseMulDiv</span><span style=" color:#000000; background-color:#ffffff;">(std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">string </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&amp;</span><span style=" color:#000000; background-color:#ffffff;">str)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Попытаться считать atom (не удалось - бросаем исключение).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Проверить, есть ли впереди оператор *, / или %</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  если нет, возвращаем Expression* от atom</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  если да, считываем и пропускаем оператор</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Попытаться рекурсивно считать expr_mul_div (не удалось - бросаем исключение).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Формируем Expression из atom, expr_mul_div и оператора</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Если же попытаться при разборе expr_mul_div в первую очередь искать вложенный expr_mul_div, то будет очевидная бесконечная рекурсия и следующее за ней переполнение стека программы. Поэтому нам ничего не остаётся, кроме как заменить рекурсию на цикл, и на каждой итерации цикла присоединять уже собранный expr_mul_div к новому как левое поддерево.</span></p>
<h2 align="center" style=" margin-top:32px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><a name="wow3"></a><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">Р</span><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">еализуем функции разбора</span></h2>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">В реализациях этих функций мы применим три дополнительные функции, которые по тем же принципам отсекают от строки пробельные символы, число и следующий оператор соответственно:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#990000; background-color:#ffffff;">SkipSpaces</span><span style=" color:#000000; background-color:#ffffff;">(std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">string </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&amp;</span><span style=" color:#000000; background-color:#ffffff;">expression)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">size_t</span><span style=" color:#000000; background-color:#ffffff;"> numSize </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#009999; background-color:#ffffff;">0</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">while</span><span style=" color:#000000; background-color:#ffffff;"> (numSize </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;</span><span style=" color:#000000; background-color:#ffffff;"> expression.size()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">           </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&amp;&amp;</span><span style=" color:#000000; background-color:#ffffff;"> (expression[numSize] </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">==</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#dd1144; background-color:#ffffff;">' '</span><span style=" color:#000000; background-color:#ffffff;">))</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">++</span><span style=" color:#000000; background-color:#ffffff;">numSize;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    expression </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> expression.substr(numSize);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Skips spaces, then reads until first non-digit character.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// If successful, removes read characters from `expression`</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  and returns true.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#445588; background-color:#ffffff;">bool</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#990000; background-color:#ffffff;">ParseDouble</span><span style=" color:#000000; background-color:#ffffff;">(std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">string </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&amp;</span><span style=" color:#000000; background-color:#ffffff;">expression, </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">double</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&amp;</span><span style=" color:#000000; background-color:#ffffff;">result)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">string remainingStr </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> expression;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    SkipSpaces(remainingStr);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">size_t</span><span style=" color:#000000; background-color:#ffffff;"> numSize </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#009999; background-color:#ffffff;">0</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">if</span><span style=" color:#000000; background-color:#ffffff;"> (remainingStr.size() </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&gt;</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#009999; background-color:#ffffff;">0</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&amp;&amp;</span><span style=" color:#000000; background-color:#ffffff;"> isdigit(remainingStr[</span><span style=" color:#009999; background-color:#ffffff;">0</span><span style=" color:#000000; background-color:#ffffff;">]))</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">while</span><span style=" color:#000000; background-color:#ffffff;"> (numSize </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;</span><span style=" color:#000000; background-color:#ffffff;"> remainingStr.size()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">               </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&amp;&amp;</span><span style=" color:#000000; background-color:#ffffff;"> isdigit(remainingStr[numSize]))</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">++</span><span style=" color:#000000; background-color:#ffffff;">numSize;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        result </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">stod(remainingStr.substr(</span><span style=" color:#009999; background-color:#ffffff;">0</span><span style=" color:#000000; background-color:#ffffff;">, numSize));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        expression </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> remainingStr.substr(numSize);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">return</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#0086b3; background-color:#ffffff;">true</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">return</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#0086b3; background-color:#ffffff;">false</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Skips spaces, then reads next operator symbol.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// If successful, removes read characters from `expression`</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  and returns true.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#445588; background-color:#ffffff;">bool</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#990000; background-color:#ffffff;">ParseOperator</span><span style=" color:#000000; background-color:#ffffff;">(std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">string </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&amp;</span><span style=" color:#000000; background-color:#ffffff;">expression, Operation </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&amp;</span><span style=" color:#000000; background-color:#ffffff;">op)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">string remainingStr </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> expression;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    SkipSpaces(remainingStr);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">if</span><span style=" color:#000000; background-color:#ffffff;"> (remainingStr.empty())</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        op </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> Operation</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">NOP;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">return</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#0086b3; background-color:#ffffff;">false</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">switch</span><span style=" color:#000000; background-color:#ffffff;"> (remainingStr[</span><span style=" color:#009999; background-color:#ffffff;">0</span><span style=" color:#000000; background-color:#ffffff;">])</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">case</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#dd1144; background-color:#ffffff;">'+'</span><span style=" color:#000000; background-color:#ffffff;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        op </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> Operation</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">ADD; </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">break</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">case</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#dd1144; background-color:#ffffff;">'-'</span><span style=" color:#000000; background-color:#ffffff;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        op </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> Operation</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">SUB; </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">break</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">case</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#dd1144; background-color:#ffffff;">'*'</span><span style=" color:#000000; background-color:#ffffff;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        op </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> Operation</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">MUL; </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">break</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">case</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#dd1144; background-color:#ffffff;">'/'</span><span style=" color:#000000; background-color:#ffffff;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        op </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> Operation</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">DIV; </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">break</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">case</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#dd1144; background-color:#ffffff;">'%'</span><span style=" color:#000000; background-color:#ffffff;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        op </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> Operation</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">MOD; </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">break</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    default:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        op </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> Operation</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">NOP; </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">break</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">const</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">bool</span><span style=" color:#000000; background-color:#ffffff;"> succeed </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> (op </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">!=</span><span style=" color:#000000; background-color:#ffffff;"> Operation</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">NOP);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">if</span><span style=" color:#000000; background-color:#ffffff;"> (succeed)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        expression </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> remainingStr.substr(</span><span style=" color:#009999; background-color:#ffffff;">1</span><span style=" color:#000000; background-color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">return</span><span style=" color:#000000; background-color:#ffffff;"> succeed;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Теперь можно показать, как выглядят реализации функций разбора по правилам грамматики. Не забываем о ранее запланированной замене рекурсии на цикл.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Parses expressions like: `a`, `a+b±...`, `a-b±...`,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  where each sub-expression parsed by `ParseMulDiv`.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">Expression </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" font-weight:600; color:#990000; background-color:#ffffff;">ParseAddSub</span><span style=" color:#000000; background-color:#ffffff;">(std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">string </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&amp;</span><span style=" color:#000000; background-color:#ffffff;">str)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    Expression </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">left </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> ParseMulDiv(str);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">while</span><span style=" color:#000000; background-color:#ffffff;"> (</span><span style=" color:#0086b3; background-color:#ffffff;">true</span><span style=" color:#000000; background-color:#ffffff;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        Operation op </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> Operation</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">NOP;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Don't remove operator from remaining string</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  when this operator remains unhandled.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">string remainingStr </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> str;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">if</span><span style=" color:#000000; background-color:#ffffff;"> (</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">!</span><span style=" color:#000000; background-color:#ffffff;">ParseOperator(remainingStr, op)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">                </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">||</span><span style=" color:#000000; background-color:#ffffff;"> (op </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">!=</span><span style=" color:#000000; background-color:#ffffff;"> Operation</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">ADD </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&amp;&amp;</span><span style=" color:#000000; background-color:#ffffff;"> op </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">!=</span><span style=" color:#000000; background-color:#ffffff;"> Operation</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">SUB))</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">return</span><span style=" color:#000000; background-color:#ffffff;"> left;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        str </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> remainingStr;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        Expression </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">right </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#0086b3; background-color:#ffffff;">nullptr</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">try</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            right </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> ParseMulDiv(str);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">catch</span><span style=" color:#000000; background-color:#ffffff;"> (...)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            DisposeExpression(left);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">throw</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">try</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            Expression </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">expr </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">new</span><span style=" color:#000000; background-color:#ffffff;"> Expression;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            expr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">pLeft </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> left;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            expr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">pRight </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> right;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            expr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">op </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> op;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            left </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> expr;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">catch</span><span style=" color:#000000; background-color:#ffffff;"> (...)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            DisposeExpression(left);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            DisposeExpression(right);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">throw</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">return</span><span style=" color:#000000; background-color:#ffffff;"> left;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Parses expressions like: `a`, `a*b...`, `a/b...`, `a%b...`</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  where each sub-expression parsed by `ParseAtom`.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">Expression </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" font-weight:600; color:#990000; background-color:#ffffff;">ParseMulDiv</span><span style=" color:#000000; background-color:#ffffff;">(std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">string </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&amp;</span><span style=" color:#000000; background-color:#ffffff;">str)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    Expression </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">left </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> ParseAtom(str);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">while</span><span style=" color:#000000; background-color:#ffffff;"> (</span><span style=" color:#0086b3; background-color:#ffffff;">true</span><span style=" color:#000000; background-color:#ffffff;">)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        Operation op </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> Operation</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">NOP;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Don't remove operator from remaining string</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  when this operator remains unhandled.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">string remainingStr </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> str;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">if</span><span style=" color:#000000; background-color:#ffffff;"> (</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">!</span><span style=" color:#000000; background-color:#ffffff;">ParseOperator(remainingStr, op)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">                </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">||</span><span style=" color:#000000; background-color:#ffffff;"> (op </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">!=</span><span style=" color:#000000; background-color:#ffffff;"> Operation</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">MUL </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&amp;&amp;</span><span style=" color:#000000; background-color:#ffffff;"> op </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">!=</span><span style=" color:#000000; background-color:#ffffff;"> Operation</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">DIV </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&amp;&amp;</span><span style=" color:#000000; background-color:#ffffff;"> op </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">!=</span><span style=" color:#000000; background-color:#ffffff;"> Operation</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">MOD))</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">return</span><span style=" color:#000000; background-color:#ffffff;"> left;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        str </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> remainingStr;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        Expression </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">right </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#0086b3; background-color:#ffffff;">nullptr</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">try</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            right </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> ParseAtom(str);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">catch</span><span style=" color:#000000; background-color:#ffffff;"> (...)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            DisposeExpression(left);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">throw</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">try</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            Expression </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">expr </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">new</span><span style=" color:#000000; background-color:#ffffff;"> Expression;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            expr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">pLeft </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> left;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            expr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">pRight </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> right;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            expr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">op </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> op;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            left </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> expr;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">catch</span><span style=" color:#000000; background-color:#ffffff;"> (...)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            DisposeExpression(left);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            DisposeExpression(right);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">            </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">throw</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">return</span><span style=" color:#000000; background-color:#ffffff;"> left;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Parses atom expression, like a number.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">Expression </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" font-weight:600; color:#990000; background-color:#ffffff;">ParseAtom</span><span style=" color:#000000; background-color:#ffffff;">(std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">string </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&amp;</span><span style=" color:#000000; background-color:#ffffff;">str)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    Expression </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">expr </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">new</span><span style=" color:#000000; background-color:#ffffff;"> Expression;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">if</span><span style=" color:#000000; background-color:#ffffff;"> (</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">!</span><span style=" color:#000000; background-color:#ffffff;">ParseDouble(str, expr</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">value))</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        DisposeExpression(expr);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">throw</span><span style=" color:#000000; background-color:#ffffff;"> std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">invalid_argument(</span><span style=" color:#dd1144; background-color:#ffffff;">&quot;Expected number at: &quot;</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">+</span><span style=" color:#000000; background-color:#ffffff;"> str);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">return</span><span style=" color:#000000; background-color:#ffffff;"> expr;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<h2 align="center" style=" margin-top:32px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><a name="wow4"></a><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">Ч</span><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">то смотреть дальше и что улучшить</span></h2>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Другие примеры и теоретические выкладки по рекурсивному спуску есть в сети:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://en.wikipedia.org/wiki/Recursive_descent_parser"><span style=" font-size:18px; text-decoration: underline; color:#2a7ae2;">Recursive descent parser (en.wikipedia.org)</span></a></li>
<li style=" color:#000000;" style=" margin-top:0px; margin-bottom:15px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.tutorialspoint.com/compiler_design/compiler_design_top_down_parser.htm"><span style=" font-size:18px; text-decoration: underline; color:#2a7ae2;">Compiler Design - Top-Down Parser</span></a></li></ul>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">В нашем парсере происходит множественное копирование строк в процессе разбора. Этого можно было бы избежать, если каждая рекурсивно вызываемая функция принимала бы</span><span style=" color:#000000;"> </span><a href="http://htrd.su/wiki/zhurnal/2016/04/29/std_string_view_i_vremennye_obekty"><span style=" text-decoration: underline; color:#2a7ae2;">string_view — невладеющую ссылку на строку</span></a><span style=" color:#000000;">. Реализацию string_view можно раздобыть несколькими способами:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px;">Найти компилятор и IDE с поддержкой C++17, в котором </span><span style=" font-size:16px; background-color:#fefefe;">&lt;string_view&gt;</span><span style=" font-size:18px;"> и объявленные в этом заголовке классы стали частью стандартной библиотеки</span></li>
<li style=" color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px;">Взять тривиальную реализацию на Github, состоящую из одного заголовка: </span><a href="https://github.com/sergey-shambir/string_view/blob/master/string_view.h"><span style=" font-size:18px; text-decoration: underline; color:#2a7ae2;">github.com/sergey-shambir/string_view</span></a></li>
<li style=" color:#000000;" style=" margin-top:0px; margin-bottom:15px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px;">Получить Boost версии 1.61 или выше, в котором есть </span><span style=" font-size:16px; background-color:#fefefe;">&lt;boost/utility/string_view.hpp&gt;</span></li></ol>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">По сути string_view — это удобная замена такой вот структуры для чтения строки слева направо:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#000000; background-color:#ffffff;">struct</span><span style=" color:#000000; background-color:#ffffff;"> StringScanState</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">string text;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">size_t</span><span style=" color:#000000; background-color:#ffffff;"> position;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">};</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<h2 align="center" style=" margin-top:32px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><a name="wow5"></a><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">У</span><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">пражнения</span></h2>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Перед кодированием составьте исправленную BNF-грамматику, чтобы спроектировать, как добавить новую возможность.</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px;">Добавьте в парсер поддержку скобок вокруг выражения. При отсутствии закрывающей скобки парсер должен выдавать какую-либо ошибку.</span></li>
<li style=" color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px;">Добавьте в парсер поддержку чтения чисел с плавающей запятой, таких как </span><span style=" font-size:16px; background-color:#fefefe;">124.17</span><span style=" font-size:18px;">. Для разбора вы можете использовать функцию </span><span style=" font-size:16px; background-color:#fefefe;">double strtod(const char *nptr, char **endptr);</span><span style=" font-size:18px;">, её полезная особенность — остановка разбора на первом недопустимом символе, с занесением адреса символа в </span><span style=" font-size:16px; background-color:#fefefe;">endptr</span><span style=" font-size:18px;"> (подробнее см. документацию).</span></li>
<li style=" color:#000000;" style=" margin-top:0px; margin-bottom:15px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px;">Добавьте в парсер поддержку унарных операторов плюс и минус. Оператор может встретиться перед любым числом, но только в одиночку, т.е. выражения вида </span><span style=" font-size:16px; background-color:#fefefe;">a * -1</span><span style=" font-size:18px;"> допустимы, а выражения вида </span><span style=" font-size:16px; background-color:#fefefe;">a + - - 2</span><span style=" font-size:18px;"> — нет.</span></li></ul>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000;"><br /></p></body></html>