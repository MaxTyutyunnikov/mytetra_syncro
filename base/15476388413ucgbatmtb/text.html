<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">В Dalvik есть сборщик мусора, но это не значит, что можно игнорировать управление памятью. Даже наоборот — нужно быть особенно внимательным при использовании памяти, которая, как известно, на мобильных устройствах ограничена. В этой статье будут рассмотрены инструменты, которые значительно помогают следить за тем, как приложение использует память.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Некоторые проблемы от чрезмерного использования памяти вполне очевидны. Например, в вашем приложении постоянно происходит утечка памяти, когда пользователь прикасается к экрану, тогда это в конечном итоге, возможно, вызовет </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt; font-style:italic;">OutOfMemoryError</span><span style=" font-family:'Sans'; font-size:10pt;">, и произойдет сбой и закрытие приложения. Другие проблемы, более тонкие, чем эта могут приводить к общему спаду производительности приложения и системы в целом (потому что сборщик мусора будет вызываться более часто и на более продолжительное время).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt; font-weight:600;">Инструменты</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Android SDK обеспечивает два основных устройства для профилирования использования памяти приложением: вкладка Allocation Tracker в <a href="http://developer.android.com/guide/developing/tools/ddms.html"><span style=" font-family:'Sans'; font-size:10pt; text-decoration: underline; color:#0000ff;">DDMS</span></a><span style=" font-family:'Sans'; font-size:10pt;"> и дампы кучи (heap dumps). Allocation Tracker может быть полезен в том случае, когда вы хотите узнать об использовании памяти в конкретный период времени, так как он не дает информации о полном состояния кучи, которая выделяется под приложение. За более подробной информацией об Allocation Tracker можно обратиться к статье </span><a href="http://developer.android.com/resources/articles/track-mem.html"><span style=" font-family:'Sans'; font-size:10pt; text-decoration: underline; color:#0000ff;">Tracking Memory Allocations</span></a><span style=" font-family:'Sans'; font-size:10pt;">. Остальная часть этой статьи будет посвящена исследования дампов кучи, так как это более мощный инструмент.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Дамп кучи — это снимок состояния всей кучи приложения, который хранится в бинарном файле, формата HPROF. Dalvik использует формат, который похож на тот, который используется инструментом <a href="http://java.sun.com/developer/technicalArticles/Programming/HPROF.html"><span style=" font-family:'Sans'; font-size:10pt; text-decoration: underline; color:#0000ff;">HPROF</span></a><span style=" font-family:'Sans'; font-size:10pt;"> в Java, но не является точно таким же.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Есть несколько способов создать дамп кучи выполняющегося Android приложения. Первый — использовать кнопку <span style=" font-family:'Sans'; font-size:10pt; font-style:italic;">Dump HPROF file</span><span style=" font-family:'Sans'; font-size:10pt;"> в DDMS. Если вам нужно выбрать момент создания дампа более точно, то можно создать его программно, при помощи метода </span><a href="http://developer.android.com/reference/android/os/Debug.html#dumpHprofData(java.lang.String)"><span style=" font-family:'Sans'; font-size:10pt; text-decoration: underline; color:#0000ff;">android.os.Debug.dumpHprofData()</span></a><span style=" font-family:'Sans'; font-size:10pt;">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Для анализа можно использовать стандартный инструмент <a href="http://download.oracle.com/javase/6/docs/technotes/tools/share/jhat.html"><span style=" font-family:'Sans'; font-size:10pt; text-decoration: underline; color:#0000ff;">jhat</span></a><span style=" font-family:'Sans'; font-size:10pt;"> или</span><a href="http://www.eclipse.org/mat/"><span style=" font-family:'Sans'; font-size:10pt; text-decoration: underline; color:#0000ff;"> Eclipse Memory Analyzer (MAT)</span></a><span style=" font-family:'Sans'; font-size:10pt;">. Однако, сначала нужно конвертировать .hprof файл из Dalvik формата в J2SE HPROF формат. Для этого используется утилита </span><span style=" font-family:'Sans'; font-size:10pt; font-style:italic;">hprof-conv</span><span style=" font-family:'Sans'; font-size:10pt;">, которая поставляется с Android SDK:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	hprof-conv dump.hprof converted-dump.hprof</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt; font-weight:600;">Пример: Отладка утечки памяти</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В Dalvik программист не размещает что-либо явно в свободную память, поэтому могут возникать утечки, как в языках C и C++. Под «утечкой памяти» обычно понимают ситуацию, при которой вы продолжаете ссылаться на объект, который больше не нужен. Иногда, одна единственная ссылка может предотвратить вызов сборщика мусора для удаления большого набора объектов.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Давайте рассмотрим приложение <a href="http://developer.android.com/resources/samples/HoneycombGallery/"><span style=" font-family:'Sans'; font-size:10pt; text-decoration: underline; color:#0000ff;">Honeycomb Gallery sample app</span></a><span style=" font-family:'Sans'; font-size:10pt;"> из Android SDK. Это простая фотогалерея, которая демонстрирует использование неких методов нового API в Honeycomb. Сейчас мы преднамеренно создадим утечку памяти, чтобы затем продемонстрировать метод отладки.</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1547638874zwybt91mbu.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Представим себе, что мы хотим, чтобы приложение получало изображения по сети. Чтобы сделать его более отзывчивым к пользователю, возможно, стоит реализовать кэш для хранения недавно просмотренных изображений. Мы можем это сделать, внеся некоторые изменения в <span style=" font-family:'Sans'; font-size:10pt; font-weight:600;">ContentFragment.java</span><span style=" font-family:'Sans'; font-size:10pt;">. В начале класса объявим и инициализируем новую переменную:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	private static HashMap&lt;String,Bitmap&gt; sBitmapCache = new HashMap&lt;String,Bitmap&gt;();</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В этом отображении мы будем кэшировать загруженные Bitmap'ы. Теперь можно изменить метод <span style=" font-family:'Sans'; font-size:10pt; font-weight:600;">updateContentAndRecycleBitmap()</span><span style=" font-family:'Sans'; font-size:10pt;"> для проверки кэша перед загрузкой и добавления Bitmap'ов в кэш после загрузки:</span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	void updateContentAndRecycleBitmap(int category, int position) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	    if (mCurrentActionMode != null) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	        mCurrentActionMode.finish();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	    }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	 </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	    // Get the bitmap that needs to be drawn and update the ImageView.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	 </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	    // Check if the Bitmap is already in the cache</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	    String bitmapId = &quot;&quot; + category + &quot;.&quot; + position;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	    mBitmap = sBitmapCache.get(bitmapId);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	 </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	    if (mBitmap == null) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	        // It's not in the cache, so load the Bitmap and add it to the cache.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	        // DANGER! We add items to this cache without ever removing any.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	        mBitmap = Directory.getCategory(category).getEntry(position)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	                .getBitmap(getResources());</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	        sBitmapCache.put(bitmapId, mBitmap);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	    }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	    ((ImageView) getView().findViewById(R.id.image)).setImageBitmap(mBitmap);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	}</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Здесь я преднамеренно создал утечку памяти: Bitmap'ы добавляются в кэш, но не удаляются из него. В реальном приложении очевидно, что размер кэша нужно ограничивать.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt; font-weight:600;">Исследование кучи с помощью DDMS</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Dalvik Debug Monitor Server (DDMS) — это один из главных инструментов для отладки в Android. Он является частью плагина <a href="http://developer.android.com/sdk/eclipse-adt.html"><span style=" font-family:'Sans'; font-size:10pt; text-decoration: underline; color:#0000ff;">ADT</span></a><span style=" font-family:'Sans'; font-size:10pt;"> к среде разработки Eclipse, его также можно найти в папке </span><span style=" font-family:'Sans'; font-size:10pt; font-style:italic;">tools/</span><span style=" font-family:'Sans'; font-size:10pt;"> вашего Android SDK. Для более подробной информации можно прочесть </span><a href="http://developer.android.com/guide/developing/debugging/ddms.html"><span style=" font-family:'Sans'; font-size:10pt; text-decoration: underline; color:#0000ff;">Using DDMS</span></a><span style=" font-family:'Sans'; font-size:10pt;">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Давайте используем DDMS для анализа использования кучи нашим приложением. Вы можете запустить DDMS двумя способами:</p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans'; font-size:10pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Из Eclipse: <span style=" font-style:italic;">Window -&gt; Open Perspective -&gt; Other… &gt; DDMS</span></li>
<li style=" font-family:'Sans'; font-size:10pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Из командной строки: запустите <span style=" font-style:italic;">ddms</span> (или ./ddms на Mac/Linux) в папке <span style=" font-style:italic;">tools/</span></li></ul>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1547638895uzjkik964i.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выберите процесс <span style=" font-family:'Sans'; font-size:10pt; font-style:italic;">com.example.android.hcgallery</span><span style=" font-family:'Sans'; font-size:10pt;"> в левой панели и кликните на кнопку </span><span style=" font-family:'Sans'; font-size:10pt; font-style:italic;">Show heap updates</span><span style=" font-family:'Sans'; font-size:10pt;"> на панели инструментов. Затем переключитесь на вкладку </span><span style=" font-family:'Sans'; font-size:10pt; font-style:italic;">VM Heap</span><span style=" font-family:'Sans'; font-size:10pt;"> в DDMS. Вы увидите некоторую базовую информацию об использовании кучи, которая будет обновляться при каждом вызове сборщика мусора. Чтобы увидеть первое обновление, кликните на кнопку </span><span style=" font-family:'Sans'; font-size:10pt; font-style:italic;">Cause GC</span><span style=" font-family:'Sans'; font-size:10pt;">.</span></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image15476389056o4moi89xa.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Можно заметить, что «живые» объекты занимают в памяти чуть меньше 8Мб (см. на колонку <span style=" font-family:'Sans'; font-size:10pt; font-style:italic;">Allocated</span><span style=" font-family:'Sans'; font-size:10pt;"> ). Теперь пролистаем фотографии, и можно будет увидеть, как это число увеличивается. Так как в приложении всего 13 фотографий, то утечка памяти ограничена. В некотором смысле, это наихудший случай, который может получиться, поэтому здесь никогда не будет </span><span style=" font-family:'Sans'; font-size:10pt; font-style:italic;">OutOfMemoryError</span><span style=" font-family:'Sans'; font-size:10pt;">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt; font-weight:600;">Создание дампа кучи</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Кликните по кнопке <span style=" font-family:'Sans'; font-size:10pt; font-style:italic;">Dump HPROF file</span><span style=" font-family:'Sans'; font-size:10pt;"> в панели инструментов DDMS, выберите место сохранения файла, и сконвертируйте его, используя утилиту </span><span style=" font-family:'Sans'; font-size:10pt; font-style:italic;">hprof-conv</span><span style=" font-family:'Sans'; font-size:10pt;">. В этом примере, мы будем использовать отдельную версию MAT (1.0.1), её можно скачать </span><a href="http://www.eclipse.org/mat/downloads.php"><span style=" font-family:'Sans'; font-size:10pt; text-decoration: underline; color:#0000ff;">здесь</span></a><span style=" font-family:'Sans'; font-size:10pt;">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если вы используете Eclipse, с установленным MAT, то после нажатия на кнопку «dump HPROF», файл автоматически конвертируется и откроется в окне Ecilpse.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt; font-weight:600;">Анализ дампа кучи при помощи MAT</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Запустите MAT и загрузите HPROF-файл, который был только что создан. MAT — мощная утилита, и разъяснение всех её особенностей вне этого топика, поэтому я объясню только один из методов как можно определить утечку — при помощи вида «Гистограмма» (Histogram view). В этом виде можно увидеть список классов, отсортированных по числу экземпляров, shallow heap (общий размер памяти, занимаемый экземплярами), или retained heap (общая память, занимаемая экземплярами и объектами, на которые они ссылаются).</p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1547638917jncdbn18zr.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Если отсортировать по <span style=" font-family:'Sans'; font-size:10pt; font-style:italic;">shallow heap</span><span style=" font-family:'Sans'; font-size:10pt;">, то можно увидеть, что вверху окажется число экземпляров byte[]. В Android 3.0 Bitmap'ы представляются в виде массивов из байтов, размер которых зависит от размера Bitmap'a. То есть понятно, что они представляют память, которая занимается нашими Bitmap'ами. Щелкните правой кнопкой на классе byte[] и выберите List Objects &gt; with incoming references. Вы увидите список всех массивов из байтов, размещенных в куче.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Выберите один из больших объектов и раскройте его. В итоге вы увидите всю цепочку ссылок, которая образуется из-за этого объекта. Вот он — наш кэш для Bitmap'ов!</p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1547638939mf4clwkaxy.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">MAT не может дать точную информацию является ли это утечкой, так как он не знает, нужны ли эти объекты. Ответ знает только программист. В нашем случае, кэш очень большой, сравнительно со всем приложением, поэтому логично было бы ограничить его размер.</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt; font-weight:600;">Сравнение дампов кучи с помощью MAT</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">При отладке утечек памяти, бывает полезно сравнить состояние кучи в разные моменты времени. Чтобы сделать это, создайте два HPROF файла (не забывайте их конвертировать утилитой <span style=" font-family:'Sans'; font-size:10pt; font-style:italic;">hprof-conv</span><span style=" font-family:'Sans'; font-size:10pt;">).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вот как вы можете сравнить эти два файла:</p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans'; font-size:10pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Откройте первый файл (<span style=" font-style:italic;">File &gt; Open Heap Dump</span>).</li>
<li style=" font-family:'Sans'; font-size:10pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Откройте гистограммный вид.</li>
<li style=" font-family:'Sans'; font-size:10pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В виде истории навигации (Window &gt; Navigation History), щелкните правой кнопкой на <span style=" font-style:italic;">histogram</span> и выберите <span style=" font-style:italic;">Add to Compare Basket</span>.</li>
<li style=" font-family:'Sans'; font-size:10pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Откройте второй файл и повторите шаги 2 и 3.</li>
<li style=" font-family:'Sans'; font-size:10pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Переключитесь в вид Compare Basket, и кликните <span style=" font-style:italic;">Compare the Results</span> (красная иконка восклицательного знака в правом верхнем углу)</li></ol>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt; font-weight:600;">Заключение</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">В этой статье я показал как Allocation Tracker и дамп кучи могут помочь вам в анализе использования памяти. Я также показал, как MAT помогает отследить утечки памяти в приложении.</p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans'; font-size:10pt;"><br /></p></body></html>