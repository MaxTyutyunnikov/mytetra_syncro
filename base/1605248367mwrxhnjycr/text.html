<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt; font-weight:600;">Осуществляем мониторинг параметров компьютера путем организации беспроводного соединения с мобильным телефоном.</span><span style=" font-family:'Sans'; font-size:10pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Для чего это нужно? </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Sans'; font-size:10pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вы сможете работать с компьютером с посредством дополнительного небольшого экрана. </li>
<li style=" font-family:'Sans'; font-size:10pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вы сможете наблюдать за процессами, исполняющимися на вашем компьютере. </li>
<li style=" font-family:'Sans'; font-size:10pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вы научитесь использовать последовательные порты в качестве простого механизма для взаимодействия систем. </li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Bluetooth-адаптеры установлены практически во всех смартфонах, в большинстве ноутбуков и в некоторых настольных компьютерах, но при этом они редко используются для чего-либо, кроме отправки аудиопотока на беспроводные наушники или колонки. И это очень огорчает, ведь данная технология является достаточно функциональной для передачи любых данных между любыми устройствами и предоставляет неограниченные возможности для создания различных программных продуктов. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">В данном руководстве я попытаюсь рассмотреть методику использования стандартных инструментов из состава Linux для передачи информации о состоянии вашего компьютера в реальном времени на ваш мобильный телефон, который будет выступать в качестве дополнительного мобильного экрана для мониторинга состояния вашего компьютера. Мы будем использовать для этой цели протокол Bluetooth, позволяющий создать виртуальный последовательный порт для обмена данными между мобильным телефоном и компьютером, работающим под управлением Linux. Последовательные порты гармонично сочетаются с парадигмой Unix, в соответствии с которой &quot;все является файлом&quot;, ведь они представлены файлами в директории </span><span style=" font-family:'monospace'; font-size:10pt;">/dev</span><span style=" font-family:'Sans'; font-size:10pt;">, причем вы можете как записывать в них данные (для передачи информации), так и читать данные из них (для приема информации). Благодаря подобной особенности вы можете использовать обычные инструменты с интерфейсом командной строки для организации процесса обмена данными между устройствами. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Перед тем, как приступить к работе, нам придется установить и настроить необходимое программное обеспечение. В первую очередь следует найти приложение для работы с Bluetooth для вашего Android-телефона. На данный момент доступно несколько подобных приложений. Лучшим из них является приложение с открытым исходным кодом Bluetooth Terminal, которое доступно из F-Droid по адресу </span><a href="https://f-droid.org/repository/browse/?fdid=ru.sash0k.bluetooth_terminal"><span style=" font-family:'Sans'; font-size:10pt; text-decoration: underline; color:#0000ff;">https://f-droid.org/repository/browse/?fdid=ru.sash0k.bluetooth_terminal</span></a><span style=" font-family:'Sans'; font-size:10pt;">. Если вы предпочитаете использовать магазин приложений Google Play, вы можете установить приложение BlueTerm от разработчика pymasde.es.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans'; font-size:10pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1605248446sxcju97t7z.png" /><span style=" font-family:'Sans'; font-size:10pt;"> </span></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans'; font-size:10pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt; font-weight:600;">Сопряжение устройств в терминологии Bluetooth - это процесс согласования работы двух устройств путем установки соединения между ними. Оно должно осуществляться однократно для каждой комбинации устройств.</span><span style=" font-family:'Sans'; font-size:10pt;"> </span></p>
<h2 style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt; font-weight:600;">Установка программного обеспечения в Linux </span></h2>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">На стороне компьютера, работающего под управлением Linux, также понадобится дополнительное программное обеспечение, которое, впрочем, может быть уже установлено. В список данного программного обеспечения должно входить как приложение для организации соединения между мобильным телефоном и компьютером, так и программное обеспечение для передачи данных через последовательный порт. Для организации соединения между двумя машинами (или сопряжения в терминологии Bluetooth) вы можете воспользоваться приложением с графическим интерфейсом из состава окружения вашего рабочего стола. В GNOME данное приложение носит имя Gnome Bluetooth Manager, в KDE — Blue Devil, а в Unity — элемент Bluetooth панели параметров системы Ubuntu. Процесс сопряжения устройств в случае использования каждого из упомянутых приложений осуществляется аналогичным образом. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">В первую очередь вам придется убедиться в том, что в вашем мобильном телефоне активирована поддержка Bluetooth и название телефона присутствует в списке устройств. Для ее активации достаточно перейти на страницу Bluetooth приложения для изменения настроек (для того, чтобы мобильный телефон обнаруживался другими устройствами, следует держать эту страницу открытой). После открытия соответствующей страницы и активации поддержки Bluetooth на уровне мобильного телефона следует открыть окно приложения для работы с устройствами Bluetooth на компьютере, работающем под управлением Linux, убедиться в том, что поддержка Bluetooth активирована, после чего выбрать название мобильного телефона из списка и воспользоваться соответствующим переключателем для установления соединения. В результате будет инициирован процесс сопряжения вашего мобильного телефона с компьютером. Вам останется лишь четко следовать выводимым приложением инструкциям для корректного завершения процесса сопряжения. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">По сути, процесс сопряжения является процессом установления соединения общего назначения между двумя устройствами, которое, в свою очередь, может использоваться для установления специализированных соединений для передачи аудиопотоков, отправки файлов или потоков данных. Для того, чтобы получить возможность передачи произвольных данных нам придется создать соединение по виртуальному последовательному порту. Процесс его создания может быть разделен на два этапа, причем на первом этапе нам придется создать виртуальный последовательный порт на уровне компьютера, а на втором — соединить этот порт с мобильным телефоном. Для этого нам придется воспользоваться утилитой rfcomm, которая может уже присутствовать в вашей системе, но если это не так, вы всегда можете установить ее с помощью менеджера пакетов программного обеспечения вашего дистрибутива (в системах, основанных на Debian она находится в пакете </span><span style=" font-family:'monospace'; font-size:10pt;">bluez</span><span style=" font-family:'Sans'; font-size:10pt;">). </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Из-за определенных недоработок утилита </span><span style=" font-family:'monospace'; font-size:10pt;">rfcomm</span><span style=" font-family:'Sans'; font-size:10pt;"> может корректно работать лишь в случае запуска от лица пользователя root, поэтому нам придется выполнять большое количество команд от лица этого пользователя. Команда для создания нового виртуального последовательного порта для Bluetooth-адаптера выглядит следующим образом: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">sudo rfcomm listen 0 </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Теперь ваш компьютер будет принимать соединения, поэтому вам придется лишь соединиться с ним с помощью мобильного телефона, выбрав доступное соединение (это не должно быть связано с какими-либо сложностями, ведь устройства уже сопряжены). По сути, вам придется открыть приложение Bluetooth-терминала на мобильном телефоне и выбрать элемент, соответствующий компьютеру, из списка на странице параметров соединений. В результате на стороне вашего компьютера будет создан файл устройства </span><span style=" font-family:'monospace'; font-size:10pt;">/dev/rfcomm0</span><span style=" font-family:'Sans'; font-size:10pt;"> (вы можете создать более одного виртуального последовательного Bluetooth-порта, увеличивая значение числового аргумента утилиты </span><span style=" font-family:'monospace'; font-size:10pt;">rfcomm</span><span style=" font-family:'Sans'; font-size:10pt;">, в результате чего будут создаваться файлы устройств </span><span style=" font-family:'monospace'; font-size:10pt;">/dev/rfcomm1</span><span style=" font-family:'Sans'; font-size:10pt;">, </span><span style=" font-family:'monospace'; font-size:10pt;">/dev/rfcomm2</span><span style=" font-family:'Sans'; font-size:10pt;"> и так далее). </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Любая информация, которую вы запишите в этот файл устройства, будет передаваться в Bluetooth-терминал на мобильном телефоне, поэтому вы можете прямо сейчас протестировать соединение с помощью следующей команды: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">sudo bash -c 'echo &quot;hello world&quot; &gt; /dev/rfcomm0' </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Команда </span><span style=" font-family:'monospace'; font-size:10pt;">echo</span><span style=" font-family:'Sans'; font-size:10pt;"> выводит текст &quot;hello world&quot;, причем символ &quot;больше&quot; сообщает командной оболочке о том, что вместо вывода следует отправить его в файл устройства </span><span style=" font-family:'monospace'; font-size:10pt;">/dev/rfcomm0</span><span style=" font-family:'Sans'; font-size:10pt;"> (соответствующий нашему последовательному соединению). Данная команда является немного более запутанной, чем обычная команда </span><span style=" font-family:'monospace'; font-size:10pt;">sudo</span><span style=" font-family:'Sans'; font-size:10pt;">, так как нам нужно осуществлять перенаправление вывода утилиты от лица пользователя root. Если бы мы выполнили данную команду, использовав лишь префикс </span><span style=" font-family:'monospace'; font-size:10pt;">sudo</span><span style=" font-family:'Sans'; font-size:10pt;">, она бы просто не сработала: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">sudo echo &quot;hello world&quot; &gt; /dev/rfcomm0 </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">В данном случае команда echo исполняется от лица пользователя </span><span style=" font-family:'monospace'; font-size:10pt;">root</span><span style=" font-family:'Sans'; font-size:10pt;">, но перенаправление вывода (</span><span style=" font-family:'monospace'; font-size:10pt;">&gt; /dev/rfcomm0</span><span style=" font-family:'Sans'; font-size:10pt;">) осуществляется от лица обычного пользователя. Вместо этого мы используем команду </span><span style=" font-family:'monospace'; font-size:10pt;">sudo</span><span style=" font-family:'Sans'; font-size:10pt;"> для запуска новой сессии командной оболочки Bash от лица пользователя root, после чего осуществляем вызов утилиты </span><span style=" font-family:'monospace'; font-size:10pt;">echo</span><span style=" font-family:'Sans'; font-size:10pt;"> и перенаправление ее вывода в рамках этой сессии. В первом варианте команды мы используем команду </span><span style=" font-family:'monospace'; font-size:10pt;">bash -c</span><span style=" font-family:'Sans'; font-size:10pt;"> для открытия новой сессии командной оболочки. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Существует и более простое решение данной проблемы: утилита </span><span style=" font-family:'monospace'; font-size:10pt;">tee</span><span style=" font-family:'Sans'; font-size:10pt;">. Эта утилита принимает данные с помощью стандартного потока ввода и выполняет две операции. Во-первых, она записывает полученные данные в файл, а во-вторых, передает их же в стандартный поток вывода. Так как файл создается и заполняется силами самой утилиты, мы можем использовать лишь команду </span><span style=" font-family:'monospace'; font-size:10pt;">sudo</span><span style=" font-family:'Sans'; font-size:10pt;"> для ее запуска от лица пользователя root. Таким образом, приведенная выше команда может быть приведена к следующей форме: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">echo &quot;hello world&quot; | sudo tee /dev/rfcomm0 </span></p>
<h2 style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt; font-weight:600;">Превращение компьютера в Bluetooth-колонку </span></h2>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Да, использование компьютера в качестве Bluetooth-колонки является не самым оптимальным решением в финансовом плане, но бывают случаи, когда это может оказаться полезным. Возможно, у вас установлен медиа-центр и вы хотите проигрывать с помощью него музыку с вашего мобильного телефона. Возможно, вам просто нужно в текущий момент проиграть музыку через колонки вашего компьютера. Вне зависимости от причины, методика проигрывания музыки является довольно простой. В первую очередь вам придется провести сопряжение мобильного телефона и компьютера таким образом, как описано выше. После окончания процесса сопряжения вам придется сообщить компьютеру о том, что соединение будет использоваться для передачи аудиоданных. В приложении с графическим интерфейсом для управления устройствами Bluetooth под названием Blueman для этого достаточно выбрать соединение, воспользоваться правой кнопкой мыши и выбрать из открывшегося контекстного меню пункт </span><span style=" font-family:'monospace'; font-size:10pt;">&quot;Audio Source&quot;</span><span style=" font-family:'Sans'; font-size:10pt;">. После этого аудиопоток с мобильного телефона будет проигрываться на компьютере. </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans'; font-size:10pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1605248262vkta6ykp6l.png" /><span style=" font-family:'Sans'; font-size:10pt;"> </span></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans'; font-size:10pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt; font-weight:600;">Blueman является небольшим приложением для работы с устройствами Bluetooth, более функциональным, чем диалог настроек устройств Bluetooth окружения рабочего стола Unity, поэтому оно может пригодиться пользователям дистрибутива Ubuntu, которым нужно осуществлять передачу аудиопотоков или файлов между устройствами.</span><span style=" font-family:'Sans'; font-size:10pt;"> </span></p>
<h2 style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt; font-weight:600;">Интерактивный вариант </span></h2>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Так как команда tee перенаправляет переданные в ее стандартный поток ввода данные как в свой стандартный поток вывода, так и в файл, вы должны увидеть строку &quot;hello world&quot; как в терминале Linux, так и в Blutooth-терминале на мобильном телефоне. Это первый вариант механизма мониторинга состояния компьютера с помощью мобильного телефона. Он может оказаться полезным в том случае, если вы запустите долго исполняющуюся команду и захотите покинуть рабочее место до момента окончания ее исполнения. Вам придется лишь перенаправить стандартный поток вывода данной команды с помощью программного канала в стандартный поток ввода команды </span><span style=" font-family:'monospace'; font-size:10pt;">sudo tee /dev/rfcomm0</span><span style=" font-family:'Sans'; font-size:10pt;">, после чего вы сможете покинуть свое рабочее место и наблюдать за исполнением команды с помощью Bluetooth-терминала, установленного на вашем мобильном телефоне. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Но данный подход имеет один серьезный недостаток: в том случае, если команда не выводит каких-либо данных, вы не сможете отследить момент окончания ее исполнения. Вы можете исправить его выполнив сразу же после этой команды еще одну команду, воспользовавшись точкой с запятой. Например, следующая составная команда позволяет обновить систему Debian (с отправкой вывода как в терминал, так и на мобильный телефон) и вывести слово &quot;finished&quot; после окончания процесса обновления: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">sudo apt-get upgrade | sudo tee /dev/rfcomm0 ; echo &quot;finished&quot; | sudo tee /dev/rfcomm0 </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">До текущего момента мы использовали наш виртуальный последовательный порт Bluetooth лишь в качестве канала для отправки данных, но не получали каких-либо данных из него. Если вы разберетесь с функциями приложения, установленного на мобильном телефоне, вы обнаружите, что оно позволяет отправлять текстовые строки, но все отправляемые таким образом данные все равно будут потеряны из-за особенностей методики работы с соединением, используемой нами до данного момента (приведенные выше команды позволяют осуществлять запись данных в файл устройства, но не их чтение). </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Простейший способ чтения отправленных данных заключается в использовании утилиты </span><span style=" font-family:'monospace'; font-size:10pt;">tail</span><span style=" font-family:'Sans'; font-size:10pt;">. Она предназначена для вывода последних строк из файла, но в случае использования флага </span><span style=" font-family:'monospace'; font-size:10pt;">-f</span><span style=" font-family:'Sans'; font-size:10pt;"> (follow — следовать), она будет постоянно отслеживать содержимое файла и выводить все строки, которые были дописаны в конец этого файла. Обычно данная утилита используется для мониторинга операций добавления строк в файлы журналов, но она вполне подойдет и для наших целей. Так как нам нужно выводить содержимое всего файла, а не его последние строки, нам также придется использовать аргумент </span><span style=" font-family:'monospace'; font-size:10pt;">-n + 1</span><span style=" font-family:'Sans'; font-size:10pt;">, сообщающий утилите </span><span style=" font-family:'monospace'; font-size:10pt;">tail</span><span style=" font-family:'Sans'; font-size:10pt;"> о том, что следует выводить все строки файла начиная с первой. Команда для приема текстовых сообщений, отправляемых с мобильного телефона на компьютер, будет выглядеть следующим образом: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">sudo tail -fn +1 /dev/rfcomm0 </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Сама по себе эта команда является не особо полезной, так как она позволяет нам лишь принимать на компьютере текст, отправленный с мобильного телефона. В принципе, вы можете создать примитивную систему обмена сообщениями, используя команду </span><span style=" font-family:'monospace'; font-size:10pt;">echo</span><span style=" font-family:'Sans'; font-size:10pt;"> для отправки сообщений и команду </span><span style=" font-family:'monospace'; font-size:10pt;">tail</span><span style=" font-family:'Sans'; font-size:10pt;"> для их приема, но это тоже не самый удобный вариант. </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans'; font-size:10pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1605248262l4dghqwo4o.png" /><span style=" font-family:'Sans'; font-size:10pt;"> </span></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans'; font-size:10pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt; font-weight:600;">Нескольких строк кода сценария командной оболочки Bash вполне достаточно для отправки диагностической информации на ваш мобильный телефон.</span><span style=" font-family:'Sans'; font-size:10pt;"> </span></p>
<h2 style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt; font-weight:600;">Полезные программные каналы </span></h2>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">К счастью, мы можем не ограничиваться выводом текста на экран. Вместо этого мы можем передавать текстовые данные другим командам. Простейший способ реализации подобного механизма заключается в чтении данных из файла устройства </span><span style=" font-family:'monospace'; font-size:10pt;">/dev/rfcomm0</span><span style=" font-family:'Sans'; font-size:10pt;">, обработке их средствами командной оболочки Bash и записи результирующих данных в этот же файл устройства. Для этой цели может использоваться следующий сценарий: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">while read -r line &lt; /dev/rfcomm0; do</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	$line &gt; /dev/rfcomm0</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">done </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">В нем используется команда </span><span style=" font-family:'monospace'; font-size:10pt;">read</span><span style=" font-family:'Sans'; font-size:10pt;"> для последовательного чтения строк из файла устройства виртуального последовательного порта. В первой строке открывается цикл </span><span style=" font-family:'monospace'; font-size:10pt;">while</span><span style=" font-family:'Sans'; font-size:10pt;">, который продолжает работу до момента отправки символа окончания файла, а так как этот символ не возвращается при чтении данных из файла устройства виртуального последовательного порта (да, при чтении данных из таких файлов никогда не возвращается символ окончания файла, так как при отсутствии данных операция чтения попросту блокируется), данный цикл будет работать до момента закрытия виртуального последовательного порта. Во второй строке осуществляется обработка прочитанной текстовой строки средствами командной оболочки и запись этой строки в файл устройства виртуального последовательного порта. Если вы сохраните данный код в файле с именем </span><span style=" font-family:'monospace'; font-size:10pt;">serialterm.sh</span><span style=" font-family:'Sans'; font-size:10pt;">, вы сможете запустить данный сценарий следующим образом: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">sudo bash -c &quot;bash serialterm.sh 2&gt; /dev/rfcomm0&quot; </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Последняя часть команды (</span><span style=" font-family:'monospace'; font-size:10pt;">2&gt; /dev/rfcomm0</span><span style=" font-family:'Sans'; font-size:10pt;">) необходима для перенаправления стандартного потока ошибок создаваемого процесса командной оболочки в устройство виртуального последовательного порта. Следует использовать этот сценарий с особой осмотрительностью, так как он позволяет использовать командную оболочку, запущенную от имени пользователя root, на вашем мобильном телефоне (хотя доступ к ней и ограничен областью действия адаптеров Bluetooth). </span></p>
<h2 style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt; font-weight:600;">Краткая история протокола Bluetooth </span></h2>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Протокол Bluetooth описан в рамках множества спецификаций, созданных специальной группой по разработке протокола Bluetooth (Bluetooth Special Interest Group или Blutooth SIG). Эта специальная группа была сформирована 20 мая 1998 года и по сей день продолжает работу над протоколом по мере развития технологий, так как изменение технологического ландшафта требует своевременной модификации спецификаций протокола. В последнюю версию протокола (Bluetooth 4) была включена новая спецификация для устройств с низким энергопотреблением, использующих аккумуляторы малой емкости, причем сама версия протокола разрабатывалась с учетом особенностей концепции &quot;интернета вещей&quot;. Кроме того, существует версия протокола для устройств, для которых скорость передачи данных важнее, чем энергопотребление (высокоскоростная версия Bluetooth), позволяющая передавать данные на скорости до 24 Мб/с. Описанные нововведения позволяют сохранять актуальность протокола, несмотря на его более чем 15-летний возраст. </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans'; font-size:10pt;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1605248262mlv5glg8s8.png" /><span style=" font-family:'Sans'; font-size:10pt;"> </span></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans'; font-size:10pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt; font-weight:600;">Некоторые приложения для мобильных телефонов, реализующие терминалы для последовательных соединений по протоколу Bluetooth, ожидают строки с окончаниями в стиле Windows и могут осуществлять не совсем корректное форматирование вывода в случае приема строк с окончаниями в стиле Linux. Тем не менее, это обстоятельство никоим образом не влияет на содержимое принимаемых строк.</span><span style=" font-family:'Sans'; font-size:10pt;"> </span></p>
<h2 style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt; font-weight:600;">ObexFTP: передача файлов в обоих направлениях </span></h2>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Простейший способ отправки файлов через Bluetooth заключается в использовании протокола ObexFTP. Возможно, вам придется установить дополнительное программное обеспечение для того, чтобы воспользоваться данным протоколом. На вашем мобильном телефоне должно быть установлено приложение, работающее с этим протоколом, причем в магазине приложений Google Play несложно найти сразу несколько таких приложений. Мы использовали приложение под названием Bluetooth File Transfer, но другие аналогичные приложения также должны отлично работать. На вашей машине, работающей под управлением Linux, также должно присутствовать приложение, способное осуществлять взаимодействие с приложением на стороне мобильного телефона. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Большинство приложений с графическим интерфейсом для работы с Bluetooth позволяет передавать файлы, но в некоторых случаях вам может потребоваться интегрировать механизм передачи файлов в собственные сценарии командной оболочки. Например, вы можете создать сценарий командной оболочки, который будет исполняться в определенное время раз в день (когда вы находитесь на рабочем месте) и создавать резервную копию файлов с вашего мобильного телефона. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">В репозиториях программного обеспечения большинства дистрибутивов Linux присутствует утилита с интерфейсом командной строки с именем ObexFTP. Вы можете использовать ее для получения списка всех файлов на вашем мобильном телефоне на стороне компьютера с помощью следующей команды: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">obexftp -b -l </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Список файлов будет представлен в не самом очевидном формате XML, но вы в любом случае без труда сможете найти их имена. А это команда для загрузки отдельного файла: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">obexftp -c &lt;директория&gt; -g &lt;файл&gt; </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">На веб-сайте проекта, по адресу </span><a href="http://dev.zuckschwerdt.org/openobex/wiki/ObexFtp"><span style=" font-family:'Sans'; font-size:10pt; text-decoration: underline; color:#0000ff;">http://dev.zuckschwerdt.org/openobex/wiki/ObexFtp</span></a><span style=" font-family:'Sans'; font-size:10pt;">, присутствуют примеры кода, а также сложных команд на основе данной утилиты. </span></p>
<h2 style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt; font-weight:600;">Взаимодействие с утилитой top </span></h2>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Одним из полезных применений соединения, организованного посредством виртуального последовательного порта по протоколу Bluetooth, является мониторинг нагрузки на центральный процессор компьютера при отсутствии возможности получения аналогичной информации посредством экрана монитора компьютера. Такая ситуация может возникнуть, к примеру, при использовании полноэкранных приложений с графическим интерфейсом. Вы можете просто перенаправить вывод утилиты </span><span style=" font-family:'monospace'; font-size:10pt;">top</span><span style=" font-family:'Sans'; font-size:10pt;"> в связанный с мобильным телефоном файл устройства виртуального последовательного порта, но из-за различий в размерах экранов устройств чтение вывода утилиты </span><span style=" font-family:'monospace'; font-size:10pt;">top</span><span style=" font-family:'Sans'; font-size:10pt;"> на экране мобильного телефона будет затруднено. Вместо этого мы самостоятельно создадим упрощенный аналог утилиты </span><span style=" font-family:'monospace'; font-size:10pt;">top</span><span style=" font-family:'Sans'; font-size:10pt;">, который будет выводить лишь информацию о нагрузке на центральный процессор компьютера, а также имя процесса, который наиболее интенсивно использует его ресурсы. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Для реализации аналога утилиты </span><span style=" font-family:'monospace'; font-size:10pt;">top</span><span style=" font-family:'Sans'; font-size:10pt;"> мы будем использовать утилиту </span><span style=" font-family:'monospace'; font-size:10pt;">mpstat</span><span style=" font-family:'Sans'; font-size:10pt;">, которая выводит информацию о нагрузке на центральный процессор, а также утилиту </span><span style=" font-family:'monospace'; font-size:10pt;">ps</span><span style=" font-family:'Sans'; font-size:10pt;">, которая выводит информацию о процессах, наиболее интенсивно использующих центральный процессор. Сценарий выглядит следующим образом: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">while true; do</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	echo -n &quot;% cpu: &quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	bc &lt;&lt;&lt; &quot;100 - $(mpstat 2 1 | grep 'Average:' | cut -c 92-)&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	echo &quot;top process: &quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">	ps -eo pcpu,args | sort -g -k 1 -r | head -1</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">done </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Утилита </span><span style=" font-family:'monospace'; font-size:10pt;">grep</span><span style=" font-family:'Sans'; font-size:10pt;"> в третьей строке используется для извлечения единственной строки, содержащей информацию о средней нагрузке на центральный процессор, из вывода утилиты </span><span style=" font-family:'monospace'; font-size:10pt;">mpstat</span><span style=" font-family:'Sans'; font-size:10pt;">, после чего утилита </span><span style=" font-family:'monospace'; font-size:10pt;">cut</span><span style=" font-family:'Sans'; font-size:10pt;"> используется для непосредственного извлечения процентных показателей времени бездействия центрального процессора. Утилита </span><span style=" font-family:'monospace'; font-size:10pt;">bc</span><span style=" font-family:'Sans'; font-size:10pt;"> по своей сути является простейшим калькулятором, с помощью которого мы вычитаем полученный процентный показатель бездействия центрального процессора из 100 процентов, вычисляя таким образом процентный показатель нагрузки на центральный процессор. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Выводимая утилитой </span><span style=" font-family:'monospace'; font-size:10pt;">ps</span><span style=" font-family:'Sans'; font-size:10pt;"> информация о нагрузке на центральный процессор, создаваемой отдельными процессами, передается с помощью программного канала сначала на вход утилиты </span><span style=" font-family:'monospace'; font-size:10pt;">sort</span><span style=" font-family:'Sans'; font-size:10pt;"> (флаг </span><span style=" font-family:'monospace'; font-size:10pt;">-g</span><span style=" font-family:'Sans'; font-size:10pt;"> позволяет осуществлять сортировку по числовым значениям), а затем — на вход утилиты </span><span style=" font-family:'monospace'; font-size:10pt;">head</span><span style=" font-family:'Sans'; font-size:10pt;"> для получения первой строки с информацией о процессе, наиболее интенсивно использующем ресурсы центрального процессора. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Существует небольшое различие между информацией, выводимой обоими упомянутыми утилитами. </span><span style=" font-family:'monospace'; font-size:10pt;">mpstat</span><span style=" font-family:'Sans'; font-size:10pt;"> периодически рассчитывает нагрузку на центральный процессор через непродолжительные промежутки времени (в нашем случае длительностью в 2 секунды), в то время, как утилита </span><span style=" font-family:'monospace'; font-size:10pt;">ps</span><span style=" font-family:'Sans'; font-size:10pt;"> рассчитывает среднюю нагрузку на центральный процессор в течение времени жизни процесса. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Для передачи описанных данных на ваш мобильный телефон вы можете перенаправить стандартный поток вывода сценария в файл устройства виртуального последовательного порта таким же образом, как это делалось ранее. Если вы сохраните сценарий под именем </span><span style=" font-family:'monospace'; font-size:10pt;">serialtop.sh</span><span style=" font-family:'Sans'; font-size:10pt;">, команда будет выглядеть следующим образом: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:10pt;">sudo bash -c &quot;bash serialtop.sh &gt; /dev/rfcomm0&quot; </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">После выполнения этой команды все выводимые сценарием данные будут передаваться непосредственно на ваш мобильный телефон и вы сможете следить за нагрузкой на центральный процессор вашего компьютера даже в том случае, если экран его монитора будет занят окнами других программ. </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans'; font-size:10pt;"><br /></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1605248262an83dfhxko.png" /><span style=" font-family:'Sans'; font-size:10pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt; font-weight:600;">Для большинства современных языков программирования, включая Python, имеются библиотеки, позволяющие работать с последовательными соединениями и полностью контролировать процесс передачи данных через эти соединения.</span><span style=" font-family:'Sans'; font-size:10pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Разумеется, в статье описано лишь несколько примеров использования последовательных соединений по протоколу Bluetooth, установленных между мобильным телефоном и компьютером. Если вы желаете развить данную идею, вы можете проработать вопрос организации последовательного соединения средствами вашего собственного приложения для мобильного телефона, которое будет принимать данные в определенном формате и обрабатывать их в соответствии со вашими предпочтениями. Например, вы вы можете просто принимать информацию от финального варианта нашего сценария и отображать ее в форме спидометра, указывающего, насколько быстро работает ваш компьютер в текущий момент. Последовательные соединения являются чрезвычайно гибкими и могут использоваться для различных целей, но в то же время, с ними достаточно просто работать, в чем вы могли самостоятельно убедиться. </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans'; font-size:10pt;"><br /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Sans'; font-size:10pt;">Ben Everard, 19 сентября 2016 г. <br />А.Панин, 14 ноября 2016 г. </span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans'; font-size:10pt;"><br /></p></body></html>