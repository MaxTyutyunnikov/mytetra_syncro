<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Драйвер видеокарты состоит из четырёх основных компонент:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">Kernel driver - nvidia.ko <br />X11 driver    - nvidia_drv.so <br />GLX Server    - libglx.so <br />GLX Client    - libGL.so.1 </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Как можно видеть, собственно сам драйвер поделён на две части (<span style=" font-family:'FreeMono'; color:#6a1009;">nvidia.ko</span> и <span style=" font-family:'FreeMono'; color:#6a1009;">nvidia_drv.ko</span>), и OpenGL поделён на две части (<span style=" font-family:'FreeMono'; color:#6a1009;">libglx.ko</span> и <span style=" font-family:'FreeMono'; color:#6a1009;">libGL.ko</span>).</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Другое объяснение:</span> это всё один драйвер, есть ядерная часть и части в юзерспейс. Библиотека OpenGL - это неотъемлемая часть драйвера - она в рантайме генерирует команды для конкретного GPU. Все четыре файла - это собственно драйвер и есть. Три части в юзерспейс (<span style=" font-family:'FreeMono'; color:#6a1009;">X11 driver</span>, <span style=" font-family:'FreeMono'; color:#6a1009;">GLX Server</span>, <span style=" font-family:'FreeMono'; color:#6a1009;">GLX Client</span>) - это реализации разных API.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans';">В случае, когда все эти части находятся на своих местах, всё работает прекрасно. Если же какая-то часть отсутствует - будут наблюдаться интересные эффекты. Например команда </span><span style=" font-family:'FreeMono'; color:#6a1009;">glxinfo</span><span style=" font-family:'DejaVu LGC Sans';"> может сообщать, что часть OpenGL у нас от Месы, а часть glx - от NVIDIA. Или иксы запускаются с драйвером </span><span style=" font-family:'FreeMono'; color:#6a1009;">nvidia_drv.so</span><span style=" font-family:'DejaVu LGC Sans';">, и даже изображение на экран выводится - вот только </span><span style=" font-family:'FreeMono'; color:#6a1009;">nvidia-settings</span><span style=" font-family:'DejaVu LGC Sans';"> показывает, что драйвер не работает, потому что </span><span style=" font-family:'FreeMono'; color:#6a1009;">nvidia.ko</span><span style=" font-family:'DejaVu LGC Sans';"> отсутствует. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans';">В 2022 году NVidia открыла под OpenSource-лицензией первый компонент из этих четырёх. И это прекрасно. Теперь будет значительно проще пользоваться Legacy-версиями драйверов на новых системах! А когда откроют вторую, можно будет забыть и про ключик IgnoreABI при выходе новой версии &quot;иксов&quot;. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans';">Кроме того, на Wayland вроде как используется KMS, а значит, нету разделения драйвера на две части. Похоже что на Wayland можно будет не ждать, когда в драйвер добавят поддержку нового ABI. Хм, в теории и на иксах можно будет заменить </span><span style=" font-family:'FreeMono'; color:#6a1009;">nvidia_drv.so</span><span style=" font-family:'DejaVu LGC Sans';"> на </span><span style=" font-family:'FreeMono'; color:#6a1009;">modesetting_drv.so</span><span style=" font-family:'DejaVu LGC Sans';">. На Интеле уже пробовали, однако я не знаю, что из этого получилось.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans';">У AMD примерно так же было изначально. Постепенно открытый драйвер в MESA стал настолько хорош что про проприетарный юзермод все как-то позабыли. А он зачем, если MESA даже быстрее и менее глючная? А основой открытого модуля ядра </span><span style=" font-family:'FreeMono'; color:#6a1009;">amdgpu</span><span style=" font-family:'DejaVu LGC Sans';"> стал реверснутый Radeon, что забавно. Прикольно когда производитель окультуривает реверс до продукта, используя свои &quot;внутренние&quot; обозначения регистров и проч. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'DejaVu LGC Sans';">Основной затык MESA+Nouveau в том что оно для актуальных чипов не умело реклок (переключение частоты ядра). Так то оно неплохое, реализует все фичи</span> OpenGL <span style=" font-family:'DejaVu LGC Sans';">и прочих. Но работа на 20% скорости (или сколько там по дефолту бутовая скорость GPU - в VBIOS прописывается вендором/OEM-ом обычно) - все это портит, получается что все работает - но со скоростью затычки для слота. И радости с того? А документации на реклок в открытом джоступе нет, фирмварь обложили через SecureBoot, так что открытые прошивки перестали работать, что хотите то и делайте, дорогие опенсорсеры. А вот в модуле все это, по идее, должно быть.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'DejaVu LGC Sans'; font-size:12pt;"><br /></p></body></html>