<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Lemon появился, когда разработчиков SQLite не устроил код, сгенерированный GNU Bison. Генератор парсеров Lemon создаёт более чистый и простой парсер, который лучше обрабатывает переполнение стека и другие исключительные случаи, более удобен в многопоточной и объектно-ориентированной средах.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" font-style:italic; color:#323232;">Пример к статье </span><a href="https://github.com/sergey-shambir/lemon-parser-generator"><span style=" font-style:italic; text-decoration: underline; color:#2a7ae2;">доступен на github</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<h2 align="center" style=" margin-top:32px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><a name="wow0"></a><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">Ч</span><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">то такое Lemon parser generator?</span></h2>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Lemon — генератор синтаксических анализаторов (parser generator), разработанный автором СУБД SQLite (Dr. Richard Hipp), и доступный без лицензии как общественное достояние. Генераторы парсеров генерируют код автомата для</span><span style=" color:#000000;"> </span><a href="https://ps-group.github.io/compilers/shift_reduce"><span style=" text-decoration: underline; color:#2a7ae2;">восходящего разбора по принципу сдвига и свёртки (shift-reduce)</span></a><span style=" color:#000000;">.</span></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Ещё до появления Lemon использовались генераторы парсеров UNIX Yacc и GNU Bison. Они не устроили автора SQLite, и он написал в целом похожий на GNU Bison генератор парсеров, учитывая прошлые ошибки проектирования:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px;">Bison и Yacc генерируют блокирующую функцию разбора, которая при вызове хочет получать весь файл сразу путём последовательного запроса токенов. Но в интерпретаторе SQL этого файла ещё просто нет, есть только отдельные строки!</span></li>
<li style=" color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px;">Bison и Yacc не позволяют выполнить указанный программистом код при выбрасывании значения из стека автомата, что может спровоцировать утечки памяти, если в стеке лежат указатели.</span></li>
<li style=" color:#000000;" style=" margin-top:0px; margin-bottom:15px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px;">Bison и Yacc генерируют не самый удобный и чистый код на C</span></li></ul>
<h2 align="center" style=" margin-top:32px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><a name="wow1"></a><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">У</span><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">становка</span></h2>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Lemon состоит из двух файлов в исходниках SQLite:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px; background-color:#fefefe;">lemon.c</span></li>
<li style=" color:#000000;" style=" margin-top:0px; margin-bottom:15px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:16px; background-color:#fefefe;">lempar.c</span></li></ul>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Эти файлы можно собрать в программу любым удобным способом для Windows, Linux или OSX.</span></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Есть проект на github, предоставляющий готовый проект Visual Studio для lemon:</span><span style=" color:#000000;"> </span><a href="https://github.com/deplinenoise/lemon-win32"><span style=" text-decoration: underline; color:#2a7ae2;">github.com/deplinenoise/lemon-win32</span></a><span style=" color:#000000;">. Собранный lemon.exe нужно положить в каталог, добавленный в переменную окружения “PATH”, и просто начать использовать.</span></p>
<h2 align="center" style=" margin-top:32px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><a name="wow2"></a><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">И</span><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">нтерфейс командной строки</span></h2>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Синтаксис вызова lemon следующий:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">lemon &lt;опции&gt; &lt;входной файл *.y или *.lemon&gt;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Список опций командной строки:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">  -c           Не применять сжатие к таблице контекстных действий правил.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">  -D&lt;string&gt;   Объявить макрос, используемый в директивах %ifdef.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">  -g           Генерировать парсер грамматики без контекстных действий.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">  -m           Генерировать файл, совместимый с makeheaders.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">  -l           Не добавлять в код директивы #line.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">  -p           Печатать конфликты, решённые автоматически за счёт приоритета операторов</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">  -q           (Тихий режим) не записывать файл отчёта Grammar.out</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">  -b           Печатать в отчёте (файл Grammar.out) только ключевую информацию.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">  -r           Не сортировать и не менять номера состояний</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">  -s           Распечатать в консоль статистику сгенерированного парсера.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">  -x           Распечатать версию утилиты.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">  -T&lt;string&gt;   Указать свой файл-шаблон для генератора кода.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">  -f&lt;string&gt;   Игнорируется. (Заготовка на будущее для опций компилятора '-f')</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">  -I&lt;string&gt;   Игнорируется. (Заготовка на будущее для опций компилятора '-I')</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">  -O&lt;string&gt;   Игнорируется. (Заготовка на будущее для опций компилятора '-O')</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">  -W&lt;string&gt;   Игнорируется. (Заготовка на будущее для опций компилятора '-W')</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" font-style:italic; color:#323232;">Подробнее об утилите makeheaders сказано здесь: </span><a href="http://www.hwaci.com/sw/mkhdr/"><span style=" font-style:italic; text-decoration: underline; color:#2a7ae2;">hwaci.com/sw/mkhdr/</span></a><span style=" font-style:italic; color:#323232;">.</span></p>
<h2 align="center" style=" margin-top:32px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><a name="wow3"></a><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">О</span><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">пределение грамматики</span></h2>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Описание грамматики составляется в файле с расширением “</span><span style=" font-style:italic; color:#000000;">.y” либо “</span><span style=" color:#000000;">.lemon”. Файл содержит список директив и правил грамматики, с помощью которых можно собрать дерево разбора либо абстрактное синтаксическое дерево, как только парсер получит извне последовательность токенов. Некоторые правила грамматики содержат императивные действия, заключённые в фигурные скобки:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">// Разрешены однострочные комментарии в стиле C++</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">// Все директивы начинаются с символа %</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">%name ParseCalcGrammar</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">// Код в блоке директивы include попадёт в начало генерируемого файла &quot;*.c&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">%include {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">#include &quot;Token.h</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">#include &quot;CalcParser.h&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">#include &lt;assert.h&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">#include &lt;math.h&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">} // end %include</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">translation_unit ::= expression(A).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    // В фигурных скобках находится императивный код,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    //  срабатывающий в момент свёртки символов по правилу</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    pParse-&gt;PrintResult(A.value);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Действия в фигурных скобках могут ссылаться на терминальные и нетерминальные символы, используя нотацию вида</span><span style=" color:#000000;"> </span><span style=" color:#000000; background-color:#fefefe;">expression(A)</span><span style=" color:#000000;"> для придания символу имени </span><span style=" color:#000000; background-color:#fefefe;">A</span><span style=" color:#000000;">, или любого другого имени. Когда правило грамматики однозначно распознаётся, оно “сворачивается”, а связанное действие выполняется. Если быть точным, исходный код действия копируется в сгенерированный код парсера, попадая внутрь какого-то блока кода внутри функции Parse, и получая доступ к именованным символам, терминальным и нетерминальным. Задача действия — прочитать значения ячеек стека, соответствующих символам в правой части правила, и заполнить ячейку стека, соответствующую конструируемому символу в левой части.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><img src="image1620895457xrk3bksixz.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><br /></p>
<h3 align="center" style=" margin-top:24px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><a name="wow4"></a><span style=" font-size:large; font-weight:600; color:#000000; background-color:#fefefe;">Р</span><span style=" font-size:large; font-weight:600; color:#000000; background-color:#fefefe;">азделение на токены</span></h3>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">На первом шаге разбора формальных языков текст разбивается на лексические токены. Вы можете выполнять этот шаг любым удобным способом, и Lemon в этом не помощник — он всего лишь объявляет целочисленные идентификаторы токенов для каждого терминального символа, описанного в грамматике. Ядро сгенерированного парсера ожидает, что токены поступают один за другим последовательно, формируя виртуальный (либо реальный) поток токенов, которые и разбираются по грамматике.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><img src="image1620895475mw8f54qb7n.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Задача лексера/сканнера — создать поток токенов. Каждая категория токенов имеет свой идентификатор, такой как TOK_LEFT_PAREN, TOK_CLASS_KEYWORD и другие. Каждый токен имеет связанное с ним значение, дополняющее идентификатор токена. Примером служит, например, токен TOK_NUMBER со значением “1234”. Все токены используют один и тот же тип для хранения своих значений, и этот тип определён директивой</span><span style=" color:#000000;"> </span><span style=" color:#000000; background-color:#fefefe;">%token_type</span><span style=" color:#000000;"> (по умолчанию </span><span style=" color:#000000; background-color:#fefefe;">int</span><span style=" color:#000000;">). Дополнительная информация о токене может выглядеть так:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#pragma once</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-weight:600; color:#999999; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#000000; background-color:#ffffff;">struct</span><span style=" color:#000000; background-color:#ffffff;"> Token</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Позиция в исходном коде.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">unsigned</span><span style=" color:#000000; background-color:#ffffff;"> position;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Числовое значение литерала (0 для остальных токенов).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">double</span><span style=" color:#000000; background-color:#ffffff;"> value;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">};</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<h3 align="center" style=" margin-top:24px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><a name="wow5"></a><span style=" font-size:large; font-weight:600; color:#000000; background-color:#fefefe;">В</span><span style=" font-size:large; font-weight:600; color:#000000; background-color:#fefefe;">осходящий разбор в стиле shift-reduce</span></h3>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Более низкоуровневое правило грамматики должно сворачиваться раньше, чем более высокоуровневое правило. То есть, с точки зрения деревьев разбора грамматики, листовые узлы создаются перед родительскими узлами. Поэтому действия правил должны придерживаться стратегии передачи значений из листовых узлов в родительские узлы. В процедурном стиле этого можно добиться, используя обобщённую структуру, представляющую узел дерева. Например, для простой грамматики калькулятора подойдёт такая структура:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#000000; background-color:#ffffff;">struct</span><span style=" color:#000000; background-color:#ffffff;"> Expression</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">double</span><span style=" color:#000000; background-color:#ffffff;"> value; </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// числовое значение</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">int</span><span style=" color:#000000; background-color:#ffffff;"> operationNo; </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// идентификатор операции +, -, *, / или %</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    Expression </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">pLeft; </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// необязательный левый дочерний  узел</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    Expression </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">pRight; </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// необязательный правый дочерний узел</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">};</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">В объектно-ориентированном стиле принят паттерн, известный как Abstract Syntax Tree. Вместо универсальной структуры, описывающей узел разбора, используются конкретные классы, наследуемые от одного или нескольких базовых интерфейсов: IExpressionAst, IStatementAst, IDeclarationAst.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">interface IExpression</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">double</span><span style=" color:#000000; background-color:#ffffff;"> Evaluate(RuntimeEnvironment </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&amp;</span><span style=" color:#000000; background-color:#ffffff;">env) </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#009999; background-color:#ffffff;">0</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">};</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#000000; background-color:#ffffff;">class</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">BinaryOperationNode</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">:</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">public</span><span style=" color:#000000; background-color:#ffffff;"> IExpression</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#000000; background-color:#ffffff;">public:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// в свойствах класса - информация об операторе и двух операндах,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  также имеющих тип IExpression</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">};</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#000000; background-color:#ffffff;">class</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">LiteralNode</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">:</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">public</span><span style=" color:#000000; background-color:#ffffff;"> IExpression</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#000000; background-color:#ffffff;">public:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// в свойствах класса - тип и значение литерала</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">};</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#000000; background-color:#ffffff;">class</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">IdentifierNode</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">:</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">public</span><span style=" color:#000000; background-color:#ffffff;"> IExpression</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#000000; background-color:#ffffff;">public:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// в свойствах класса - строковое имя и указатель на объект,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  на который ссылается идентификатор</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">};</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><img src="image1620895494tbi6gx76sh.png" /></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><br /></p>
<h2 align="center" style=" margin-top:32px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><a name="wow6"></a><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">П</span><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">роцедурный интерфейс генерируемого кода</span></h2>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Все типы токенов в Lemon получают целочисленные идентификаторы, представленные как набор макросов. Для управления генерацией имён макросов в lemon есть директива “token_prefix”. Директива “token_type” указывает строку, которая будет именем типа токена.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">// All token codes are small integers with #defines that begin with &quot;TK_&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">%token_prefix TK_</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">// The type of the data attached to each token is Token.  This is also the</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">// default type for non-terminals.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">//</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">%token_type {Token}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">%default_type {Token}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Предполагаем, что структура Token объявлена в “Token.h”:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#pragma once</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-weight:600; color:#999999; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#000000; background-color:#ffffff;">struct</span><span style=" color:#000000; background-color:#ffffff;"> Token</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// position in source code.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">unsigned</span><span style=" color:#000000; background-color:#ffffff;"> position;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// token value (always 0 for most tokens).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">double</span><span style=" color:#000000; background-color:#ffffff;"> value;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">};</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Для языка C заменяем 'struct Token' на простой 'Token'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#000000; background-color:#ffffff;">typedef</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">struct</span><span style=" color:#000000; background-color:#ffffff;"> Token Token;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">После генерации набор токенов выглядит следующим образом:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Токен 0 зарезервирован под конец файла</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// enum не используется по историческим причинам.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#define TK_PLUS                             1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#define TK_MINUS                            2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#define TK_STAR                             3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#define TK_SLASH                            4</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#define TK_PERCENT                          5</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#define TK_LPAREN                           6</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#define TK_RPAREN                           7</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#define TK_NUMBER                           8</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-weight:600; color:#999999; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" font-style:italic; color:#323232;">Числовые значения токенов выбирает именно синтаксический анализатор, а не лексический. Дело в том, что для лексического анализатора токены — это выходные значения, и их изменение не меняет таблицу переходов в конечном автомате, который может быть внутри лексического анализатора. Для синтаксического анализатора токены становятся терминальными символами, и их числовые коды попадают в таблицу переходов парсера как входные сигналы автомата. Также в таблицу попадают числовые коды нетерминальных символов (объявленных в левой части правил грамматики).</span></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Lemon генерирует код, который позволяет держать в памяти множество парсеров одновременно, и использовать их по мере поступления токенов. Эта особенность очень важна для СУБД SQLite, которая обрабатывает SQL-код из множества присоединившихся клиентов. Имена сгенерированных функций зависят от директивы “name”. Пример использования директивы:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">// The name of the generated procedure that implements the parser</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">// is as follows:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">%name ParseCalcGrammar</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">В данном случае процедурный интерфейс парсера будет выглядеть так:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">ParseCalcGrammarAlloc(</span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">(</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">mallocProc)(</span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">size_t</span><span style=" color:#000000; background-color:#ffffff;">));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> ParseCalcGrammar(</span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">, </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">int</span><span style=" color:#000000; background-color:#ffffff;">, Token);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> ParseCalcGrammarFree(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">  </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">parser,               </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">/* The parser to be deleted */</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">  </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> (</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">freeProc)(</span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">)     </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">/* Function used to reclaim memory */</span><span style=" color:#000000; background-color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#ifndef NDEBUG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> ParseCalcGrammarTrace(</span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">FILE</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;"> TraceFILE, </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">char</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;"> zTracePrompt);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#endif</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-weight:600; color:#999999; background-color:#ffffff;"><br /></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px;">Функция “ParseCalcGrammarAlloc” создаёт новое состояние парсера подобно конструкторам в C++, и она принимает “mallocProc” — указатель на функцию, выделяющую память</span></li>
<li style=" color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px;">Функция “ParseCalcGrammar” получает на вход токен и продвигает состояние shift-reduce парсера вперёд на один shift и несколько reduce</span></li>
<li style=" color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px;">Функция “ParseCalcGrammarFree” работает как деструктор, очищая состояние парсера и затем удаляя его через предоставленную функцию освобождения памяти “freeProc”</span></li>
<li style=" color:#000000;" style=" margin-top:0px; margin-bottom:15px; margin-left:30px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18px;">В отладочном режиме сборки также доступна функция “ParseCalcGrammarTrace”, которая устанавливает файл, куда lemon будет записывать отладочную информацию. Нетрудно догадаться, что для вывода отладочной информации в консоль достаточно передать вместо файла объект “stderr” или “stdout”.</span></li></ul>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Контекстные действия, добавленные к правилам грамматики, будут встроены в функцию ParseCalcGrammar вперемешку с генерируемым кодом парсера. Возникает вопрос — как из действий обратиться к остальным объектам программы, если в функции ParseCalcGrammar доступны лишь параметры этой функции? Для проброса внешнего контекста в функцию ParseCalcGrammar предназначена директива “extra_argument”, позволяющая избегать использования глобальных переменных (тем самым позволяя иметь множество объектов-парсеров, существующих и работающих совместно).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// The generated parser function takes a 4th argument as follows:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#000000; background-color:#ffffff;">%</span><span style=" color:#000000; background-color:#ffffff;">extra_argument {ParserState </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">pState}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Теперь в контекстных действиях правил будет доступна переменная “pState”, а сигнатура функции ParseCalcGrammar изменится:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> ParseCalcGrammar(</span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">, </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">int</span><span style=" color:#000000; background-color:#ffffff;">, Token, ParserState </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<h2 align="center" style=" margin-top:32px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><a name="wow7"></a><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">О</span><span style=" font-size:x-large; font-weight:600; color:#000000; background-color:#fefefe;">бъектный фасад к процедурному коду</span></h2>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">В ООП принято привязывать методы к объекту. В языке C++ каждый метод к тому же получает неявный параметр this. В то же время lemon генерирует процедурный код на языке C89 (совместимый с C++). Превратить неудобный процедурный интерфейс в удобный объектно-ориентированный можно с помощью шаблона проектирования “Фасад”. Рассмотрим, как это сделать.</span></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">В первую очередь, следует заставить lemon выдать код на языке C++. Генератор lemon умеет генерировать только код на C89, но ничто не мешает просто переименовать файл из “</span><span style=" font-style:italic; color:#000000;">.c” в “</span><span style=" color:#000000;">.cpp”. Сделать это можно с помощью Shell-скрипта для Linux/OSX либо аналогичного Bat-скрипта для Windows:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">#!/usr/bin/env bash</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-style:italic; color:#999988; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;"># Опции командной строки lemon:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;"># -q (Quite) чтобы избежать вывода отчёта о генерации кода в CalcGrammar.out</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;"># -l чтобы не добавлять директивы препроцессора #line при генерации кода</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;"># -s чтобы написать краткую сводку о результатах генерации парсера</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">lemon </span><span style=" color:#000080; background-color:#ffffff;">-q</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#000080; background-color:#ffffff;">-s</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#000080; background-color:#ffffff;">-l</span><span style=" color:#000000; background-color:#ffffff;"> CalcGrammar.lemon</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">rm </span><span style=" color:#000080; background-color:#ffffff;">-f</span><span style=" color:#000000; background-color:#ffffff;"> CalcGrammar.cpp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">mv CalcGrammar.c CalcGrammar.cpp</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Интерфейс класса будет выглядеть следующим образом:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">#pragma once</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">struct Token;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">/// Фасад для созданного утилитой lemon парсера,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">///  предоставляющий объектно-ориентированный интерфейс</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">class ICalcParser</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">public:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    virtual ~ICalcParser() = default;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    virtual bool Advance(int tokenId, Token const&amp; tokenData) = 0;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">#ifndef NDEBUG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    virtual void StartDebugTrace(FILE *output) = 0;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">#endif</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">};</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">Реализация будет содержать ещё несколько публичных методов, необходимых для внутренних целей парсера: из кода, сгенерированного lemon, мы можем обращаться к классу CCalcParser только через публичные методы. Чтобы передавать нужную информацию в CCalcParser, следует модифицировать грамматику:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Сгенерированная функция продвижения состояния парсера будет принимать 4-й аргумент</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#000000; background-color:#ffffff;">%</span><span style=" color:#000000; background-color:#ffffff;">extra_argument {CCalcParser </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">pParse}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Этот блок кода запускается при синтаксической ошибке.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#000000; background-color:#ffffff;">%</span><span style=" color:#000000; background-color:#ffffff;">syntax_error {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    (</span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;">)yymajor; </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// глушим предупреждения.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    pParse</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">OnError(TOKEN); </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// переменная TOKEN имеет тип, указанный в директиве '%token_type'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Этот блок кода запускается при переполнении стека LALR-парсера</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#000000; background-color:#ffffff;">%</span><span style=" color:#000000; background-color:#ffffff;">stack_overflow {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    (</span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;">)yypMinor; </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// глушим предупреждения.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    pParse</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">OnStackOverflow();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Деструктор будет выполняться перед выбросом токена со стека,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  в данном случае мы просто глушим предупреждения.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#000000; background-color:#ffffff;">%</span><span style=" color:#000000; background-color:#ffffff;">token_destructor {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    (</span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;">)yypParser;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    (</span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;">)yypminor;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    (</span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;">)pParse;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">translation_unit </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::=</span><span style=" color:#000000; background-color:#ffffff;"> expression(A).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Печатаем результат выражения</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    pParse</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;">PrintResult(A.value);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">С учётом изменений в грамматике, реализация интерфейса ICalcParser будет выглядеть так:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#pragma once</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#include &quot;ICalcParser.h&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-weight:600; color:#999999; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#include &lt;string&gt;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-weight:600; color:#999999; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#000000; background-color:#ffffff;">struct</span><span style=" color:#000000; background-color:#ffffff;"> Token;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#000000; background-color:#ffffff;">class</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">CCalcParser</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">:</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">public</span><span style=" color:#000000; background-color:#ffffff;"> ICalcParser</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#000000; background-color:#ffffff;">public:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    CCalcParser();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">~</span><span style=" color:#000000; background-color:#ffffff;">CCalcParser();</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">bool</span><span style=" color:#000000; background-color:#ffffff;"> Advance(</span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">int</span><span style=" color:#000000; background-color:#ffffff;"> tokenId, Token </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">const&amp;</span><span style=" color:#000000; background-color:#ffffff;"> tokenData) </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">final</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#ifndef NDEBUG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> StartDebugTrace(</span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">FILE</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">output) </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">final</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#endif</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-weight:600; color:#999999; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> OnError(Token </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">const&amp;</span><span style=" color:#000000; background-color:#ffffff;"> token);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> OnStackOverflow();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> PrintResult(</span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">double</span><span style=" color:#000000; background-color:#ffffff;"> value);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#000000; background-color:#ffffff;">private:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#ifndef NDEBUG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Префиксом отладочных сообщений владеет C++ код,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  даже если префикс - пустая строка</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">string m_tracePrompt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#endif</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">bool</span><span style=" color:#000000; background-color:#ffffff;"> m_isErrorState </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#0086b3; background-color:#ffffff;">false</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">m_parser </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#0086b3; background-color:#ffffff;">nullptr</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">};</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#fefefe;"><span style=" color:#000000; background-color:#fefefe;">При создании фасада мы не будем трогать генерируемые файлы “CalcGrammar.h” и “CalcGrammar.cpp”. Чтобы использовать функции из “CalcGrammar.cpp”, достаточно сделать эквивалентные объявления функций и использовать их — реализации функций будут подставлены в на стадии компоновки. Это позволяет создать реализацию фасада парсера:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#include &quot;CalcParser.h&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#include &quot;Token.h&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#include &lt;stdlib.h&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#include &lt;new&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#include &lt;iostream&gt;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-weight:600; color:#999999; background-color:#ffffff;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-weight:600; color:#999999; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// pre-declaration of generated functions.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">ParseCalcGrammarAlloc(</span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">(</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">mallocProc)(</span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">size_t</span><span style=" color:#000000; background-color:#ffffff;">));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> ParseCalcGrammar(</span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">, </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">int</span><span style=" color:#000000; background-color:#ffffff;">, Token, CCalcParser</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> ParseCalcGrammarFree(</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">  </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">p,                    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">/* The parser to be deleted */</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">  </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> (</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">freeProc)(</span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">)     </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">/* Function used to reclaim memory */</span><span style=" color:#000000; background-color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#ifndef NDEBUG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> ParseCalcGrammarTrace(</span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">FILE</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;"> TraceFILE, </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">char</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;"> zTracePrompt);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#endif</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-weight:600; color:#999999; background-color:#ffffff;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-weight:600; color:#999999; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">CCalcParser</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">CCalcParser()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Лямбда-функция allocate не захватывает переменных,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  и может быть преобразована в указатель на функцию</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">auto</span><span style=" color:#000000; background-color:#ffffff;"> allocate </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> [](</span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">size_t</span><span style=" color:#000000; background-color:#ffffff;"> size) </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;"> {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">return</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">new</span><span style=" color:#000000; background-color:#ffffff;"> (std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">nothrow) </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">char</span><span style=" color:#000000; background-color:#ffffff;">[size];</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    };</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    m_parser </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> ParseCalcGrammarAlloc(allocate);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">CCalcParser</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::~</span><span style=" color:#000000; background-color:#ffffff;">CCalcParser()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">// Лямбда-функция retain не захватывает переменных,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-style:italic; color:#999988; background-color:#ffffff;">//  и может быть преобразована в указатель на функцию</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">auto</span><span style=" color:#000000; background-color:#ffffff;"> retain </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> [](</span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">pointer) </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">-&gt;</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">auto</span><span style=" color:#000000; background-color:#ffffff;"> array </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">reinterpret_cast&lt;</span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">char</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*&gt;</span><span style=" color:#000000; background-color:#ffffff;">(pointer);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">        </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">delete</span><span style=" color:#000000; background-color:#ffffff;">[] array;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    };</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    ParseCalcGrammarFree(m_parser, retain);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#445588; background-color:#ffffff;">bool</span><span style=" color:#000000; background-color:#ffffff;"> CCalcParser</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">Advance(</span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">int</span><span style=" color:#000000; background-color:#ffffff;"> tokenId, </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">const</span><span style=" color:#000000; background-color:#ffffff;"> Token </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&amp;</span><span style=" color:#000000; background-color:#ffffff;">tokenData)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    ParseCalcGrammar(m_parser, tokenId, tokenData, </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">this</span><span style=" color:#000000; background-color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">return</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">!</span><span style=" color:#000000; background-color:#ffffff;">m_isErrorState;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#ifndef NDEBUG</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> CCalcParser</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">StartDebugTrace(</span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">FILE</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">*</span><span style=" color:#000000; background-color:#ffffff;">output)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    m_tracePrompt </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#dd1144; background-color:#ffffff;">&quot;&quot;</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    ParseCalcGrammarTrace(output, </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&amp;</span><span style=" color:#000000; background-color:#ffffff;">m_tracePrompt[</span><span style=" color:#009999; background-color:#ffffff;">0</span><span style=" color:#000000; background-color:#ffffff;">]);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#999999; background-color:#ffffff;">#endif</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-weight:600; color:#999999; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> CCalcParser</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">OnError(</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">const</span><span style=" color:#000000; background-color:#ffffff;"> Token </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&amp;</span><span style=" color:#000000; background-color:#ffffff;">token)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">cerr </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;&lt;</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#dd1144; background-color:#ffffff;">&quot;Syntax error at position &quot;</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;&lt;</span><span style=" color:#000000; background-color:#ffffff;"> token.position </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;&lt;</span><span style=" color:#000000; background-color:#ffffff;"> std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">endl;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    m_isErrorState </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#0086b3; background-color:#ffffff;">true</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> CCalcParser</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">OnStackOverflow()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">cerr </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;&lt;</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#dd1144; background-color:#ffffff;">&quot;LALR parser stack overflow occured.&quot;</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;&lt;</span><span style=" color:#000000; background-color:#ffffff;"> std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">endl;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    m_isErrorState </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">=</span><span style=" color:#000000; background-color:#ffffff;"> </span><span style=" color:#0086b3; background-color:#ffffff;">true</span><span style=" color:#000000; background-color:#ffffff;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-weight:600; color:#445588; background-color:#ffffff;">void</span><span style=" color:#000000; background-color:#ffffff;"> CCalcParser</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">PrintResult(</span><span style=" font-weight:600; color:#445588; background-color:#ffffff;">double</span><span style=" color:#000000; background-color:#ffffff;"> value)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">    std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">cerr </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;&lt;</span><span style=" color:#000000; background-color:#ffffff;"> value </span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">&lt;&lt;</span><span style=" color:#000000; background-color:#ffffff;"> std</span><span style=" font-weight:600; color:#000000; background-color:#ffffff;">::</span><span style=" color:#000000; background-color:#ffffff;">endl;</span></p>
<p style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" color:#000000; background-color:#ffffff;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; color:#000000; background-color:#ffffff;"><br /></p></body></html>