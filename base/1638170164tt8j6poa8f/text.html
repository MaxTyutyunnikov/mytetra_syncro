<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14pt; font-weight:600;">Массовая настройка и установка значений пинов</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вместо медленного вызова функций digitalWrite() для установки значения каждого пина по отдельности, можно устанавливать значения цифровых пинов сразу для группы из 8 пинов. Делается это следующим кодом:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">void setup()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">  DDRD = B11111111; // Установка всех ножек порта D (digital 7~0) в режим OUTPUT</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">void loop()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">  PORTD = B11111111; // Установка значений всех пинов порта D (digital 7~0) в HIGH</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">  PORTD = B00000000; // Установка значений всех пинов порта D (digital 7~0) в LOW</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:14pt; font-weight:600;">Настройка и установка единичных пинов</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Пример, как установить отдельный вывод PB5 как выход:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">DDRB |= (1 &lt;&lt; 5); // вывод PB5 как выход (OUTPUT)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Пример периодической установки нуля и единицы на выводе PB5:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">while (1) {</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">    PORTB &amp;= ~(1 &lt;&lt; 5); // низкий уровень (0) на выводе PB5</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">    _delay_ms(1000);    // задержка 1000 миллисекунд </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">    PORTB |= (1 &lt;&lt; 5);  // высокий уровень (1) на выводе PB5</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">    _delay_ms(1000);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">}</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:15pt; font-weight:600;">Обозначения портов и управляющих регистров</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" color:#111111; background-color:#ffffff;">Каждый порт микроконтроллера AVR (обычно имеют имена A, B и иногда C или даже D) имеет 8 разрядов, каждый из которых привязан к определенной ножке корпуса. Каждый порт имеет три специальных регистра </span><span style=" font-weight:600;">DDRx</span>, <span style=" font-weight:600;">PORTx</span> и <span style=" font-weight:600;">PINx</span> (где x соответствует букве порта A, B, C или D). Назначение регистров:<span style=" color:#111111;"><br /><br /></span><span style=" font-weight:600; color:#111111; background-color:#ffffff;">DDRx</span><span style=" color:#111111; background-color:#ffffff;"> – Настройка разрядов порта x на вход или выход.</span><span style=" color:#111111;"><br /><br /></span><span style=" font-weight:600; color:#111111; background-color:#ffffff;">PORTx</span><span style=" color:#111111; background-color:#ffffff;"> – Управление состоянием выходов порта x (если соответствующий разряд настроен как выход), или подключением внутреннего pull-up резистора (если соответствующий разряд настроен как вход).</span><span style=" color:#111111;"><br /><br /></span><span style=" font-weight:600; color:#111111; background-color:#ffffff;">PINx</span><span style=" color:#111111; background-color:#ffffff;"> –Чтение логических уровней разрядов порта x.</span><span style=" color:#111111;"><br /><br /></span><span style=" font-weight:600; color:#111111; background-color:#ffffff;">PINхn</span><span style=" color:#111111; background-color:#ffffff;"> – это регистр чтения. Из него можно только читать. В регистре </span><span style=" font-weight:600; color:#111111; background-color:#ffffff;">PINxn</span><span style=" color:#111111; background-color:#ffffff;"> содержится информация о реальном текущем логическом уровне на выводах порта. Вне зависимости от настроек порта. Так что если хотим узнать что у нас на входе — читаем соответствующий бит регистра </span><span style=" font-weight:600; color:#111111; background-color:#ffffff;">PINxn</span><span style=" color:#111111; background-color:#ffffff;">. Причем существует две границы: граница гарантированного нуля и граница гарантированной единицы — пороги за которыми мы можем однозначно четко определить текущий логический уровень. Для пятивольтового питания это 1.4 и 1.8 вольт соответственно. То есть при снижении напряжения от максимума до минимума бит в регистре </span><span style=" font-weight:600; color:#111111; background-color:#ffffff;">PINx</span><span style=" color:#111111; background-color:#ffffff;"> переключится с 1 на 0 только при снижении напряжение ниже 1.4 вольт, а вот когда напряжение нарастает от минимума до максимума переключение бита с 0 на 1 будет только по достижении напряжения в 1.8 вольта. То есть возникает гистерезис переключения с 0 на 1, что исключает хаотичные переключения под действием помех и наводок, а также исключает ошибочное считывание логического уровня между порогами переключения.</span><span style=" color:#111111;"><br /><br /></span><span style=" color:#111111; background-color:#ffffff;">При снижении напряжения питания, разумеется, эти пороги также снижаются.</span><span style=" color:#111111;"><br /><br /></span><span style=" font-weight:600; color:#111111; background-color:#ffffff;">DDRxn</span><span style=" color:#111111; background-color:#ffffff;"> – это регистр направления порта. Порт в конкретный момент времени может быть либо входом либо выходом (но для состояния битов PINxn это значения не имеет. Читать из </span><span style=" font-weight:600; color:#111111; background-color:#ffffff;">PINxn</span><span style=" color:#111111; background-color:#ffffff;"> реальное значение можно всегда).</span><span style=" color:#111111;"><br /><br /></span><span style=" font-style:italic; color:#111111; background-color:#ffffff;">DDRxy</span><span style=" color:#111111; background-color:#ffffff;"> = 0 – вывод работает как ВХОД.</span><span style=" color:#111111;"><br /><br /></span><span style=" font-style:italic; color:#111111; background-color:#ffffff;">DDRxy</span><span style=" color:#111111; background-color:#ffffff;"> = 1 – вывод работает на ВЫХОД.</span><span style=" color:#111111;"><br /><br /></span><span style=" font-weight:600; color:#111111; background-color:#ffffff;">PORTxn</span><span style=" color:#111111; background-color:#ffffff;"> – режим управления состоянием вывода. Когда мы настраиваем вывод на вход, то от </span><span style=" font-weight:600; color:#111111; background-color:#ffffff;">PORTх</span><span style=" color:#111111; background-color:#ffffff;"> зависит тип входа (Hi-Z или PullUp, об этом чуть ниже).</span><span style=" color:#111111;"><br /><br /></span><span style=" color:#111111; background-color:#ffffff;">Когда ножка настроена на выход, то значение соответствующего бита в регистре </span><span style=" font-weight:600; color:#111111; background-color:#ffffff;">PORTx</span><span style=" color:#111111; background-color:#ffffff;"> определяет состояние вывода. Если </span><span style=" font-weight:600; color:#111111; background-color:#ffffff;">PORTxn</span><span style=" color:#111111; background-color:#ffffff;">=1 то на выводе лог.1, если </span><span style=" font-weight:600; color:#111111; background-color:#ffffff;">PORTxn</span><span style=" color:#111111; background-color:#ffffff;">=0 то на выводе лог.0.</span><span style=" color:#111111;"><br /><br /></span><span style=" color:#111111; background-color:#ffffff;">Когда ножка настроена на вход, то если </span><span style=" font-weight:600; color:#111111; background-color:#ffffff;">PORTxn</span><span style=" color:#111111; background-color:#ffffff;">=0, то вывод в режиме Hi-Z. Если </span><span style=" font-weight:600; color:#111111; background-color:#ffffff;">PORTxn</span><span style=" color:#111111; background-color:#ffffff;">=1 то вывод в режиме PullUpс подтяжкой резистором в 100к до питания.</span><span style=" color:#111111;"><br /><br /></span><span style=" color:#111111; background-color:#ffffff;">Таблица. Конфигурация выводов портов.</span><span style=" color:#111111;"><br /><br /></span><span style=" color:#111111; background-color:#ffffff;">DDRxn PORTxn I/O Comment</span><span style=" color:#111111;"><br /></span><span style=" color:#111111; background-color:#ffffff;">0 0 I (Input) Вход Высокоимпендансный вход. (Не рекомендую использовать, так как могут наводится наводки от питания)</span><span style=" color:#111111;"><br /></span><span style=" color:#111111; background-color:#ffffff;">0 1 I (Input) Вход Подтянуто внутренне сопротивление.</span><span style=" color:#111111;"><br /></span><span style=" color:#111111; background-color:#ffffff;">1 0 O (Output) Выход На выходе низкий уровень.</span><span style=" color:#111111;"><br /></span><span style=" color:#111111; background-color:#ffffff;">1 1 O (Output) Выход На выходе высокий уровень.</span> </p></body></html>