<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Удивительно, но в <span style=" font-family:'FreeMono'; color:#6a1009;">QGraphicsScene</span> не предусмотрено такой простой, казалось бы вещи, как отрисовка ломанной линии. Есть отрисовка прямых линий между двумя точками, эллипсов, прямоугольников, произвольных полигонов, картинок. Но нет явного механизма для отрисовки ломанной линии. Что делать?</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Одно из решений такое:</span> создать собственный класс <span style=" font-family:'FreeMono'; color:#6a1009;">BreakLines</span>, унаследованный от <span style=" font-family:'FreeMono'; color:#6a1009;">QGraphicsItemGroup</span>, который будет содержать внутри себя несколько <span style=" font-family:'FreeMono'; color:#6a1009;">QGraphicsLineItem</span>. Каждый элемент <span style=" font-family:'FreeMono'; color:#6a1009;">QGraphicsLineItem</span> - это один из сегментов ломанной линии. Объект класса <span style=" font-family:'FreeMono'; color:#6a1009;">BreakLines</span> можно положить на <span style=" font-family:'FreeMono'; color:#6a1009;">QGraphicsScene</span> с помощью метода <span style=" font-family:'FreeMono'; color:#6a1009;">addItem()</span>.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Но неужели нельзя сделать проще? Ведь произвольный полигон, например класса <span style=" font-family:'FreeMono'; color:#6a1009;">QPolygon</span> - это и есть ломанная линия, только замкнутая. Может быть, можно нарисовать полигон незамкнутым? Может быть, у полигона есть установка свойств замкнутости/незамкнутости? Читаем документацию, и видим, что такой возможности нет.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">И все-таки существует достаточно простой способ поместить на <span style=" font-family:'FreeMono'; color:#6a1009;">QGraphicsScene</span> ломанную линию. В Qt есть класс <span style=" font-family:'FreeMono'; color:#6a1009;">QPainterPath</span>, который является представлением незамкнутого контура. У этого класса есть одна маленькая проблема: начальную точку надо задавать методом <span style=" font-family:'FreeMono'; color:#6a1009;">moveTo()</span>, а последующие точки добавляются методом <span style=" font-family:'FreeMono'; color:#6a1009;">lineTo()</span>. Нельзя просто так создать объект незамкнутого контура и просто напихать в него координаты точек, чтобы по ним нарисовалась ломанная линия (иногда необходим именно такой подход).</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Решение следующее: у <span style=" font-family:'FreeMono'; color:#6a1009;">QPolygon</span> есть конструктор, который принимает <span style=" font-family:'FreeMono'; color:#6a1009;">QVector&lt;QPoint&gt;</span>, то есть набор координат точек ломанной линии. А у <span style=" font-family:'FreeMono'; color:#6a1009;">QPainterPath</span> есть метод <span style=" font-family:'FreeMono'; color:#6a1009;">addPolygon()</span>. Совместив все вместе получается простая методика размещения ломанной линии на сценграфе:</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">QVector&lt;QPoint&gt; points;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">points.append( QPoint(100,100));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">points.append( QPoint(250,250));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">points.append( QPoint(150,300));</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'FreeMono'; color:#6a1009;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">QPainterPath painterPath;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">painterPath.addPolygon( </span><span style=" font-family:'FreeMono'; color:#6a1009;">QPolygon(points)</span><span style=" font-family:'FreeMono'; color:#6a1009;"> );</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Sans Serif'; font-size:9pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">QGraphicsScene scene;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:20px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'FreeMono'; color:#6a1009;">scene.addPath( painterPath );</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вот таким образом рисуется ломанная линия в Qt.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p></body></html>